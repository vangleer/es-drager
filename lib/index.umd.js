(function(Y,s){typeof exports=="object"&&typeof module<"u"?s(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],s):(Y=typeof globalThis<"u"?globalThis:Y||self,s(Y.ESDrager={},Y.Vue))})(this,function(Y,s){"use strict";const se={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},maxWidth:{type:Number,default:0},maxHeight:{type:Number,default:0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean},checkCollision:{type:Boolean}};function K(n,o){const e=t=>{o&&o(t),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",n),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",n),document.addEventListener("touchend",e)}function _(n){let o=0,e=0;if(ie(n)){const t=n.targetTouches[0];o=t.pageX,e=t.pageY}else o=n.clientX,e=n.clientY;return{clientX:o,clientY:e}}function ie(n){const o=Object.prototype.toString.call(n);return o.substring(8,o.length-1)==="TouchEvent"}const T=(n=0)=>parseInt(n+"")+"px",j={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},O=["n","ne","e","se","s","sw","w","nw"],re={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},ae={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},le=(n,o)=>{const e=ae[Math.floor(n/30)],i=(re[o]+e)%8;return O[i]},F=(n=0,o)=>{let e=[];for(let t=0;t<O.length;t++){const i=O[t],[h,c]=j[i].split("-"),d=le(n,i),u={[h]:"0%",cursor:d+"-resize",side:j[i]};if(c)u[c]="0%";else{const y=["top","bottom"].includes(h)?"left":"top";u[y]="50%"}o?o.includes(j[i])&&e.push(u):e.push(u)}return e},U=n=>n*Math.PI/180,ce=(n,o)=>Math.sqrt(n*n+o*o),b=n=>Math.cos(U(n)),k=n=>Math.sin(U(n)),ue=(n,o,e,t,i,h,c)=>{let{width:d,height:u,centerX:y,centerY:v,rotateAngle:r}=o;const g=d<0?-1:1,m=u<0?-1:1;switch(d=Math.abs(d),u=Math.abs(u),n){case"right":{const l=x(d,e,h);d=l.width,e=l.deltaW,i?(t=e/i,u=d/i,y+=e/2*b(r)-t/2*k(r),v+=e/2*k(r)+t/2*b(r)):(y+=e/2*b(r),v+=e/2*k(r));break}case"top-right":{t=-t;const l=x(d,e,h);d=l.width,e=l.deltaW;const f=C(u,t,c);u=f.height,t=f.deltaH,i&&(e=t*i,d=u*i),y+=e/2*b(r)+t/2*k(r),v+=e/2*k(r)-t/2*b(r);break}case"bottom-right":{const l=x(d,e,h);d=l.width,e=l.deltaW;const f=C(u,t,c);u=f.height,t=f.deltaH,i&&(e=t*i,d=u*i),y+=e/2*b(r)-t/2*k(r),v+=e/2*k(r)+t/2*b(r);break}case"bottom":{const l=C(u,t,c);u=l.height,t=l.deltaH,i?(e=t*i,d=u*i,y+=e/2*b(r)-t/2*k(r),v+=e/2*k(r)+t/2*b(r)):(y-=t/2*k(r),v+=t/2*b(r));break}case"bottom-left":{e=-e;const l=x(d,e,h);d=l.width,e=l.deltaW;const f=C(u,t,c);u=f.height,t=f.deltaH,i&&(u=d/i,t=e/i),y-=e/2*b(r)+t/2*k(r),v-=e/2*k(r)-t/2*b(r);break}case"left":{e=-e;const l=x(d,e,h);d=l.width,e=l.deltaW,i?(u=d/i,t=e/i,y-=e/2*b(r)+t/2*k(r),v-=e/2*k(r)-t/2*b(r)):(y-=e/2*b(r),v-=e/2*k(r));break}case"top-left":{e=-e,t=-t;const l=x(d,e,h);d=l.width,e=l.deltaW;const f=C(u,t,c);u=f.height,t=f.deltaH,i&&(d=u*i,e=t*i),y-=e/2*b(r)-t/2*k(r),v-=e/2*k(r)+t/2*b(r);break}case"top":{t=-t;const l=C(u,t,c);u=l.height,t=l.deltaH,i?(d=u*i,e=t*i,y+=e/2*b(r)+t/2*k(r),v+=e/2*k(r)-t/2*b(r)):(y+=t/2*k(r),v-=t/2*b(r));break}}return{position:{centerX:y,centerY:v},size:{width:d*g,height:u*m}}},C=(n,o,e)=>{const t=n+o;return t>e?n=t:(o=e-n,n=e),{height:n,deltaH:o}},x=(n,o,e)=>{const t=n+o;return t>e?n=t:(o=e-n,n=e),{width:n,deltaW:o}},de=({centerX:n,centerY:o,width:e,height:t,angle:i})=>({top:o-t/2,left:n-e/2,width:e,height:t,angle:i}),he=(n,o,e)=>{const{width:t,height:i}=n;return{width:Math.abs(t),height:Math.abs(i),left:o-Math.abs(t)/2,top:e-Math.abs(i)/2}};function V(n,o){const e=Math.abs(n)%o,t=n>0?o:-o;let i=0;return e>o/2?i=t*Math.ceil(Math.abs(n)/o):i=t*Math.floor(Math.abs(n)/o),i}function fe(n,o){if(!n||!o)return!1;const e=n.getBoundingClientRect(),t=o.getBoundingClientRect();return e.left<t.left+t.width&&e.left+e.width>t.left&&e.top<t.top+t.height&&e.top+e.height>t.top}function ge(n,o,e,{getBoundary:t,fixBoundary:i,checkDragerCollision:h,emit:c}){let d=0,u=0;const y=r=>{let{left:g,top:m}=o.value;if(d||(d=g),u||(u=m),["ArrowRight","ArrowLeft"].includes(r.key)){const l=r.key==="ArrowRight";let f=l?1:-1;n.snapToGrid&&(f=l?n.gridX:-n.gridX),g=g+f}else if(["ArrowUp","ArrowDown"].includes(r.key)){const l=r.key==="ArrowDown";let f=l?1:-1;n.snapToGrid&&(f=l?n.gridY:-n.gridY),m=m+f}if(n.boundary){const[l,f,M,B]=t();[g,m]=i(g,m,l,f,M,B)}o.value.left=g,o.value.top=m,c("change",{...o.value})},v=r=>{["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(r.key)&&n.checkCollision&&h()&&(o.value.left=d,o.value.top=u),d=0,u=0};s.watch(e,r=>{n.disabledKeyEvent||(r?(document.addEventListener("keydown",y),document.addEventListener("keyup",v)):(document.removeEventListener("keydown",y),document.removeEventListener("keyup",v)))}),s.onBeforeUnmount(()=>{document.removeEventListener("keydown",y),document.removeEventListener("keyup",v)})}function me(n,o,e){const t=s.ref(!1),i=s.ref(!1),h=s.ref({width:o.width,height:o.height,left:o.left,top:o.top,angle:o.angle}),c=new Set;function d(g){if(c.add(g.button),o.disabled)return;t.value=!0,i.value=!0;let{clientX:m,clientY:l}=_(g);const{left:f,top:M}=h.value;let B=0,a=0,w=0,p=0;o.boundary&&([B,a,w,p]=u()),e&&e("drag-start",h.value),K(E=>{if(c.size>1)return;const{clientX:A,clientY:N}=_(E);let R=(A-m)/o.scaleRatio+f,X=(N-l)/o.scaleRatio+M;if(o.snapToGrid){let{left:S,top:I}=h.value;const q=R-S,z=X-I;R=S+V(q,o.gridX),X=I+V(z,o.gridY)}o.boundary&&([R,X]=y(R,X,B,a,w,p)),h.value.left=R,h.value.top=X,e&&e("drag",h.value)},E=>{o.checkCollision&&v()&&(h.value.top=M,h.value.left=f),c.clear(),t.value=!1,document.addEventListener("click",r,{once:!0}),e&&e("drag-end",h.value)})}const u=()=>{let g=0,m=0;const{left:l,top:f,height:M,width:B,angle:a}=h.value,p=(n.value.parentElement||document.body).getBoundingClientRect();if(a&&o.scaleRatio===1){const A=n.value.getBoundingClientRect();g=Math.abs(A.left-(l+p.left)),m=Math.abs(A.top-(f+p.top))}const L=p.width/o.scaleRatio-B,E=p.height/o.scaleRatio-M;return[g,L-g,m,E-m,p.width/o.scaleRatio,p.height/o.scaleRatio]},y=(g,m,l,f,M,B)=>(g=g<l?l:g,g=g>f?f:g,m=m<M?M:m,m=m>B?B:m,[g,m]),v=()=>{const g=n.value.parentElement||document.body,m=Array.from(g.children).filter(l=>l!==n.value&&l.classList.contains("es-drager"));for(let l=0;l<m.length;l++){const f=m[l];if(fe(n.value,f))return!0}},r=()=>{i.value=!1};return ge(o,h,i,{getBoundary:u,fixBoundary:y,checkDragerCollision:v,emit:e}),s.onMounted(()=>{if(n.value){if(!h.value.width&&!h.value.height){const{width:g,height:m}=n.value.getBoundingClientRect();h.value={...h.value,width:g||100,height:m||100},e("change",{...h.value})}n.value.addEventListener("mousedown",d),n.value.addEventListener("touchstart",d,{passive:!0})}}),{isMousedown:t,selected:i,dragData:h,getBoundary:u,checkDragerCollision:v}}const pe=s.createElementVNode("div",{class:"es-drager-rotate-handle"},[s.createElementVNode("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[s.createElementVNode("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),we=s.defineComponent({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(n,{emit:o}){const e=n,t=s.ref(null),i=s.computed({get:()=>e.modelValue,set:c=>{o("update:modelValue",c)}});function h(c){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");c.stopPropagation();const{width:d,height:u,left:y,top:v}=e.element.getBoundingClientRect(),r=y+d/2,g=v+u/2;o("rotate-start",i.value),K(m=>{const{clientX:l,clientY:f}=_(m),M=r-l,B=g-f,w=Math.atan2(B,M)*180/Math.PI-90;i.value=(w+360)%360,o("rotate",i.value)},()=>{o("rotate-end",i.value)})}return(c,d)=>(s.openBlock(),s.createElementBlock("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:h,onTouchstartPassive:h},[s.renderSlot(c.$slots,"default",{},()=>[pe])],544))}}),xe="",ye=["data-side","onMousedown","onTouchstartPassive"],ve=s.createElementVNode("div",{class:"es-drager-dot-handle"},null,-1),P=s.defineComponent({__name:"drager",props:se,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(n,{emit:o}){const e=n,t=(a,...w)=>{o(a,...w),o("change",...w)},i=s.ref(null),{selected:h,dragData:c,isMousedown:d,getBoundary:u,checkDragerCollision:y}=me(i,e,t),v=s.ref(F(0,e.resizeList)),r=s.computed(()=>e.resizable&&!e.disabled),g=s.computed(()=>e.rotatable&&!e.disabled&&h.value),m=s.computed(()=>{const{width:a,height:w,left:p,top:L,angle:E}=c.value,A={};return a&&(A.width=T(a)),w&&(A.height=T(w)),{...A,left:T(p),top:T(L),zIndex:e.zIndex,transform:`rotate(${E}deg)`,"--es-drager-color":e.color}});function l(a){i.value||(i.value=a.$el||a)}function f(a){v.value=F(a,e.resizeList),t("rotate-end",c.value)}function M(a,w){if(e.disabled)return;w.stopPropagation();const{clientX:p,clientY:L}=_(w),E=p,A=L,{width:N,height:R,left:X,top:S}=c.value,I=X+N/2,q=S+R/2,z={width:N,height:R,centerX:I,centerY:q,rotateAngle:c.value.angle},be=a.side,{minWidth:ke,minHeight:Me,aspectRatio:Q,equalProportion:Ee}=e;t("resize-start",c.value);let Z=[];e.boundary&&(Z=u()),K(H=>{const{clientX:Ae,clientY:Be}=_(H);let $=(Ae-E)/e.scaleRatio,G=(Be-A)/e.scaleRatio;e.snapToGrid&&($=V($,e.gridX),G=V(G,e.gridY));const Le=Math.atan2(G,$),W=ce($,G),Re=H.shiftKey,ee=Le-U(z.rotateAngle),Xe=W*Math.cos(ee),Ye=W*Math.sin(ee),te=(Ee||Re)&&!Q?z.width/z.height:Q,{position:{centerX:ne,centerY:oe},size:{width:ze,height:De}}=ue(be,{...z,rotateAngle:z.rotateAngle},Xe,Ye,te,ke,Me),Ce=de({centerX:ne,centerY:oe,width:ze,height:De,angle:c.value.angle});let D={...c.value,...he(Ce,ne,oe)};e.maxWidth>0&&(D.width=Math.min(D.width,e.maxWidth)),e.maxHeight>0&&(D.height=Math.min(D.height,e.maxHeight)),e.boundary&&(D=B(D,Z,te)),c.value=D,t("resize",c.value)},()=>{e.checkCollision&&y()&&(c.value={...c.value,width:N,height:R,left:X,top:S}),t("resize-end",c.value)})}function B(a,w,p){const[L,E,A,N,R,X]=w;return a.left<L&&(a.left=L,a.width=c.value.width,p&&(a.height=c.value.height)),a.left+a.width>R&&(a.left=c.value.left,a.width=R-a.left,p&&(a.height=c.value.height)),a.top<A&&(a.top=A,a.height=c.value.height,p&&(a.width=c.value.width)),a.top+a.height>X&&(a.top=c.value.top,a.height=X-a.top,p&&(a.width=c.value.width)),a}return s.watch(()=>[e.width,e.height,e.left,e.top,e.angle],([a,w,p,L,E])=>{c.value={...c.value,width:a,height:w,left:p,top:L,angle:E}}),s.watch(()=>e.selected,a=>{h.value=a},{immediate:!0}),(a,w)=>(s.openBlock(),s.createBlock(s.resolveDynamicComponent(a.tag),{ref:l,class:s.normalizeClass(["es-drager",{disabled:a.disabled,dragging:s.unref(d),selected:s.unref(h),border:a.border}]),style:s.normalizeStyle(m.value),onClick:w[3]||(w[3]=s.withModifiers(()=>{},["stop"]))},{default:s.withCtx(()=>[s.renderSlot(a.$slots,"default"),r.value?(s.openBlock(!0),s.createElementBlock(s.Fragment,{key:0},s.renderList(v.value,(p,L)=>(s.openBlock(),s.createElementBlock("div",{key:L,class:"es-drager-dot","data-side":p.side,style:s.normalizeStyle({...p}),onMousedown:E=>M(p,E),onTouchstartPassive:E=>M(p,E)},[s.renderSlot(a.$slots,"resize",s.normalizeProps(s.guardReactiveProps({side:p.side})),()=>[ve])],44,ye))),128)):s.createCommentVNode("",!0),g.value?(s.openBlock(),s.createBlock(we,{key:1,modelValue:s.unref(c).angle,"onUpdate:modelValue":w[0]||(w[0]=p=>s.unref(c).angle=p),element:i.value,onRotate:w[1]||(w[1]=p=>t("rotate",s.unref(c))),onRotateStart:w[2]||(w[2]=p=>t("rotate-start",s.unref(c))),onRotateEnd:f},{default:s.withCtx(()=>[s.renderSlot(a.$slots,"rotate")]),_:3},8,["modelValue","element"])):s.createCommentVNode("",!0)]),_:3},8,["class","style"]))}}),Ne="",J=n=>{n.component("es-drager",P)};P.install=J,Y.ESDrager=P,Y.default=P,Y.install=J,Object.defineProperties(Y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
