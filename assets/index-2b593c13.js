import{eO as ge,d as H,o as d,c as y,j as se,eJ as ue,i as S,n as T,F as $,_ as F,r as D,eP as fe,eQ as J,e as P,t as j,eR as te,eH as h,l,w as u,a as L,b as E,eI as Q,u as o,eS as de,eT as pe,m as K,eU as G,eK as Y,h as R,eV as X,eE as le,eW as he,eX as B,eY as ye,eZ as ve,e_ as ke,e$ as Ve,g as xe,f0 as we,f1 as Ce,f2 as Se,f3 as $e,f4 as Ue,f5 as Me,f6 as ze,f7 as Ee,f8 as Re,f9 as Le,eN as ie,fa as De,fb as He}from"./index-ebf099c7.js";import{E as O,G as Ie}from"./GridRect-85ee48cd.js";import{u as Te,A as Ae}from"./useArea-6069353b.js";import{u as Ne,$ as Oe,a as ce}from"./useEditorContainer-af051780.js";const Be=["fontSize","lineHeight","borderWidth","borderRadius"],me=["fontSize","fontWeight","fontFamily","color","lineHeight","fontStyle","textDecoration","justifyContent","alignItems"];function Z(i,e=!0){if(!i)return i;const s={},p=Object.keys(i).filter(t=>e?me.includes(t):!me.includes(t));for(const t of p)s[t]=Be.includes(t)?ge(i[t]):i[t];return s}function Pe(i,e){return Object.keys(i).reduce((s,p)=>(e.includes(p)||(s[p]=i[p]),s),{})}const je=H({__name:"MarkLine",props:{left:Number,top:Number},setup(i){return(e,s)=>(d(),y($,null,[se(S("div",{class:"es-editor-markline-left",style:T({left:i.left+"px"})},null,4),[[ue,i.left]]),se(S("div",{class:"es-editor-markline-top",style:T({top:i.top+"px"})},null,4),[[ue,i.top]])],64))}}),Ge=F(je,[["__scopeId","data-v-ce69b00a"]]),We=["contenteditable"],Ye=H({__name:"TextEditor",props:{editable:{type:Boolean,default:!1},text:{type:String}},setup(i){const e=i,s=D();function p(){if(!s.value)return;const t=document.createRange();t.selectNode(s.value),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)}return fe(()=>[e.editable],()=>{e.editable&&p()}),(t,v)=>(d(),y("div",{ref_key:"textRef",ref:s,class:te(["es-text",{editable:i.editable}]),contenteditable:i.editable},[J(t.$slots,"default",{},()=>[P(j(i.text),1)],!0)],10,We))}}),_e=F(Ye,[["__scopeId","data-v-6f7332e1"]]),Fe={class:"es-layout-aside"},qe={class:"collapse-content"},Xe=["onDragstart"],Ke={class:"collapse-content"},Je=["onDragstart"],Qe=H({__name:"Aside",emits:["dragstart","dragend"],setup(i,{emit:e}){const s=e,p=D(["1"]);function t(m,n){let a=50,b=50;n.component!=="es-icon"&&(a=m.target.offsetWidth,b=m.target.offsetHeight),s("dragstart",{...n,width:a,height:b})}function v(){s("dragend")}return(m,n)=>{const a=h("el-collapse-item"),b=h("el-collapse");return d(),y("div",Fe,[J(m.$slots,"default",{},()=>[l(b,{modelValue:p.value,"onUpdate:modelValue":n[0]||(n[0]=r=>p.value=r)},{default:u(()=>[l(a,{title:"通用",name:"1"},{default:u(()=>[S("div",qe,[(d(!0),y($,null,L(o(de).componentList,r=>(d(),y("div",{class:"es-block",draggable:"true",onDragstart:g=>t(g,r),onDragend:v},[r.component?(d(),E(Q(r.component),{key:0},{default:u(()=>[P(j(r.text),1)]),_:2},1024)):(d(),y($,{key:1},[P(j(r.text),1)],64))],40,Xe))),256))])]),_:1}),l(a,{title:"杂项",name:"2"}),l(a,{title:"图标",name:"3"},{default:u(()=>[S("div",Ke,[(d(!0),y($,null,L(o(de).iconList,r=>(d(),y("div",{class:"es-block",draggable:"true",onDragstart:g=>t(g,r),onDragend:v},[r.component?(d(),E(Q(r.component),pe(K({key:0},r.props)),null,16)):(d(),y($,{key:1},[P(j(r.props.icon),1)],64))],40,Je))),256))])]),_:1})]),_:1},8,["modelValue"])])])}}}),Ze="/es-drager/assets/light-github-b93c5746.svg",et="/es-drager/assets/dark-github-2b1fc026.svg",tt="/es-drager/assets/light-theme-c88f1a0f.svg",lt="/es-drager/assets/dark-theme-756c206a.svg",ot={class:"es-header"},nt={class:"es-header-toolbar"},at=["onClick"],rt={class:"es-navbar"},st=["src"],ut={class:"es-header-link",href:"https://github.com/vangleer/es-drager",target:"_blank"},dt=["src"],it=H({__name:"Header",props:{tools:{type:Array,default:()=>[]},title:{type:String,default:"ES Drager"}},setup(i){const e=G(O);function s(){e.theme=e.theme==="light"?"dark":"light"}function p(t){typeof t.handler=="function"&&t.handler()}return fe(()=>e.theme,t=>{t&&(document.documentElement.className=t,localStorage.setItem("theme",t))},{immediate:!0}),(t,v)=>{const m=h("el-button");return d(),y("div",ot,[S("h1",null,j(i.title),1),S("div",nt,[(d(!0),y($,null,L(i.tools,n=>(d(),y("div",{class:"es-tool-btn",onClick:a=>p(n)},[l(m,{icon:n.icon},{default:u(()=>[P(j(n.label),1)]),_:2},1032,["icon"])],8,at))),256))]),S("div",rt,[J(t.$slots,"navbar-start",{},void 0,!0),S("a",{class:te(["es-header-link",o(e).theme]),onClick:Y(s,["prevent"])},[S("img",{src:o(e).theme==="light"?o(tt):o(lt)},null,8,st)],2),S("a",ut,[S("img",{src:o(e).theme==="light"?o(Ze):o(et)},null,8,dt)]),J(t.$slots,"navbar-end",{},void 0,!0)])])}}}),ct=F(it,[["__scopeId","data-v-87b1c681"]]),mt=H({__name:"EditorStyle",setup(i){const e=G(O),s=D(100),p=R({get:()=>{const{width:m,height:n}=e.data.container.style;return`${m} x ${n}`},set:m=>{const[n,a]=m.split(" x ");e.data.container.style.width=+n,e.data.container.style.height=+a}}),t=[{label:"PC",options:[{label:"1360 x 760",value:"1360 x 760"},{label:"1280 x 720",value:"1280 x 720"},{label:"800 x 600",value:"800 x 600"}]},{label:"H5",options:[{label:"360 x 780",value:"360 x 780"},{label:"iPhone 6/7/8",value:"375 x 667"},{label:"iPhone 6/7/8 Plus",value:"414 x 736"}]}],v=m=>{e.data.container.scaleRatio=m/100};return(m,n)=>{const a=h("el-option"),b=h("el-option-group"),r=h("el-select"),g=h("el-form-item"),U=h("el-input"),c=h("el-input-number"),_=h("el-switch"),M=h("el-color-picker"),C=h("el-checkbox"),A=h("el-form");return d(),E(A,{model:o(e).data.container,"label-width":"90px","label-position":"left",style:{padding:"0 10px"}},{default:u(()=>[l(g,{label:"画布尺寸"},{default:u(()=>[l(r,{modelValue:p.value,"onUpdate:modelValue":n[0]||(n[0]=k=>p.value=k)},{default:u(()=>[(d(),y($,null,L(t,k=>l(b,{key:k.label,label:k.label},{default:u(()=>[(d(!0),y($,null,L(k.options,f=>(d(),E(a,{label:f.label,value:f.value},null,8,["label","value"]))),256))]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1}),l(g,{label:"缩放比例(%)"},{default:u(()=>[l(U,{modelValue:s.value,"onUpdate:modelValue":n[1]||(n[1]=k=>s.value=k),modelModifiers:{number:!0},onChange:v},null,8,["modelValue"])]),_:1}),l(g,{label:"画布宽度"},{default:u(()=>[l(c,{modelValue:o(e).data.container.style.width,"onUpdate:modelValue":n[2]||(n[2]=k=>o(e).data.container.style.width=k)},null,8,["modelValue"])]),_:1}),l(g,{label:"画布高度"},{default:u(()=>[l(c,{modelValue:o(e).data.container.style.height,"onUpdate:modelValue":n[3]||(n[3]=k=>o(e).data.container.style.height=k)},null,8,["modelValue"])]),_:1}),l(g,{label:"网格"},{default:u(()=>[l(_,{modelValue:o(e).data.container.snapToGrid,"onUpdate:modelValue":n[4]||(n[4]=k=>o(e).data.container.snapToGrid=k)},null,8,["modelValue"])]),_:1}),l(g,{label:"网格大小"},{default:u(()=>[l(c,{modelValue:o(e).data.container.gridSize,"onUpdate:modelValue":n[5]||(n[5]=k=>o(e).data.container.gridSize=k)},null,8,["modelValue"])]),_:1}),l(g,{label:"网格颜色"},{default:u(()=>[l(M,{modelValue:o(e).data.container.gridColor,"onUpdate:modelValue":n[6]||(n[6]=k=>o(e).data.container.gridColor=k)},null,8,["modelValue"])]),_:1}),l(g,{label:"背景颜色"},{default:u(()=>[l(M,{modelValue:o(e).data.container.style.backgroundColor,"onUpdate:modelValue":n[7]||(n[7]=k=>o(e).data.container.style.backgroundColor=k)},null,8,["modelValue"])]),_:1}),l(g,{label:"参考线"},{default:u(()=>[l(C,{modelValue:o(e).data.container.markline.show,"onUpdate:modelValue":n[8]||(n[8]=k=>o(e).data.container.markline.show=k)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])}}}),ft='<svg t="1692778133849" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15222" width="16" height="16"><path d="M123.26 411.37a32 32 0 1 1 45.28-45.23l311.34 311.67L479.71 97a32 32 0 0 1 32-32 32 32 0 0 1 32 32l0.17 580.89 311.59-311.76a32 32 0 0 1 45.27 45.24l-366.2 366.39-0.19 0.18-0.94 0.9-0.52 0.44-0.62 0.53-0.1 0.09-0.62 0.47-0.5 0.4c-0.05 0-0.1 0.08-0.16 0.11-0.21 0.16-0.43 0.31-0.65 0.46l-0.46 0.32-0.2 0.14-0.65 0.41-0.48 0.29a1.64 1.64 0 0 1-0.22 0.14l-0.62 0.35-0.52 0.29-0.23 0.13-0.59 0.29-0.6 0.3-0.18 0.09c-0.17 0.09-0.35 0.16-0.53 0.24l-0.71 0.3-0.19 0.08-0.48 0.18c-0.27 0.1-0.54 0.21-0.81 0.3H522.6l-0.42 0.13-0.91 0.3h-0.14l-0.39 0.11-1 0.26h-0.12l-0.38 0.08c-0.34 0.08-0.68 0.16-1 0.22h-0.06l-0.42 0.07-1 0.17h-0.09c-0.17 0-0.34 0-0.51 0.06l-0.94 0.12h-0.95l-0.75 0.05h-3.12l-0.75-0.05H508.84l-0.94-0.12c-0.17 0-0.34 0-0.51-0.06h-0.09l-1-0.17-0.42-0.07h-0.1c-0.34-0.06-0.68-0.14-1-0.22l-0.4-0.08h-0.08l-1-0.26-0.4-0.11h-0.14l-0.89-0.29-0.45-0.14-0.14-0.05c-0.26-0.09-0.53-0.19-0.79-0.3l-0.49-0.18h-0.2l-0.69-0.3-0.55-0.24-0.18-0.09-0.59-0.3-0.6-0.29-0.17-0.09h-0.05l-0.52-0.28-0.64-0.36-0.14-0.09h-0.07l-0.47-0.3c-0.22-0.14-0.45-0.27-0.67-0.42h-0.07l-0.11-0.08-0.47-0.33-0.81-0.49-0.09-0.08-0.53-0.42-0.61-0.47-0.08-0.07c-0.24-0.19-0.47-0.4-0.7-0.6l-0.46-0.4c-0.41-0.37-0.81-0.74-1.19-1.13zM896.68 895H127.32a32 32 0 1 0 0 64h769.36a32 32 0 0 0 0-64z" fill="currentColor" p-id="15223"></path></svg>',pt='<svg t="1692774315617" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8893" width="16" height="16"><path fill="currentColor" d="M96 128h832v96H96zM96 576h832v96H96zM224 352h576v96H224zM224 800h576v96H224z" p-id="8894"></path></svg>',vt='<svg t="1692774266304" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6910" width="16" height="16"><path fill="currentColor" d="M96 128h832v96H96zM96 576h832v96H96zM96 352h576v96H96zM96 800h576v96H96z" p-id="6911"></path></svg>',_t='<svg t="1692778640543" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7435" width="16" height="16"><path fill="currentColor" d="M143.998942-0.011289h64.007055V1024h-64.007055zM815.982714 224.002117h64.007056v575.984478h-64.007056zM591.991886-0.011289h64.007056V1024h-64.007056zM368.001058 224.002117h63.995767v575.984478h-63.995767z" p-id="7436"></path></svg>',bt='<svg t="1692774301684" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7896" width="16" height="16"><path fill="currentColor" d="M96 128h832v96H96zM96 576h832v96H96zM352 352h576v96H352zM352 800h576v96H352z" p-id="7897"></path></svg>',gt='<svg t="1692777879594" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="14228" width="16" height="16"><path d="M557.654996 981.669904c-6.499999 59.041994-88.986991 53.776995-92.179991 0-0.083-40.896996-0.083-641.390937-0.083-641.390937l-283.839972 273.963973c-44.472996 38.308996-97.43499-22.922998-64.344994-63.215994 125.709988-121.895988 351.289966-340.004967 356.507965-345.049966 20.810998-22.608998 53.572995-23.779998 75.721993 0 41.406996 40.037996 348.700966 336.328967 358.028965 346.989966 31.166997 38.741996-19.223998 96.073991-62.242994 63.773994C834.109969 607.310941 557.739996 340.267967 557.739996 340.267967M116.396039 3.332l786.487923 0 0 89.285991L116.396039 92.617991 116.396039 3.332z" fill="currentColor" p-id="14229"></path></svg>',ht=Object.assign({"./bottom.svg":ft,"./center.svg":pt,"./left.svg":vt,"./middle.svg":_t,"./right.svg":bt,"./top.svg":gt}),q=i=>i?ht[`./${i}.svg`]:"",yt={class:"text-block-box"},kt={class:"text-style-block"},Vt=["onClick","innerHTML"],xt=H({__name:"TextStyle",setup(i){const e=G(O),s=[{label:"正常",value:"normal"},{label:"标题 1",value:"2em"},{label:"标题 2",value:"1.5em"},{label:"标题 3",value:"1.17em"},{label:"标题 4",value:"1em"},{label:"标题 5",value:"0.9em"},{label:"标题 6",value:"0.8em"}],p=D(""),t=[{label:"B",key:"fontWeight",value:"bold"},{label:"I",key:"fontStyle",value:"italic"},{label:"U",key:"textDecoration",value:"underline"},{label:"S",key:"textDecoration",value:"line-through"},{label:q("left"),key:"justifyContent",value:"flex-start"},{label:q("center"),key:"justifyContent",value:"center"},{label:q("right"),key:"justifyContent",value:"flex-end"},{label:q("top"),key:"alignItems",value:"flex-start"},{label:q("middle"),key:"alignItems",value:"center"},{label:q("bottom"),key:"alignItems",value:"flex-end"}],v=R(()=>[...t].map(c=>({...c,selected:U(c.key)===c.value}))),m=R(()=>[v.value.slice(0,4),v.value.slice(4,7),v.value.slice(7,10)]),n=[{label:"Helvetica"},{label:"PingFang SC"},{label:"Hiragino Sans GB"},{label:"Microsoft YaHei"},{label:"Times New Roman"},{label:"Verdana"},{label:"Courier New"},{label:"Georgia"},{label:"Lucida Sans"},{label:"Tahoma"}];function a(c){c.selected=!c.selected,g(c.key,c.selected?c.value:void 0)}function b(c){const _=c==="normal";e.current.style.fontSize=_?void 0:c,e.current.style.fontWeight=_?"normal":"bold"}const r=R({get:()=>e.current.style||{},set:c=>{e.current.style=e.current.style||{},Object.keys(c).forEach(_=>{g(_,c[_])})}});function g(c,_){e.current.style[c]=_}function U(c){return e.current.style[c]}return(c,_)=>{const M=h("el-color-picker"),C=h("el-form-item"),A=h("el-option"),k=h("el-select"),f=h("el-input"),I=h("el-input-number");return d(),y("div",null,[l(C,{label:"字体颜色"},{default:u(()=>[l(M,{modelValue:r.value.color,"onUpdate:modelValue":_[0]||(_[0]=x=>r.value.color=x)},null,8,["modelValue"])]),_:1}),l(C,{label:"标题"},{default:u(()=>[l(k,{modelValue:p.value,"onUpdate:modelValue":_[1]||(_[1]=x=>p.value=x),placeholder:"标题",onChange:b},{default:u(()=>[(d(),y($,null,L(s,x=>l(A,{label:x.label,value:x.value},{default:u(()=>[S("span",{style:T({fontSize:x.value,fontWeight:"bold"})},j(x.label),5)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(C,{label:"字体"},{default:u(()=>[l(k,{modelValue:r.value.fontFamily,"onUpdate:modelValue":_[2]||(_[2]=x=>r.value.fontFamily=x),placeholder:"字体"},{default:u(()=>[(d(),y($,null,L(n,x=>l(A,{label:x.label,value:x.label},{default:u(()=>[S("span",{style:T({fontFamily:x.label})},j(x.label),5)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(C,{label:"字体大小"},{default:u(()=>[l(f,{modelValue:r.value.fontSize,"onUpdate:modelValue":_[3]||(_[3]=x=>r.value.fontSize=x)},null,8,["modelValue"])]),_:1}),l(C,{label:"行高"},{default:u(()=>[l(I,{modelValue:r.value.lineHeight,"onUpdate:modelValue":_[4]||(_[4]=x=>r.value.lineHeight=x)},null,8,["modelValue"])]),_:1}),l(C,{label:"文本"},{default:u(()=>[l(f,{type:"textarea",modelValue:o(e).current.text,"onUpdate:modelValue":_[5]||(_[5]=x=>o(e).current.text=x)},null,8,["modelValue"])]),_:1}),S("div",yt,[(d(!0),y($,null,L(m.value,(x,ee)=>(d(),y("div",kt,[(d(!0),y($,null,L(x,W=>(d(),y("div",{style:T(ee===0?{[W.key]:W.value}:{}),class:te(["block-item",{active:W.selected}]),onClick:oe=>a(W),innerHTML:W.label},null,14,Vt))),256))]))),256))])])}}}),wt=F(xt,[["__scopeId","data-v-e7476531"]]),Ct={class:"info-color-map"},St={class:"color-list"},$t=["onClick"],Ut=H({__name:"ElementStyle",setup(i){const e=G(O),s=D(["style"]),p=D([[{backgroundColor:"#18141d",borderColor:"#ffffff"},{backgroundColor:"#f5f5f5",borderColor:"#666666"},{backgroundColor:"#dae8fc",borderColor:"#6b8ebf"},{backgroundColor:"#d5e8d4",borderColor:"#82b366"},{backgroundColor:"#ffe6cc",borderColor:"#d79b00"},{backgroundColor:"#fff2cc",borderColor:"#d6b656"},{backgroundColor:"#f8cecc",borderColor:"#b85450"},{backgroundColor:"#e1d5e7",borderColor:"#9673a6"}]]),t=[{label:"实线",value:"solid"},{label:"虚线",value:"dashed"},{label:"点线",value:"dotted"}],v=n=>{e.current.selected&&(e.current.style={...e.current.style,...n})};function m(n,a){e.current.style[n]=a}return(n,a)=>{const b=h("el-input-number"),r=h("el-form-item"),g=h("el-color-picker"),U=h("el-checkbox"),c=h("el-slider"),_=h("el-option"),M=h("el-select"),C=h("el-collapse-item"),A=h("el-collapse"),k=h("el-form");return o(e).current&&o(e).current.selected?(d(),E(k,{key:0,model:o(e).current,"label-width":"80px","label-position":"left"},{default:u(()=>[l(A,{modelValue:s.value,"onUpdate:modelValue":a[15]||(a[15]=f=>s.value=f)},{default:u(()=>[l(C,{title:"布局/样式",name:"style"},{default:u(()=>[S("div",Ct,[(d(!0),y($,null,L(p.value,f=>(d(),y("div",St,[(d(!0),y($,null,L(f,I=>(d(),y("div",{class:"color-item",style:T(I),onClick:x=>v(I)},null,12,$t))),256))]))),256))]),l(r,{label:"left"},{default:u(()=>[l(b,{modelValue:o(e).current.left,"onUpdate:modelValue":a[0]||(a[0]=f=>o(e).current.left=f)},null,8,["modelValue"])]),_:1}),l(r,{label:"top"},{default:u(()=>[l(b,{modelValue:o(e).current.top,"onUpdate:modelValue":a[1]||(a[1]=f=>o(e).current.top=f)},null,8,["modelValue"])]),_:1}),l(r,{label:"width"},{default:u(()=>[l(b,{modelValue:o(e).current.width,"onUpdate:modelValue":a[2]||(a[2]=f=>o(e).current.width=f)},null,8,["modelValue"])]),_:1}),l(r,{label:"height"},{default:u(()=>[l(b,{modelValue:o(e).current.height,"onUpdate:modelValue":a[3]||(a[3]=f=>o(e).current.height=f)},null,8,["modelValue"])]),_:1}),l(r,{label:"angle"},{default:u(()=>[l(b,{modelValue:o(e).current.angle,"onUpdate:modelValue":a[4]||(a[4]=f=>o(e).current.angle=f)},null,8,["modelValue"])]),_:1}),l(r,{label:"color"},{default:u(()=>[l(g,{modelValue:o(e).current.color,"onUpdate:modelValue":a[5]||(a[5]=f=>o(e).current.color=f)},null,8,["modelValue"])]),_:1}),l(r,{label:"disabled"},{default:u(()=>[l(U,{modelValue:o(e).current.disabled,"onUpdate:modelValue":a[6]||(a[6]=f=>o(e).current.disabled=f)},null,8,["modelValue"])]),_:1}),l(r,{label:"resizable"},{default:u(()=>[l(U,{modelValue:o(e).current.resizable,"onUpdate:modelValue":a[7]||(a[7]=f=>o(e).current.resizable=f),checked:!0},null,8,["modelValue"])]),_:1}),l(r,{label:"rotatable"},{default:u(()=>[l(U,{modelValue:o(e).current.rotatable,"onUpdate:modelValue":a[8]||(a[8]=f=>o(e).current.rotatable=f),checked:!0},null,8,["modelValue"])]),_:1}),l(r,{label:"透明度"},{default:u(()=>[l(c,{modelValue:1,step:.01,min:0,max:1,onInput:a[9]||(a[9]=f=>m("opacity",f))})]),_:1}),o(e).current.style?(d(),y($,{key:0},[l(r,{label:"背景颜色"},{default:u(()=>[l(g,{modelValue:o(e).current.style.backgroundColor,"onUpdate:modelValue":a[10]||(a[10]=f=>o(e).current.style.backgroundColor=f)},null,8,["modelValue"])]),_:1}),l(r,{label:"边框颜色"},{default:u(()=>[l(g,{modelValue:o(e).current.style.borderColor,"onUpdate:modelValue":a[11]||(a[11]=f=>o(e).current.style.borderColor=f)},null,8,["modelValue"])]),_:1}),l(r,{label:"边框宽度"},{default:u(()=>[l(b,{modelValue:o(e).current.style.borderWidth,"onUpdate:modelValue":a[12]||(a[12]=f=>o(e).current.style.borderWidth=f)},null,8,["modelValue"])]),_:1}),l(r,{label:"边框风格"},{default:u(()=>[l(M,{modelValue:o(e).current.style.borderStyle,"onUpdate:modelValue":a[13]||(a[13]=f=>o(e).current.style.borderStyle=f)},{default:u(()=>[(d(),y($,null,L(t,f=>l(_,{key:f.value,label:f.label,value:f.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"边框半径"},{default:u(()=>[l(b,{modelValue:o(e).current.style.borderRadius,"onUpdate:modelValue":a[14]||(a[14]=f=>o(e).current.style.borderRadius=f)},null,8,["modelValue"])]),_:1})],64)):X("",!0)]),_:1}),l(C,{title:"文本",name:"text"},{default:u(()=>[l(wt)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["model"])):X("",!0)}}}),Mt=F(Ut,[["__scopeId","data-v-175d563d"]]),zt=H({__name:"Style",setup(i){const e=G(O);return(s,p)=>(d(),y("div",{class:"es-info-style",onClick:p[0]||(p[0]=Y(()=>{},["stop"]))},[o(e).current&&o(e).current.selected?(d(),E(Mt,{key:0})):(d(),E(mt,{key:1}))]))}}),Et={class:"es-layout-info"},Rt=H({__name:"Info",setup(i){const e=G(O),s=R(()=>e.current&&e.current.selected?"元素属性":"画布属性"),p=D("style"),t=(v,m)=>{console.log(v,m)};return(v,m)=>{const n=h("el-tab-pane"),a=h("el-tabs");return d(),y("div",Et,[l(a,{modelValue:p.value,"onUpdate:modelValue":m[0]||(m[0]=b=>p.value=b),class:"es-info-tabs",onTabClick:t},{default:u(()=>[l(n,{label:s.value,name:"style"},{default:u(()=>[l(zt)]),_:1},8,["label"])]),_:1},8,["modelValue"])])}}});function Lt(i){const e={current:-1,queue:[],commands:{},commandArray:[],destoryArray:[]},s=t=>{e.commandArray.push(t),e.commands[t.name]=(...v)=>{const{redo:m,undo:n}=t.execute(...v);if(m&&m(),t.pushQueue){let{queue:a}=e;a.length>0&&(a=a.slice(0,e.current+1),e.queue=a),e.queue.push({redo:m,undo:n}),e.current+=1}}};s({name:"redo",keyboard:"ctrl+y",execute(){return{redo(){let t=e.queue[e.current+1];t&&(t.redo&&t.redo(),e.current++)}}}}),s({name:"undo",keyboard:"ctrl+z",execute(){return{redo(){if(e.current===-1)return;let t=e.queue[e.current];t&&(t.undo&&t.undo(),e.current--)}}}}),s({name:"drag",pushQueue:!0,init(){const t=()=>{this.before=ye(i.data.elements)},v=()=>e.commands.drag();return B.on("dragstart",t),B.on("dragend",v),()=>{B.off("dragstart",t),B.off("dragend",v)}},execute(){const t=this.before,v=i.data.elements;return{redo(){i.data={...i.data,elements:v}},undo(){i.data={...i.data,elements:t}}}}}),s({name:"updateContainer",pushQueue:!0,execute(t){const v={before:i.data,after:t};return{redo(){i.data=v.after},undo(){i.data=v.before}}}}),e.commandArray.forEach(t=>{t.init&&e.destoryArray.push(t.init())});const p=()=>{const t=v=>{const{ctrlKey:m,key:n}=v,a=[];m&&a.push("ctrl"),a.push(n);const b=a.join("+");e.commandArray.forEach(({name:r,keyboard:g})=>{g&&g===b&&(e.commands[r](),v.preventDefault())})};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}};return le(()=>{e.destoryArray.push(p())}),he(()=>{e.destoryArray.forEach(t=>t&&t())}),e}function Dt(i,e){const s=ve({left:null,top:null}),p=D({x:[],y:[]});return{markLine:s,updateLines:()=>{p.value=ke(i.value.elements,e.value)},updateMarkline:m=>{s.top=null,s.left=null;for(let n=0;n<p.value.y.length;n++){const{top:a,showTop:b}=p.value.y[n];if(Math.abs(a-m.top)<5){s.top=b;break}}for(let n=0;n<p.value.x.length;n++){const{left:a,showLeft:b}=p.value.x[n];if(Math.abs(a-m.left)<5){s.left=b;break}}}}}const Ht=H({__name:"index",props:{modelValue:{type:Object,required:!0,default:()=>({})},commands:{type:Object}},setup(i){const e=G(O),s=i,p=D(null),t=R({get:()=>s.modelValue,set:()=>{}}),v=R(()=>t.value.container.markline&&t.value.container.markline.show),m=R(()=>{var w;return((w=s.modelValue.container)==null?void 0:w.gridSize)||10}),n=R(()=>{var w;return((w=s.modelValue.container)==null?void 0:w.scaleRatio)||1}),a=R(()=>{const{width:w,height:z}=t.value.container.style;return{...t.value.container.style,width:w+"px",height:z+"px",transform:`scale(${n.value})`,transformOrigin:"top left"}}),b=D({startX:0,startY:0,disX:0,disY:0}),r=R({get:()=>e.current,set:w=>{e.current=w}}),{markLine:g,updateLines:U,updateMarkline:c}=Dt(t,r),_=D(),{areaSelected:M,onEditorMouseDown:C,onAreaMove:A,onAreaUp:k}=Te(t,_),{editorRect:f,onContextmenu:I,onEditorContextMenu:x}=Ne(t,p);function ee(w){r.value=w,M.value||t.value.elements.filter(V=>V.selected).length===1&&t.value.elements.forEach(V=>V.selected=!1),r.value.selected=!0,b.value.startX=r.value.left,b.value.startY=r.value.top,v.value&&U(),B.emit("dragstart")}function W(){B.emit("dragend"),g.left=null,g.top=null}function oe(w){const z=w.left-b.value.startX,V=w.top-b.value.startY;v.value&&c(w),t.value.elements.forEach((N,Gt)=>{var re;N.selected&&((re=r.value)==null?void 0:re.id)!==N.id&&(N.left+=z,N.top+=V)}),b.value.startX=w.left,b.value.startY=w.top}function be(w,z){Object.keys(w).forEach(V=>{z[V]=w[V]})}const ne={dblclick:()=>{!r.value||!r.value.selected||(r.value.editable=!0)},click:()=>{r.value&&(r.value.editable=!1)}};function ae(w="on"){["dblclick","click"].forEach(V=>{w==="on"?document.addEventListener(V,ne[V]):document.removeEventListener(V,ne[V])})}return le(()=>{ae()}),Ve(()=>{ae("off")}),(w,z)=>(d(),y("div",{ref_key:"editorRef",ref:p,class:"es-editor",style:T(a.value),onMousedown:z[2]||(z[2]=(...V)=>o(C)&&o(C)(...V)),onContextmenu:z[3]||(z[3]=Y((...V)=>o(x)&&o(x)(...V),["prevent"]))},[(d(!0),y($,null,L(t.value.elements,V=>(d(),E(o(xe),K({rotatable:""},o(Pe)(V,["style","props"]),{"grid-x":m.value,"grid-y":m.value,scaleRatio:n.value,boundary:"",onDragStart:N=>ee(V),onDragEnd:W,onDrag:oe,onChange:N=>be(N,V),onContextmenu:Y(N=>o(I)(N,V),["stop"]),onMousedown:z[0]||(z[0]=Y(()=>{},["stop"])),onClick:z[1]||(z[1]=Y(()=>{},["stop"]))}),{default:u(()=>[(d(),E(Q(V.component),K({element:V},V.props,{style:{...o(Z)(V.style,!1),width:"100%",height:"100%"}}),{default:u(()=>[V.text?(d(),E(_e,{key:0,editable:V.editable,text:V.text,style:T(o(Z)(V.style))},null,8,["editable","text","style"])):X("",!0)]),_:2},1040,["element","style"]))]),_:2},1040,["grid-x","grid-y","scaleRatio","onDragStart","onChange","onContextmenu"]))),256)),v.value?(d(),E(Ge,pe(K({key:0},o(g))),null,16)):X("",!0),t.value.container.snapToGrid?(d(),E(Ie,{key:1,grid:t.value.container.gridSize,"border-color":t.value.container.gridColor},null,8,["grid","border-color"])):X("",!0),l(Ae,{ref_key:"areaRef",ref:_,onMove:o(A),onUp:o(k)},null,8,["onMove","onUp"])],36))}}),It=F(Ht,[["__scopeId","data-v-d665e1cb"]]),Tt={class:"es-preview-tools"},At=H({__name:"Preview",setup(i){const e=G(O),s=D(),p=R(()=>{const{width:m,height:n}=e.data.container.style;return{...e.data.container.style,width:m+"px",height:n+"px",transform:`scale(${t.value})`,transformOrigin:"top left"}}),t=R(()=>{var m;return((m=e.data.container)==null?void 0:m.scaleRatio)||1});function v(m){const{width:n,height:a}=e.data.container.style,b=we().format("YYYY-MM-DD")+"-es-drager-editor."+m;Ce(s.value).then(r=>{if(m==="pdf"){const g=new Se("l","pt","a4"),U=r.toDataURL();return g.addImage(U,"PNG",0,0,+n,+a),g.save(b)}r.toBlob(g=>{const U=document.createElement("a");U.download=b;const c=URL.createObjectURL(g);U.href=c,U.click(),URL.revokeObjectURL(c)})})}return(m,n)=>{const a=h("el-button"),b=h("el-dialog");return d(),E(b,{draggable:"",fullscreen:""},{default:u(()=>[S("div",Tt,[l(a,{type:"primary",onClick:n[0]||(n[0]=r=>v("png"))},{default:u(()=>[P("导出PNG")]),_:1}),l(a,{type:"primary",onClick:n[1]||(n[1]=r=>v("jpg"))},{default:u(()=>[P("导出JPG")]),_:1}),l(a,{type:"primary",onClick:n[2]||(n[2]=r=>v("pdf"))},{default:u(()=>[P("导出PDF")]),_:1})]),S("div",{class:"es-preview-body",style:T({width:p.value.width,height:p.value.height})},[S("div",{ref_key:"editorRef",ref:s,class:"es-editor preview",style:T(p.value)},[(d(!0),y($,null,L(o(e).data.elements,r=>(d(),E(Q(r.component),K(r.props,{style:{...o(Z)(r.style,!1),width:r.width+"px",height:r.height+"px",position:"absolute",left:r.left+"px",top:r.top+"px"}}),{default:u(()=>[r.text?(d(),E(_e,{key:0,text:r.text,style:T(o(Z)(r.style))},null,8,["text","style"])):X("",!0)]),_:2},1040,["style"]))),256))],4)],4)]),_:1})}}}),Nt=F(At,[["__scopeId","data-v-c79f5fb4"]]),Ot={class:"es-layout"},Bt={class:"es-layout-container"},Pt="ES Drager Editor 开发中...",jt=H({__name:"index",props:{store:{type:Object,required:!0}},setup(i){const e=i,s=ve(e.store);s.theme=e.store.theme||"light",$e(O,s);const p=D(),{commands:t}=Lt(s),v=[{label:"撤销",icon:Ue,handler:t.undo},{label:"重做",icon:Me,handler:t.redo},{label:"导出",icon:ze,handler:()=>{Oe({title:"导出",content:JSON.stringify(s.data),confirm(c){t.updateContainer(JSON.parse(c))}})}},{label:"导入",icon:Ee,handler:()=>{ce({resultType:"json",onChange(c){t.updateContainer(JSON.parse(c))}})}},{label:"插入图片",icon:Re,handler:()=>{ce({resultType:"image",onChange(c){const M={id:ie(),component:"img",props:{src:c,width:200,onLoadOnce(C){if(M.props.loaded)return;const{naturalHeight:A,naturalWidth:k}=C.target,f=s.data.elements.find(x=>x.id===M.id);let I=200/k;I>1&&(I=1),f.width=k*I,f.height=A*I,M.props.loaded=!0}}};s.data.elements.push(M)}})}},{label:"预览",icon:Le,handler:()=>s.preview=!0}],m=R(()=>{var c;return((c=p.value)==null?void 0:c.getBoundingClientRect())||{}});let n=null;function a(c){B.emit("dragstart"),n=c}function b(){B.emit("dragend")}function r(c){c.dataTransfer.dropEffect="move"}function g(c){if(!n)return;const _=n.component==="es-icon",M=[...s.data.elements,{...n,equalProportion:_,left:c.offsetX-n.width/2,top:c.offsetY-n.height/2,id:ie(),style:n.style||{}}];s.data.elements=M,n=null}function U(){s.data.container.style.width=m.value.width-1,s.data.container.style.height=m.value.height-4}return le(()=>{U()}),(c,_)=>{const M=h("el-scrollbar");return d(),y($,null,[S("div",Ot,[l(ct,{title:Pt,tools:v}),S("div",Bt,[l(Qe,{onDragstart:a,onDragend:b}),S("div",{ref_key:"mainRef",ref:p,class:"es-layout-main"},[l(M,{height:m.value.height},{default:u(()=>[l(It,{modelValue:s.data,"onUpdate:modelValue":_[0]||(_[0]=C=>s.data=C),commands:o(t),onDragenter:r,onDrop:g,onDragover:_[1]||(_[1]=Y(()=>{},["prevent"]))},null,8,["modelValue","commands"])]),_:1},8,["height"])],512),l(Rt,{modelValue:s.current,"onUpdate:modelValue":_[2]||(_[2]=C=>s.current=C)},null,8,["modelValue"])])]),l(Nt,{modelValue:s.preview,"onUpdate:modelValue":_[3]||(_[3]=C=>s.preview=C)},null,8,["modelValue"])],64)}}}),Xt=H({__name:"index",setup(i){const e=De(),s=He(),p=R(()=>({...e,theme:s.theme}));return(t,v)=>(d(),E(o(jt),{store:p.value},null,8,["store"]))}});export{Xt as default};
