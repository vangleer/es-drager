import{d as se,E as Ve,r as O,s as N,l as Te,G as K,o as W,c as $,H as Be,i as I,I as ve,y as V,k as J,C as ee,g as fe,m as ge,F as He,a as Ue,b as Ce,u as R,t as Me,J as ke,D as G,K as Pe,M as $e,N as Qe,w as re,B as Fe,e as _e,O as qe}from"./index-394668c0.js";import{_ as Ke}from"./index-0c8ad8ec.js";/*!vue3-sketch-ruler v2.2.62024年11月Sat Nov 16 2024 20:02:44 GMT+0800 (中国标准时间)制作*/const Ge=e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1;function Ze(e,t,n,o,l,r){r?l.moveTo(e,0):l.moveTo(0,e),l.save(),r?l.translate(e+5,o*.2):l.translate(n*.1,e+32),r||l.rotate(-Math.PI/2),l.fillText(Math.round(t).toString(),4,7),l.restore(),r?l.lineTo(e,o):l.lineTo(n,e),l.stroke(),l.closePath(),l.setTransform(1,0,0,1,0,0)}function ce(e,t,n,o,l,r){o.fillStyle=l.fontShadowColor,o.strokeStyle=l.longfgColor,o.save(),o.translate(e,t),r||o.rotate(-Math.PI/2),o.strokeText(String(n),0,0),o.fillText(String(n),0,0),o.restore()}const je=(e,t,n,o,l,r)=>{const{scale:h,width:v,height:u,ratio:k,palette:A,gridRatio:b,showShadowText:m}=l,{bgColor:d,fontColor:p,shadowColor:T,longfgColor:H}=A,w=r?l.canvasWidth:l.canvasHeight;e.setTransform(1,0,0,1,0,0),e.scale(k,k),e.clearRect(0,0,v,u),e.fillStyle=d,e.fillRect(0,0,v,u);const y=Ge(h)*b*10,E=y*h,B=Math.floor(t/y)*y,U=(B-t)/y*E,X=t+Math.ceil((r?v:u)/h);if(o){const x=(n-t)*h,M=o*h;if(e.fillStyle=T,r?e.fillRect(x,0,M,u):e.fillRect(0,x,v,M),m)if(r){ce(x,u*.4,Math.round(n),e,A,r);const L=(n+o-t)*h;ce(L,u*.4,Math.round(n+o),e,A,r)}else{ce(v*.4,x,Math.round(n),e,A,r);const L=(n+o-t)*h;ce(v*.4,L,Math.round(n+o),e,A,r)}}e.beginPath(),e.fillStyle=p,e.strokeStyle=H;for(let x=B,M=0;x<X;x+=y,M++){const L=U+M*E+.5;if(x-y<w&&x>w||x==w){const Q=U+M*E+.5+(w-x)*h;Ze(Q,w,v,u,e,r);return}x>=0&&x<=w&&(x==0?r?(e.moveTo(L,0),e.lineTo(L,u)):(e.moveTo(0,L),e.lineTo(v,L)):r?(e.moveTo(L,20),e.lineTo(L,u/1.3)):(e.moveTo(20,L),e.lineTo(v/1.3,L)),e.save(),x==0?r?e.translate(L-15,u*.01):e.translate(v*.3,L-5):r?e.translate(L-12,u*.05):e.translate(v*.05,L+12),r||e.rotate(-Math.PI/2),w-x>y/2&&(!m||o==0||Math.abs(x-n)>y/2&&Math.abs(x-(n+o))>y/2)&&e.fillText(x.toString(),4,9),e.restore())}e.stroke(),e.closePath()};function Ee(e,t=100){let n=null;const o=function(...l){n!==null&&clearTimeout(n),n=setTimeout(()=>{e(...l)},t)};return o.cancel=function(){n!==null&&(clearTimeout(n),n=null)},o}function We(e,t){const n=O(0),o=O(0),l=O(!1),r=N(()=>({backgroundColor:e.palette.hoverBg,color:e.palette.hoverColor,[t?"top":"left"]:"-8px",[t?"left":"top"]:`${n.value+10}px`})),h=({offsetX:d,offsetY:p})=>{n.value=t?d:p},v=(d,p)=>new Promise(T=>{if(e.lockLine)return;const H=t?d.clientY:d.clientX;h(d);const w=p||o.value;let y=w;const E=U=>{let X=((t?U.clientY:U.clientX)-H)/e.scale+w,x=X;const M=(t?e.snapsObj.h:e.snapsObj.v).slice().sort((L,Q)=>Math.abs(x-L)-Math.abs(x-Q));M.length&&Math.abs(M[0]-X)<e.snapThreshold/e.scale&&(x=M[0],X=x),y=Math.round(X),o.value=y},B=()=>{document.removeEventListener("mousemove",E),u(y,e.index),T()};document.addEventListener("mousemove",E),document.addEventListener("mouseup",B,{once:!0})}),u=(d,p)=>{var T,H;const w=t?(T=e.lines)==null?void 0:T.h:(H=e.lines)==null?void 0:H.v,y=k(d);if(w)if(y)if(typeof p=="number")w.splice(p,1);else return;else typeof p!="number"?w.push(d):w.splice(p,1,d)},k=d=>{const p=t?e.canvasHeight:e.canvasWidth;return d<0||d>p},A=N(()=>k(o.value)?"放开删除":`${t?"Y":"X"}：${o.value*e.rate}`),b=Ee(()=>{l.value=!1},200),m=Ee(()=>{l.value=!0},200);return{showLabel:l,startValue:o,actionStyle:r,labelContent:A,handleMouseDown:v,handleMouseenter:d=>{e.lockLine||(h(d),m(),b.cancel())},handleMouseLeave:()=>{b()}}}const Je={key:0,class:"value"},et=se({__name:"ruler-line",props:{scale:{},palette:{},index:{},start:{},vertical:{type:Boolean},value:{},canvasWidth:{},canvasHeight:{},lines:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},lockLine:{type:Boolean}},setup(e){const t=e,n=O(!1),{actionStyle:o,handleMouseDown:l,labelContent:r,startValue:h,showLabel:v,handleMouseenter:u,handleMouseLeave:k}=We(t,t.vertical),A=N(()=>h.value>=t.start),b=N(()=>{const{lineType:d,lockLineColor:p,lineColor:T}=t.palette,H=t.lockLine?p:T??"black",w=t.lockLine||n.value?"none":"auto",y=t.isShowReferLine&&!t.lockLine?t.vertical?"ns-resize":"ew-resize":"default",E=t.vertical?"borderTop":"borderLeft",B=(h.value-t.start)*t.scale;return{[E]:`1px ${d} ${H}`,pointerEvents:w,cursor:y,[t.vertical?"top":"left"]:`${B}px`}});Te(()=>{h.value=t.value??0});const m=Ee(()=>{n.value=!1},1e3);return K([()=>t.scale],()=>{n.value=!0,m()}),(d,p)=>J((W(),$("div",{class:"line",style:V(b.value),onMouseenter:p[0]||(p[0]=G((...T)=>R(u)&&R(u)(...T),["stop"])),onMouseleave:p[1]||(p[1]=G((...T)=>R(k)&&R(k)(...T),["stop"])),onMousedown:p[2]||(p[2]=G((...T)=>R(l)&&R(l)(...T),["stop"]))},[I("div",{class:"action",style:V(R(o))},[R(v)?(W(),$("span",Je,Me(R(r)),1)):ke("",!0)],4)],36)),[[ee,A.value]])}}),tt=se({__name:"index",props:{scale:{},palette:{},vertical:{type:Boolean},showShadowText:{type:Boolean},start:{},width:{},height:{},selectStart:{},selectLength:{},canvasWidth:{},canvasHeight:{},rate:{},gridRatio:{}},emits:["handleDragStart"],setup(e,{emit:t}){const n=e,o=t,l=Pe({isDragging:!1,canvasContext:null});let r=window.devicePixelRatio;const h=O(null);Te(()=>{window.addEventListener("resize",v),u(),A(r),b(r)});const v=()=>{r=window.devicePixelRatio,A(r),b(r)},u=()=>{var d;l.canvasContext=((d=h.value)==null?void 0:d.getContext("2d"))||null},k=N(()=>({width:n.width+"px",height:n.height+"px",cursor:n.vertical?"ew-resize":"ns-resize",[n.vertical?"borderRight":"borderBottom"]:`1px solid ${n.palette.borderColor||"#eeeeef"} `}));$e(()=>{window.removeEventListener("resize",v)});const A=d=>{if(h.value){h.value.width=Math.round(n.width*d),h.value.height=Math.round(n.height*d);const p=l.canvasContext;p&&(p.font=`11px -apple-system,
                "Helvetica Neue", ".SFNSText-Regular",
                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",
                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif`,p.lineWidth=1,p.textBaseline="middle")}},b=d=>{const p={scale:n.scale,width:n.width,height:n.height,palette:n.palette,canvasWidth:n.canvasWidth,canvasHeight:n.canvasHeight,ratio:d,rate:n.rate,gridRatio:n.gridRatio,showShadowText:n.showShadowText};p.scale=n.scale/n.rate,p.canvasWidth=n.canvasWidth*n.rate,p.canvasHeight=n.canvasHeight*n.rate,l.canvasContext&&je(l.canvasContext,n.start*n.rate,n.selectStart,n.selectLength,p,!n.vertical)};K([()=>n.width,()=>n.height,()=>n.start,()=>n.palette,()=>n.selectStart,()=>n.selectLength],()=>{b(r)}),K([()=>n.width,()=>n.height],()=>{A(r)});const m=d=>{o("handleDragStart",d)};return(d,p)=>(W(),$("canvas",{ref_key:"canvas",ref:h,class:"ruler",style:V(k.value),onMousedown:G(m,["stop"])},null,36))}}),nt={class:"lines"},ot={key:0,class:"value"},ze=se({__name:"ruler-wrapper",props:{scale:{},thick:{},canvasWidth:{},canvasHeight:{},palette:{},vertical:{type:Boolean},width:{},height:{},start:{},startOther:{},lines:{},selectStart:{},selectLength:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},gridRatio:{},lockLine:{type:Boolean},showShadowText:{type:Boolean}},emits:["changeLineState"],setup(e,{emit:t}){const n=e,{showLabel:o,actionStyle:l,handleMouseenter:r,handleMouseLeave:h,handleMouseDown:v,labelContent:u,startValue:k}=We(n,!n.vertical),A=O(!1),b=O(!1),m=N(()=>n.vertical?"v-container":"h-container"),d=t,p=N(()=>{var w,y;return n.vertical?(w=n.lines)==null?void 0:w.h:(y=n.lines)==null?void 0:y.v}),T=N(()=>{const w=n.palette.lineType;let y=n.vertical?"left":"top",E=n.vertical?"top":"left",B=n.vertical?"borderLeft":"borderBottom";const U=(k.value-n.startOther)*n.scale+n.thick;return{[y]:U+"px",[E]:-n.thick+"px",cursor:n.vertical?"ew-resize":"ns-resize",[B]:`1px ${w} ${n.palette.lineColor}`}}),H=async w=>{const{offsetX:y,offsetY:E}=w,{scale:B,vertical:U,thick:X,startOther:x}=n;b.value=!0,A.value=!1,d("changeLineState",!1);let M=Math.round(x-X/B+(U?y:E)/B);k.value=M,await v(w,M),b.value=!1};return K([()=>n.lockLine],()=>{A.value=n.lockLine}),(w,y)=>(W(),$("div",{class:ve(m.value)},[fe(tt,ge(w.$props,{onHandleDragStart:H}),null,16),J(I("div",nt,[(W(!0),$(He,null,Ue(p.value,(E,B)=>(W(),Ce(et,ge({key:E+B,index:B,value:E>>0,ref_for:!0},w.$props),null,16,["index","value"]))),128))],512),[[ee,w.isShowReferLine]]),w.isShowReferLine?J((W(),$("div",{key:0,class:"indicator",style:V(T.value),onMouseenter:y[0]||(y[0]=(...E)=>R(r)&&R(r)(...E)),onMouseleave:y[1]||(y[1]=(...E)=>R(h)&&R(h)(...E))},[I("div",{class:"action",style:V(R(l))},[R(o)?(W(),$("span",ot,Me(R(u)),1)):ke("",!0)],4)],36)),[[ee,b.value]]):ke("",!0)],2))}}),at="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC",it="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII=";/*!simple-panzoom v1.0.72024年8月Sat Aug 10 2024 16:04:04 GMT+0800 (中国标准时间)制作*/typeof window<"u"&&(window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),typeof window.CustomEvent!="function"&&(window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}));function Ye(e,t){let n=e.length;for(;n--;)if(e[n].pointerId===t.pointerId)return n;return-1}function Le(e,t){let n;if(t.touches){n=0;for(const o of t.touches)o.pointerId=n++,Le(e,o);return}n=Ye(e,t),n>-1&&e.splice(n,1),e.push(t)}function lt(e,t){if(t.touches){for(;e.length;)e.pop();return}const n=Ye(e,t);n>-1&&e.splice(n,1)}function Oe(e){e=e.slice(0);let t=e.pop(),n;for(;n=e.pop();)t={clientX:(n.clientX-t.clientX)/2+t.clientX,clientY:(n.clientY-t.clientY)/2+t.clientY};return t}function xe(e){if(e.length<2)return 0;const t=e[0],n=e[1];return Math.sqrt(Math.pow(Math.abs(n.clientX-t.clientX),2)+Math.pow(Math.abs(n.clientY-t.clientY),2))}let le={down:"mousedown",move:"mousemove",up:"mouseup mouseleave"};typeof window<"u"&&(typeof window.PointerEvent=="function"?le={down:"pointerdown",move:"pointermove",up:"pointerup pointerleave pointercancel"}:typeof window.TouchEvent=="function"&&(le={down:"touchstart",move:"touchmove",up:"touchend touchcancel"}));function Ae(e,t,n,o){le[e].split(" ").forEach(l=>{t.addEventListener(l,n,o)})}function Se(e,t,n){le[e].split(" ").forEach(o=>{t.removeEventListener(o,n)})}const st=typeof document<"u"&&!!document.documentMode;let Xe;function rt(){return Xe||(Xe=document.createElement("div").style)}const Ne=["webkit","moz","ms"],ue={};function Re(e){if(ue[e])return ue[e];const t=rt();if(e in t)return ue[e]=e;const n=e[0].toUpperCase()+e.slice(1);let o=Ne.length;for(;o--;){const l=`${Ne[o]}${n}`;if(l in t)return ue[e]=l}}function he(e,t){return parseFloat(t[Re(e)])||0}function de(e,t,n=window.getComputedStyle(e)){const o=t==="border"?"Width":"";return{left:he(`${t}Left${o}`,n),right:he(`${t}Right${o}`,n),top:he(`${t}Top${o}`,n),bottom:he(`${t}Bottom${o}`,n)}}function j(e,t,n){e.style[Re(t)]=n}function ct(e,t){const n=Re("transform");j(e,"transition",`${n} ${t.duration}ms ${t.easing}`)}function ut(e,{x:t,y:n,scale:o,isSVG:l},r){if(j(e,"transform",`scale(${o}) translate(${t}px, ${n}px)`),l&&st){const h=window.getComputedStyle(e).getPropertyValue("transform");e.setAttribute("transform",h)}}function pe(e){const t=e.parentNode,n=window.getComputedStyle(e),o=window.getComputedStyle(t),l=e.getBoundingClientRect(),r=t.getBoundingClientRect();return{elem:{style:n,width:l.width,height:l.height,top:l.top,bottom:l.bottom,left:l.left,right:l.right,margin:de(e,"margin",n),border:de(e,"border",n)},parent:{style:o,width:r.width,height:r.height,top:r.top,bottom:r.bottom,left:r.left,right:r.right,padding:de(t,"padding",o),border:de(t,"border",o)}}}function ht(e){let t=e;for(;t&&t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}return!1}function dt(e){return(e.getAttribute("class")||"").trim()}function pt(e,t){return e.nodeType===1&&` ${dt(e)} `.indexOf(` ${t} `)>-1}function vt(e,t){for(let n=e;n!=null;n=n.parentNode)if(pt(n,t.excludeClass)||t.exclude.indexOf(n)>-1)return!0;return!1}const ft=/^http:[\w\.\/]+svg$/;function gt(e){return ft.test(e.namespaceURI)&&e.nodeName.toLowerCase()!=="svg"}function mt(e){const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}const Ie={animate:!1,canvas:!1,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,duration:200,easing:"ease-in-out",exclude:[],excludeClass:"panzoom-exclude",handleStartEvent:e=>{e.preventDefault(),e.stopPropagation()},maxScale:4,minScale:.125,overflow:"hidden",panOnlyWhenZoomed:!1,pinchAndPan:!1,relative:!1,setTransform:ut,startX:0,startY:0,startScale:1,step:.3,touchAction:"none"};function De(e,t){if(!e)throw new Error("Panzoom requires an element as an argument");if(e.nodeType!==1)throw new Error("Panzoom requires an element with a nodeType of 1");if(!ht(e))throw new Error("Panzoom should be called on elements that have been attached to the DOM");t={...Ie,...t};const n=gt(e),o=e.parentNode;o.style.overflow=t.overflow,o.style.userSelect="none",o.style.touchAction=t.touchAction,(t.canvas?o:e).style.cursor=t.cursor,e.style.userSelect="none",e.style.touchAction=t.touchAction,j(e,"transformOrigin",typeof t.origin=="string"?t.origin:n?"0 0":"50% 50%");function l(){o.style.overflow="",o.style.userSelect="",o.style.touchAction="",o.style.cursor="",e.style.cursor="",e.style.userSelect="",e.style.touchAction="",j(e,"transformOrigin","")}function r(a={}){for(const c in a)a.hasOwnProperty(c)&&(t[c]=a[c]);(a.hasOwnProperty("cursor")||a.hasOwnProperty("canvas"))&&(o.style.cursor=e.style.cursor="",(t.canvas?o:e).style.cursor=t.cursor),a.hasOwnProperty("overflow")&&(o.style.overflow=a.overflow),a.hasOwnProperty("touchAction")&&(o.style.touchAction=a.touchAction,e.style.touchAction=a.touchAction)}let h=0,v=0,u=1,k=!1;T(t.startScale,{animate:!1,force:!0}),setTimeout(()=>{p(t.startX,t.startY,{animate:!1,force:!0})});function A(a,c,g){if(g.silent)return;const C=new CustomEvent(a,{detail:c});e.dispatchEvent(C)}function b(a,c,g){const C={x:h,y:v,scale:u,isSVG:n,originalEvent:g,dimsOut:{}};typeof c.animate=="boolean"&&(c.animate?ct(e,c):j(e,"transition","none")),c.setTransform(e,C,c);function s(){const S=pe(e);C.dimsOut=S,A(a,C,c),A("panzoomchange",C,c)}return c.animate?setTimeout(()=>{s()},c.duration+50):requestAnimationFrame(()=>{s()}),C}function m(a,c,g,C){const s={...t,...C},S={x:h,y:v,opts:s};if(!s.force&&(s.disablePan||s.panOnlyWhenZoomed&&u===s.startScale))return S;if(a=parseFloat(a),c=parseFloat(c),s.disableXAxis||(S.x=(s.relative?h:0)+a),s.disableYAxis||(S.y=(s.relative?v:0)+c),s.contain){const f=pe(e),D=f.elem.width/u,Y=f.elem.height/u,ae=D*g,ie=Y*g,_=(ae-D)/2,q=(ie-Y)/2;if(s.contain==="inside"){const me=(-f.elem.margin.left-f.parent.padding.left+_)/g,we=(f.parent.width-ae-f.parent.padding.left-f.elem.margin.left-f.parent.border.left-f.parent.border.right+_)/g;S.x=Math.max(Math.min(S.x,we),me);const ye=(-f.elem.margin.top-f.parent.padding.top+q)/g,be=(f.parent.height-ie-f.parent.padding.top-f.elem.margin.top-f.parent.border.top-f.parent.border.bottom+q)/g;S.y=Math.max(Math.min(S.y,be),ye)}else if(s.contain==="outside"){const me=(-(ae-f.parent.width)-f.parent.padding.left-f.parent.border.left-f.parent.border.right+_)/g,we=(_-f.parent.padding.left)/g;S.x=Math.max(Math.min(S.x,we),me);const ye=(-(ie-f.parent.height)-f.parent.padding.top-f.parent.border.top-f.parent.border.bottom+q)/g,be=(q-f.parent.padding.top)/g;S.y=Math.max(Math.min(S.y,be),ye)}}return s.roundPixels&&(S.x=Math.round(S.x),S.y=Math.round(S.y)),S}function d(a,c){const g={...t,...c},C={scale:u,opts:g};if(!g.force&&g.disableZoom)return C;let s=t.minScale,S=t.maxScale;if(g.contain){const f=pe(e),D=f.elem.width/u,Y=f.elem.height/u;if(D>1&&Y>1){const ae=f.parent.width-f.parent.border.left-f.parent.border.right,ie=f.parent.height-f.parent.border.top-f.parent.border.bottom,_=ae/D,q=ie/Y;t.contain==="inside"?S=Math.min(S,_,q):t.contain==="outside"&&(s=Math.max(s,_,q))}}return C.scale=Math.min(Math.max(a,s),S),C}function p(a,c,g,C){const s=m(a,c,u,g);return h!==s.x||v!==s.y?(h=s.x,v=s.y,b("panzoompan",s.opts,C)):{x:h,y:v,scale:u,isSVG:n,originalEvent:C}}function T(a,c,g){const C=d(a,c),s=C.opts;if(!s.force&&s.disableZoom)return;a=C.scale;let S=h,f=v;if(s.focal){const Y=s.focal;S=(Y.x/a-Y.x/u+h*a)/a,f=(Y.y/a-Y.y/u+v*a)/a}const D=m(S,f,a,{relative:!1,force:!0});return h=D.x,v=D.y,u=a,b("panzoomzoom",s,g)}function H(a,c){const g={...t,animate:!0,...c};return T(u*Math.exp((a?1:-1)*g.step),g)}function w(a){return H(!0,a)}function y(a){return H(!1,a)}function E(a,c,g,C){const s=pe(e),S={width:s.parent.width-s.parent.padding.left-s.parent.padding.right-s.parent.border.left-s.parent.border.right,height:s.parent.height-s.parent.padding.top-s.parent.padding.bottom-s.parent.border.top-s.parent.border.bottom};let f=c.clientX-s.parent.left-s.parent.padding.left-s.parent.border.left-s.elem.margin.left,D=c.clientY-s.parent.top-s.parent.padding.top-s.parent.border.top-s.elem.margin.top;n||(f-=s.elem.width/u/2,D-=s.elem.height/u/2);const Y={x:f/S.width*(S.width*a),y:D/S.height*(S.height*a)};return T(a,{...g,animate:!1,focal:Y},C)}function B(a,c){a.preventDefault();const g={...t,...c,animate:!1},C=(a.deltaY===0&&a.deltaX?a.deltaX:a.deltaY)<0?1:-1,s=d(u*Math.exp(C*g.step/3),g).scale;return E(s,a,g,a)}function U(a){const c={...t,animate:!0,force:!0,...a};u=d(c.startScale,c).scale;const g=m(c.startX,c.startY,u,c);return h=g.x,v=g.y,b("panzoomreset",c)}let X,x,M,L,Q,F;const P=[];function te(a){if(vt(a.target,t))return;Le(P,a),k=!0,t.handleStartEvent(a),X=h,x=v,A("panzoomstart",{x:h,y:v,scale:u,isSVG:n,originalEvent:a},t);const c=Oe(P);M=c.clientX,L=c.clientY,Q=u,F=xe(P)}function ne(a){if(!k||X===void 0||x===void 0||M===void 0||L===void 0)return;Le(P,a);const c=Oe(P),g=P.length>1;let C=u;if(g){F===0&&(F=xe(P));const s=xe(P)-F;C=d(s*t.step/80+Q).scale,E(C,c,{animate:!1},a)}(!g||t.pinchAndPan)&&p(X+(c.clientX-M)/C,x+(c.clientY-L)/C,{animate:!1},a)}function Z(a){P.length===1&&A("panzoomend",{x:h,y:v,scale:u,isSVG:n,originalEvent:a},t),lt(P,a),k&&(k=!1,X=x=M=L=void 0)}let oe=!1;function i(){oe||(oe=!0,Ae("down",t.canvas?o:e,te),Ae("move",document,ne,{passive:!0}),Ae("up",document,Z,{passive:!0}))}function z(){oe=!1,Se("down",t.canvas?o:e,te),Se("move",document,ne),Se("up",document,Z)}return t.noBind||i(),{bind:i,destroy:z,eventNames:le,getPan:()=>({x:h,y:v}),getScale:()=>u,getOptions:()=>mt(t),handleDown:te,handleMove:ne,handleUp:Z,pan:p,reset:U,resetStyle:l,setOptions:r,setStyle:(a,c)=>j(e,a,c),zoom:T,zoomIn:w,zoomOut:y,zoomToPoint:E,zoomWithWheel:B}}De.defaultOptions=Ie;const wt={class:"sketch-ruler"},yt=se({__name:"index",props:{showRuler:{type:Boolean,default:!0},eyeIcon:{},closeEyeIcon:{},scale:{default:1},rate:{default:1},thick:{default:16},palette:{},width:{default:1400},height:{default:800},paddingRatio:{default:.2},autoCenter:{type:Boolean,default:!0},shadow:{default:()=>({x:0,y:0,width:0,height:0})},lines:{default:()=>({h:[],v:[]})},isShowReferLine:{type:Boolean,default:!0},canvasWidth:{default:700},canvasHeight:{default:700},snapsObj:{default:()=>({h:[],v:[]})},snapThreshold:{default:5},gridRatio:{default:1},lockLine:{type:Boolean,default:!1},selfHandle:{type:Boolean,default:!1},showShadowText:{type:Boolean,default:!0},panzoomOption:{}},emits:["onCornerClick","update:scale","zoomchange","update:lockLine"],setup(e,{expose:t,emit:n}){Ve(i=>({"218edfd4":oe.value}));const o=e,l=n,r=O(null),h=O(0),v=O(0);let u=0,k=0;const A=O(1),b=O(o.isShowReferLine),m=O(null),d=O("defaultCursor"),p=N(()=>({bgColor:"#f6f7f9",longfgColor:"#BABBBC",fontColor:"#7D8694",fontShadowColor:"#106ebe",shadowColor:"#e9f7fe",lineColor:"#51d6a9",lineType:"solid",lockLineColor:"#d4d7dc",hoverBg:"#000",hoverColor:"#fff",borderColor:"#eeeeef",...o.palette})),T=N(()=>({backgroundImage:b.value?`url(${o.eyeIcon??at})`:`url(${o.closeEyeIcon??it})`,width:o.thick+"px",height:o.thick+"px",borderRight:`1px solid ${p.value.borderColor}`,borderBottom:`1px solid ${p.value.borderColor}`})),H=N(()=>({background:p.value.bgColor,width:w.value+"px",height:y.value+"px"})),w=N(()=>o.width-o.thick),y=N(()=>o.height-o.thick),E=i=>{var z;(i.ctrlKey||i.metaKey)&&((z=m.value)==null||z.zoomWithWheel(i))},B=i=>{var z;const a=document.activeElement;a!=null&&a.closest(".monaco-editor")||(a==null?void 0:a.tagName)==="INPUT"||(a==null?void 0:a.tagName)==="TEXTAREA"||(a==null?void 0:a.getAttribute("contenteditable"))==="true"||i.key===" "&&(d.value="grabCursor",(z=m.value)==null||z.bind(),i.preventDefault())},U=i=>{var z;const a=document.activeElement;a!=null&&a.closest(".monaco-editor")||(a==null?void 0:a.tagName)==="INPUT"||(a==null?void 0:a.tagName)==="TEXTAREA"||(a==null?void 0:a.getAttribute("contenteditable"))==="true"||i.key===" "&&((z=m.value)==null||z.destroy(),d.value="defaultCursor")};Te(()=>{if(M(),!o.selfHandle&&r.value){const i=r.value.parentElement;if(!i)return;i.addEventListener("wheel",E),document.addEventListener("keydown",B),document.addEventListener("keyup",U)}});const X=i=>({noBind:!0,startScale:i,startX:u,startY:k,smoothScroll:!0,canvas:!0,...o.panzoomOption}),x=i=>{const{scale:z,dimsOut:a}=i.detail;if(a){l("update:scale",z),A.value=z;const c=(a.parent.left-a.elem.left)/z,g=(a.parent.top-a.elem.top)/z;h.value=c,l("zoomchange",i.detail),v.value=g}},M=()=>{if(r.value=document.querySelector(".canvasedit"),r.value){let i=o.scale;o.autoCenter&&(i=L()),m.value=De(r.value,X(i)),r.value&&r.value.addEventListener("panzoomchange",x)}},L=()=>{const i=w.value*(1-o.paddingRatio)/o.canvasWidth,z=y.value*(1-o.paddingRatio)/o.canvasHeight,a=Math.min(i,z);return u=w.value/2-o.canvasWidth/2,a<1?k=(o.canvasHeight*a/2-o.canvasHeight/2)/a-(o.canvasHeight*a-y.value)/a/2:a>1?k=(o.canvasHeight*a-o.canvasHeight)/2/a+(y.value-o.canvasHeight*a)/a/2:k=0,a},Q=()=>{var i;return(i=m.value)==null?void 0:i.reset()},F=()=>{var i;return(i=m.value)==null?void 0:i.zoomIn()},P=()=>{var i;return(i=m.value)==null?void 0:i.zoomOut()},te=()=>{var i;(i=m.value)==null||i.setOptions(X(o.scale))},ne=()=>{b.value=!b.value,l("onCornerClick",b.value)},Z=i=>{l("update:lockLine",i)},oe=N(()=>o.thick+"px");return K([()=>o.isShowReferLine],()=>{b.value=o.isShowReferLine}),K([()=>o.canvasWidth,()=>o.canvasHeight,()=>o.width,()=>o.height],()=>{M()}),K(()=>o.panzoomOption,()=>{te()},{deep:!0}),t({initPanzoom:M,panzoomInstance:m,reset:Q,zoomIn:F,zoomOut:P,cursorClass:d}),(i,z)=>(W(),$("div",wt,[Be(i.$slots,"btn",{reset:Q,zoomIn:F,zoomOut:P}),I("div",{class:ve(["canvasedit-parent",d.value]),style:V(H.value)},[I("div",{class:ve(["canvasedit",d.value])},[Be(i.$slots,"default")],2)],6),J(fe(ze,{style:V({marginLeft:i.thick+"px",width:w.value+"px"}),vertical:!1,width:i.width,height:i.thick,"is-show-refer-line":b.value,thick:i.thick,start:h.value,"start-other":v.value,lines:i.lines,"select-start":i.shadow.x,"snap-threshold":i.snapThreshold,"snaps-obj":i.snapsObj,"select-length":i.shadow.width,scale:A.value,palette:p.value,"canvas-width":i.canvasWidth,"show-shadow-text":i.showShadowText,"canvas-height":i.canvasHeight,rate:i.rate,"grid-ratio":i.gridRatio,"lock-line":i.lockLine,onChangeLineState:Z},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","snap-threshold","snaps-obj","select-length","scale","palette","canvas-width","show-shadow-text","canvas-height","rate","grid-ratio","lock-line"]),[[ee,i.showRuler]]),J(fe(ze,{style:V({marginTop:i.thick+"px",top:0,height:y.value+"px"}),vertical:!0,width:i.thick,height:i.height,"is-show-refer-line":b.value,thick:i.thick,start:v.value,"start-other":h.value,lines:i.lines,"select-start":i.shadow.y,"select-length":i.shadow.height,"snap-threshold":i.snapThreshold,"snaps-obj":i.snapsObj,scale:A.value,palette:p.value,"canvas-width":i.canvasWidth,"canvas-height":i.canvasHeight,"show-shadow-text":i.showShadowText,rate:i.rate,"grid-ratio":i.gridRatio,"lock-line":i.lockLine,onChangeLineState:Z},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","select-length","snap-threshold","snaps-obj","scale","palette","canvas-width","canvas-height","show-shadow-text","rate","grid-ratio","lock-line"]),[[ee,i.showRuler]]),J(I("a",{class:"corner",style:V(T.value),onClick:ne},null,4),[[ee,i.showRuler]])]))}});const bt={class:"btns"},xt=["onClick"],At=["onClick"],St=["onClick"],Et=se({__name:"snap",setup(e){const t=Qe(),n=O(),o=O(),l=Pe({scale:1,thick:20,width:1470,height:700,showShadowText:!1,canvasWidth:1e3,canvasHeight:500,showRuler:!0,palette:{bgColor:"transparent",lineType:"dashed"},isShowReferLine:!0,shadow:{x:0,y:0,width:0,height:0},lines:{h:[300],v:[400]}}),r=O({componentList:[{id:"div1",component:"div",text:"div1",width:100,height:100,left:0,top:0},{id:"div2",component:"div",text:"div2",width:100,height:100,top:100,left:100}]}),h=N(()=>({width:`${l.width}px`,height:`${l.height}px`})),v=N(()=>({width:`${l.canvasWidth}px`,height:`${l.canvasHeight}px`,position:"relative",background:t.isLight?"#eff2f5":"#333333"})),u=(A,b)=>{qe(()=>{l.shadow={x:b.left,y:b.top,width:b.width,height:b.height}}),Object.keys(A).forEach(m=>{b[m]=A[m]})},k=A=>Array.from(document.querySelectorAll(".sketch-ruler .lines .line"));return(A,b)=>(W(),$("div",null,[I("div",{class:ve(["wrapper",[R(t).isLight?"whitewrapper":"blackwrapper"]]),style:V(h.value)},[fe(R(yt),ge({ref_key:"sketchruleRef",ref:n,scale:l.scale,"onUpdate:scale":b[0]||(b[0]=m=>l.scale=m)},l),{default:re(()=>[I("div",{ref_key:"dragParentRef",ref:o,"data-type":"page",style:V(v.value)},[(W(!0),$(He,null,Ue(r.value.componentList,m=>(W(),Ce(R(Ke),ge(m,{key:m.id,snap:"",scaleRatio:l.scale,class:"dragerItem","snap-threshold":10,markline:"",extraLines:k,onChange:d=>u(d,m)}),{default:re(()=>[(W(),Ce(Fe(m.component),null,{default:re(()=>[_e(Me(m.text),1)]),_:2},1024))]),_:2},1040,["scaleRatio","onChange"]))),128))],4)]),btn:re(({reset:m,zoomIn:d,zoomOut:p})=>[I("div",bt,[I("button",{onClick:G(m,["stop"])},"还原",8,xt),I("button",{onClick:G(d,["stop"])},"放大",8,At),I("button",{onClick:G(p,["stop"])},"缩小",8,St)])]),_:1},16,["scale"])],6)]))}});export{Et as default};
