import{d as ce,r as D,g as G,eQ as U,o as P,b as re,w as se,eR as _,c as O,a as Le,n as de,eJ as Xe,eK as Ye,F as Ce,eS as ue,u as A,eT as Ae,eM as Ne,eI as xe,eD as De,eG as He,h as $}from"./index-fbbac7a1.js";const Pe={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},maxWidth:{type:Number,default:0},maxHeight:{type:Number,default:0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean},checkCollision:{type:Boolean}};function J(o,a){const e=t=>{a&&a(t),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",o),document.addEventListener("touchend",e)}function T(o){let a=0,e=0;if(Te(o)){const t=o.targetTouches[0];a=t.pageX,e=t.pageY}else a=o.clientX,e=o.clientY;return{clientX:a,clientY:e}}function Te(o){const a=Object.prototype.toString.call(o);return a.substring(8,a.length-1)==="TouchEvent"}const S=(o=0)=>parseInt(o+"")+"px",K={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},F=["n","ne","e","se","s","sw","w","nw"],We={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},Ve={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},Ie=(o,a)=>{const e=Ve[Math.floor(o/30)],t=(We[a]+e)%8;return F[t]},he=(o=0,a)=>{let e=[];for(let t=0;t<F.length;t++){const n=F[t],[d,r]=K[n].split("-"),c=Ie(o,n),u={[d]:"0%",cursor:c+"-resize",side:K[n]};if(r)u[r]="0%";else{const v=["top","bottom"].includes(d)?"left":"top";u[v]="50%"}a?a.includes(K[n])&&e.push(u):e.push(u)}return e},Q=o=>o*Math.PI/180,Se=(o,a)=>Math.sqrt(o*o+a*a),b=o=>Math.cos(Q(o)),y=o=>Math.sin(Q(o)),Ge=(o,a,e,t,n,d,r)=>{let{width:c,height:u,centerX:v,centerY:w,rotateAngle:s}=a;const L=c<0?-1:1,g=u<0?-1:1;switch(c=Math.abs(c),u=Math.abs(u),o){case"right":{const i=x(c,e,d);c=i.width,e=i.deltaW,n?(t=e/n,u=c/n,v+=e/2*b(s)-t/2*y(s),w+=e/2*y(s)+t/2*b(s)):(v+=e/2*b(s),w+=e/2*y(s));break}case"top-right":{t=-t;const i=x(c,e,d);c=i.width,e=i.deltaW;const h=N(u,t,r);u=h.height,t=h.deltaH,n&&(e=t*n,c=u*n),v+=e/2*b(s)+t/2*y(s),w+=e/2*y(s)-t/2*b(s);break}case"bottom-right":{const i=x(c,e,d);c=i.width,e=i.deltaW;const h=N(u,t,r);u=h.height,t=h.deltaH,n&&(e=t*n,c=u*n),v+=e/2*b(s)-t/2*y(s),w+=e/2*y(s)+t/2*b(s);break}case"bottom":{const i=N(u,t,r);u=i.height,t=i.deltaH,n?(e=t*n,c=u*n,v+=e/2*b(s)-t/2*y(s),w+=e/2*y(s)+t/2*b(s)):(v-=t/2*y(s),w+=t/2*b(s));break}case"bottom-left":{e=-e;const i=x(c,e,d);c=i.width,e=i.deltaW;const h=N(u,t,r);u=h.height,t=h.deltaH,n&&(u=c/n,t=e/n),v-=e/2*b(s)+t/2*y(s),w-=e/2*y(s)-t/2*b(s);break}case"left":{e=-e;const i=x(c,e,d);c=i.width,e=i.deltaW,n?(u=c/n,t=e/n,v-=e/2*b(s)+t/2*y(s),w-=e/2*y(s)-t/2*b(s)):(v-=e/2*b(s),w-=e/2*y(s));break}case"top-left":{e=-e,t=-t;const i=x(c,e,d);c=i.width,e=i.deltaW;const h=N(u,t,r);u=h.height,t=h.deltaH,n&&(c=u*n,e=t*n),v-=e/2*b(s)-t/2*y(s),w-=e/2*y(s)+t/2*b(s);break}case"top":{t=-t;const i=N(u,t,r);u=i.height,t=i.deltaH,n?(c=u*n,e=t*n,v+=e/2*b(s)+t/2*y(s),w+=e/2*y(s)-t/2*b(s)):(v+=t/2*y(s),w-=t/2*b(s));break}}return{position:{centerX:v,centerY:w},size:{width:c*L,height:u*g}}},N=(o,a,e)=>{const t=o+a;return t>e?o=t:(a=e-o,o=e),{height:o,deltaH:a}},x=(o,a,e)=>{const t=o+a;return t>e?o=t:(a=e-o,o=e),{width:o,deltaW:a}},_e=({centerX:o,centerY:a,width:e,height:t,angle:n})=>({top:a-t/2,left:o-e/2,width:e,height:t,angle:n}),$e=(o,a,e)=>{const{width:t,height:n}=o;return{width:Math.abs(t),height:Math.abs(n),left:a-Math.abs(t)/2,top:e-Math.abs(n)/2}};function j(o,a){const e=Math.abs(o)%a,t=o>0?a:-a;let n=0;return e>a/2?n=t*Math.ceil(Math.abs(o)/a):n=t*Math.floor(Math.abs(o)/a),n}function je(o,a){if(!o||!a)return!1;const e=o.getBoundingClientRect(),t=a.getBoundingClientRect();return e.left<t.left+t.width&&e.left+e.width>t.left&&e.top<t.top+t.height&&e.top+e.height>t.top}function qe(o,a,e){const t=D(!1),n=D(!1),d=D({width:a.width,height:a.height,left:a.left,top:a.top,angle:a.angle}),r=new Set;function c(g){if(r.add(g.button),a.disabled)return;t.value=!0,n.value=!0;let{clientX:i,clientY:h}=T(g);const{left:f,top:M}=d.value;let l=0,m=0,p=0,k=0;a.boundary&&([l,m,p,k]=u()),e&&e("drag-start",d.value),J(R=>{if(r.size>1)return;const{clientX:E,clientY:C}=T(R);let z=(E-i)/a.scaleRatio+f,B=(C-h)/a.scaleRatio+M;if(a.snapToGrid){let{left:H,top:W}=d.value;const q=z-H,X=B-W;z=H+j(q,a.gridX),B=W+j(X,a.gridY)}a.boundary&&([z,B]=v(z,B,l,m,p,k)),d.value.left=z,d.value.top=B,e&&e("drag",d.value)},R=>{a.checkCollision&&w()&&(d.value.top=M,d.value.left=f),r.clear(),t.value=!1,document.addEventListener("click",s,{once:!0}),e&&e("drag-end",d.value)})}const u=()=>{let g=0,i=0;const{left:h,top:f,height:M,width:l,angle:m}=d.value,p=(o.value.parentElement||document.body).getBoundingClientRect();if(m&&a.scaleRatio===1){const E=o.value.getBoundingClientRect();g=Math.abs(E.left-(h+p.left)),i=Math.abs(E.top-(f+p.top))}const k=p.width/a.scaleRatio-l,R=p.height/a.scaleRatio-M;return[g,k-g,i,R-i,p.width/a.scaleRatio,p.height/a.scaleRatio]},v=(g,i,h,f,M,l)=>(g=g<h?h:g,g=g>f?f:g,i=i<M?M:i,i=i>l?l:i,[g,i]),w=()=>{const g=o.value.parentElement||document.body,i=Array.from(g.children).filter(h=>h!==o.value&&h.classList.contains("es-drager"));for(let h=0;h<i.length;h++){const f=i[h];if(je(o.value,f))return!0}},s=()=>{n.value=!1},L=g=>{if(t.value)return;let{left:i,top:h}=d.value;if(["ArrowRight","ArrowLeft"].includes(g.key)){const f=g.key==="ArrowRight";let M=f?1:-1;a.snapToGrid&&(M=f?a.gridX:-a.gridX),i=i+M}else if(["ArrowUp","ArrowDown"].includes(g.key)){const f=g.key==="ArrowDown";let M=f?1:-1;a.snapToGrid&&(M=f?a.gridY:-a.gridY),h=h+M}if(a.boundary){const[f,M,l,m]=u();[i,h]=v(i,h,f,M,l,m)}d.value.left=i,d.value.top=h,e("change",{...d.value})};return De(()=>{if(o.value){if(!d.value.width&&!d.value.height){const{width:g,height:i}=o.value.getBoundingClientRect();d.value={...d.value,width:g||100,height:i||100},e("change",{...d.value})}o.value.addEventListener("mousedown",c),o.value.addEventListener("touchstart",c,{passive:!0})}}),U(n,g=>{a.disabledKeyEvent||(g?document.addEventListener("keydown",L):document.removeEventListener("keydown",L))}),He(()=>{document.removeEventListener("keydown",L)}),{isMousedown:t,selected:n,dragData:d,getBoundary:u,checkDragerCollision:w}}const Ke=$("div",{class:"es-drager-rotate-handle"},[$("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[$("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),Ue=ce({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(o,{emit:a}){const e=o,t=D(null),n=G({get:()=>e.modelValue,set:r=>{a("update:modelValue",r)}});function d(r){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");r.stopPropagation();const{width:c,height:u,left:v,top:w}=e.element.getBoundingClientRect(),s=v+c/2,L=w+u/2;a("rotate-start",n.value),J(g=>{const{clientX:i,clientY:h}=T(g),f=s-i,M=L-h,l=Math.atan2(M,f)*180/Math.PI-90;n.value=(l+360)%360,a("rotate",n.value)},()=>{a("rotate-end",n.value)})}return(r,c)=>(P(),O("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:d,onTouchstartPassive:d},[_(r.$slots,"default",{},()=>[Ke])],544))}}),Oe=["data-side","onMousedown","onTouchstartPassive"],Fe=$("div",{class:"es-drager-dot-handle"},null,-1),ge=ce({__name:"drager",props:Pe,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(o,{emit:a}){const e=o,t=(l,...m)=>{a(l,...m),a("change",...m)},n=D(null),{selected:d,dragData:r,isMousedown:c,getBoundary:u,checkDragerCollision:v}=qe(n,e,t),w=D(he(0,e.resizeList)),s=G(()=>e.resizable&&!e.disabled),L=G(()=>e.rotatable&&!e.disabled&&d.value),g=G(()=>{const{width:l,height:m,left:p,top:k,angle:R}=r.value,E={};return l&&(E.width=S(l)),m&&(E.height=S(m)),{...E,left:S(p),top:S(k),zIndex:e.zIndex,transform:`rotate(${R}deg)`,"--es-drager-color":e.color}});function i(l){n.value||(n.value=l.$el||l)}function h(l){w.value=he(l,e.resizeList),t("rotate-end",r.value)}function f(l,m){if(e.disabled)return;m.stopPropagation();const{clientX:p,clientY:k}=T(m),R=p,E=k,{width:C,height:z,left:B,top:H}=r.value,W=B+C/2,q=H+z/2,X={width:C,height:z,centerX:W,centerY:q,rotateAngle:r.value.angle},pe=l.side,{minWidth:me,minHeight:ve,aspectRatio:Z,equalProportion:fe}=e;t("resize-start",r.value);let ee=[];e.boundary&&(ee=u()),J(te=>{const{clientX:we,clientY:be}=T(te);let V=(we-R)/e.scaleRatio,I=(be-E)/e.scaleRatio;e.snapToGrid&&(V=j(V,e.gridX),I=j(I,e.gridY));const ye=Math.atan2(I,V),ae=Se(V,I),Me=te.shiftKey,oe=ye-Q(X.rotateAngle),ke=ae*Math.cos(oe),Re=ae*Math.sin(oe),le=(fe||Me)&&!Z?X.width/X.height:Z,{position:{centerX:ne,centerY:ie},size:{width:Ee,height:ze}}=Ge(pe,{...X,rotateAngle:X.rotateAngle},ke,Re,le,me,ve),Be=_e({centerX:ne,centerY:ie,width:Ee,height:ze,angle:r.value.angle});let Y={...r.value,...$e(Be,ne,ie)};e.maxWidth>0&&(Y.width=Math.min(Y.width,e.maxWidth)),e.maxHeight>0&&(Y.height=Math.min(Y.height,e.maxHeight)),e.boundary&&(Y=M(Y,ee,le)),r.value=Y,t("resize",r.value)},()=>{e.checkCollision&&v()&&(r.value={...r.value,width:C,height:z,left:B,top:H}),t("resize-end",r.value)})}function M(l,m,p){const[k,R,E,C,z,B]=m;return l.left<k&&(l.left=k,l.width=r.value.width,p&&(l.height=r.value.height)),l.left+l.width>z&&(l.left=r.value.left,l.width=z-l.left,p&&(l.height=r.value.height)),l.top<E&&(l.top=E,l.height=r.value.height,p&&(l.width=r.value.width)),l.top+l.height>B&&(l.top=r.value.top,l.height=B-l.top,p&&(l.width=r.value.width)),l}return U(()=>[e.width,e.height,e.left,e.top,e.angle],([l,m,p,k,R])=>{r.value={...r.value,width:l,height:m,left:p,top:k,angle:R}}),U(()=>e.selected,l=>{d.value=l},{immediate:!0}),(l,m)=>(P(),re(xe(l.tag),{ref:i,class:Ae(["es-drager",{disabled:l.disabled,dragging:A(c),selected:A(d),border:l.border}]),style:de(g.value),onClick:m[3]||(m[3]=Ne(()=>{},["stop"]))},{default:se(()=>[_(l.$slots,"default"),s.value?(P(!0),O(Ce,{key:0},Le(w.value,(p,k)=>(P(),O("div",{key:k,class:"es-drager-dot","data-side":p.side,style:de({...p}),onMousedown:R=>f(p,R),onTouchstartPassive:R=>f(p,R)},[_(l.$slots,"resize",Xe(Ye({side:p.side})),()=>[Fe])],44,Oe))),128)):ue("",!0),L.value?(P(),re(Ue,{key:1,modelValue:A(r).angle,"onUpdate:modelValue":m[0]||(m[0]=p=>A(r).angle=p),element:n.value,onRotate:m[1]||(m[1]=p=>t("rotate",A(r))),onRotateStart:m[2]||(m[2]=p=>t("rotate-start",A(r))),onRotateEnd:h},{default:se(()=>[_(l.$slots,"rotate")]),_:3},8,["modelValue","element"])):ue("",!0)]),_:3},8,["class","style"]))}}),Je=o=>{o.component("es-drager",ge)};ge.install=Je;export{ge as g};
