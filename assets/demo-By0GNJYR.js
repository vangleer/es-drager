import{i as I,r as $,s as we,D as j,E as De,y as Ne,d as be,o as V,c as ee,G as O,j as J,b as de,w as fe,a as Re,q as he,m as Pe,F as Ie,H as ge,u as K,C as ve,I as $e,A as Ke}from"./index-O4UMQ5WV.js";const Ve={type:{type:String,default:"rect"},tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},maxWidth:{type:Number,default:0},maxHeight:{type:Number,default:0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean},checkCollision:{type:Boolean},snap:Boolean,snapThreshold:{type:Number,default:10},markline:[Boolean,Function]};function ne(o,n){const e=t=>{n&&n(t),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",o),document.addEventListener("touchend",e)}function F(o){let n=0,e=0;if(Fe(o)){const t=o.targetTouches[0];n=t.pageX,e=t.pageY}else n=o.clientX,e=o.clientY;return{clientX:n,clientY:e}}function Fe(o){const n=Object.prototype.toString.call(o);return n.substring(8,n.length-1)==="TouchEvent"}const U=(o=0)=>parseInt(o+"")+"px",_={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},te=["n","ne","e","se","s","sw","w","nw"],Ge={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},qe={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},Ue=(o,n)=>{const e=qe[Math.floor(o/30)],i=(Ge[n]+e)%8;return te[i]},me=(o=0,n)=>{let e=[];for(let t=0;t<te.length;t++){const i=te[t],[c,f]=_[i].split("-"),s=Ue(o,i),u={[c]:"0%",cursor:s+"-resize",side:_[i]};if(f)u[f]="0%";else{const g=["top","bottom"].includes(c)?"left":"top";u[g]="50%"}n?n.includes(_[i])&&e.push(u):e.push(u)}return e},oe=o=>o*Math.PI/180,je=(o,n)=>Math.sqrt(o*o+n*n),k=o=>Math.cos(oe(o)),x=o=>Math.sin(oe(o)),Oe=(o,n,e,t,i,c,f)=>{let{width:s,height:u,centerX:g,centerY:w,rotateAngle:a}=n;const L=s<0?-1:1,v=u<0?-1:1;if(s=Math.abs(s),u=Math.abs(u),["top-left","top-right","bottom-left","bottom-right"].includes(o)){o==="top-right"?t=-t:o==="bottom-left"?e=-e:o==="top-left"&&(e=-e,t=-t);const d=W(s,e,c);s=d.width,e=d.deltaW;const r=H(u,t,f);u=r.height,t=r.deltaH,i&&(t=e/i,u=s/i)}switch(o){case"right":{const d=W(s,e,c);s=d.width,e=d.deltaW,i?(t=e/i,u=s/i,g+=e/2*k(a)-t/2*x(a),w+=e/2*x(a)+t/2*k(a)):(g+=e/2*k(a),w+=e/2*x(a));break}case"top-right":{g+=e/2*k(a)+t/2*x(a),w+=e/2*x(a)-t/2*k(a);break}case"bottom-right":{g+=e/2*k(a)-t/2*x(a),w+=e/2*x(a)+t/2*k(a);break}case"bottom":{const d=H(u,t,f);u=d.height,t=d.deltaH,i?(e=t*i,s=u*i,g+=e/2*k(a)-t/2*x(a),w+=e/2*x(a)+t/2*k(a)):(g-=t/2*x(a),w+=t/2*k(a));break}case"bottom-left":{g-=e/2*k(a)+t/2*x(a),w-=e/2*x(a)-t/2*k(a);break}case"left":{e=-e;const d=W(s,e,c);s=d.width,e=d.deltaW,i?(u=s/i,t=e/i,g-=e/2*k(a)+t/2*x(a),w-=e/2*x(a)-t/2*k(a)):(g-=e/2*k(a),w-=e/2*x(a));break}case"top-left":{g-=e/2*k(a)-t/2*x(a),w-=e/2*x(a)+t/2*k(a);break}case"top":{t=-t;const d=H(u,t,f);u=d.height,t=d.deltaH,i?(s=u*i,e=t*i,g+=e/2*k(a)+t/2*x(a),w+=e/2*x(a)-t/2*k(a)):(g+=t/2*x(a),w-=t/2*k(a));break}}return{position:{centerX:g,centerY:w},size:{width:s*L,height:u*v}}},H=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{height:o,deltaH:n}},W=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{width:o,deltaW:n}},Je=({centerX:o,centerY:n,width:e,height:t,angle:i})=>({top:n-t/2,left:o-e/2,width:e,height:t,angle:i}),Qe=(o,n,e)=>{const{width:t,height:i}=o;return{width:Math.abs(t),height:Math.abs(i),left:n-Math.abs(t)/2,top:e-Math.abs(i)/2}};function Q(o,n){const e=Math.abs(o)%n,t=o>0?n:-n;let i=0;return e>n/2?i=t*Math.ceil(Math.abs(o)/n):i=t*Math.floor(Math.abs(o)/n),i}function Ze(o,n,e){if(!o||!n)return!1;const t=D(o,e),i=D(n,e);return t.left<i.left+i.width&&t.left+t.width>i.left&&t.top<i.top+i.height&&t.top+t.height>i.top}const D=(o,n)=>{var e=o.getBoundingClientRect();return{...e,left:e.left/n,top:e.top/n,right:e.right/n,bottom:e.bottom/n,width:e.width/n,height:e.height/n}},pe=o=>typeof o=="function";function _e(o,n){let e=null,t=null;const i=I(()=>o.value.offsetParent||document.body),c=I(()=>D(i.value,n.scaleRatio)),f=$({x:[],y:[]}),s=()=>{n.markline&&!pe(n.markline)&&(e||(e=document.querySelector(".es-drager-markline-x")||ye("x",i.value,n.color)),t||(t=document.querySelector(".es-drager-markline-y")||ye("y",i.value,n.color)))},u=(v={})=>{if(n.markline){if(pe(n.markline))return n.markline(v);v.left===null?e.style.display="none":(e.style.left=v.left+"px",e.style.backgroundColor=n.color,e.style.display="block"),v.top===null?t.style.display="none":(t.style.top=v.top+"px",t.style.backgroundColor=n.color,t.style.display="block")}},g=()=>{const v=D(o.value,n.scaleRatio),d=document.querySelectorAll(".es-drager"),r=[];for(let h=0;h<d.length;h++){const p=d[h];p!==o.value&&r.push(D(p,n.scaleRatio))}f.value=He(r,v)},w=()=>{const v={top:null,left:null,diffX:0,diffY:0},d=D(o.value,n.scaleRatio);for(let r=0;r<f.value.y.length;r++){const{top:h,showTop:p}=f.value.y[r];if(Math.abs(h-d.top)<n.snapThreshold){v.diffY=h-d.top,v.top=p-c.value.top;break}}for(let r=0;r<f.value.x.length;r++){const{left:h,showLeft:p}=f.value.x[r];if(Math.abs(h-d.left)<n.snapThreshold){v.diffX=h-d.left,v.left=p-c.value.left;break}}return u(v),v},a=()=>{u({left:null,top:null})},L=v=>{if(!(!n.snap&&!n.markline))switch(v){case"drag-start":g();break;case"drag":return w();case"drag-end":a();break}};return we(()=>{s()}),{marklineEmit:L}}function ye(o="x",n,e=""){const t=document.createElement("div");return t.classList.add(`es-drager-markline-${o}`),t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.zIndex="9999",t.style.backgroundColor=e,t.style.display="none",o==="x"?(t.style.height="100%",t.style.width="1px"):(t.style.height="1px",t.style.width="100%"),n.appendChild(t),t}function He(o,n){const e={x:[],y:[]},{width:t=0,height:i=0}=n;return o.forEach(c=>{const{top:f,left:s,width:u,height:g}=c;e.y.push({showTop:f,top:f}),e.y.push({showTop:f,top:f-i}),e.y.push({showTop:f+g/2,top:f+g/2-i/2}),e.y.push({showTop:f+g,top:f+g}),e.y.push({showTop:f+g,top:f+g-i}),e.x.push({showLeft:s,left:s}),e.x.push({showLeft:s+u,left:s+u}),e.x.push({showLeft:s+u/2,left:s+u/2-t/2}),e.x.push({showLeft:s+u,left:s+u-t}),e.x.push({showLeft:s,left:s-t})}),e}function We(o,n,e,{getBoundary:t,fixBoundary:i,checkDragerCollision:c,emit:f}){let s=0,u=0;return{onKeydown:a=>{let{left:L,top:v}=n.value;if(s||(s=L),u||(u=v),["ArrowRight","ArrowLeft"].includes(a.key)){const d=a.key==="ArrowRight";let r=d?1:-1;o.snapToGrid&&(r=d?o.gridX:-o.gridX),L=L+r}else if(["ArrowUp","ArrowDown"].includes(a.key)){const d=a.key==="ArrowDown";let r=d?1:-1;o.snapToGrid&&(r=d?o.gridY:-o.gridY),v=v+r}if(o.boundary){const[d,r,h,p]=t();[L,v]=i(L,v,d,r,h,p)}n.value.left=L,n.value.top=v},onKeyup:a=>{["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(a.key)&&o.checkCollision&&c()&&(n.value.left=s,n.value.top=u),s=0,u=0}}}function et(o,n,e){const t=$(!1),i=$(!1),c=$({width:n.width,height:n.height,left:n.left,top:n.top,angle:n.angle}),{marklineEmit:f}=_e(o,n),s=new Set;function u(r){if(s.add(r.button),n.disabled)return;t.value=!0,i.value=!0;let{clientX:h,clientY:p}=F(r);const{left:Y,top:C}=c.value;let l=0,m=0,y=0,b=0;n.boundary&&([l,m,y,b]=g()),f("drag-start"),e&&e("drag-start",c.value),ne(M=>{if(s.size>1)return;const{clientX:E,clientY:S}=F(M);let T=(E-h)/n.scaleRatio+Y,B=(S-p)/n.scaleRatio+C;if(n.snapToGrid){let{left:A,top:N}=c.value;const z=T-A,R=B-N;T=A+Q(z,n.gridX),B=N+Q(R,n.gridY)}n.boundary&&([T,B]=w(T,B,l,m,y,b)),c.value.left=T,c.value.top=B,e&&e("drag",c.value),De(()=>{const A=f("drag");n.snap&&(A.diffX&&(c.value.left+=A.diffX),A.diffY&&(c.value.top+=A.diffY))})},M=>{n.checkCollision&&a()&&(c.value.top=C,c.value.left=Y),s.clear(),t.value=!1,f("drag-end"),e&&e("drag-end",c.value)})}const g=()=>{let r=0,h=0;const{left:p,top:Y,height:C,width:l,angle:m}=c.value,y=o.value.offsetParent||document.body,b=D(y,n.scaleRatio);if(m){const E=D(o.value,n.scaleRatio);r=E.left-Math.floor(p-(E.width-l)+b.left),h=E.top-Math.floor(Y-(E.height-C)+b.top)}const X=b.width-l,M=b.height-C;return[r,X-r,h,M-h,b.width,b.height]},w=(r,h,p,Y,C,l)=>(r=r<p?p:r,r=r>Y?Y:r,h=h<C?C:h,h=h>l?l:h,[r,h]),a=()=>{const r=o.value.offsetParent||document.body,h=Array.from(r.children).filter(p=>p!==o.value&&p.classList.contains("es-drager"));for(let p=0;p<h.length;p++){const Y=h[p];if(Ze(o.value,Y,n.scaleRatio))return!0}},L=()=>{i.value=!1},{onKeydown:v,onKeyup:d}=We(n,c,i,{getBoundary:g,fixBoundary:w,checkDragerCollision:a,emit:e});return j(i,r=>{r?(e("focus",r),document.addEventListener("click",L,{once:!0})):e("blur",r),!n.disabledKeyEvent&&(r?(document.addEventListener("keydown",v),document.addEventListener("keyup",d)):(document.removeEventListener("keydown",v),document.removeEventListener("keyup",d)))}),we(()=>{if(o.value){if(!c.value.width&&!c.value.height){const{width:r,height:h}=D(o.value,n.scaleRatio);c.value={...c.value,width:r+2,height:h+2}}if(o.value.addEventListener("mousedown",u),o.value.addEventListener("touchstart",u,{passive:!0}),n.type==="text"){const r=window.getComputedStyle(o.value);c.value.height=parseInt(r.fontSize)}}}),Ne(()=>{document.removeEventListener("click",L),document.removeEventListener("keydown",v),document.removeEventListener("keyup",d)}),{isMousedown:t,selected:i,dragData:c,getBoundary:g,checkDragerCollision:a}}const tt=be({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=n,i=$(null),c=I({get:()=>e.modelValue,set:s=>{t("update:modelValue",s)}});function f(s){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");s.stopPropagation();const{width:u,height:g,left:w,top:a}=e.element.getBoundingClientRect(),L=w+u/2,v=a+g/2;t("rotate-start",c.value),ne(d=>{const{clientX:r,clientY:h}=F(d),p=L-r,Y=v-h,l=Math.atan2(Y,p)*180/Math.PI-90;c.value=(l+360)%360,t("rotate",c.value)},()=>{t("rotate-end",c.value)})}return(s,u)=>(V(),ee("div",{ref_key:"rotateRef",ref:i,class:"es-drager-rotate",onMousedown:f,onTouchstartPassive:f},[O(s.$slots,"default",{},()=>[u[0]||(u[0]=J("div",{class:"es-drager-rotate-handle"},[J("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[J("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1))])],544))}}),nt=["data-side","onMousedown","onTouchstartPassive"],ke=be({__name:"drager",props:Ve,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end","focus","blur"],setup(o,{emit:n}){const e=o,t=n,i=(l,...m)=>{t(l,...m)},c=$(null),{selected:f,dragData:s,isMousedown:u,getBoundary:g,checkDragerCollision:w}=et(c,e,i),a=$(me(0,e.resizeList)),L=I(()=>e.resizable&&!e.disabled),v=I(()=>e.rotatable&&!e.disabled&&f.value),d=I(()=>e.type!="text"?a.value:a.value.filter(l=>!["top","bottom"].includes(l.side))),r=I(()=>{const{width:l,height:m,left:y,top:b,angle:X}=s.value,M={};l&&(M.width=U(l)),m&&(e.type==="text"?M.fontSize=m+"px":M.height=U(m));let E=[`translateX(${U(y)})`,`translateY(${U(b)})`,`rotate(${X}deg)`];return{...M,zIndex:e.zIndex,transform:E.join(" "),"--es-drager-color":e.color}});function h(l){c.value||(c.value=l.$el||l)}function p(l){a.value=me(l,e.resizeList),i("rotate-end",s.value)}function Y(l,m){if(e.disabled)return;m.stopPropagation();const{clientX:y,clientY:b}=F(m),X=y,M=b,{width:E,height:S,left:T,top:B}=s.value,A=T+E/2,N=B+S/2,z={width:E,height:S,centerX:A,centerY:N,rotateAngle:s.value.angle},R=l.side;let{minWidth:xe,minHeight:Le,aspectRatio:Z,equalProportion:Me}=e;i("resize-start",s.value,R);let se=[];e.boundary&&(se=g()),["text","image"].includes(e.type)&&R.includes("-")&&(Z=z.width/z.height),ne(ie=>{const{clientX:Ee,clientY:Ye}=F(ie);let G=(Ee-X)/e.scaleRatio,q=(Ye-M)/e.scaleRatio;e.snapToGrid&&(G=Q(G,e.gridX),q=Q(q,e.gridY));const Xe=Math.atan2(q,G),le=je(G,q),Ae=ie.shiftKey,ae=Xe-oe(z.rotateAngle),ze=le*Math.cos(ae),Te=le*Math.sin(ae),re=(Me||Ae)&&!Z?z.width/z.height:Z,{position:{centerX:ue,centerY:ce},size:{width:Be,height:Ce}}=Oe(R,{...z,rotateAngle:z.rotateAngle},ze,Te,re,xe,Le),Se=Je({centerX:ue,centerY:ce,width:Be,height:Ce,angle:s.value.angle});let P={...s.value,...Qe(Se,ue,ce)};e.maxWidth>0&&(P.width=Math.min(P.width,e.maxWidth)),e.maxHeight>0&&(P.height=Math.min(P.height,e.maxHeight)),e.boundary&&(P=C(P,se,re)),s.value=P,i("resize",s.value,R)},()=>{e.checkCollision&&w()&&(s.value={...s.value,width:E,height:S,left:T,top:B}),i("resize-end",s.value,R)})}function C(l,m,y){const[b,X,M,E,S,T]=m,B=l.left<b,A=l.left+l.width>S,N=l.top<M,z=l.top+l.height>T;return B&&(l.left=b,l.width=s.value.width),N&&(l.top=M,l.height=s.value.height),(A||z)&&(A&&(l.left=s.value.left),z&&(l.top=s.value.top),z||(l.width=S-l.left),A||(l.height=T-l.top)),(z||N)&&y&&(l.width=s.value.width,l.left=s.value.left),(A||B)&&y&&(l.height=s.value.height,l.top=s.value.top),l}return j(()=>[e.width,e.height,e.left,e.top,e.angle],([l,m,y,b,X],[M,E,S,T,B])=>{l!==M&&(s.value.width=l),m!==E&&(s.value.height=m),y!==S&&(s.value.left=y),b!==T&&(s.value.top=b),X!==B&&(s.value.angle=X)}),j(()=>s.value,l=>{t("change",{...l})},{deep:!0}),j(()=>e.selected,l=>{f.value=l},{immediate:!0}),(l,m)=>(V(),de(Ke(l.tag),{ref:h,class:$e(["es-drager",`es-drager-${l.type}`,{disabled:l.disabled,dragging:K(u),selected:K(f),border:l.border}]),style:he(r.value),onClick:m[3]||(m[3]=ve(()=>{},["stop"])),onMousedown:m[4]||(m[4]=ve(()=>{},["stop"]))},{default:fe(()=>[O(l.$slots,"default"),L.value?(V(!0),ee(Ie,{key:0},Re(d.value,(y,b)=>(V(),ee("div",{key:b,class:"es-drager-dot","data-side":y.side,style:he({...y}),onMousedown:X=>Y(y,X),onTouchstartPassive:X=>Y(y,X)},[O(l.$slots,"resize",Pe({ref_for:!0},{side:y.side}),()=>[m[5]||(m[5]=J("div",{class:"es-drager-dot-handle"},null,-1))])],44,nt))),128)):ge("",!0),v.value?(V(),de(tt,{key:1,modelValue:K(s).angle,"onUpdate:modelValue":m[0]||(m[0]=y=>K(s).angle=y),element:c.value,onRotate:m[1]||(m[1]=y=>i("rotate",K(s))),onRotateStart:m[2]||(m[2]=y=>i("rotate-start",K(s))),onRotateEnd:p},{default:fe(()=>[O(l.$slots,"rotate")]),_:3},8,["modelValue","element"])):ge("",!0)]),_:3},40,["class","style"]))}}),ot=o=>{o.component("es-drager",ke)};ke.install=ot;const lt="/es-drager/assets/demo-CFOJL5gY.png";export{ke as _,lt as i};
