import{G as S}from"./GridRect-df38e00c.js";import{i as M}from"./index.es-96c8c24f.js";import{M as F}from"./MarkLine-05fe920a.js";import{d as G,r as m,eE as I,eF as J,eG as K,o as i,c as y,g as k,j as u,w as d,e as _,u as v,F as O,a as P,b as L,eH as V,t as j,m as z,eI as R,eJ as T,eK as q,_ as H}from"./index-0e1211f5.js";const U={class:"es-container"},$={class:"es-tools"},A={class:"es-editor"},Q=G({__name:"markline",setup(W){const w=m(-1),l=m({componentList:[{id:"div1",component:"div",text:"div1",width:100,height:100,left:0,top:0},{id:"div2",component:"div",text:"div2",width:100,height:100,top:100,left:100}]}),s=I({left:null,top:null}),r=m({x:[],y:[]}),p=E(l);function C(t){w.value=t,r.value=q(l.value.componentList,l.value.componentList[t])}function x(t){s.top=null,s.left=null;for(let e=0;e<r.value.y.length;e++){const{top:o,showTop:n}=r.value.y[e];if(Math.abs(o-t.top)<5){s.top=n;break}}for(let e=0;e<r.value.x.length;e++){const{left:o,showLeft:n}=r.value.x[e];if(Math.abs(o-t.left)<5){s.left=n;break}}}function b(){p.record(),s.top=null,s.left=null}function D(t,e){Object.keys(t).forEach(o=>{e[o]=t[o]})}function E(t){const e=[];let o=-1;const n=()=>{console.log("redo",o,e),o<e.length-1&&(o++,t.value.componentList=f(e[o]))},c=()=>{console.log("undo",o,e),o>=0&&(o--,e[o]&&(t.value.componentList=f(e[o])))},a=()=>{e[++o]=f(t.value.componentList)};a();const g=B=>{const{ctrlKey:N,key:h}=B;N&&(h==="z"?c():h==="y"&&n())};return window.addEventListener("keydown",g),J(()=>{window.removeEventListener("keydown",g)}),{redo:n,undo:c,record:a}}function f(t){return JSON.parse(JSON.stringify(t))}return(t,e)=>{const o=K("el-button");return i(),y("div",U,[k("div",$,[u(o,{type:"primary",onClick:v(p).undo},{default:d(()=>[_("撤销")]),_:1},8,["onClick"]),u(o,{type:"primary",onClick:v(p).redo},{default:d(()=>[_("重做")]),_:1},8,["onClick"])]),k("div",A,[(i(!0),y(O,null,P(l.value.componentList,(n,c)=>(i(),L(v(M),z(n,{onDragStart:a=>C(c),onDrag:e[0]||(e[0]=a=>x(a)),onChange:a=>D(a,n),onDragEnd:b}),{default:d(()=>[(i(),L(V(n.component),null,{default:d(()=>[_(j(n.text),1)]),_:2},1024))]),_:2},1040,["onDragStart","onChange"]))),256)),u(F,R(T(s)),null,16),u(S,{class:"grid-rect"})])])}}});const oe=H(Q,[["__scopeId","data-v-6210b5ac"]]);export{oe as default};
