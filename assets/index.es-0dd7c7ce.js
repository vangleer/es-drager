import{d as de,r as N,g as W,eQ as j,o as T,b as ne,w as le,eR as I,c as K,a as Ee,n as re,eJ as ze,eK as Be,F as Le,eS as ie,u as Y,eT as Re,eM as Xe,eI as Ye,eD as Ce,eG as Ae,h as _}from"./index-3c88ecf2.js";const Ne={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean},checkCollision:{type:Boolean}};function q(o,a){const e=t=>{a&&a(t),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",o),document.addEventListener("touchend",e)}function P(o){let a=0,e=0;if(Te(o)){const t=o.targetTouches[0];a=t.pageX,e=t.pageY}else a=o.clientX,e=o.clientY;return{clientX:a,clientY:e}}function Te(o){const a=Object.prototype.toString.call(o);return a.substring(8,a.length-1)==="TouchEvent"}const V=(o=0)=>parseInt(o+"")+"px",U={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},F=["n","ne","e","se","s","sw","w","nw"],Pe={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},De={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},He=(o,a)=>{const e=De[Math.floor(o/30)],t=(Pe[a]+e)%8;return F[t]},se=(o=0,a)=>{let e=[];for(let t=0;t<F.length;t++){const n=F[t],[c,s]=U[n].split("-"),g=He(o,n),d={[c]:"0%",cursor:g+"-resize",side:U[n]};if(s)d[s]="0%";else{const f=["top","bottom"].includes(c)?"left":"top";d[f]="50%"}a?a.includes(U[n])&&e.push(d):e.push(d)}return e},Q=o=>o*Math.PI/180,Se=(o,a)=>Math.sqrt(o*o+a*a),w=o=>Math.cos(Q(o)),b=o=>Math.sin(Q(o)),xe=(o,a,e,t,n,c,s)=>{let{width:g,height:d,centerX:f,centerY:m,rotateAngle:r}=a;const E=g<0?-1:1,p=d<0?-1:1;switch(g=Math.abs(g),d=Math.abs(d),o){case"right":{const l=A(g,e,c);g=l.width,e=l.deltaW,n?(t=e/n,d=g/n,f+=e/2*w(r)-t/2*b(r),m+=e/2*b(r)+t/2*w(r)):(f+=e/2*w(r),m+=e/2*b(r));break}case"top-right":{t=-t;const l=A(g,e,c);g=l.width,e=l.deltaW;const h=C(d,t,s);d=h.height,t=h.deltaH,n&&(e=t*n,g=d*n),f+=e/2*w(r)+t/2*b(r),m+=e/2*b(r)-t/2*w(r);break}case"bottom-right":{const l=A(g,e,c);g=l.width,e=l.deltaW;const h=C(d,t,s);d=h.height,t=h.deltaH,n&&(e=t*n,g=d*n),f+=e/2*w(r)-t/2*b(r),m+=e/2*b(r)+t/2*w(r);break}case"bottom":{const l=C(d,t,s);d=l.height,t=l.deltaH,n?(e=t*n,g=d*n,f+=e/2*w(r)-t/2*b(r),m+=e/2*b(r)+t/2*w(r)):(f-=t/2*b(r),m+=t/2*w(r));break}case"bottom-left":{e=-e;const l=A(g,e,c);g=l.width,e=l.deltaW;const h=C(d,t,s);d=h.height,t=h.deltaH,n&&(d=g/n,t=e/n),f-=e/2*w(r)+t/2*b(r),m-=e/2*b(r)-t/2*w(r);break}case"left":{e=-e;const l=A(g,e,c);g=l.width,e=l.deltaW,n?(d=g/n,t=e/n,f-=e/2*w(r)+t/2*b(r),m-=e/2*b(r)-t/2*w(r)):(f-=e/2*w(r),m-=e/2*b(r));break}case"top-left":{e=-e,t=-t;const l=A(g,e,c);g=l.width,e=l.deltaW;const h=C(d,t,s);d=h.height,t=h.deltaH,n&&(g=d*n,e=t*n),f-=e/2*w(r)-t/2*b(r),m-=e/2*b(r)+t/2*w(r);break}case"top":{t=-t;const l=C(d,t,s);d=l.height,t=l.deltaH,n?(g=d*n,e=t*n,f+=e/2*w(r)+t/2*b(r),m+=e/2*b(r)-t/2*w(r)):(f+=t/2*b(r),m-=t/2*w(r));break}}return{position:{centerX:f,centerY:m},size:{width:g*E,height:d*p}}},C=(o,a,e)=>{const t=o+a;return t>e?o=t:(a=e-o,o=e),{height:o,deltaH:a}},A=(o,a,e)=>{const t=o+a;return t>e?o=t:(a=e-o,o=e),{width:o,deltaW:a}},Ve=({centerX:o,centerY:a,width:e,height:t,angle:n})=>({top:a-t/2,left:o-e/2,width:e,height:t,angle:n}),We=(o,a,e)=>{const{width:t,height:n}=o;return{width:Math.abs(t),height:Math.abs(n),left:a-Math.abs(t)/2,top:e-Math.abs(n)/2}};function $(o,a){const e=Math.abs(o)%a,t=o>0?a:-a;let n=0;return e>a/2?n=t*Math.ceil(Math.abs(o)/a):n=t*Math.floor(Math.abs(o)/a),n}function Ie(o,a){if(!o||!a)return!1;const e=o.getBoundingClientRect(),t=a.getBoundingClientRect();return e.left<t.left+t.width&&e.left+e.width>t.left&&e.top<t.top+t.height&&e.top+e.height>t.top}function _e(o,a,e){const t=N(!1),n=N(!1),c=N({width:a.width,height:a.height,left:a.left,top:a.top,angle:a.angle}),s=new Set;function g(p){if(s.add(p.button),a.disabled)return;t.value=!0,n.value=!0;let{clientX:l,clientY:h}=P(p);const{left:i,top:u}=c.value;let v=0,M=0,y=0,k=0;a.boundary&&([v,M,y,k]=d()),e&&e("drag-start",c.value),q(z=>{if(s.size>1)return;const{clientX:B,clientY:D}=P(z);let L=(B-l)/a.scaleRatio+i,X=(D-h)/a.scaleRatio+u;if(a.snapToGrid){let{left:H,top:R}=c.value;const G=L-H,O=X-R;L=H+$(G,a.gridX),X=R+$(O,a.gridY)}a.boundary&&([L,X]=f(L,X,v,M,y,k)),c.value.left=L,c.value.top=X,e&&e("drag",c.value)},z=>{a.checkCollision&&m()&&(c.value.top=u,c.value.left=i),s.clear(),t.value=!1,document.addEventListener("click",r,{once:!0}),e&&e("drag-end",c.value)})}const d=()=>{let p=0,l=0;const{left:h,top:i,height:u,width:v,angle:M}=c.value,y=(o.value.parentElement||document.body).getBoundingClientRect();if(M&&a.scaleRatio===1){const B=o.value.getBoundingClientRect();p=Math.abs(B.left-(h+y.left)),l=Math.abs(B.top-(i+y.top))}const k=y.width/a.scaleRatio-v,z=y.height/a.scaleRatio-u;return[p,k-p,l,z-l]},f=(p,l,h,i,u,v)=>(p=p<h?h:p,p=p>i?i:p,l=l<u?u:l,l=l>v?v:l,[p,l]),m=()=>{const p=o.value.parentElement||document.body,l=Array.from(p.children).filter(h=>h!==o.value&&h.classList.contains("es-drager"));for(let h=0;h<l.length;h++){const i=l[h];if(Ie(o.value,i))return!0}},r=()=>{n.value=!1},E=p=>{if(t.value)return;let{left:l,top:h}=c.value;if(["ArrowRight","ArrowLeft"].includes(p.key)){const i=p.key==="ArrowRight";let u=i?1:-1;a.snapToGrid&&(u=i?a.gridX:-a.gridX),l=l+u}else if(["ArrowUp","ArrowDown"].includes(p.key)){const i=p.key==="ArrowDown";let u=i?1:-1;a.snapToGrid&&(u=i?a.gridY:-a.gridY),h=h+u}if(a.boundary){const[i,u,v,M]=d();[l,h]=f(l,h,i,u,v,M)}c.value.left=l,c.value.top=h};return Ce(()=>{if(o.value){if(!c.value.width&&!c.value.height){const{width:p,height:l}=o.value.getBoundingClientRect();c.value={...c.value,width:p||100,height:l||100},e("change",{...c.value})}o.value.addEventListener("mousedown",g),o.value.addEventListener("touchstart",g,{passive:!0})}}),j(n,p=>{a.disabledKeyEvent||(p?document.addEventListener("keydown",E):document.removeEventListener("keydown",E))}),Ae(()=>{document.removeEventListener("keydown",E)}),{isMousedown:t,selected:n,dragData:c,getBoundary:d,checkDragerCollision:m}}const $e=_("div",{class:"es-drager-rotate-handle"},[_("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[_("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),Ge=de({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(o,{emit:a}){const e=o,t=N(null),n=W({get:()=>e.modelValue,set:s=>{a("update:modelValue",s)}});function c(s){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");s.stopPropagation();const{width:g,height:d,left:f,top:m}=e.element.getBoundingClientRect(),r=f+g/2,E=m+d/2;a("rotate-start",n.value),q(p=>{const{clientX:l,clientY:h}=P(p),i=r-l,u=E-h,v=Math.atan2(u,i)*180/Math.PI-90;n.value=(v+360)%360,a("rotate",n.value)},()=>{a("rotate-end",n.value)})}return(s,g)=>(T(),K("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:c,onTouchstartPassive:c},[I(s.$slots,"default",{},()=>[$e])],544))}}),Oe=["data-side","onMousedown","onTouchstartPassive"],Ue=_("div",{class:"es-drager-dot-handle"},null,-1),ue=de({__name:"drager",props:Ne,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(o,{emit:a}){const e=o,t=(i,...u)=>{a(i,...u),a("change",...u)},n=N(null),{selected:c,dragData:s,isMousedown:g,checkDragerCollision:d}=_e(n,e,t),f=N(se(0,e.resizeList)),m=W(()=>e.resizable&&!e.disabled),r=W(()=>e.rotatable&&!e.disabled&&c.value),E=W(()=>{const{width:i,height:u,left:v,top:M,angle:y}=s.value,k={};return i&&(k.width=V(i)),u&&(k.height=V(u)),{...k,left:V(v),top:V(M),zIndex:e.zIndex,transform:`rotate(${y}deg)`,"--es-drager-color":e.color}});function p(i){n.value||(n.value=i.$el||i)}function l(i){f.value=se(i,e.resizeList),t("rotate-end",s.value)}function h(i,u){u.stopPropagation();const{clientX:v,clientY:M}=P(u),y=v,k=M,{width:z,height:B,left:D,top:L}=s.value,X=D+z/2,H=L+B/2,R={width:z,height:B,centerX:X,centerY:H,rotateAngle:s.value.angle},G=i.side,{minWidth:O,minHeight:ce,aspectRatio:J,equalProportion:he}=e;t("resize-start",s.value),q(Z=>{const{clientX:ge,clientY:pe}=P(Z);let S=(ge-y)/e.scaleRatio,x=(pe-k)/e.scaleRatio;e.snapToGrid&&(S=$(S,e.gridX),x=$(x,e.gridY));const ve=Math.atan2(x,S),ee=Se(S,x),fe=Z.shiftKey,te=ve-Q(R.rotateAngle),me=ee*Math.cos(te),we=ee*Math.sin(te),be=(he||fe)&&!J?R.width/R.height:J,{position:{centerX:ae,centerY:oe},size:{width:ye,height:Me}}=xe(G,{...R,rotateAngle:R.rotateAngle},me,we,be,O,ce),ke=Ve({centerX:ae,centerY:oe,width:ye,height:Me,angle:s.value.angle});s.value={...s.value,...We(ke,ae,oe)},t("resize",s.value)},()=>{e.checkCollision&&d()&&(s.value={...s.value,width:z,height:B,left:D,top:L}),t("resize-end",s.value)})}return j(()=>[e.width,e.height,e.left,e.top,e.angle],([i,u,v,M,y])=>{s.value={...s.value,width:i,height:u,left:v,top:M,angle:y}}),j(()=>e.selected,i=>{c.value=i},{immediate:!0}),(i,u)=>(T(),ne(Ye(i.tag),{ref:p,class:Re(["es-drager",{disabled:i.disabled,dragging:Y(g),selected:Y(c),border:i.border}]),style:re(E.value),onClick:u[3]||(u[3]=Xe(()=>{},["stop"]))},{default:le(()=>[I(i.$slots,"default"),m.value?(T(!0),K(Le,{key:0},Ee(f.value,(v,M)=>(T(),K("div",{key:M,class:"es-drager-dot","data-side":v.side,style:re({...v}),onMousedown:y=>h(v,y),onTouchstartPassive:y=>h(v,y)},[I(i.$slots,"resize",ze(Be({side:v.side})),()=>[Ue])],44,Oe))),128)):ie("",!0),r.value?(T(),ne(Ge,{key:1,modelValue:Y(s).angle,"onUpdate:modelValue":u[0]||(u[0]=v=>Y(s).angle=v),element:n.value,onRotate:u[1]||(u[1]=v=>t("rotate",Y(s))),onRotateStart:u[2]||(u[2]=v=>t("rotate-start",Y(s))),onRotateEnd:l},{default:le(()=>[I(i.$slots,"rotate")]),_:3},8,["modelValue","element"])):ie("",!0)]),_:3},8,["class","style"]))}}),je=o=>{o.component("es-drager",ue)};ue.install=je;export{ue as d};
