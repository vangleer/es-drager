import{d as te,r as R,f as ae,eI as $,o as B,c as V,eJ as W,F as pe,a as fe,n as U,eK as J,eL as me,eM as ve,eN as Z,u as b,b as we,w as be,eO as ye,eC as Me,eF as ke,g as _}from"./index-b8b6afa8.js";const Re={resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:100},height:{type:Number,default:100},left:{type:Number,default:0},top:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean},H=(s=0)=>parseInt(s+"")+"px",Q={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},G=["n","ne","e","se","s","sw","w","nw"],Xe={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},Ye={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},ze=(s,a)=>{const e=Ye[Math.floor(s/30)],t=(Xe[a]+e)%8;return G[t]},ee=(s=0)=>{let a=[];for(let e=0;e<G.length;e++){const t=G[e],[n,p]=Q[t].split("-"),l=ze(s,t),c={[n]:"0%",cursor:l+"-resize",side:Q[t]};if(p)c[p]="0%";else{const h=["top","bottom"].includes(n)?"left":"top";c[h]="50%"}a[e]=c}return a},I=s=>s*Math.PI/180,Ee=(s,a)=>Math.sqrt(s*s+a*a),m=s=>Math.cos(I(s)),v=s=>Math.sin(I(s)),Be=(s,a,e,t,n,p,l)=>{let{width:c,height:h,centerX:f,centerY:w,rotateAngle:r}=a;const i=c<0?-1:1,d=h<0?-1:1;switch(c=Math.abs(c),h=Math.abs(h),s){case"right":{const o=Y(c,e,p);c=o.width,e=o.deltaW,n?(t=e/n,h=c/n,f+=e/2*m(r)-t/2*v(r),w+=e/2*v(r)+t/2*m(r)):(f+=e/2*m(r),w+=e/2*v(r));break}case"top-right":{t=-t;const o=Y(c,e,p);c=o.width,e=o.deltaW;const u=X(h,t,l);h=u.height,t=u.deltaH,n&&(e=t*n,c=h*n),f+=e/2*m(r)+t/2*v(r),w+=e/2*v(r)-t/2*m(r);break}case"bottom-right":{const o=Y(c,e,p);c=o.width,e=o.deltaW;const u=X(h,t,l);h=u.height,t=u.deltaH,n&&(e=t*n,c=h*n),f+=e/2*m(r)-t/2*v(r),w+=e/2*v(r)+t/2*m(r);break}case"bottom":{const o=X(h,t,l);h=o.height,t=o.deltaH,n?(e=t*n,c=h*n,f+=e/2*m(r)-t/2*v(r),w+=e/2*v(r)+t/2*m(r)):(f-=t/2*v(r),w+=t/2*m(r));break}case"bottom-left":{e=-e;const o=Y(c,e,p);c=o.width,e=o.deltaW;const u=X(h,t,l);h=u.height,t=u.deltaH,n&&(h=c/n,t=e/n),f-=e/2*m(r)+t/2*v(r),w-=e/2*v(r)-t/2*m(r);break}case"left":{e=-e;const o=Y(c,e,p);c=o.width,e=o.deltaW,n?(h=c/n,t=e/n,f-=e/2*m(r)+t/2*v(r),w-=e/2*v(r)-t/2*m(r)):(f-=e/2*m(r),w-=e/2*v(r));break}case"top-left":{e=-e,t=-t;const o=Y(c,e,p);c=o.width,e=o.deltaW;const u=X(h,t,l);h=u.height,t=u.deltaH,n&&(c=h*n,e=t*n),f-=e/2*m(r)-t/2*v(r),w-=e/2*v(r)+t/2*m(r);break}case"top":{t=-t;const o=X(h,t,l);h=o.height,t=o.deltaH,n?(c=h*n,e=t*n,f+=e/2*m(r)+t/2*v(r),w+=e/2*v(r)-t/2*m(r)):(f+=t/2*v(r),w-=t/2*m(r));break}}return{position:{centerX:f,centerY:w},size:{width:c*i,height:h*d}}},X=(s,a,e)=>{const t=s+a;return t>e?s=t:(a=e-s,s=e),{height:s,deltaH:a}},Y=(s,a,e)=>{const t=s+a;return t>e?s=t:(a=e-s,s=e),{width:s,deltaW:a}},Le=({centerX:s,centerY:a,width:e,height:t,angle:n})=>({top:a-t/2,left:s-e/2,width:e,height:t,angle:n}),Ne=(s,a,e)=>{const{width:t,height:n}=s;return{width:Math.abs(t),height:Math.abs(n),left:a-Math.abs(t)/2,top:e-Math.abs(n)/2}};function x(s,a){const e=Math.abs(s)%a,t=s>0?a:-a;let n=0;return e>a/2?n=t*Math.ceil(Math.abs(s)/a):n=t*Math.floor(Math.abs(s)/a),n}let Ae=1e3;function Ce(s,a,e){const t=R(),n=R(!1),p=R(!1),l=R({width:a.width,height:a.height,left:a.left,top:a.top,angle:a.angle});function c(i){if(a.disabled)return;n.value=!0,p.value=!0;let{clientX:d,clientY:o}=i;const{left:u,top:g}=l.value;s.value.style.zIndex=He();let z=0,L=0;a.boundary&&([z,L]=h()),e&&e("drag-start",l.value),K(E=>{let M=(E.clientX-d)/a.scaleRatio+u,k=(E.clientY-o)/a.scaleRatio+g;if(a.snapToGrid){let{left:y,top:N}=l.value;const D=M-y,P=k-N;M=y+x(D,a.gridX),k=N+x(P,a.gridY)}a.boundary&&([M,k]=f(M,k,z,L)),l.value.left=M,l.value.top=k,e&&e("drag",l.value)},E=>{n.value=!1,document.addEventListener("click",w,{once:!0}),e&&e("drag-end",l.value)})}const h=()=>{const{width:i,height:d}=l.value,o=(s.value.parentElement||document.body).getBoundingClientRect(),u=o.width/a.scaleRatio-i,g=o.height/a.scaleRatio-d;return[u,g]},f=(i,d,o,u)=>(i=i<0?0:i,i=i>o?o:i,d=d<0?0:d,d=d>u?u:d,[i,d]),w=()=>{p.value=!1},r=i=>{if(n.value)return;let{left:d,top:o}=l.value;if(["ArrowRight","ArrowLeft"].includes(i.key)){const u=i.key==="ArrowRight";let g=u?1:-1;a.snapToGrid&&(g=u?a.gridX:-a.gridX),d=d+g}else if(["ArrowUp","ArrowDown"].includes(i.key)){const u=i.key==="ArrowDown";let g=u?1:-1;a.snapToGrid&&(g=u?a.gridY:-a.gridY),o=o+g}if(a.boundary){const[u,g]=h();[d,o]=f(d,o,u,g)}l.value.left=d,l.value.top=o};return Me(()=>{s.value&&s.value.addEventListener("mousedown",c)}),$(p,i=>{a.disabledKeyEvent||(i?document.addEventListener("keydown",r):document.removeEventListener("keydown",r))}),ke(()=>{document.removeEventListener("keydown",r)}),{isMousedown:n,selected:p,dragRef:t,dragData:l}}function He(){return++Ae+""}function K(s,a){const e=t=>{a&&a(t),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e)}const Ve=_("div",{class:"es-drager-rotate-handle"},[_("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[_("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),We=te({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object,required:!0}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(s,{emit:a}){const e=s,t=R(null),n=ae({get:()=>e.modelValue,set:l=>{a("update:modelValue",l)}});function p(l){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");l.stopPropagation(),l.preventDefault();const{width:c,height:h,left:f,top:w}=e.element.getBoundingClientRect(),r=f+c/2,i=w+h/2;a("rotate-start",n.value),K(d=>{const o=r-d.clientX,u=i-d.clientY,g=Math.atan2(u,o)*180/Math.PI-90;n.value=(g+360)%360,a("rotate",n.value)},()=>{a("rotate-end",n.value)})}return(l,c)=>(B(),V("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:p},[W(l.$slots,"default",{},()=>[Ve])],544))}}),_e=["data-side","onMousedown"],xe=_("div",{class:"es-drager-dot-handle"},null,-1),oe=te({__name:"drager",props:Re,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(s,{emit:a}){const e=s,t=(i,...d)=>{a(i,...d),a("change",...d)},n=R(null),{selected:p,dragData:l,isMousedown:c}=Ce(n,e,t),h=R(ee()),f=ae(()=>{const{width:i,height:d,left:o,top:u,angle:g}=l.value;return{width:H(i),height:H(d),left:H(o),top:H(u),transform:`rotate(${g}deg)`,"--es-drager-color":e.color}});function w(i){h.value=ee(i),t("rotate-end",l.value)}function r(i,d){d.stopPropagation(),d.preventDefault();const o=d.clientX,u=d.clientY,{width:g,height:z,left:L,top:E}=l.value,M=L+g/2,k=E+z/2,y={width:g,height:z,centerX:M,centerY:k,rotateAngle:l.value.angle},N=i.side,{minWidth:D,minHeight:P,aspectRatio:S}=e;t("resize-start",l.value),K(T=>{const{clientX:se,clientY:ne}=T;let A=(se-o)/e.scaleRatio,C=(ne-u)/e.scaleRatio;e.snapToGrid&&(A=x(A,e.gridX),C=x(C,e.gridY));const re=Math.atan2(C,A),F=Ee(A,C),le=T.shiftKey,q=re-I(y.rotateAngle),de=F*Math.cos(q),ie=F*Math.sin(q),ue=le&&!S?y.width/y.height:S,{position:{centerX:O,centerY:j},size:{width:ce,height:he}}=Be(N,{...y,rotateAngle:y.rotateAngle},de,ie,ue,D,P),ge=Le({centerX:O,centerY:j,width:ce,height:he,angle:l.value.angle});l.value={...l.value,...Ne(ge,O,j)},t("resize",l.value)},()=>{t("resize-end",l.value)})}return $(()=>[e.width,e.height,e.left,e.top,e.angle],([i,d,o,u,g])=>{l.value={...l.value,width:i,height:d,left:o,top:u,angle:g}}),$(()=>e.selected,i=>{p.value=i},{immediate:!0}),(i,d)=>(B(),V("div",{ref_key:"dragRef",ref:n,class:ye(["es-drager",{disabled:i.disabled,dragging:b(c),selected:b(p)}]),style:U(b(f)),onClick:d[3]||(d[3]=J(()=>{},["stop"]))},[W(i.$slots,"default"),!i.disabled&&i.resizable?(B(!0),V(pe,{key:0},fe(h.value,(o,u)=>(B(),V("div",{key:u,class:"es-drager-dot","data-side":o.side,style:U({...o}),onMousedown:J(g=>r(o,g),["stop","prevent"])},[W(i.$slots,"resize",me(ve({side:o.side})),()=>[xe])],44,_e))),128)):Z("",!0),!i.disabled&&b(p)?(B(),we(We,{key:1,modelValue:b(l).angle,"onUpdate:modelValue":d[0]||(d[0]=o=>b(l).angle=o),"drag-data":b(l),element:n.value,onRotate:d[1]||(d[1]=o=>t("rotate",b(l))),onRotateStart:d[2]||(d[2]=o=>t("rotate-start",b(l))),onRotateEnd:w},{default:be(()=>[W(i.$slots,"rotate")]),_:3},8,["modelValue","drag-data","element"])):Z("",!0)],6))}}),De=s=>{s.component("es-drager",oe)};oe.install=De;export{oe as o};
