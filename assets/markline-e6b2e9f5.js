import{d as X,r as p,f as Y,eE as z,eF as H,c as T,g as h,u as c,F as I,a as J,h as b,eG as C,n as y,o as g,b as D,w as S,eH as K,e as M,t as V,m as j,_ as q}from"./index-badecdea.js";import{i as P}from"./index.es-6d7c8841.js";const U={class:"es-tools"},W=X({__name:"markline",setup($){const x=p(!0),_=p(20),L=p(20),E=Y(()=>x.value?{"--es-grid-width":_.value+"px","--es-grid-height":L.value+"px"}:{}),m=p(-1),v=p({componentList:[{component:"div",text:"div1",width:100,height:100,left:0,top:0},{component:"div",text:"div2",width:100,height:100,top:100,left:100}]}),l=z({left:null,top:null}),d=p({x:[],y:[]}),f=O(v);function B(o){m.value=o,d.value=N()}function A(o){l.top=null,l.left=null;for(let t=0;t<d.value.y.length;t++){const{top:e,showTop:r}=d.value.y[t];if(Math.abs(e-o.top)<5){l.top=r;break}}for(let t=0;t<d.value.x.length;t++){const{left:e,showLeft:r}=d.value.x[t];if(Math.abs(e-o.left)<5){l.left=r;break}}}function G(){f.record(),l.top=null,l.left=null}function N(){const o={x:[],y:[]},{width:t,height:e}=v.value.componentList[m.value];return v.value.componentList.forEach((r,i)=>{if(m.value===i)return;const{top:n,left:s,width:a,height:u}=r;o.x.push({showLeft:s,left:s}),o.x.push({showLeft:s+a,left:s+a}),o.x.push({showLeft:s+a/2,left:s+a/2-t/2}),o.x.push({showLeft:s+a,left:s+a-t}),o.x.push({showLeft:s,left:s-t}),o.y.push({showTop:n,top:n}),o.y.push({showTop:n,top:n-e}),o.y.push({showTop:n+u/2,top:n+u/2-e/2}),o.y.push({showTop:n+u,top:n+u}),o.y.push({showTop:n+u,top:n+u-e})}),o}function F(o,t){Object.keys(o).forEach(e=>{t[e]=o[e]})}function O(o){const t=[];let e=-1;const r=()=>{console.log("redo",e,t),e<t.length-1&&(e++,o.value.componentList=w(t[e]))},i=()=>{console.log("undo",e,t),e>=0&&(e--,t[e]&&(o.value.componentList=w(t[e])))},n=()=>{t[++e]=w(o.value.componentList)};n();const s=a=>{const{ctrlKey:u,key:k}=a;u&&(k==="z"?i():k==="y"&&r())};return window.addEventListener("keydown",s),H(()=>{window.removeEventListener("keydown",s)}),{redo:r,undo:i,record:n}}function w(o){return JSON.parse(JSON.stringify(o))}return(o,t)=>(g(),T("div",{class:"es-container",style:y(c(E))},[h("div",U,[h("div",{class:"es-button",onClick:t[0]||(t[0]=(...e)=>c(f).undo&&c(f).undo(...e))},"撤销"),h("div",{class:"es-button",onClick:t[1]||(t[1]=(...e)=>c(f).redo&&c(f).redo(...e))},"重做")]),(g(!0),T(I,null,J(v.value.componentList,(e,r)=>(g(),D(c(P),j(e,{snapToGrid:x.value,gridX:_.value,gridY:L.value,onDragStart:i=>B(r),onDrag:t[2]||(t[2]=i=>A(i)),onChange:i=>F(i,e),onDragEnd:G}),{default:S(()=>[(g(),D(K(e.component),null,{default:S(()=>[M(V(e.text),1)]),_:2},1024))]),_:2},1040,["snapToGrid","gridX","gridY","onDragStart","onChange"]))),256)),b(h("div",{class:"es-markline-left",style:y({left:l.left+"px"})},null,4),[[C,l.left]]),b(h("div",{class:"es-markline-top",style:y({top:l.top+"px"})},null,4),[[C,l.top]])],4))}});const Z=q(W,[["__scopeId","data-v-9e519e5b"]]);export{Z as default};
