import{d as O,Z as z,E as K,$ as G,o as x,b as H,w as k,j as M,g as C,e as N,u as _,a0 as S,N as W,m as Z,a1 as Q,a2 as I,r as V,i as B,s as T,y as ee,a3 as te,a4 as ne,a5 as oe,a6 as le,c as E,q as P,l as se,B as ie,F as ce,a as ae,t as re,H as ue,C as X,_ as J,L as pe}from"./index-BmVjITA3.js";import{c as de,m as me,e as R,u as fe}from"./GridRect-B1hSIZj1.js";const ve=O({__name:"Dialog",props:{option:{type:Object,default:()=>({})}},setup(t,{expose:p}){const o=z({option:t.option,visible:!1});let c;const s=i=>{o.option=i,o.visible=!0,K(()=>{c=G.edit("esEditor",{maxLines:34,minLines:34,fontSize:14,theme:"ace/theme/one_dark",mode:"ace/mode/json5",tabSize:4,readOnly:!1}),c.setValue(JSON.stringify(JSON.parse(o.option.content),null,4))})},b=()=>{o.visible=!1},g=()=>{const{confirm:i}=o.option;i&&i(c&&c.getValue())},d=()=>{if(!c)return;const i=document.createElement("a"),l=W().format("YYYY-MM-DD")+"-es-drager.json";i.download=l;const f=new Blob([c.getValue()]),u=URL.createObjectURL(f);i.href=u,i.click(),URL.revokeObjectURL(u)};return p({open:s,close:b}),(i,l)=>(x(),H(_(Q),Z({modelValue:o.visible,"onUpdate:modelValue":l[0]||(l[0]=f=>o.visible=f)},o.option,{draggable:""}),{footer:k(()=>[C(_(S),{onClick:b},{default:k(()=>l[1]||(l[1]=[N("取消")])),_:1}),C(_(S),{type:"primary",onClick:g},{default:k(()=>l[2]||(l[2]=[N("保存编辑")])),_:1}),C(_(S),{type:"primary",onClick:d},{default:k(()=>l[3]||(l[3]=[N("导出JSON")])),_:1})]),default:k(()=>[l[4]||(l[4]=M("div",{id:"esEditor"},null,-1))]),_:1},16,["modelValue"]))}});let L=null;function Re(t){if(!L){const{container:r}=Y(),o=document.createElement("div");L=C(ve,{option:t}),I(L,o),r.appendChild(o.firstElementChild)}const{open:p}=L.component.exposed;p(t)}const be={key:0},ge=["onClick"],ye=O({__name:"Menu",props:{option:{type:Object,default:()=>({})}},setup(t,{expose:p}){const r=t,o=V(),c=V(),s=z({option:r.option,visible:!1,top:0,left:0}),b=B(()=>({left:s.left+"px",top:s.top+"px"})),g=B(()=>({left:s.option.clientX+"px",top:s.option.clientY+"px"})),d=[ne(),oe(),le(10)],i=u=>{s.option=u,s.visible=!0,te(o.value,c.value,{middleware:d}).then(m=>{s.left=m.x,s.top=m.y})},l=()=>{s.visible=!1},f=u=>{s.option.onClick&&s.option.onClick(u),l()};return T(()=>{document.addEventListener("mousedown",l)}),ee(()=>{document.removeEventListener("mousedown",l)}),p({open:i,close:l}),(u,m)=>(x(),E("div",null,[M("div",{ref_key:"triggerRef",ref:o,class:"es-trigger",style:P(g.value)},null,4),se(M("div",{ref_key:"menuRef",ref:c,class:"es-contentmenu",style:P(b.value),onClick:m[0]||(m[0]=X(()=>{},["stop"])),onMousedown:m[1]||(m[1]=X(()=>{},["stop"]))},[s.option.items?(x(),E("ul",be,[(x(!0),E(ce,null,ae(s.option.items,e=>(x(),E("li",{onClick:n=>f(e)},re(e.label),9,ge))),256))])):ue("",!0)],36),[[ie,s.visible]])]))}}),xe=J(ye,[["__scopeId","data-v-b6d1f345"]]);let D=null;function q(t){if(!D){const{container:r}=Y(),o=document.createElement("div");D=C(xe,{option:t}),I(D,o),r.appendChild(o.firstElementChild)}const{open:p}=D.component.exposed;p(t)}const Ce=["accept"],ke=O({__name:"Upload",props:{option:{type:Object,required:!0}},setup(t,{expose:p}){const r={json:".json",image:"image/*"},o=t,c={option:o.option},s=V(),b=i=>{c.option=i;let l=r[i.resultType];i.accept&&(l=i.accept),s.value.setAttribute("accept",l),s.value.click()},g=async i=>{if(!c.option||!c.option.onChange)return;const{resultType:l,onChange:f}=c.option;let u=i;const m=i.target.files[0];["json","text"].includes(l)?u=await d(m):l==="image"&&(u=await d(m,l)),f(u),s.value.value=""},d=(i,l="text")=>new Promise(f=>{const u=new FileReader;u.addEventListener("load",m=>{const e=m.target.result||"{}";f(e)}),l==="text"?u.readAsText(i):u.readAsDataURL(i)});return T(()=>{b(o.option)}),p({open:b}),(i,l)=>{var f;return x(),E("input",{ref_key:"inpurRef",ref:s,type:"file",accept:(f=c.option)==null?void 0:f.accept,class:"es-upload",onChange:g},null,40,Ce)}}}),Ee=J(ke,[["__scopeId","data-v-bff817d0"]]);let U=null;function Le(t){if(U){const{open:p}=U.component.exposed;p(t)}else{const{container:p}=Y(),r=document.createElement("div");U=C(Ee,{option:t}),I(U,r),p.appendChild(r.firstElementChild)}}const he={"ctrl+x":"cut","ctrl+c":"copy","ctrl+v":"paste",Delete:"remove","ctrl+a":"selectAll","ctrl+d":"duplicate"};function De(t,p){const r=B(()=>{var e;return((e=p.value)==null?void 0:e.getBoundingClientRect())||{}});let o=null,c=null;const s=e=>e?t.value.elements.findIndex(n=>n.id===e.id):-1,b=(e,n)=>{[t.value.elements[e],t.value.elements[n]]=[t.value.elements[n],t.value.elements[e]]},g=e=>{if(!e)return;const n=R(e);n.id=fe(),t.value.elements.push(n)},d={remove(){const e=s(o);e>-1&&t.value.elements.splice(e,1)},cut(e){c=e,d.remove(e)},copy(e){c=e},duplicate(e){const n=R(e);n.left+=10,n.top+=10,g(n)},top(e){const n=s(e),[a]=t.value.elements.splice(n,1);t.value.elements.push(a)},bottom(e){const n=s(e),[a]=t.value.elements.splice(n,1);t.value.elements.unshift(a)},group(){t.value.elements=me(t.value.elements,r.value)},ungroup(){t.value.elements=de(t.value.elements,r.value)},paste(e,n,a){if(!c)return;const v=R(c);v.left=n-r.value.left,v.top=a-r.value.top,g(v)},selectAll(){t.value.elements.forEach(e=>e.selected=!0)},lock(e){const n=s(e);t.value.elements[n].disabled=!t.value.elements[n].disabled},moveUp(e){const n=s(e);n>=t.value.elements.length-1||b(n,n+1)},moveDown(e){const n=s(e);n<=0||b(n,n-1)}},i=(e,n)=>{e.preventDefault();const{clientX:a,clientY:v}=e;o=R(n);const j=t.value.elements.filter(w=>w.selected),y=[{action:"remove",label:"删除"},{action:"cut",label:"剪切"},{action:"copy",label:"复制"},{action:"duplicate",label:"创建副本"},{action:"top",label:"置顶"},{action:"bottom",label:"置底"},{action:"moveUp",label:"上移一层"},{action:"moveDown",label:"下移一层"}];!n.group&&j.length>1?y.push({action:"group",label:"组合"}):n.group&&y.push({action:"ungroup",label:"取消组合"});const h=o.disabled,F={action:"lock",label:"锁定 / 解锁"};h||y.push(F),q({clientX:a,clientY:v,items:h?[F]:y,onClick:({action:w})=>{d[w]&&d[w](o)}})},l=e=>{const{clientX:n,clientY:a}=e;q({clientX:n,clientY:a,items:[{action:"paste",label:"在这粘贴"},{action:"selectAll",label:"全选"}],onClick({action:v}){v==="paste"?d.paste(o,n,a):d[v]&&d[v](o)}})},f=e=>{if(!e.ctrlKey)return;e.preventDefault();const{deltaY:n}=e;let a=t.value.container.scaleRatio||1;n<0?a+=.1:a-=.1,a<.5?a=.5:a>2&&(a=2),t.value.container.scaleRatio=a},u=()=>{let e=document.activeElement||{tagName:""};return e.tagName==="INPUT"||e.tagName==="TEXTAREA"},m=e=>{const{ctrlKey:n,key:a}=e,v=[];n&&v.push("ctrl"),v.push(a);const j=v.join("+"),y=he[j];d[y]&&(u()||(e.preventDefault(),o=t.value.elements.find(h=>h.selected)||null,d[y](o)))};return T(()=>{window.addEventListener("keydown",m)}),pe(()=>{window.removeEventListener("keydown",m)}),{editorRect:r,onContextmenu:i,onEditorContextMenu:l,onWheel:f}}let $;const A="es-editor-container-1996",Y=()=>{if(!$&&!document.querySelector(`#${A}`)){const t=document.createElement("div");t.id=A,$=t,document.body.appendChild(t)}return{container:$,selector:A}};export{Re as $,Le as a,De as u};
