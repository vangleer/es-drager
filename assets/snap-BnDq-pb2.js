import{d as se,r as O,s as N,p as Me,c as $,D as G,o as W,E as Be,i as I,j as J,G as fe,y as V,B as ee,a as ve,H as Ce,m as me,F as He,b as Ue,e as ke,u as T,t as Re,I as Pe,J as Ve,l as Z,K as $e,L as Qe,w as ie,C as Fe,f as qe,M as Ke}from"./index--VypQAbc.js";import{_ as Ge}from"./index-D-uwUXAy.js";/*!vue3-sketch-ruler v2.2.102025年5月Sat May 10 2025 10:27:38 GMT+0800 (中国标准时间)制作*/const Ze=e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1;function _e(e,t,n,o,r,i){i?r.moveTo(e,0):r.moveTo(0,e),r.save(),i?r.translate(e+5,o*.2):r.translate(n*.1,e+32),i||r.rotate(-Math.PI/2),r.fillText(Math.round(t).toString(),4,7),r.restore(),i?r.lineTo(e,o):r.lineTo(n,e),r.stroke(),r.closePath(),r.setTransform(1,0,0,1,0,0)}function ce(e,t,n,o,r,i){o.fillStyle=r.fontShadowColor,o.strokeStyle=r.longfgColor,o.save(),o.translate(e,t),i||o.rotate(-Math.PI/2),o.font="bold 12px  Aria",o.fillText(String(n),0,0),o.restore()}const je=(e,t,n,o,r,i)=>{const{scale:h,width:f,height:u,ratio:k,palette:A,gridRatio:b,showShadowText:g}=r,{bgColor:d,fontColor:p,shadowColor:M,longfgColor:H}=A,w=i?r.canvasWidth:r.canvasHeight;e.setTransform(1,0,0,1,0,0),e.scale(k,k),e.clearRect(0,0,f,u),e.fillStyle=d,e.fillRect(0,0,f,u);const y=Ze(h)*b*10,E=y*h,B=Math.floor(t/y)*y,U=(B-t)/y*E,X=t+Math.ceil((i?f:u)/h);if(o){const x=(n-t)*h,R=o*h;if(e.fillStyle=M,i?e.fillRect(x,0,R,u):e.fillRect(0,x,f,R),g)if(i){ce(x,u*.4,Math.round(n),e,A,i);const L=(n+o-t)*h;ce(L,u*.4,Math.round(n+o),e,A,i)}else{ce(f*.4,x,Math.round(n),e,A,i);const L=(n+o-t)*h;ce(f*.4,L,Math.round(n+o),e,A,i)}}e.beginPath(),e.fillStyle=p,e.strokeStyle=H;for(let x=B,R=0;x<X;x+=y,R++){const L=U+R*E+.5;if(x-y<w&&x>w||x==w){const Q=U+R*E+.5+(w-x)*h;_e(Q,w,f,u,e,i);return}x>=0&&x<=w&&(x==0?i?(e.moveTo(L,0),e.lineTo(L,u)):(e.moveTo(0,L),e.lineTo(f,L)):i?(e.moveTo(L,20),e.lineTo(L,u/1.3)):(e.moveTo(20,L),e.lineTo(f/1.3,L)),e.save(),x==0?i?e.translate(L-15,u*.01):e.translate(f*.3,L-5):i?e.translate(L-12,u*.05):e.translate(f*.05,L+12),i||e.rotate(-Math.PI/2),w-x>y/2&&(!g||o==0||Math.abs(x-n)>y/2&&Math.abs(x-(n+o))>y/2)&&e.fillText(x.toString(),4,9),e.restore())}e.stroke(),e.closePath()};function Ee(e,t=100){let n=null;const o=function(...r){n!==null&&clearTimeout(n),n=setTimeout(()=>{e(...r)},t)};return o.cancel=function(){n!==null&&(clearTimeout(n),n=null)},o}function We(e,t){const n=O(0),o=O(0),r=O(!1),i=N(()=>({backgroundColor:e.palette.hoverBg,color:e.palette.hoverColor,[t?"top":"left"]:"-8px",[t?"left":"top"]:`${n.value+10}px`})),h=({offsetX:d,offsetY:p})=>{n.value=t?d:p},f=(d,p)=>new Promise(M=>{if(e.lockLine)return;const H=t?d.clientY:d.clientX;h(d);const w=p||o.value;let y=w;const E=U=>{let X=((t?U.clientY:U.clientX)-H)/e.scale+w,x=X;const R=(t?e.snapsObj.h:e.snapsObj.v).slice().sort((L,Q)=>Math.abs(x-L)-Math.abs(x-Q));R.length&&Math.abs(R[0]-X)<e.snapThreshold/e.scale&&(x=R[0],X=x),y=Math.round(X),o.value=y},B=()=>{document.removeEventListener("mousemove",E),u(y,e.index),M()};document.addEventListener("mousemove",E),document.addEventListener("mouseup",B,{once:!0})}),u=(d,p)=>{var M,H;const w=t?(M=e.lines)==null?void 0:M.h:(H=e.lines)==null?void 0:H.v,y=k(d);if(w)if(y)if(typeof p=="number")w.splice(p,1);else return;else typeof p!="number"?w.push(d):w[p]=d},k=d=>{const p=t?e.canvasHeight:e.canvasWidth;return d<0||d>p},A=N(()=>k(o.value)?"放开删除":`${t?"Y":"X"}：${o.value*e.rate}`),b=Ee(()=>{r.value=!1},200),g=Ee(()=>{r.value=!0},200);return{showLabel:r,startValue:o,actionStyle:i,labelContent:A,handleMouseDown:f,handleMouseenter:d=>{e.lockLine||(h(d),g(),b.cancel())},handleMouseLeave:()=>{b()}}}const Je={key:0,class:"value"},et=se({__name:"ruler-line",props:{scale:{},palette:{},index:{},start:{},vertical:{type:Boolean},value:{},canvasWidth:{},canvasHeight:{},lines:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},lockLine:{type:Boolean}},setup(e){const t=e,n=O(!1),{actionStyle:o,handleMouseDown:r,labelContent:i,startValue:h,showLabel:f,handleMouseenter:u,handleMouseLeave:k}=We(t,t.vertical),A=N(()=>h.value>=t.start),b=N(()=>{const{lineType:d,lockLineColor:p,lineColor:M}=t.palette,H=t.lockLine?p:M??"black",w=t.lockLine||n.value?"none":"auto",y=t.isShowReferLine&&!t.lockLine?t.vertical?"ns-resize":"ew-resize":"default",E=t.vertical?"borderTop":"borderLeft",B=(h.value-t.start)*t.scale;return{[E]:`1px ${d} ${H}`,pointerEvents:w,cursor:y,[t.vertical?"top":"left"]:`${B}px`}});Me(()=>{h.value=t.value??0});const g=Ee(()=>{n.value=!1},1e3);return G([()=>t.scale],()=>{n.value=!0,g()}),(d,p)=>J((W(),$("div",{class:"line",style:V(b.value),onMouseenter:p[0]||(p[0]=Z((...M)=>T(u)&&T(u)(...M),["stop"])),onMouseleave:p[1]||(p[1]=Z((...M)=>T(k)&&T(k)(...M),["stop"])),onMousedown:p[2]||(p[2]=Z((...M)=>T(r)&&T(r)(...M),["stop"]))},[I("div",{class:"action",style:V(T(o))},[T(f)?(W(),$("span",Je,Re(T(i)),1)):Ce("",!0)],4)],36)),[[ee,A.value]])}}),tt=se({__name:"index",props:{scale:{},palette:{},vertical:{type:Boolean},showShadowText:{type:Boolean},start:{},width:{},height:{},selectStart:{},selectLength:{},canvasWidth:{},canvasHeight:{},rate:{},gridRatio:{}},emits:["handleDragStart"],setup(e,{emit:t}){const n=e,o=t,r=Pe({isDragging:!1,canvasContext:null});let i=window.devicePixelRatio;const h=O(null);Me(()=>{window.addEventListener("resize",f),u(),A(i),b(i)});const f=()=>{i=window.devicePixelRatio,A(i),b(i)},u=()=>{var d;r.canvasContext=((d=h.value)==null?void 0:d.getContext("2d"))||null},k=N(()=>({width:n.width+"px",height:n.height+"px",cursor:n.vertical?"ew-resize":"ns-resize",[n.vertical?"borderRight":"borderBottom"]:`1px solid ${n.palette.borderColor||"#eeeeef"} `}));Ve(()=>{window.removeEventListener("resize",f)});const A=d=>{if(h.value){h.value.width=Math.round(n.width*d),h.value.height=Math.round(n.height*d);const p=r.canvasContext;p&&(p.font=`11px -apple-system,
                "Helvetica Neue", ".SFNSText-Regular",
                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",
                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif`,p.lineWidth=1,p.textBaseline="middle")}},b=d=>{const p={scale:n.scale,width:n.width,height:n.height,palette:n.palette,canvasWidth:n.canvasWidth,canvasHeight:n.canvasHeight,ratio:d,rate:n.rate,gridRatio:n.gridRatio,showShadowText:n.showShadowText};p.scale=n.scale/n.rate,p.canvasWidth=n.canvasWidth*n.rate,p.canvasHeight=n.canvasHeight*n.rate,r.canvasContext&&je(r.canvasContext,n.start*n.rate,n.selectStart,n.selectLength,p,!n.vertical)};G([()=>n.width,()=>n.height,()=>n.start,()=>n.palette,()=>n.selectStart,()=>n.selectLength],()=>{b(i)}),G([()=>n.width,()=>n.height],()=>{A(i)});const g=d=>{o("handleDragStart",d)};return(d,p)=>(W(),$("canvas",{ref_key:"canvas",ref:h,class:"ruler",style:V(k.value),onMousedown:Z(g,["stop"])},null,36))}}),nt={class:"lines"},ot={key:0,class:"value"},ze=se({__name:"ruler-wrapper",props:{scale:{},thick:{},canvasWidth:{},canvasHeight:{},palette:{},vertical:{type:Boolean},width:{},height:{},start:{},startOther:{},lines:{},selectStart:{},selectLength:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},gridRatio:{},lockLine:{type:Boolean},showShadowText:{type:Boolean}},emits:["changeLineState"],setup(e,{emit:t}){const n=e,{showLabel:o,actionStyle:r,handleMouseenter:i,handleMouseLeave:h,handleMouseDown:f,labelContent:u,startValue:k}=We(n,!n.vertical),A=O(!1),b=O(!1),g=N(()=>n.vertical?"v-container":"h-container"),d=t,p=N(()=>{var w,y;return n.vertical?(w=n.lines)==null?void 0:w.h:(y=n.lines)==null?void 0:y.v}),M=N(()=>{const w=n.palette.lineType;let y=n.vertical?"left":"top",E=n.vertical?"top":"left",B=n.vertical?"borderLeft":"borderBottom";const U=(k.value-n.startOther)*n.scale+n.thick;return{[y]:U+"px",[E]:-n.thick+"px",cursor:n.vertical?"ew-resize":"ns-resize",[B]:`1px ${w} ${n.palette.lineColor}`}}),H=async w=>{const{offsetX:y,offsetY:E}=w,{scale:B,vertical:U,thick:X,startOther:x}=n;if(!A.value){b.value=!0,d("changeLineState",!1);let R=Math.round(x-X/B+(U?y:E)/B);k.value=R,await f(w,R),b.value=!1}};return G([()=>n.lockLine],()=>{A.value=n.lockLine}),(w,y)=>(W(),$("div",{class:fe(g.value)},[ve(tt,me(w.$props,{onHandleDragStart:H}),null,16),J(I("div",nt,[(W(!0),$(He,null,Ue(p.value,(E,B)=>(W(),ke(et,me({key:E+B,index:B,value:E>>0,ref_for:!0},w.$props),null,16,["index","value"]))),128))],512),[[ee,w.isShowReferLine]]),w.isShowReferLine?J((W(),$("div",{key:0,class:"indicator",style:V(M.value),onMouseenter:y[0]||(y[0]=(...E)=>T(i)&&T(i)(...E)),onMouseleave:y[1]||(y[1]=(...E)=>T(h)&&T(h)(...E))},[I("div",{class:"action",style:V(T(r))},[T(o)?(W(),$("span",ot,Re(T(u)),1)):Ce("",!0)],4)],36)),[[ee,b.value]]):Ce("",!0)],2))}}),at="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC",lt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII=";/*!simple-panzoom v1.0.72024年8月Sat Aug 10 2024 16:04:04 GMT+0800 (中国标准时间)制作*/typeof window<"u"&&(window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),typeof window.CustomEvent!="function"&&(window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}));function Ye(e,t){let n=e.length;for(;n--;)if(e[n].pointerId===t.pointerId)return n;return-1}function Le(e,t){let n;if(t.touches){n=0;for(const o of t.touches)o.pointerId=n++,Le(e,o);return}n=Ye(e,t),n>-1&&e.splice(n,1),e.push(t)}function rt(e,t){if(t.touches){for(;e.length;)e.pop();return}const n=Ye(e,t);n>-1&&e.splice(n,1)}function Oe(e){e=e.slice(0);let t=e.pop(),n;for(;n=e.pop();)t={clientX:(n.clientX-t.clientX)/2+t.clientX,clientY:(n.clientY-t.clientY)/2+t.clientY};return t}function xe(e){if(e.length<2)return 0;const t=e[0],n=e[1];return Math.sqrt(Math.pow(Math.abs(n.clientX-t.clientX),2)+Math.pow(Math.abs(n.clientY-t.clientY),2))}let re={down:"mousedown",move:"mousemove",up:"mouseup mouseleave"};typeof window<"u"&&(typeof window.PointerEvent=="function"?re={down:"pointerdown",move:"pointermove",up:"pointerup pointerleave pointercancel"}:typeof window.TouchEvent=="function"&&(re={down:"touchstart",move:"touchmove",up:"touchend touchcancel"}));function Ae(e,t,n,o){re[e].split(" ").forEach(r=>{t.addEventListener(r,n,o)})}function Se(e,t,n){re[e].split(" ").forEach(o=>{t.removeEventListener(o,n)})}const st=typeof document<"u"&&!!document.documentMode;let Xe;function it(){return Xe||(Xe=document.createElement("div").style)}const Ne=["webkit","moz","ms"],ue={};function Te(e){if(ue[e])return ue[e];const t=it();if(e in t)return ue[e]=e;const n=e[0].toUpperCase()+e.slice(1);let o=Ne.length;for(;o--;){const r=`${Ne[o]}${n}`;if(r in t)return ue[e]=r}}function he(e,t){return parseFloat(t[Te(e)])||0}function de(e,t,n=window.getComputedStyle(e)){const o=t==="border"?"Width":"";return{left:he(`${t}Left${o}`,n),right:he(`${t}Right${o}`,n),top:he(`${t}Top${o}`,n),bottom:he(`${t}Bottom${o}`,n)}}function j(e,t,n){e.style[Te(t)]=n}function ct(e,t){const n=Te("transform");j(e,"transition",`${n} ${t.duration}ms ${t.easing}`)}function ut(e,{x:t,y:n,scale:o,isSVG:r},i){if(j(e,"transform",`scale(${o}) translate(${t}px, ${n}px)`),r&&st){const h=window.getComputedStyle(e).getPropertyValue("transform");e.setAttribute("transform",h)}}function pe(e){const t=e.parentNode,n=window.getComputedStyle(e),o=window.getComputedStyle(t),r=e.getBoundingClientRect(),i=t.getBoundingClientRect();return{elem:{style:n,width:r.width,height:r.height,top:r.top,bottom:r.bottom,left:r.left,right:r.right,margin:de(e,"margin",n),border:de(e,"border",n)},parent:{style:o,width:i.width,height:i.height,top:i.top,bottom:i.bottom,left:i.left,right:i.right,padding:de(t,"padding",o),border:de(t,"border",o)}}}function ht(e){let t=e;for(;t&&t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}return!1}function dt(e){return(e.getAttribute("class")||"").trim()}function pt(e,t){return e.nodeType===1&&` ${dt(e)} `.indexOf(` ${t} `)>-1}function ft(e,t){for(let n=e;n!=null;n=n.parentNode)if(pt(n,t.excludeClass)||t.exclude.indexOf(n)>-1)return!0;return!1}const vt=/^http:[\w\.\/]+svg$/;function mt(e){return vt.test(e.namespaceURI)&&e.nodeName.toLowerCase()!=="svg"}function gt(e){const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}const Ie={animate:!1,canvas:!1,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,duration:200,easing:"ease-in-out",exclude:[],excludeClass:"panzoom-exclude",handleStartEvent:e=>{e.preventDefault(),e.stopPropagation()},maxScale:4,minScale:.125,overflow:"hidden",panOnlyWhenZoomed:!1,pinchAndPan:!1,relative:!1,setTransform:ut,startX:0,startY:0,startScale:1,step:.3,touchAction:"none"};function De(e,t){if(!e)throw new Error("Panzoom requires an element as an argument");if(e.nodeType!==1)throw new Error("Panzoom requires an element with a nodeType of 1");if(!ht(e))throw new Error("Panzoom should be called on elements that have been attached to the DOM");t={...Ie,...t};const n=mt(e),o=e.parentNode;o.style.overflow=t.overflow,o.style.userSelect="none",o.style.touchAction=t.touchAction,(t.canvas?o:e).style.cursor=t.cursor,e.style.userSelect="none",e.style.touchAction=t.touchAction,j(e,"transformOrigin",typeof t.origin=="string"?t.origin:n?"0 0":"50% 50%");function r(){o.style.overflow="",o.style.userSelect="",o.style.touchAction="",o.style.cursor="",e.style.cursor="",e.style.userSelect="",e.style.touchAction="",j(e,"transformOrigin","")}function i(a={}){for(const c in a)a.hasOwnProperty(c)&&(t[c]=a[c]);(a.hasOwnProperty("cursor")||a.hasOwnProperty("canvas"))&&(o.style.cursor=e.style.cursor="",(t.canvas?o:e).style.cursor=t.cursor),a.hasOwnProperty("overflow")&&(o.style.overflow=a.overflow),a.hasOwnProperty("touchAction")&&(o.style.touchAction=a.touchAction,e.style.touchAction=a.touchAction)}let h=0,f=0,u=1,k=!1;M(t.startScale,{animate:!1,force:!0}),setTimeout(()=>{p(t.startX,t.startY,{animate:!1,force:!0})});function A(a,c,m){if(m.silent)return;const C=new CustomEvent(a,{detail:c});e.dispatchEvent(C)}function b(a,c,m){const C={x:h,y:f,scale:u,isSVG:n,originalEvent:m,dimsOut:{}};typeof c.animate=="boolean"&&(c.animate?ct(e,c):j(e,"transition","none")),c.setTransform(e,C,c);function s(){const S=pe(e);C.dimsOut=S,A(a,C,c),A("panzoomchange",C,c)}return c.animate?setTimeout(()=>{s()},c.duration+50):requestAnimationFrame(()=>{s()}),C}function g(a,c,m,C){const s={...t,...C},S={x:h,y:f,opts:s};if(!s.force&&(s.disablePan||s.panOnlyWhenZoomed&&u===s.startScale))return S;if(a=parseFloat(a),c=parseFloat(c),s.disableXAxis||(S.x=(s.relative?h:0)+a),s.disableYAxis||(S.y=(s.relative?f:0)+c),s.contain){const v=pe(e),D=v.elem.width/u,Y=v.elem.height/u,ae=D*m,le=Y*m,q=(ae-D)/2,K=(le-Y)/2;if(s.contain==="inside"){const ge=(-v.elem.margin.left-v.parent.padding.left+q)/m,we=(v.parent.width-ae-v.parent.padding.left-v.elem.margin.left-v.parent.border.left-v.parent.border.right+q)/m;S.x=Math.max(Math.min(S.x,we),ge);const ye=(-v.elem.margin.top-v.parent.padding.top+K)/m,be=(v.parent.height-le-v.parent.padding.top-v.elem.margin.top-v.parent.border.top-v.parent.border.bottom+K)/m;S.y=Math.max(Math.min(S.y,be),ye)}else if(s.contain==="outside"){const ge=(-(ae-v.parent.width)-v.parent.padding.left-v.parent.border.left-v.parent.border.right+q)/m,we=(q-v.parent.padding.left)/m;S.x=Math.max(Math.min(S.x,we),ge);const ye=(-(le-v.parent.height)-v.parent.padding.top-v.parent.border.top-v.parent.border.bottom+K)/m,be=(K-v.parent.padding.top)/m;S.y=Math.max(Math.min(S.y,be),ye)}}return s.roundPixels&&(S.x=Math.round(S.x),S.y=Math.round(S.y)),S}function d(a,c){const m={...t,...c},C={scale:u,opts:m};if(!m.force&&m.disableZoom)return C;let s=t.minScale,S=t.maxScale;if(m.contain){const v=pe(e),D=v.elem.width/u,Y=v.elem.height/u;if(D>1&&Y>1){const ae=v.parent.width-v.parent.border.left-v.parent.border.right,le=v.parent.height-v.parent.border.top-v.parent.border.bottom,q=ae/D,K=le/Y;t.contain==="inside"?S=Math.min(S,q,K):t.contain==="outside"&&(s=Math.max(s,q,K))}}return C.scale=Math.min(Math.max(a,s),S),C}function p(a,c,m,C){const s=g(a,c,u,m);return h!==s.x||f!==s.y?(h=s.x,f=s.y,b("panzoompan",s.opts,C)):{x:h,y:f,scale:u,isSVG:n,originalEvent:C}}function M(a,c,m){const C=d(a,c),s=C.opts;if(!s.force&&s.disableZoom)return;a=C.scale;let S=h,v=f;if(s.focal){const Y=s.focal;S=(Y.x/a-Y.x/u+h*a)/a,v=(Y.y/a-Y.y/u+f*a)/a}const D=g(S,v,a,{relative:!1,force:!0});return h=D.x,f=D.y,u=a,b("panzoomzoom",s,m)}function H(a,c){const m={...t,animate:!0,...c};return M(u*Math.exp((a?1:-1)*m.step),m)}function w(a){return H(!0,a)}function y(a){return H(!1,a)}function E(a,c,m,C){const s=pe(e),S={width:s.parent.width-s.parent.padding.left-s.parent.padding.right-s.parent.border.left-s.parent.border.right,height:s.parent.height-s.parent.padding.top-s.parent.padding.bottom-s.parent.border.top-s.parent.border.bottom};let v=c.clientX-s.parent.left-s.parent.padding.left-s.parent.border.left-s.elem.margin.left,D=c.clientY-s.parent.top-s.parent.padding.top-s.parent.border.top-s.elem.margin.top;n||(v-=s.elem.width/u/2,D-=s.elem.height/u/2);const Y={x:v/S.width*(S.width*a),y:D/S.height*(S.height*a)};return M(a,{...m,animate:!1,focal:Y},C)}function B(a,c){a.preventDefault();const m={...t,...c,animate:!1},C=(a.deltaY===0&&a.deltaX?a.deltaX:a.deltaY)<0?1:-1,s=d(u*Math.exp(C*m.step/3),m).scale;return E(s,a,m,a)}function U(a){const c={...t,animate:!0,force:!0,...a};u=d(c.startScale,c).scale;const m=g(c.startX,c.startY,u,c);return h=m.x,f=m.y,b("panzoomreset",c)}let X,x,R,L,Q,F;const P=[];function te(a){if(ft(a.target,t))return;Le(P,a),k=!0,t.handleStartEvent(a),X=h,x=f,A("panzoomstart",{x:h,y:f,scale:u,isSVG:n,originalEvent:a},t);const c=Oe(P);R=c.clientX,L=c.clientY,Q=u,F=xe(P)}function ne(a){if(!k||X===void 0||x===void 0||R===void 0||L===void 0)return;Le(P,a);const c=Oe(P),m=P.length>1;let C=u;if(m){F===0&&(F=xe(P));const s=xe(P)-F;C=d(s*t.step/80+Q).scale,E(C,c,{animate:!1},a)}(!m||t.pinchAndPan)&&p(X+(c.clientX-R)/C,x+(c.clientY-L)/C,{animate:!1},a)}function _(a){P.length===1&&A("panzoomend",{x:h,y:f,scale:u,isSVG:n,originalEvent:a},t),rt(P,a),k&&(k=!1,X=x=R=L=void 0)}let oe=!1;function l(){oe||(oe=!0,Ae("down",t.canvas?o:e,te),Ae("move",document,ne,{passive:!0}),Ae("up",document,_,{passive:!0}))}function z(){oe=!1,Se("down",t.canvas?o:e,te),Se("move",document,ne),Se("up",document,_)}return t.noBind||l(),{bind:l,destroy:z,eventNames:re,getPan:()=>({x:h,y:f}),getScale:()=>u,getOptions:()=>gt(t),handleDown:te,handleMove:ne,handleUp:_,pan:p,reset:U,resetStyle:r,setOptions:i,setStyle:(a,c)=>j(e,a,c),zoom:M,zoomIn:w,zoomOut:y,zoomToPoint:E,zoomWithWheel:B}}De.defaultOptions=Ie;const wt={class:"sketch-ruler"},yt=se({__name:"index",props:{showRuler:{type:Boolean,default:!0},eyeIcon:{},closeEyeIcon:{},scale:{default:1},rate:{default:1},thick:{default:16},palette:{},width:{default:1400},height:{default:800},paddingRatio:{default:.2},autoCenter:{type:Boolean,default:!0},shadow:{default:()=>({x:0,y:0,width:0,height:0})},lines:{default:()=>({h:[],v:[]})},isShowReferLine:{type:Boolean,default:!0},canvasWidth:{default:700},canvasHeight:{default:700},snapsObj:{default:()=>({h:[],v:[]})},snapThreshold:{default:5},gridRatio:{default:1},lockLine:{type:Boolean,default:!1},selfHandle:{type:Boolean,default:!1},showShadowText:{type:Boolean,default:!0},panzoomOption:{}},emits:["onCornerClick","update:scale","zoomchange","update:lockLine"],setup(e,{expose:t,emit:n}){$e(l=>({"1ec76aa2":oe.value}));const o=e,r=n,i=O(null),h=O(0),f=O(0);let u=0,k=0;const A=O(1),b=O(o.isShowReferLine),g=O(null),d=O("defaultCursor"),p=N(()=>({bgColor:"#f6f7f9",longfgColor:"#BABBBC",fontColor:"#7D8694",fontShadowColor:"#106ebe",shadowColor:"#e9f7fe",lineColor:"#51d6a9",lineType:"solid",lockLineColor:"#d4d7dc",hoverBg:"#000",hoverColor:"#fff",borderColor:"#eeeeef",...o.palette})),M=N(()=>({backgroundImage:b.value?`url(${o.eyeIcon??at})`:`url(${o.closeEyeIcon??lt})`,width:o.thick+"px",height:o.thick+"px",borderRight:`1px solid ${p.value.borderColor}`,borderBottom:`1px solid ${p.value.borderColor}`})),H=N(()=>({background:p.value.bgColor,width:w.value+"px",height:y.value+"px"})),w=N(()=>o.width-o.thick),y=N(()=>o.height-o.thick),E=l=>{var z;(l.ctrlKey||l.metaKey)&&((z=g.value)==null||z.zoomWithWheel(l))},B=l=>{var z;const a=document.activeElement;a!=null&&a.closest(".monaco-editor")||(a==null?void 0:a.tagName)==="INPUT"||(a==null?void 0:a.tagName)==="TEXTAREA"||(a==null?void 0:a.getAttribute("contenteditable"))==="true"||l.key===" "&&(d.value="grabCursor",(z=g.value)==null||z.bind(),l.preventDefault())},U=l=>{var z;const a=document.activeElement;a!=null&&a.closest(".monaco-editor")||(a==null?void 0:a.tagName)==="INPUT"||(a==null?void 0:a.tagName)==="TEXTAREA"||(a==null?void 0:a.getAttribute("contenteditable"))==="true"||l.key===" "&&((z=g.value)==null||z.destroy(),d.value="defaultCursor")};Me(()=>{if(R(),!o.selfHandle&&i.value){const l=i.value.parentElement;if(!l)return;l.addEventListener("wheel",E),document.addEventListener("keydown",B),document.addEventListener("keyup",U)}});const X=l=>({noBind:!0,startScale:l,startX:u,startY:k,smoothScroll:!0,canvas:!0,...o.panzoomOption}),x=l=>{const{scale:z,dimsOut:a}=l.detail;if(a){r("update:scale",z),A.value=z;const c=(a.parent.left-a.elem.left)/z,m=(a.parent.top-a.elem.top)/z;h.value=c,r("zoomchange",l.detail),f.value=m}},R=()=>{if(i.value=document.querySelector(".canvasedit"),i.value){let l=o.scale;o.autoCenter&&(l=L()),g.value=De(i.value,X(l)),i.value&&i.value.addEventListener("panzoomchange",x)}},L=()=>{const l=w.value*(1-o.paddingRatio)/o.canvasWidth,z=y.value*(1-o.paddingRatio)/o.canvasHeight,a=Math.min(l,z);return u=w.value/2-o.canvasWidth/2,a<1?k=(o.canvasHeight*a/2-o.canvasHeight/2)/a-(o.canvasHeight*a-y.value)/a/2:a>1?k=(o.canvasHeight*a-o.canvasHeight)/2/a+(y.value-o.canvasHeight*a)/a/2:k=0,a},Q=()=>{var l;return(l=g.value)==null?void 0:l.reset()},F=()=>{var l;return(l=g.value)==null?void 0:l.zoomIn()},P=()=>{var l;return(l=g.value)==null?void 0:l.zoomOut()},te=()=>{var l;(l=g.value)==null||l.setOptions(X(o.scale))},ne=()=>{b.value=!b.value,r("onCornerClick",b.value)},_=l=>{r("update:lockLine",l)},oe=N(()=>o.thick+"px");return G([()=>o.isShowReferLine],()=>{b.value=o.isShowReferLine}),G([()=>o.canvasWidth,()=>o.canvasHeight,()=>o.width,()=>o.height],()=>{R()}),G(()=>o.panzoomOption,()=>{te()},{deep:!0}),t({initPanzoom:R,panzoomInstance:g,reset:Q,zoomIn:F,zoomOut:P,cursorClass:d}),(l,z)=>(W(),$("div",wt,[Be(l.$slots,"btn",{reset:Q,zoomIn:F,zoomOut:P}),I("div",{class:fe(["canvasedit-parent",d.value]),style:V(H.value)},[I("div",{class:fe(["canvasedit",d.value])},[Be(l.$slots,"default")],2)],6),J(ve(ze,{style:V({marginLeft:l.thick+"px",width:w.value+"px"}),vertical:!1,width:l.width,height:l.thick,"is-show-refer-line":b.value,thick:l.thick,start:h.value,"start-other":f.value,lines:l.lines,"select-start":l.shadow.x,"snap-threshold":l.snapThreshold,"snaps-obj":l.snapsObj,"select-length":l.shadow.width,scale:A.value,palette:p.value,"canvas-width":l.canvasWidth,"show-shadow-text":l.showShadowText,"canvas-height":l.canvasHeight,rate:l.rate,"grid-ratio":l.gridRatio,"lock-line":l.lockLine,onChangeLineState:_},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","snap-threshold","snaps-obj","select-length","scale","palette","canvas-width","show-shadow-text","canvas-height","rate","grid-ratio","lock-line"]),[[ee,l.showRuler]]),J(ve(ze,{style:V({marginTop:l.thick+"px",top:0,height:y.value+"px"}),vertical:!0,width:l.thick,height:l.height,"is-show-refer-line":b.value,thick:l.thick,start:f.value,"start-other":h.value,lines:l.lines,"select-start":l.shadow.y,"select-length":l.shadow.height,"snap-threshold":l.snapThreshold,"snaps-obj":l.snapsObj,scale:A.value,palette:p.value,"canvas-width":l.canvasWidth,"canvas-height":l.canvasHeight,"show-shadow-text":l.showShadowText,rate:l.rate,"grid-ratio":l.gridRatio,"lock-line":l.lockLine,onChangeLineState:_},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","select-length","snap-threshold","snaps-obj","scale","palette","canvas-width","canvas-height","show-shadow-text","rate","grid-ratio","lock-line"]),[[ee,l.showRuler]]),J(I("a",{class:"corner",style:V(M.value),onClick:ne},null,4),[[ee,l.showRuler]])]))}}),bt={class:"btns"},xt=["onClick"],At=["onClick"],St=["onClick"],Et=se({__name:"snap",setup(e){const t=Qe(),n=O(),o=O(),r=Pe({scale:1,thick:20,width:1470,height:700,showShadowText:!1,canvasWidth:1e3,canvasHeight:500,showRuler:!0,palette:{bgColor:"transparent",lineType:"dashed"},isShowReferLine:!0,shadow:{x:0,y:0,width:0,height:0},lines:{h:[300],v:[400]}}),i=O({componentList:[{id:"div1",component:"div",text:"div1",width:100,height:100,left:0,top:0},{id:"div2",component:"div",text:"div2",width:100,height:100,top:100,left:100}]}),h=N(()=>({width:`${r.width}px`,height:`${r.height}px`})),f=N(()=>({width:`${r.canvasWidth}px`,height:`${r.canvasHeight}px`,position:"relative",background:t.isLight?"#eff2f5":"#333333"})),u=(A,b)=>{Ke(()=>{r.shadow={x:b.left,y:b.top,width:b.width,height:b.height}}),Object.keys(A).forEach(g=>{b[g]=A[g]})},k=A=>Array.from(document.querySelectorAll(".sketch-ruler .lines .line"));return(A,b)=>(W(),$("div",null,[I("div",{class:fe(["wrapper",[T(t).isLight?"whitewrapper":"blackwrapper"]]),style:V(h.value)},[ve(T(yt),me({ref_key:"sketchruleRef",ref:n,scale:r.scale,"onUpdate:scale":b[0]||(b[0]=g=>r.scale=g)},r),{default:ie(()=>[I("div",{ref_key:"dragParentRef",ref:o,"data-type":"page",style:V(f.value)},[(W(!0),$(He,null,Ue(i.value.componentList,g=>(W(),ke(T(Ge),me({ref_for:!0},g,{key:g.id,snap:"",scaleRatio:r.scale,class:"dragerItem","snap-threshold":10,markline:"",extraLines:k,onChange:d=>u(d,g)}),{default:ie(()=>[(W(),ke(Fe(g.component),null,{default:ie(()=>[qe(Re(g.text),1)]),_:2},1024))]),_:2},1040,["scaleRatio","onChange"]))),128))],4)]),btn:ie(({reset:g,zoomIn:d,zoomOut:p})=>[I("div",bt,[I("button",{onClick:Z(g,["stop"])},"还原",8,xt),I("button",{onClick:Z(d,["stop"])},"放大",8,At),I("button",{onClick:Z(p,["stop"])},"缩小",8,St)])]),_:1},16,["scale"])],6)]))}});export{Et as default};
