import{r as L,eA as De,eI as U,eD as Ae,d as q,eJ as ue,o as E,c as B,eK as z,f as R,b as oe,w as V,eL as ke,u as y,eM as se,eN as ae,eH as Ee,a as Le,eF as Xe,eG as Ye,F as de,eO as re,_ as ze,i as ce,e as ie}from"./index-c7156e89.js";const Re={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array}};function J(s,n){const e=t=>{n&&n(t),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",s),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",s),document.addEventListener("touchend",e)}function N(s){let n=0,e=0;if(Be(s)){const t=s.targetTouches[0];n=t.pageX,e=t.pageY}else n=s.clientX,e=s.clientY;return{clientX:n,clientY:e}}function Be(s){const n=Object.prototype.toString.call(s);return n.substring(8,n.length-1)==="TouchEvent"}const S=(s=0)=>parseInt(s+"")+"px",O={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},j=["n","ne","e","se","s","sw","w","nw"],Ne={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},xe={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},Te=(s,n)=>{const e=xe[Math.floor(s/30)],r=(Ne[n]+e)%8;return j[r]},le=(s=0,n)=>{let e=[];for(let t=0;t<j.length;t++){const r=j[t],[h,l]=O[r].split("-"),d=Te(s,r),u={[h]:"0%",cursor:d+"-resize",side:O[r]};if(l)u[l]="0%";else{const g=["top","bottom"].includes(h)?"left":"top";u[g]="50%"}n?n.includes(O[r])&&e.push(u):e.push(u)}return e},Q=s=>s*Math.PI/180,$e=(s,n)=>Math.sqrt(s*s+n*n),p=s=>Math.cos(Q(s)),w=s=>Math.sin(Q(s)),Ce=(s,n,e,t,r,h,l)=>{let{width:d,height:u,centerX:g,centerY:v,rotateAngle:o}=n;const f=d<0?-1:1,c=u<0?-1:1;switch(d=Math.abs(d),u=Math.abs(u),s){case"right":{const a=Y(d,e,h);d=a.width,e=a.deltaW,r?(t=e/r,u=d/r,g+=e/2*p(o)-t/2*w(o),v+=e/2*w(o)+t/2*p(o)):(g+=e/2*p(o),v+=e/2*w(o));break}case"top-right":{t=-t;const a=Y(d,e,h);d=a.width,e=a.deltaW;const i=X(u,t,l);u=i.height,t=i.deltaH,r&&(e=t*r,d=u*r),g+=e/2*p(o)+t/2*w(o),v+=e/2*w(o)-t/2*p(o);break}case"bottom-right":{const a=Y(d,e,h);d=a.width,e=a.deltaW;const i=X(u,t,l);u=i.height,t=i.deltaH,r&&(e=t*r,d=u*r),g+=e/2*p(o)-t/2*w(o),v+=e/2*w(o)+t/2*p(o);break}case"bottom":{const a=X(u,t,l);u=a.height,t=a.deltaH,r?(e=t*r,d=u*r,g+=e/2*p(o)-t/2*w(o),v+=e/2*w(o)+t/2*p(o)):(g-=t/2*w(o),v+=t/2*p(o));break}case"bottom-left":{e=-e;const a=Y(d,e,h);d=a.width,e=a.deltaW;const i=X(u,t,l);u=i.height,t=i.deltaH,r&&(u=d/r,t=e/r),g-=e/2*p(o)+t/2*w(o),v-=e/2*w(o)-t/2*p(o);break}case"left":{e=-e;const a=Y(d,e,h);d=a.width,e=a.deltaW,r?(u=d/r,t=e/r,g-=e/2*p(o)+t/2*w(o),v-=e/2*w(o)-t/2*p(o)):(g-=e/2*p(o),v-=e/2*w(o));break}case"top-left":{e=-e,t=-t;const a=Y(d,e,h);d=a.width,e=a.deltaW;const i=X(u,t,l);u=i.height,t=i.deltaH,r&&(d=u*r,e=t*r),g-=e/2*p(o)-t/2*w(o),v-=e/2*w(o)+t/2*p(o);break}case"top":{t=-t;const a=X(u,t,l);u=a.height,t=a.deltaH,r?(d=u*r,e=t*r,g+=e/2*p(o)+t/2*w(o),v+=e/2*w(o)-t/2*p(o)):(g+=t/2*w(o),v-=t/2*p(o));break}}return{position:{centerX:g,centerY:v},size:{width:d*f,height:u*c}}},X=(s,n,e)=>{const t=s+n;return t>e?s=t:(n=e-s,s=e),{height:s,deltaH:n}},Y=(s,n,e)=>{const t=s+n;return t>e?s=t:(n=e-s,s=e),{width:s,deltaW:n}},Se=({centerX:s,centerY:n,width:e,height:t,angle:r})=>({top:n-t/2,left:s-e/2,width:e,height:t,angle:r}),Ve=(s,n,e)=>{const{width:t,height:r}=s;return{width:Math.abs(t),height:Math.abs(r),left:n-Math.abs(t)/2,top:e-Math.abs(r)/2}};function I(s,n){const e=Math.abs(s)%n,t=s>0?n:-n;let r=0;return e>n/2?r=t*Math.ceil(Math.abs(s)/n):r=t*Math.floor(Math.abs(s)/n),r}function Ie(s,n,e){const t=L(!1),r=L(!1),h=L({width:n.width,height:n.height,left:n.left,top:n.top,angle:n.angle});function l(o){if(n.disabled)return;t.value=!0,r.value=!0;let{clientX:f,clientY:c}=N(o);const{left:a,top:i}=h.value;let m=0,b=0;n.boundary&&([m,b]=d()),e&&e("drag-start",h.value),J(D=>{const{clientX:x,clientY:P}=N(D);let A=(x-f)/n.scaleRatio+a,k=(P-c)/n.scaleRatio+i;if(n.snapToGrid){let{left:T,top:M}=h.value;const F=A-T,K=k-M;A=T+I(F,n.gridX),k=M+I(K,n.gridY)}n.boundary&&([A,k]=u(A,k,m,b)),h.value.left=A,h.value.top=k,e&&e("drag",h.value)},D=>{t.value=!1,document.addEventListener("click",g,{once:!0}),e&&e("drag-end",h.value)})}const d=()=>{const{width:o,height:f}=h.value,a=(s.value.parentElement||document.body).getBoundingClientRect(),i=a.width/n.scaleRatio-o,m=a.height/n.scaleRatio-f;return[i,m]},u=(o,f,c,a)=>(o=o<0?0:o,o=o>c?c:o,f=f<0?0:f,f=f>a?a:f,[o,f]),g=()=>{r.value=!1},v=o=>{if(t.value)return;let{left:f,top:c}=h.value;if(["ArrowRight","ArrowLeft"].includes(o.key)){const a=o.key==="ArrowRight";let i=a?1:-1;n.snapToGrid&&(i=a?n.gridX:-n.gridX),f=f+i}else if(["ArrowUp","ArrowDown"].includes(o.key)){const a=o.key==="ArrowDown";let i=a?1:-1;n.snapToGrid&&(i=a?n.gridY:-n.gridY),c=c+i}if(n.boundary){const[a,i]=d();[f,c]=u(f,c,a,i)}h.value.left=f,h.value.top=c};return De(()=>{if(!s.value)return;const{width:o,height:f}=s.value.getBoundingClientRect();h.value={...h.value,width:o||100,height:f||100},s.value.addEventListener("mousedown",l),s.value.addEventListener("touchstart",l)}),U(r,o=>{n.disabledKeyEvent||(o?document.addEventListener("keydown",v):document.removeEventListener("keydown",v))}),Ae(()=>{document.removeEventListener("keydown",v)}),{isMousedown:t,selected:r,dragData:h}}const Ge=R("div",{class:"es-drager-rotate-handle"},[R("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[R("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),Pe=q({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object,required:!0}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(s,{emit:n}){const e=s,t=L(null),r=ue({get:()=>e.modelValue,set:l=>{n("update:modelValue",l)}});function h(l){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");l.stopPropagation(),l.preventDefault();const{width:d,height:u,left:g,top:v}=e.element.getBoundingClientRect(),o=g+d/2,f=v+u/2;n("rotate-start",r.value),J(c=>{const{clientX:a,clientY:i}=N(c),m=o-a,b=f-i,D=Math.atan2(b,m)*180/Math.PI-90;r.value=(D+360)%360,n("rotate",r.value)},()=>{n("rotate-end",r.value)})}return(l,d)=>(E(),B("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:h,onTouchstart:h},[z(l.$slots,"default",{},()=>[Ge])],544))}});const Fe=["data-side","onMousedown","onTouchstart"],Ke=R("div",{class:"es-drager-dot-handle"},null,-1),G=q({__name:"drager",props:Re,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(s,{emit:n}){const e=s,t=(c,...a)=>{n(c,...a),n("change",...a)},r=L(null),{selected:h,dragData:l,isMousedown:d}=Ie(r,e,t),u=L(le(0,e.resizeList)),g=ue(()=>{const{width:c,height:a,left:i,top:m,angle:b}=l.value,_={};return c&&(_.width=S(c)),a&&(_.height=S(a)),{..._,left:S(i),top:S(m),zIndex:e.zIndex,transform:`rotate(${b}deg)`,"--es-drager-color":e.color}});function v(c){r.value||(r.value=c.$el||c)}function o(c){u.value=le(c,e.resizeList),t("rotate-end",l.value)}function f(c,a){a.stopPropagation(),a.preventDefault();const{clientX:i,clientY:m}=N(a),b=i,_=m,{width:D,height:x,left:P,top:A}=l.value,k=P+D/2,T=A+x/2,M={width:D,height:x,centerX:k,centerY:T,rotateAngle:l.value.angle},F=c.side,{minWidth:K,minHeight:he,aspectRatio:Z}=e;t("resize-start",l.value),J(H=>{const{clientX:fe,clientY:ge}=N(H);let $=(fe-b)/e.scaleRatio,C=(ge-_)/e.scaleRatio;e.snapToGrid&&($=I($,e.gridX),C=I(C,e.gridY));const ve=Math.atan2(C,$),W=$e($,C),pe=H.shiftKey,ee=ve-Q(M.rotateAngle),we=W*Math.cos(ee),me=W*Math.sin(ee),be=pe&&!Z?M.width/M.height:Z,{position:{centerX:te,centerY:ne},size:{width:ye,height:Me}}=Ce(F,{...M,rotateAngle:M.rotateAngle},we,me,be,K,he),_e=Se({centerX:te,centerY:ne,width:ye,height:Me,angle:l.value.angle});l.value={...l.value,...Ve(_e,te,ne)},t("resize",l.value)},()=>{t("resize-end",l.value)})}return U(()=>[e.width,e.height,e.left,e.top,e.angle],([c,a,i,m,b])=>{l.value={...l.value,width:c,height:a,left:i,top:m,angle:b}}),U(()=>e.selected,c=>{h.value=c},{immediate:!0}),(c,a)=>(E(),oe(Ee(c.tag),{ref:v,class:ke(["es-drager",{disabled:c.disabled,dragging:y(d),selected:y(h),border:c.border}]),style:se(g.value),onClick:a[3]||(a[3]=ae(()=>{},["stop"]))},{default:V(()=>[z(c.$slots,"default"),!c.disabled&&c.resizable?(E(!0),B(de,{key:0},Le(u.value,(i,m)=>(E(),B("div",{key:m,class:"es-drager-dot","data-side":i.side,style:se({...i}),onMousedown:ae(b=>f(i,b),["stop","prevent"]),onTouchstart:b=>f(i,b)},[z(c.$slots,"resize",Xe(Ye({side:i.side})),()=>[Ke])],44,Fe))),128)):re("",!0),!c.disabled&&y(h)?(E(),oe(Pe,{key:1,modelValue:y(l).angle,"onUpdate:modelValue":a[0]||(a[0]=i=>y(l).angle=i),"drag-data":y(l),element:r.value,onRotate:a[1]||(a[1]=i=>t("rotate",y(l))),onRotateStart:a[2]||(a[2]=i=>t("rotate-start",y(l))),onRotateEnd:o},{default:V(()=>[z(c.$slots,"rotate")]),_:3},8,["modelValue","drag-data","element"])):re("",!0)]),_:3},8,["class","style"]))}});const Oe=s=>{s.component("es-drager",G)};G.install=Oe;const Ue={};function je(s,n){return E(),B("span",null,[z(s.$slots,"default")])}const qe=ze(Ue,[["render",je]]),Ze=q({__name:"temp",setup(s){const n=L(!1);return(e,t)=>(E(),B(de,null,[R("button",{onClick:t[0]||(t[0]=r=>n.value=!n.value)},"切换选中"),ce(y(G),{width:100,height:100,left:100,top:100,rotatable:"",boundary:""},{default:V(()=>[ie(" 测试 ")]),_:1}),ce(y(G),{tag:qe,left:100,top:300,rotatable:"",boundary:""},{default:V(()=>[ie(" 123465 ")]),_:1})],64))}});export{Ze as default};
