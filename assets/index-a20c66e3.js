import{eT as z,eC as P,eU as Z,eV as C,eW as ee,eE as te,r as E,eK as oe,d as $,eG as k,o as b,c as V,u as o,b as w,w as m,g as R,F as A,a as D,n as Q,j as a,eR as I,eL as M,_ as N,eP as le,eQ as ne,e as ae,t as re,eS as de,f as T,eX as se,eH as ue,m as j,eI as ie,eJ as ce,eY as fe,eZ as me,eO as B}from"./index-c7e2b012.js";import{_ as pe}from"./index-c2572186.js";import{G as _e}from"./GridRect-68c34400.js";import{M as be}from"./MarkLine-59dc379e.js";import{u as ve,A as ye}from"./useArea-6d6f1866.js";import{u as ge,$ as Ve,a as J}from"./useEditorContainer-66830201.js";function ke(){const f=z(),e={current:-1,queue:[],commands:{},commandArray:[],destoryArray:[]},s=t=>{e.commandArray.push(t),e.commands[t.name]=(...c)=>{const{redo:l,undo:d}=t.execute(...c);if(l&&l(),t.pushQueue){let{queue:n}=e;n.length>0&&(n=n.slice(0,e.current+1),e.queue=n),e.queue.push({redo:l,undo:d}),e.current+=1}}};s({name:"redo",keyboard:"ctrl+y",execute(){return{redo(){let t=e.queue[e.current+1];t&&(t.redo&&t.redo(),e.current++)}}}}),s({name:"undo",keyboard:"ctrl+z",execute(){return{redo(){if(e.current===-1)return;let t=e.queue[e.current];t&&(t.undo&&t.undo(),e.current--)}}}}),s({name:"drag",pushQueue:!0,init(){const t=()=>{this.before=ee(f.data.elements)},c=()=>e.commands.drag();return C.on("dragstart",t),C.on("dragend",c),()=>{C.off("dragstart",t),C.off("dragend",c)}},execute(){const t=this.before,c=f.data.elements;return{redo(){f.data={...f.data,elements:c}},undo(){f.data={...f.data,elements:t}}}}}),s({name:"updateContainer",pushQueue:!0,execute(t){const c={before:f.data,after:t};return{redo(){f.data=c.after},undo(){f.data=c.before}}}}),e.commandArray.forEach(t=>{t.init&&e.destoryArray.push(t.init())});const p=()=>{const t=c=>{const{ctrlKey:l,key:d}=c,n=[];l&&n.push("ctrl"),n.push(d);const i=n.join("+");e.commandArray.forEach(({name:_,keyboard:g})=>{g&&g===i&&(e.commands[_](),c.preventDefault())})};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}};return P(()=>{e.destoryArray.push(p())}),Z(()=>{e.destoryArray.forEach(t=>t&&t())}),e}function xe(f,e){const s=te({left:null,top:null}),p=E({x:[],y:[]});return{markLine:s,updateLines:()=>{p.value=oe(f.value.elements,e.value)},updateMarkline:l=>{s.top=null,s.left=null;for(let d=0;d<p.value.y.length;d++){const{top:n,showTop:i}=p.value.y[d];if(Math.abs(n-l.top)<5){s.top=i;break}}for(let d=0;d<p.value.x.length;d++){const{left:n,showLeft:i}=p.value.x[d];if(Math.abs(n-l.left)<5){s.left=i;break}}}}}const Ce={class:"info-color-map"},he={class:"color-list"},we=["onClick"],Ee=$({__name:"Style",setup(f){const e=z(),s=E([[{backgroundColor:"#18141d",borderColor:"#ffffff"},{backgroundColor:"#f5f5f5",borderColor:"#666666"},{backgroundColor:"#dae8fc",borderColor:"#6b8ebf"},{backgroundColor:"#d5e8d4",borderColor:"#82b366"},{backgroundColor:"#ffe6cc",borderColor:"#d79b00"},{backgroundColor:"#fff2cc",borderColor:"#d6b656"},{backgroundColor:"#f8cecc",borderColor:"#b85450"},{backgroundColor:"#e1d5e7",borderColor:"#9673a6"}]]),p=[{label:"实线",value:"solid"},{label:"虚线",value:"dashed"},{label:"点线",value:"dotted"}],t=c=>{e.current.selected&&(e.current.style={...e.current.style,...c})};return(c,l)=>{const d=k("el-input-number"),n=k("el-form-item"),i=k("el-checkbox"),_=k("el-color-picker"),g=k("el-option"),S=k("el-select"),U=k("el-form"),h=k("el-switch");return b(),V("div",{class:"es-info-style",onClick:l[15]||(l[15]=M(()=>{},["stop"]))},[o(e).current&&o(e).current.selected?(b(),w(U,{key:0,model:o(e).current,"label-width":"80px","label-position":"left"},{default:m(()=>[R("div",Ce,[(b(!0),V(A,null,D(s.value,r=>(b(),V("div",he,[(b(!0),V(A,null,D(r,L=>(b(),V("div",{class:"color-item",style:Q(L),onClick:X=>t(L)},null,12,we))),256))]))),256))]),a(n,{label:"left"},{default:m(()=>[a(d,{modelValue:o(e).current.left,"onUpdate:modelValue":l[0]||(l[0]=r=>o(e).current.left=r)},null,8,["modelValue"])]),_:1}),a(n,{label:"top"},{default:m(()=>[a(d,{modelValue:o(e).current.top,"onUpdate:modelValue":l[1]||(l[1]=r=>o(e).current.top=r)},null,8,["modelValue"])]),_:1}),a(n,{label:"width"},{default:m(()=>[a(d,{modelValue:o(e).current.width,"onUpdate:modelValue":l[2]||(l[2]=r=>o(e).current.width=r)},null,8,["modelValue"])]),_:1}),a(n,{label:"height"},{default:m(()=>[a(d,{modelValue:o(e).current.height,"onUpdate:modelValue":l[3]||(l[3]=r=>o(e).current.height=r)},null,8,["modelValue"])]),_:1}),a(n,{label:"angle"},{default:m(()=>[a(d,{modelValue:o(e).current.angle,"onUpdate:modelValue":l[4]||(l[4]=r=>o(e).current.angle=r)},null,8,["modelValue"])]),_:1}),a(n,{label:"disabled"},{default:m(()=>[a(i,{modelValue:o(e).current.disabled,"onUpdate:modelValue":l[5]||(l[5]=r=>o(e).current.disabled=r)},null,8,["modelValue"])]),_:1}),a(n,{label:"resizable"},{default:m(()=>[a(i,{modelValue:o(e).current.resizable,"onUpdate:modelValue":l[6]||(l[6]=r=>o(e).current.resizable=r),checked:!0},null,8,["modelValue"])]),_:1}),a(n,{label:"rotatable"},{default:m(()=>[a(i,{modelValue:o(e).current.rotatable,"onUpdate:modelValue":l[7]||(l[7]=r=>o(e).current.rotatable=r),checked:!0},null,8,["modelValue"])]),_:1}),o(e).current.style?(b(),V(A,{key:0},[a(n,{label:"背景"},{default:m(()=>[a(_,{modelValue:o(e).current.style.backgroundColor,"onUpdate:modelValue":l[8]||(l[8]=r=>o(e).current.style.backgroundColor=r)},null,8,["modelValue"])]),_:1}),a(n,{label:"边框宽度"},{default:m(()=>[a(d,{modelValue:o(e).current.style.borderWidth,"onUpdate:modelValue":l[9]||(l[9]=r=>o(e).current.style.borderWidth=r)},null,8,["modelValue"])]),_:1}),a(n,{label:"边框风格"},{default:m(()=>[a(S,{modelValue:o(e).current.style.borderStyle,"onUpdate:modelValue":l[10]||(l[10]=r=>o(e).current.style.borderStyle=r)},{default:m(()=>[(b(),V(A,null,D(p,r=>a(g,{key:r.value,label:r.label,value:r.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"边框颜色"},{default:m(()=>[a(_,{modelValue:o(e).current.style.borderColor,"onUpdate:modelValue":l[11]||(l[11]=r=>o(e).current.style.borderColor=r)},null,8,["modelValue"])]),_:1})],64)):I("",!0)]),_:1},8,["model"])):(b(),w(U,{key:1,model:o(e).data.container,"label-width":"80px","label-position":"left"},{default:m(()=>[a(n,{label:"网格"},{default:m(()=>[a(h,{modelValue:o(e).data.container.snapToGrid,"onUpdate:modelValue":l[12]||(l[12]=r=>o(e).data.container.snapToGrid=r)},null,8,["modelValue"])]),_:1}),a(n,{label:"网格大小"},{default:m(()=>[a(d,{modelValue:o(e).data.container.gridSize,"onUpdate:modelValue":l[13]||(l[13]=r=>o(e).data.container.gridSize=r)},null,8,["modelValue"])]),_:1}),a(n,{label:"背景颜色"},{default:m(()=>[a(_,{modelValue:o(e).data.container.style.backgroundColor,"onUpdate:modelValue":l[14]||(l[14]=r=>o(e).data.container.style.backgroundColor=r)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]))])}}});const Se=N(Ee,[["__scopeId","data-v-8f5b332d"]]),Ue={class:"es-layout-info"},Me=R("div",{class:"es-info-text"}," 文本 ",-1),$e=$({__name:"Info",setup(f){const e=E("style"),s=(p,t)=>{console.log(p,t)};return(p,t)=>{const c=k("el-tab-pane"),l=k("el-tabs");return b(),V("div",Ue,[a(l,{modelValue:e.value,"onUpdate:modelValue":t[0]||(t[0]=d=>e.value=d),class:"es-info-tabs",onTabClick:s},{default:m(()=>[a(c,{label:"样式",name:"style"},{default:m(()=>[a(Se)]),_:1}),a(c,{label:"文本",name:"text"},{default:m(()=>[Me]),_:1})]),_:1},8,["modelValue"])])}}});const Ae=["contenteditable"],Le=$({__name:"TextEditor",props:{editable:{type:Boolean,default:!1},text:{type:String}},setup(f){const e=f,s=E();function p(){if(!s.value)return;const t=document.createRange();t.selectNode(s.value),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)}return le(()=>[e.editable],()=>{e.editable&&p()}),(t,c)=>(b(),V("div",{ref_key:"textRef",ref:s,class:de(["es-text",{editable:f.editable}]),contenteditable:f.editable,select:""},[ne(t.$slots,"default",{},()=>[ae(re(f.text),1)],!0)],10,Ae))}});const Te=N(Le,[["__scopeId","data-v-53f59d1c"]]),De=$({__name:"index",props:{modelValue:{type:Object,required:!0,default:()=>({})},commands:{type:Object}},setup(f){const e=f,s=z(),p=E(null),t=T({get:()=>e.modelValue,set:()=>{}}),c=T(()=>{var v;return((v=e.modelValue.container)==null?void 0:v.gridSize)||10}),l=T(()=>(t.value.container.style,{...t.value.container.style})),d=E({startX:0,startY:0,disX:0,disY:0}),n=T({get:()=>s.current,set:v=>{s.current=v}}),{markLine:i,updateLines:_,updateMarkline:g}=xe(t,n),S=E(),{areaSelected:U,onEditorMouseDown:h,onAreaMove:r,onAreaUp:L}=ve(t,S),{onContextmenu:X,onEditorContextMenu:Y}=ge(t,p);function W(v){n.value=v,U.value||t.value.elements.filter(u=>u.selected).length===1&&t.value.elements.forEach(u=>u.selected=!1),n.value.selected=!0,d.value.startX=n.value.left,d.value.startY=n.value.top,_(),C.emit("dragstart")}function H(){C.emit("dragend"),i.left=null,i.top=null}function K(v){const y=v.left-d.value.startX,u=v.top-d.value.startY;g(v),t.value.elements.forEach((x,qe)=>{var O;x.selected&&((O=n.value)==null?void 0:O.id)!==x.id&&(x.left+=y,x.top+=u)}),d.value.startX=v.left,d.value.startY=v.top}function F(v,y){Object.keys(v).forEach(u=>{y[u]=v[u]})}const q={dblclick:()=>{!n.value||!n.value.selected||(n.value.editable=!0)},click:()=>{n.value&&(n.value.editable=!1)}};function G(v="on"){["dblclick","click"].forEach(u=>{v==="on"?document.addEventListener(u,q[u]):document.removeEventListener(u,q[u])})}return P(()=>{G()}),se(()=>{G("off")}),(v,y)=>(b(),V("div",{ref_key:"editorRef",ref:p,class:"es-editor",style:Q(l.value),onMousedown:y[2]||(y[2]=(...u)=>o(h)&&o(h)(...u)),onContextmenu:y[3]||(y[3]=M((...u)=>o(Y)&&o(Y)(...u),["prevent"]))},[(b(!0),V(A,null,D(t.value.elements,u=>(b(),w(o(pe),j({rotatable:""},u,{"grid-x":c.value,"grid-y":c.value,boundary:"",onDragStart:x=>W(u),onDragEnd:H,onDrag:K,onChange:x=>F(x,u),onContextmenu:M(x=>o(X)(x,u),["stop"]),onMousedown:y[0]||(y[0]=M(()=>{},["stop"])),onClick:y[1]||(y[1]=M(()=>{},["stop"]))}),{default:m(()=>[(b(),w(ue(u.component),j(u.props,{style:{...u.style,width:"100%",height:"100%"}}),null,16,["style"])),u.text?(b(),w(Te,{key:0,editable:u.editable,text:u.text},null,8,["editable","text"])):I("",!0)]),_:2},1040,["grid-x","grid-y","onDragStart","onChange","onContextmenu"]))),256)),a(be,ie(ce(o(i))),null,16),t.value.container.snapToGrid?(b(),w(_e,{key:0,grid:t.value.container.gridSize},null,8,["grid"])):I("",!0),a(ye,{ref_key:"areaRef",ref:S,onMove:o(r),onUp:o(L)},null,8,["onMove","onUp"])],36))}});const Re=N(De,[["__scopeId","data-v-60dd63c5"]]),ze={class:"es-layout"},Ie={class:"es-layout-container"},Ne={ref:"mainRef",class:"es-layout-main"},Xe="ES Drager Editor 开发中...",Ye=$({__name:"index",setup(f){const e=z(),{commands:s}=ke(),p=[{label:"撤销",handler:s.undo},{label:"重做",handler:s.redo},{label:"导出",handler:()=>{Ve({title:"导出",content:JSON.stringify(e.data),confirm(i){s.updateContainer(JSON.parse(i))}})}},{label:"导入",handler:()=>{J({resultType:"json",onChange(i){s.updateContainer(JSON.parse(i))}})}},{label:"插入图片",handler:()=>{J({resultType:"image",onChange(i){const _={id:B(),component:"img",props:{src:i,width:160,onLoad(g){const{naturalHeight:S,naturalWidth:U}=g.target,h=e.data.elements.find(r=>r.id===_.id);h.width=U,h.height=S}}};e.data.elements.push(_)}})}}];let t=null;function c(i){C.emit("dragstart"),t=i}function l(){C.emit("dragend")}function d(i){i.dataTransfer.dropEffect="move"}function n(i){if(!t)return;const _=[...e.data.elements,{...t,left:i.offsetX-t.width/2,top:i.offsetY-t.height/2,id:B()}];e.data.elements=_,t=null}return(i,_)=>(b(),V("div",ze,[a(fe,{title:Xe,tools:p}),R("div",Ie,[a(me,{onDragstart:c,onDragend:l}),R("div",Ne,[a(Re,{modelValue:o(e).data,"onUpdate:modelValue":_[0]||(_[0]=g=>o(e).data=g),commands:o(s),onDragenter:d,onDrop:n,onDragover:_[1]||(_[1]=M(()=>{},["prevent"]))},null,8,["modelValue","commands"])],512),a($e,{modelValue:o(e).current,"onUpdate:modelValue":_[2]||(_[2]=g=>o(e).current=g)},null,8,["modelValue"])])]))}});const Qe=$({__name:"index",setup(f){return(e,s)=>(b(),w(Ye))}});export{Qe as default};
