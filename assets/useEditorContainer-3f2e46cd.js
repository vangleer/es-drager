import{d as V,Z as J,o as g,b as P,w as h,k as y,e as D,u as _,$ as M,m as X,a0 as q,h as U,a1 as G,a2 as Z,O as H,a3 as A,r as B,g as O,s as N,y as Q,c as x,n as T,i as W,B as ee,F as te,a as ne,t as oe,K as se,C as F,a4 as le,a5 as ce,a6 as ie,a7 as ae,_ as K,N as re}from"./index-c9bc5507.js";import{d as E,m as ue,c as pe,u as de}from"./GridRect-b5d0fe6b.js";const me=U("div",{id:"esEditor"},null,-1),fe=V({__name:"Dialog",props:{option:{type:Object,default:()=>({})}},setup(n,{expose:u}){const o=J({option:n.option,visible:!1});let i;const s=l=>{o.option=l,o.visible=!0,G(()=>{i=Z.edit("esEditor",{maxLines:34,minLines:34,fontSize:14,theme:"ace/theme/one_dark",mode:"ace/mode/json5",tabSize:4,readOnly:!1}),i.setValue(JSON.stringify(JSON.parse(o.option.content),null,4))})},f=()=>{o.visible=!1},v=()=>{const{confirm:l}=o.option;l&&l(i&&i.getValue())},p=()=>{if(!i)return;const l=document.createElement("a"),c=H().format("YYYY-MM-DD")+"-es-drager.json";l.download=c;const d=new Blob([i.getValue()]),e=URL.createObjectURL(d);l.href=e,l.click(),URL.revokeObjectURL(e)};return u({open:s,close:f}),(l,c)=>(g(),P(_(q),X({modelValue:o.visible,"onUpdate:modelValue":c[0]||(c[0]=d=>o.visible=d)},o.option,{draggable:""}),{footer:h(()=>[y(_(M),{onClick:f},{default:h(()=>[D("取消")]),_:1}),y(_(M),{type:"primary",onClick:v},{default:h(()=>[D("保存编辑")]),_:1}),y(_(M),{type:"primary",onClick:p},{default:h(()=>[D("导出JSON")]),_:1})]),default:h(()=>[me]),_:1},16,["modelValue"]))}});let w=null;function we(n){if(!w){const{container:a}=I(),o=document.createElement("div");w=y(fe,{option:n}),A(w,o),a.appendChild(o.firstElementChild)}const{open:u}=w.component.exposed;u(n)}const ve={key:0},be=["onClick"],ge=V({__name:"Menu",props:{option:{type:Object,default:()=>({})}},setup(n,{expose:u}){const a=n,o=B(),i=B(),s=J({option:a.option,visible:!1,top:0,left:0}),f=O(()=>({left:s.left+"px",top:s.top+"px"})),v=O(()=>({left:s.option.clientX+"px",top:s.option.clientY+"px"})),p=[ce(),ie(),ae(10)],l=e=>{s.option=e,s.visible=!0,le(o.value,i.value,{middleware:p}).then(t=>{s.left=t.x,s.top=t.y})},c=()=>{s.visible=!1},d=e=>{s.option.onClick&&s.option.onClick(e),c()};return N(()=>{document.addEventListener("mousedown",c)}),Q(()=>{document.removeEventListener("mousedown",c)}),u({open:l,close:c}),(e,t)=>(g(),x("div",null,[U("div",{ref_key:"triggerRef",ref:o,class:"es-trigger",style:T(v.value)},null,4),W(U("div",{ref_key:"menuRef",ref:i,class:"es-contentmenu",style:T(f.value),onClick:t[0]||(t[0]=F(()=>{},["stop"])),onMousedown:t[1]||(t[1]=F(()=>{},["stop"]))},[s.option.items?(g(),x("ul",ve,[(g(!0),x(te,null,ne(s.option.items,r=>(g(),x("li",{onClick:m=>d(r)},oe(r.label),9,be))),256))])):se("",!0)],36),[[ee,s.visible]])]))}}),ye=K(ge,[["__scopeId","data-v-b6d1f345"]]);let L=null;function z(n){if(!L){const{container:a}=I(),o=document.createElement("div");L=y(ye,{option:n}),A(L,o),a.appendChild(o.firstElementChild)}const{open:u}=L.component.exposed;u(n)}const he=["accept"],xe=V({__name:"Upload",props:{option:{type:Object,required:!0}},setup(n,{expose:u}){const a={json:".json",image:"image/*"},o=n,i={option:o.option},s=B(),f=l=>{i.option=l;let c=a[l.resultType];l.accept&&(c=l.accept),s.value.setAttribute("accept",c),s.value.click()},v=async l=>{if(!i.option||!i.option.onChange)return;const{resultType:c,onChange:d}=i.option;let e=l;const t=l.target.files[0];["json","text"].includes(c)?e=await p(t):c==="image"&&(e=await p(t,c)),d(e),s.value.value=""},p=(l,c="text")=>new Promise(d=>{const e=new FileReader;e.addEventListener("load",t=>{const r=t.target.result||"{}";d(r)}),c==="text"?e.readAsText(l):e.readAsDataURL(l)});return N(()=>{f(o.option)}),u({open:f}),(l,c)=>{var d;return g(),x("input",{ref_key:"inpurRef",ref:s,type:"file",accept:(d=i.option)==null?void 0:d.accept,class:"es-upload",onChange:v},null,40,he)}}}),ke=K(xe,[["__scopeId","data-v-bff817d0"]]);let R=null;function Le(n){if(R){const{open:u}=R.component.exposed;u(n)}else{const{container:u}=I(),a=document.createElement("div");R=y(ke,{option:n}),A(R,a),u.appendChild(a.firstElementChild)}}const Ce={"ctrl+x":"cut","ctrl+c":"copy","ctrl+v":"paste",Delete:"remove","ctrl+a":"selectAll","ctrl+d":"duplicate"};function Re(n,u){const a=O(()=>{var e;return((e=u.value)==null?void 0:e.getBoundingClientRect())||{}});let o=null,i=null;const s=e=>e?n.value.elements.findIndex(t=>t.id===e.id):-1,f=(e,t)=>{[n.value.elements[e],n.value.elements[t]]=[n.value.elements[t],n.value.elements[e]]},v=e=>{if(!e)return;const t=E(e);t.id=de(),n.value.elements.push(t)},p={remove(){const e=s(o);e>-1&&n.value.elements.splice(e,1)},cut(e){i=e,p.remove(e)},copy(e){i=e},duplicate(e){const t=E(e);t.left+=10,t.top+=10,v(t)},top(e){const t=s(e),[r]=n.value.elements.splice(t,1);n.value.elements.push(r)},bottom(e){const t=s(e),[r]=n.value.elements.splice(t,1);n.value.elements.unshift(r)},group(){n.value.elements=ue(n.value.elements,a.value)},ungroup(){n.value.elements=pe(n.value.elements,a.value)},paste(e,t,r){if(!i)return;const m=E(i);m.left=t-a.value.left,m.top=r-a.value.top,v(m)},selectAll(){n.value.elements.forEach(e=>e.selected=!0)},lock(e){const t=s(e);n.value.elements[t].disabled=!n.value.elements[t].disabled},moveUp(e){const t=s(e);t>=n.value.elements.length-1||f(t,t+1)},moveDown(e){const t=s(e);t<=0||f(t,t-1)}},l=(e,t)=>{e.preventDefault();const{clientX:r,clientY:m}=e;o=E(t);const $=n.value.elements.filter(C=>C.selected),b=[{action:"remove",label:"删除"},{action:"cut",label:"剪切"},{action:"copy",label:"复制"},{action:"duplicate",label:"创建副本"},{action:"top",label:"置顶"},{action:"bottom",label:"置底"},{action:"moveUp",label:"上移一层"},{action:"moveDown",label:"下移一层"}];!t.group&&$.length>1?b.push({action:"group",label:"组合"}):t.group&&b.push({action:"ungroup",label:"取消组合"});const k=o.disabled,Y={action:"lock",label:"锁定 / 解锁"};k||b.push(Y),z({clientX:r,clientY:m,items:k?[Y]:b,onClick:({action:C})=>{p[C]&&p[C](o)}})},c=e=>{const{clientX:t,clientY:r}=e;z({clientX:t,clientY:r,items:[{action:"paste",label:"在这粘贴"},{action:"selectAll",label:"全选"}],onClick({action:m}){m==="paste"?p.paste(o,t,r):p[m]&&p[m](o)}})},d=e=>{const{ctrlKey:t,key:r}=e,m=[];t&&m.push("ctrl"),m.push(r);const $=m.join("+"),b=Ce[$];p[b]&&(e.preventDefault(),o=n.value.elements.find(k=>k.selected)||null,p[b](o))};return N(()=>{window.addEventListener("keydown",d)}),re(()=>{window.removeEventListener("keydown",d)}),{editorRect:a,onContextmenu:l,onEditorContextMenu:c}}let S;const j="es-editor-container-1996",I=()=>{if(!S&&!document.querySelector(`#${j}`)){const n=document.createElement("div");n.id=j,S=n,document.body.appendChild(n)}return{container:S,selector:j}};export{we as $,Le as a,Re as u};
