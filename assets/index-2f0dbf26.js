import{r as X,eC as Ae,eL as O,eF as De,d as ce,f as I,o as Y,c as U,eM as $,g as V,b as ne,w as oe,eO as Ee,u as L,n as se,eP as ke,eH as Le,a as ze,eI as Re,eJ as Xe,F as Ye,eN as ae}from"./index-0e1211f5.js";const _e={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean}};function q(o,n){const e=t=>{n&&n(t),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",o),document.addEventListener("touchend",e)}function _(o){let n=0,e=0;if(Be(o)){const t=o.targetTouches[0];n=t.pageX,e=t.pageY}else n=o.clientX,e=o.clientY;return{clientX:n,clientY:e}}function Be(o){const n=Object.prototype.toString.call(o);return n.substring(8,n.length-1)==="TouchEvent"}const C=(o=0)=>parseInt(o+"")+"px",K={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},j=["n","ne","e","se","s","sw","w","nw"],Ne={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},xe={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},Te=(o,n)=>{const e=xe[Math.floor(o/30)],s=(Ne[n]+e)%8;return j[s]},re=(o=0,n)=>{let e=[];for(let t=0;t<j.length;t++){const s=j[t],[u,l]=K[s].split("-"),d=Te(o,s),i={[u]:"0%",cursor:d+"-resize",side:K[s]};if(l)i[l]="0%";else{const v=["top","bottom"].includes(u)?"left":"top";i[v]="50%"}n?n.includes(K[s])&&e.push(i):e.push(i)}return e},J=o=>o*Math.PI/180,Pe=(o,n)=>Math.sqrt(o*o+n*n),p=o=>Math.cos(J(o)),m=o=>Math.sin(J(o)),Se=(o,n,e,t,s,u,l)=>{let{width:d,height:i,centerX:v,centerY:y,rotateAngle:r}=n;const f=d<0?-1:1,g=i<0?-1:1;switch(d=Math.abs(d),i=Math.abs(i),o){case"right":{const c=R(d,e,u);d=c.width,e=c.deltaW,s?(t=e/s,i=d/s,v+=e/2*p(r)-t/2*m(r),y+=e/2*m(r)+t/2*p(r)):(v+=e/2*p(r),y+=e/2*m(r));break}case"top-right":{t=-t;const c=R(d,e,u);d=c.width,e=c.deltaW;const a=z(i,t,l);i=a.height,t=a.deltaH,s&&(e=t*s,d=i*s),v+=e/2*p(r)+t/2*m(r),y+=e/2*m(r)-t/2*p(r);break}case"bottom-right":{const c=R(d,e,u);d=c.width,e=c.deltaW;const a=z(i,t,l);i=a.height,t=a.deltaH,s&&(e=t*s,d=i*s),v+=e/2*p(r)-t/2*m(r),y+=e/2*m(r)+t/2*p(r);break}case"bottom":{const c=z(i,t,l);i=c.height,t=c.deltaH,s?(e=t*s,d=i*s,v+=e/2*p(r)-t/2*m(r),y+=e/2*m(r)+t/2*p(r)):(v-=t/2*m(r),y+=t/2*p(r));break}case"bottom-left":{e=-e;const c=R(d,e,u);d=c.width,e=c.deltaW;const a=z(i,t,l);i=a.height,t=a.deltaH,s&&(i=d/s,t=e/s),v-=e/2*p(r)+t/2*m(r),y-=e/2*m(r)-t/2*p(r);break}case"left":{e=-e;const c=R(d,e,u);d=c.width,e=c.deltaW,s?(i=d/s,t=e/s,v-=e/2*p(r)+t/2*m(r),y-=e/2*m(r)-t/2*p(r)):(v-=e/2*p(r),y-=e/2*m(r));break}case"top-left":{e=-e,t=-t;const c=R(d,e,u);d=c.width,e=c.deltaW;const a=z(i,t,l);i=a.height,t=a.deltaH,s&&(d=i*s,e=t*s),v-=e/2*p(r)-t/2*m(r),y-=e/2*m(r)+t/2*p(r);break}case"top":{t=-t;const c=z(i,t,l);i=c.height,t=c.deltaH,s?(d=i*s,e=t*s,v+=e/2*p(r)+t/2*m(r),y+=e/2*m(r)-t/2*p(r)):(v+=t/2*m(r),y-=t/2*p(r));break}}return{position:{centerX:v,centerY:y},size:{width:d*f,height:i*g}}},z=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{height:o,deltaH:n}},R=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{width:o,deltaW:n}},Ce=({centerX:o,centerY:n,width:e,height:t,angle:s})=>({top:n-t/2,left:o-e/2,width:e,height:t,angle:s}),Ie=(o,n,e)=>{const{width:t,height:s}=o;return{width:Math.abs(t),height:Math.abs(s),left:n-Math.abs(t)/2,top:e-Math.abs(s)/2}};function G(o,n){const e=Math.abs(o)%n,t=o>0?n:-n;let s=0;return e>n/2?s=t*Math.ceil(Math.abs(o)/n):s=t*Math.floor(Math.abs(o)/n),s}function $e(o,n,e){const t=X(!1),s=X(!1),u=X({width:n.width,height:n.height,left:n.left,top:n.top,angle:n.angle}),l=new Set;function d(f){if(l.add(f.button),n.disabled)return;t.value=!0,s.value=!0;let{clientX:g,clientY:c}=_(f);const{left:a,top:h}=u.value;let w=0,M=0;n.boundary&&([w,M]=i()),e&&e("drag-start",u.value),q(A=>{if(l.size>1)return;const{clientX:B,clientY:N}=_(A);let D=(B-g)/n.scaleRatio+a,E=(N-c)/n.scaleRatio+h;if(n.snapToGrid){let{left:x,top:T}=u.value;const k=D-x,F=E-T;D=x+G(k,n.gridX),E=T+G(F,n.gridY)}n.boundary&&([D,E]=v(D,E,w,M)),u.value.left=D,u.value.top=E,e&&e("drag",u.value)},A=>{l.clear(),t.value=!1,document.addEventListener("click",y,{once:!0}),e&&e("drag-end",u.value)})}const i=()=>{const{width:f,height:g}=u.value,a=(o.value.parentElement||document.body).getBoundingClientRect(),h=a.width/n.scaleRatio-f,w=a.height/n.scaleRatio-g;return[h,w]},v=(f,g,c,a)=>(f=f<0?0:f,f=f>c?c:f,g=g<0?0:g,g=g>a?a:g,[f,g]),y=()=>{s.value=!1},r=f=>{if(t.value)return;let{left:g,top:c}=u.value;if(["ArrowRight","ArrowLeft"].includes(f.key)){const a=f.key==="ArrowRight";let h=a?1:-1;n.snapToGrid&&(h=a?n.gridX:-n.gridX),g=g+h}else if(["ArrowUp","ArrowDown"].includes(f.key)){const a=f.key==="ArrowDown";let h=a?1:-1;n.snapToGrid&&(h=a?n.gridY:-n.gridY),c=c+h}if(n.boundary){const[a,h]=i();[g,c]=v(g,c,a,h)}u.value.left=g,u.value.top=c};return Ae(()=>{if(o.value){if(!u.value.width&&!u.value.height){const{width:f,height:g}=o.value.getBoundingClientRect();u.value={...u.value,width:f||100,height:g||100},e("change",{...u.value})}o.value.addEventListener("mousedown",d),o.value.addEventListener("touchstart",d,{passive:!0})}}),O(s,f=>{n.disabledKeyEvent||(f?document.addEventListener("keydown",r):document.removeEventListener("keydown",r))}),De(()=>{document.removeEventListener("keydown",r)}),{isMousedown:t,selected:s,dragData:u}}const Ve=V("div",{class:"es-drager-rotate-handle"},[V("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[V("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),Ge=ce({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=X(null),s=I({get:()=>e.modelValue,set:l=>{n("update:modelValue",l)}});function u(l){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");l.stopPropagation();const{width:d,height:i,left:v,top:y}=e.element.getBoundingClientRect(),r=v+d/2,f=y+i/2;n("rotate-start",s.value),q(g=>{const{clientX:c,clientY:a}=_(g),h=r-c,w=f-a,b=Math.atan2(w,h)*180/Math.PI-90;s.value=(b+360)%360,n("rotate",s.value)},()=>{n("rotate-end",s.value)})}return(l,d)=>(Y(),U("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:u,onTouchstartPassive:u},[$(l.$slots,"default",{},()=>[Ve])],544))}});const Fe=["data-side","onMousedown","onTouchstartPassive"],Ke=V("div",{class:"es-drager-dot-handle"},null,-1),ie=ce({__name:"drager",props:_e,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=(a,...h)=>{n(a,...h),n("change",...h)},s=X(null),{selected:u,dragData:l,isMousedown:d}=$e(s,e,t),i=X(re(0,e.resizeList)),v=I(()=>e.resizable&&!e.disabled),y=I(()=>e.rotatable&&!e.disabled&&u.value),r=I(()=>{const{width:a,height:h,left:w,top:M,angle:b}=l.value,A={};return a&&(A.width=C(a)),h&&(A.height=C(h)),{...A,left:C(w),top:C(M),zIndex:e.zIndex,transform:`rotate(${b}deg)`,"--es-drager-color":e.color}});function f(a){s.value||(s.value=a.$el||a)}function g(a){i.value=re(a,e.resizeList),t("rotate-end",l.value)}function c(a,h){h.stopPropagation();const{clientX:w,clientY:M}=_(h),b=w,A=M,{width:B,height:N,left:D,top:E}=l.value,x=D+B/2,T=E+N/2,k={width:B,height:N,centerX:x,centerY:T,rotateAngle:l.value.angle},F=a.side,{minWidth:le,minHeight:ue,aspectRatio:Q,equalProportion:de}=e;t("resize-start",l.value),q(Z=>{const{clientX:he,clientY:fe}=_(Z);let P=(he-b)/e.scaleRatio,S=(fe-A)/e.scaleRatio;e.snapToGrid&&(P=G(P,e.gridX),S=G(S,e.gridY));const ge=Math.atan2(S,P),H=Pe(P,S),ve=Z.shiftKey,W=ge-J(k.rotateAngle),we=H*Math.cos(W),pe=H*Math.sin(W),me=(de||ve)&&!Q?k.width/k.height:Q,{position:{centerX:ee,centerY:te},size:{width:ye,height:be}}=Se(F,{...k,rotateAngle:k.rotateAngle},we,pe,me,le,ue),Me=Ce({centerX:ee,centerY:te,width:ye,height:be,angle:l.value.angle});l.value={...l.value,...Ie(Me,ee,te)},t("resize",l.value)},()=>{t("resize-end",l.value)})}return O(()=>[e.width,e.height,e.left,e.top,e.angle],([a,h,w,M,b])=>{l.value={...l.value,width:a,height:h,left:w,top:M,angle:b}}),O(()=>e.selected,a=>{u.value=a},{immediate:!0}),(a,h)=>(Y(),ne(Le(a.tag),{ref:f,class:Ee(["es-drager",{disabled:a.disabled,dragging:L(d),selected:L(u),border:a.border}]),style:se(r.value),onClick:h[3]||(h[3]=ke(()=>{},["stop"]))},{default:oe(()=>[$(a.$slots,"default"),v.value?(Y(!0),U(Ye,{key:0},ze(i.value,(w,M)=>(Y(),U("div",{key:M,class:"es-drager-dot","data-side":w.side,style:se({...w}),onMousedown:b=>c(w,b),onTouchstartPassive:b=>c(w,b)},[$(a.$slots,"resize",Re(Xe({side:w.side})),()=>[Ke])],44,Fe))),128)):ae("",!0),y.value?(Y(),ne(Ge,{key:1,modelValue:L(l).angle,"onUpdate:modelValue":h[0]||(h[0]=w=>L(l).angle=w),element:s.value,onRotate:h[1]||(h[1]=w=>t("rotate",L(l))),onRotateStart:h[2]||(h[2]=w=>t("rotate-start",L(l))),onRotateEnd:g},{default:oe(()=>[$(a.$slots,"rotate")]),_:3},8,["modelValue","element"])):ae("",!0)]),_:3},8,["class","style"]))}});const Oe=o=>{o.component("es-drager",ie)};ie.install=Oe;export{ie as _};
