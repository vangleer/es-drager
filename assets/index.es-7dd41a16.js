import{d as ee,r as R,f as te,eE as P,o as E,c as V,eF as W,F as ge,a as fe,n as U,eG as pe,eH as me,eI as J,u as b,b as ve,w as we,eJ as be,eK as ye,eC as Me,eL as ke,g as _}from"./index-16035a13.js";const Re={resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:100},height:{type:Number,default:100},left:{type:Number,default:0},top:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean},C=(s=0)=>parseInt(s+"")+"px",Z={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},$=["n","ne","e","se","s","sw","w","nw"],ze={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},Xe={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},Ye=(s,a)=>{const e=Xe[Math.floor(s/30)],t=(ze[a]+e)%8;return $[t]},Q=(s=0)=>{let a=[];for(let e=0;e<$.length;e++){const t=$[e],[n,f]=Z[t].split("-"),r=Ye(s,t),c={[n]:"0%",cursor:r+"-resize",side:Z[t]};if(f)c[f]="0%";else{const h=["top","bottom"].includes(n)?"left":"top";c[h]="50%"}a[e]=c}return a},I=s=>s*Math.PI/180,Be=(s,a)=>Math.sqrt(s*s+a*a),m=s=>Math.cos(I(s)),v=s=>Math.sin(I(s)),Ee=(s,a,e,t,n,f,r)=>{let{width:c,height:h,centerX:p,centerY:w,rotateAngle:l}=a;const i=c<0?-1:1,d=h<0?-1:1;switch(c=Math.abs(c),h=Math.abs(h),s){case"right":{const o=X(c,e,f);c=o.width,e=o.deltaW,n?(t=e/n,h=c/n,p+=e/2*m(l)-t/2*v(l),w+=e/2*v(l)+t/2*m(l)):(p+=e/2*m(l),w+=e/2*v(l));break}case"top-right":{t=-t;const o=X(c,e,f);c=o.width,e=o.deltaW;const u=z(h,t,r);h=u.height,t=u.deltaH,n&&(e=t*n,c=h*n),p+=e/2*m(l)+t/2*v(l),w+=e/2*v(l)-t/2*m(l);break}case"bottom-right":{const o=X(c,e,f);c=o.width,e=o.deltaW;const u=z(h,t,r);h=u.height,t=u.deltaH,n&&(e=t*n,c=h*n),p+=e/2*m(l)-t/2*v(l),w+=e/2*v(l)+t/2*m(l);break}case"bottom":{const o=z(h,t,r);h=o.height,t=o.deltaH,n?(e=t*n,c=h*n,p+=e/2*m(l)-t/2*v(l),w+=e/2*v(l)+t/2*m(l)):(p-=t/2*v(l),w+=t/2*m(l));break}case"bottom-left":{e=-e;const o=X(c,e,f);c=o.width,e=o.deltaW;const u=z(h,t,r);h=u.height,t=u.deltaH,n&&(h=c/n,t=e/n),p-=e/2*m(l)+t/2*v(l),w-=e/2*v(l)-t/2*m(l);break}case"left":{e=-e;const o=X(c,e,f);c=o.width,e=o.deltaW,n?(h=c/n,t=e/n,p-=e/2*m(l)+t/2*v(l),w-=e/2*v(l)-t/2*m(l)):(p-=e/2*m(l),w-=e/2*v(l));break}case"top-left":{e=-e,t=-t;const o=X(c,e,f);c=o.width,e=o.deltaW;const u=z(h,t,r);h=u.height,t=u.deltaH,n&&(c=h*n,e=t*n),p-=e/2*m(l)-t/2*v(l),w-=e/2*v(l)+t/2*m(l);break}case"top":{t=-t;const o=z(h,t,r);h=o.height,t=o.deltaH,n?(c=h*n,e=t*n,p+=e/2*m(l)+t/2*v(l),w+=e/2*v(l)-t/2*m(l)):(p+=t/2*v(l),w-=t/2*m(l));break}}return{position:{centerX:p,centerY:w},size:{width:c*i,height:h*d}}},z=(s,a,e)=>{const t=s+a;return t>e?s=t:(a=e-s,s=e),{height:s,deltaH:a}},X=(s,a,e)=>{const t=s+a;return t>e?s=t:(a=e-s,s=e),{width:s,deltaW:a}},Ne=({centerX:s,centerY:a,width:e,height:t,angle:n})=>({top:a-t/2,left:s-e/2,width:e,height:t,angle:n}),Ae=(s,a,e)=>{const{width:t,height:n}=s;return{width:Math.abs(t),height:Math.abs(n),left:a-Math.abs(t)/2,top:e-Math.abs(n)/2}};function x(s,a){const e=Math.abs(s)%a,t=s>0?a:-a;let n=0;return e>a/2?n=t*Math.ceil(Math.abs(s)/a):n=t*Math.floor(Math.abs(s)/a),n}let Le=1e3;function He(s,a,e){const t=R(),n=R(!1),f=R(!1),r=R({width:a.width,height:a.height,left:a.left,top:a.top,angle:a.angle});function c(i){if(a.disabled)return;n.value=!0,f.value=!0;let{clientX:d,clientY:o}=i;const{left:u,top:g}=r.value;s.value.style.zIndex=Ce();let Y=0,N=0;a.boundary&&([Y,N]=h()),e&&e("drag-start",r.value),K(B=>{let M=(B.clientX-d)/a.scaleRatio+u,k=(B.clientY-o)/a.scaleRatio+g;if(a.snapToGrid){let{left:y,top:A}=r.value;const D=M-y,G=k-A;M=y+x(D,a.gridX),k=A+x(G,a.gridY)}a.boundary&&([M,k]=p(M,k,Y,N)),r.value.left=M,r.value.top=k,e&&e("drag",r.value)},B=>{n.value=!1,document.addEventListener("click",w,{once:!0}),e&&e("drag-end",r.value)})}const h=()=>{const{width:i,height:d}=r.value,o=(s.value.parentElement||document.body).getBoundingClientRect(),u=o.width/a.scaleRatio-i,g=o.height/a.scaleRatio-d;return[u,g]},p=(i,d,o,u)=>(i=i<0?0:i,i=i>o?o:i,d=d<0?0:d,d=d>u?u:d,[i,d]),w=()=>{f.value=!1},l=i=>{if(n.value)return;let{left:d,top:o}=r.value;if(["ArrowRight","ArrowLeft"].includes(i.key)){const u=i.key==="ArrowRight";let g=u?1:-1;a.snapToGrid&&(g=u?a.gridX:-a.gridX),d=d+g}else if(["ArrowUp","ArrowDown"].includes(i.key)){const u=i.key==="ArrowDown";let g=u?1:-1;a.snapToGrid&&(g=u?a.gridY:-a.gridY),o=o+g}if(a.boundary){const[u,g]=h();[d,o]=p(d,o,u,g)}r.value.left=d,r.value.top=o};return Me(()=>{s.value&&s.value.addEventListener("mousedown",c)}),P(f,i=>{a.disabledKeyEvent||(i?document.addEventListener("keydown",l):document.removeEventListener("keydown",l))}),ke(()=>{document.removeEventListener("keydown",l)}),{isMousedown:n,selected:f,dragRef:t,dragData:r}}function Ce(){return++Le+""}function K(s,a){const e=t=>{a&&a(t),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",e)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",e)}const Ve=_("div",{class:"es-drager-rotate-handle"},[_("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[_("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),We=ee({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object,required:!0}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(s,{emit:a}){const e=s,t=R(null),n=te({get:()=>e.modelValue,set:r=>{a("update:modelValue",r)}});function f(r){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");r.stopPropagation(),r.preventDefault();const{width:c,height:h,left:p,top:w}=e.element.getBoundingClientRect(),l=p+c/2,i=w+h/2;a("rotate-start",n.value),K(d=>{const o=l-d.clientX,u=i-d.clientY,g=Math.atan2(u,o)*180/Math.PI-90;n.value=(g+360)%360,a("rotate",n.value)},()=>{a("rotate-end",n.value)})}return(r,c)=>(E(),V("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:f},[W(r.$slots,"default",{},()=>[Ve])],544))}}),_e=["data-side","onMousedown"],xe=_("div",{class:"es-drager-dot-handle"},null,-1),ae=ee({__name:"drager",props:Re,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(s,{emit:a}){const e=s,t=(i,...d)=>{a(i,...d),a("change",...d)},n=R(null),{selected:f,dragData:r,isMousedown:c}=He(n,e,t),h=R(Q()),p=te(()=>{const{width:i,height:d,left:o,top:u,angle:g}=r.value;return{width:C(i),height:C(d),left:C(o),top:C(u),transform:`rotate(${g}deg)`,"--es-drager-color":e.color}});function w(i){h.value=Q(i),t("rotate-end",r.value)}function l(i,d){d.stopPropagation(),d.preventDefault();const o=d.clientX,u=d.clientY,{width:g,height:Y,left:N,top:B}=r.value,M=N+g/2,k=B+Y/2,y={width:g,height:Y,centerX:M,centerY:k,rotateAngle:r.value.angle},A=i.side,{minWidth:D,minHeight:G,aspectRatio:S}=e;t("resize-start",r.value),K(T=>{const{clientX:oe,clientY:se}=T;let L=(oe-o)/e.scaleRatio,H=(se-u)/e.scaleRatio;e.snapToGrid&&(L=x(L,e.gridX),H=x(H,e.gridY));const ne=Math.atan2(H,L),F=Be(L,H),le=T.shiftKey,q=ne-I(y.rotateAngle),re=F*Math.cos(q),de=F*Math.sin(q),ie=le&&!S?y.width/y.height:S,{position:{centerX:j,centerY:O},size:{width:ue,height:ce}}=Ee(A,{...y,rotateAngle:y.rotateAngle},re,de,ie,D,G),he=Ne({centerX:j,centerY:O,width:ue,height:ce,angle:r.value.angle});r.value={...r.value,...Ae(he,j,O)},t("resize",r.value)},()=>{t("resize-end",r.value)})}return P(()=>[e.width,e.height,e.left,e.top,e.angle],([i,d,o,u,g])=>{r.value={...r.value,width:i,height:d,left:o,top:u,angle:g}}),P(()=>e.selected,i=>{f.value=i},{immediate:!0}),(i,d)=>(E(),V("div",{ref_key:"dragRef",ref:n,class:be(["es-drager",{disabled:i.disabled,dragging:b(c),selected:b(f)}]),style:U(b(p)),onClick:d[3]||(d[3]=ye(()=>{},["stop"]))},[W(i.$slots,"default"),!i.disabled&&i.resizable?(E(!0),V(ge,{key:0},fe(h.value,(o,u)=>(E(),V("div",{key:u,class:"es-drager-dot","data-side":o.side,style:U({...o}),onMousedown:g=>l(o,g)},[W(i.$slots,"resize",pe(me({side:o.side})),()=>[xe])],44,_e))),128)):J("",!0),!i.disabled&&b(f)?(E(),ve(We,{key:1,modelValue:b(r).angle,"onUpdate:modelValue":d[0]||(d[0]=o=>b(r).angle=o),"drag-data":b(r),element:n.value,onRotate:d[1]||(d[1]=o=>t("rotate",b(r))),onRotateStart:d[2]||(d[2]=o=>t("rotate-start",b(r))),onRotateEnd:w},{default:we(()=>[W(i.$slots,"rotate")]),_:3},8,["modelValue","drag-data","element"])):J("",!0)],6))}}),De=s=>{s.component("es-drager",ae)};ae.install=De;export{ae as n};
