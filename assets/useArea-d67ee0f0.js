import{g as z,r as B,eD as pe,eN as K,eF as Be,eT as Re,d as W,o as P,c as O,eO as U,h as q,b as ue,w as de,eS as Ce,u as D,n as Z,eJ as Te,eH as ze,a as De,eP as Se,eQ as Ne,F as Pe,eR as he,i as Ie,eI as $e,_ as Ve}from"./index-50d0385d.js";const Fe={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},maxWidth:{type:Number,default:0},maxHeight:{type:Number,default:0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean},checkCollision:{type:Boolean},snap:Boolean,snapThreshold:{type:Number,default:10},markline:[Boolean,Function]};function ee(o,n){const e=t=>{n&&n(t),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",o),document.addEventListener("touchend",e)}function I(o){let n=0,e=0;if(Ge(o)){const t=o.targetTouches[0];n=t.pageX,e=t.pageY}else n=o.clientX,e=o.clientY;return{clientX:n,clientY:e}}function Ge(o){const n=Object.prototype.toString.call(o);return n.substring(8,n.length-1)==="TouchEvent"}const G=(o=0)=>parseInt(o+"")+"px",Q={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},H=["n","ne","e","se","s","sw","w","nw"],Ke={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},Ue={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},qe=(o,n)=>{const e=Ue[Math.floor(o/30)],l=(Ke[n]+e)%8;return H[l]},fe=(o=0,n)=>{let e=[];for(let t=0;t<H.length;t++){const l=H[t],[f,s]=Q[l].split("-"),a=qe(o,l),i={[f]:"0%",cursor:a+"-resize",side:Q[l]};if(s)i[s]="0%";else{const g=["top","bottom"].includes(f)?"left":"top";i[g]="50%"}n?n.includes(Q[l])&&e.push(i):e.push(i)}return e},te=o=>o*Math.PI/180,Oe=(o,n)=>Math.sqrt(o*o+n*n),k=o=>Math.cos(te(o)),x=o=>Math.sin(te(o)),je=(o,n,e,t,l,f,s)=>{let{width:a,height:i,centerX:g,centerY:v,rotateAngle:c}=n;const M=a<0?-1:1,d=i<0?-1:1;switch(a=Math.abs(a),i=Math.abs(i),o){case"right":{const r=N(a,e,f);a=r.width,e=r.deltaW,l?(t=e/l,i=a/l,g+=e/2*k(c)-t/2*x(c),v+=e/2*x(c)+t/2*k(c)):(g+=e/2*k(c),v+=e/2*x(c));break}case"top-right":{t=-t;const r=N(a,e,f);a=r.width,e=r.deltaW;const h=S(i,t,s);i=h.height,t=h.deltaH,l&&(e=t*l,a=i*l),g+=e/2*k(c)+t/2*x(c),v+=e/2*x(c)-t/2*k(c);break}case"bottom-right":{const r=N(a,e,f);a=r.width,e=r.deltaW;const h=S(i,t,s);i=h.height,t=h.deltaH,l&&(e=t*l,a=i*l),g+=e/2*k(c)-t/2*x(c),v+=e/2*x(c)+t/2*k(c);break}case"bottom":{const r=S(i,t,s);i=r.height,t=r.deltaH,l?(e=t*l,a=i*l,g+=e/2*k(c)-t/2*x(c),v+=e/2*x(c)+t/2*k(c)):(g-=t/2*x(c),v+=t/2*k(c));break}case"bottom-left":{e=-e;const r=N(a,e,f);a=r.width,e=r.deltaW;const h=S(i,t,s);i=h.height,t=h.deltaH,l&&(i=a/l,t=e/l),g-=e/2*k(c)+t/2*x(c),v-=e/2*x(c)-t/2*k(c);break}case"left":{e=-e;const r=N(a,e,f);a=r.width,e=r.deltaW,l?(i=a/l,t=e/l,g-=e/2*k(c)+t/2*x(c),v-=e/2*x(c)-t/2*k(c)):(g-=e/2*k(c),v-=e/2*x(c));break}case"top-left":{e=-e,t=-t;const r=N(a,e,f);a=r.width,e=r.deltaW;const h=S(i,t,s);i=h.height,t=h.deltaH,l&&(a=i*l,e=t*l),g-=e/2*k(c)-t/2*x(c),v-=e/2*x(c)+t/2*k(c);break}case"top":{t=-t;const r=S(i,t,s);i=r.height,t=r.deltaH,l?(a=i*l,e=t*l,g+=e/2*k(c)+t/2*x(c),v+=e/2*x(c)-t/2*k(c)):(g+=t/2*x(c),v-=t/2*k(c));break}}return{position:{centerX:g,centerY:v},size:{width:a*M,height:i*d}}},S=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{height:o,deltaH:n}},N=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{width:o,deltaW:n}},Je=({centerX:o,centerY:n,width:e,height:t,angle:l})=>({top:n-t/2,left:o-e/2,width:e,height:t,angle:l}),Qe=(o,n,e)=>{const{width:t,height:l}=o;return{width:Math.abs(t),height:Math.abs(l),left:n-Math.abs(t)/2,top:e-Math.abs(l)/2}};function j(o,n){const e=Math.abs(o)%n,t=o>0?n:-n;let l=0;return e>n/2?l=t*Math.ceil(Math.abs(o)/n):l=t*Math.floor(Math.abs(o)/n),l}function Ze(o,n){if(!o||!n)return!1;const e=o.getBoundingClientRect(),t=n.getBoundingClientRect();return e.left<t.left+t.width&&e.left+e.width>t.left&&e.top<t.top+t.height&&e.top+e.height>t.top}const ge=o=>typeof o=="function";function He(o,n){let e=null,t=null;const l=z(()=>o.value.offsetParent||document.body),f=z(()=>l.value.getBoundingClientRect()),s=B({x:[],y:[]}),a=()=>{n.markline&&!ge(n.markline)&&(e||(e=document.querySelector(".es-drager-markline-x")||ve("x",l.value,n.color)),t||(t=document.querySelector(".es-drager-markline-y")||ve("y",l.value,n.color)))},i=(d={})=>{if(n.markline){if(ge(n.markline))return n.markline(d);d.left===null?e.style.display="none":(e.style.left=d.left+"px",e.style.backgroundColor=n.color,e.style.display="block"),d.top===null?t.style.display="none":(t.style.top=d.top+"px",t.style.backgroundColor=n.color,t.style.display="block")}},g=()=>{const d=o.value.getBoundingClientRect(),r=document.querySelectorAll(".es-drager"),h=[];for(let m=0;m<r.length;m++){const b=r[m];b!==o.value&&h.push(b.getBoundingClientRect())}s.value=We(h,d)},v=()=>{const d={top:null,left:null,diffX:0,diffY:0},r=o.value.getBoundingClientRect();for(let h=0;h<s.value.y.length;h++){const{top:m,showTop:b}=s.value.y[h];if(Math.abs(m-r.top)<n.snapThreshold){d.diffY=m-r.top,d.top=b-f.value.top;break}}for(let h=0;h<s.value.x.length;h++){const{left:m,showLeft:b}=s.value.x[h];if(Math.abs(m-r.left)<n.snapThreshold){d.diffX=m-r.left,d.left=b-f.value.left;break}}return i(d),d},c=()=>{i({left:null,top:null})},M=d=>{if(!(!n.snap&&!n.markline))switch(d){case"drag-start":g();break;case"drag":return v();case"drag-end":c();break}};return pe(()=>{a()}),{marklineEmit:M}}function ve(o="x",n,e=""){const t=document.createElement("div");return t.classList.add(`es-drager-markline-${o}`),t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.zIndex="9999",t.style.backgroundColor=e,t.style.display="none",o==="x"?(t.style.height="100%",t.style.width="1px"):(t.style.height="1px",t.style.width="100%"),n.appendChild(t),t}function We(o,n){const e={x:[],y:[]},{width:t=0,height:l=0}=n;return o.forEach(f=>{const{top:s,left:a,width:i,height:g}=f;e.y.push({showTop:s,top:s}),e.y.push({showTop:s,top:s-l}),e.y.push({showTop:s+g/2,top:s+g/2-l/2}),e.y.push({showTop:s+g,top:s+g}),e.y.push({showTop:s+g,top:s+g-l}),e.x.push({showLeft:a,left:a}),e.x.push({showLeft:a+i,left:a+i}),e.x.push({showLeft:a+i/2,left:a+i/2-t/2}),e.x.push({showLeft:a+i,left:a+i-t}),e.x.push({showLeft:a,left:a-t})}),e}function et(o,n,e,{getBoundary:t,fixBoundary:l,checkDragerCollision:f,emit:s}){let a=0,i=0;const g=c=>{let{left:M,top:d}=n.value;if(a||(a=M),i||(i=d),["ArrowRight","ArrowLeft"].includes(c.key)){const r=c.key==="ArrowRight";let h=r?1:-1;o.snapToGrid&&(h=r?o.gridX:-o.gridX),M=M+h}else if(["ArrowUp","ArrowDown"].includes(c.key)){const r=c.key==="ArrowDown";let h=r?1:-1;o.snapToGrid&&(h=r?o.gridY:-o.gridY),d=d+h}if(o.boundary){const[r,h,m,b]=t();[M,d]=l(M,d,r,h,m,b)}n.value.left=M,n.value.top=d},v=c=>{["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(c.key)&&o.checkCollision&&f()&&(n.value.left=a,n.value.top=i),a=0,i=0};K(e,c=>{o.disabledKeyEvent||(c?(document.addEventListener("keydown",g),document.addEventListener("keyup",v)):(document.removeEventListener("keydown",g),document.removeEventListener("keyup",v)))}),Be(()=>{document.removeEventListener("keydown",g),document.removeEventListener("keyup",v)})}function tt(o,n,e){const t=B(!1),l=B(!1),f=B({width:n.width,height:n.height,left:n.left,top:n.top,angle:n.angle}),{marklineEmit:s}=He(o,n),a=new Set;function i(d){if(a.add(d.button),n.disabled)return;t.value=!0,l.value=!0;let{clientX:r,clientY:h}=I(d);const{left:m,top:b}=f.value;let u=0,p=0,w=0,y=0;n.boundary&&([u,p,w,y]=g()),s("drag-start"),e&&e("drag-start",f.value),ee(L=>{if(a.size>1)return;const{clientX:_,clientY:X}=I(L);let E=(_-r)/n.scaleRatio+m,Y=(X-h)/n.scaleRatio+b;if(n.snapToGrid){let{left:R,top:$}=f.value;const C=E-R,J=Y-$;E=R+j(C,n.gridX),Y=$+j(J,n.gridY)}n.boundary&&([E,Y]=v(E,Y,u,p,w,y)),f.value.left=E,f.value.top=Y,e&&e("drag",f.value),Re(()=>{const R=s("drag");n.snap&&(R.diffX&&(f.value.left+=R.diffX),R.diffY&&(f.value.top+=R.diffY))})},L=>{n.checkCollision&&c()&&(f.value.top=b,f.value.left=m),a.clear(),t.value=!1,document.addEventListener("click",M,{once:!0}),s("drag-end"),e&&e("drag-end",f.value)})}const g=()=>{let d=0,r=0;const{left:h,top:m,height:b,width:u,angle:p}=f.value,y=(o.value.offsetParent||document.body).getBoundingClientRect();if(p&&n.scaleRatio===1){const _=o.value.getBoundingClientRect();d=Math.abs(_.left-(h+y.left)),r=Math.abs(_.top-(m+y.top))}const A=y.width/n.scaleRatio-u,L=y.height/n.scaleRatio-b;return[d,A-d,r,L-r,y.width/n.scaleRatio,y.height/n.scaleRatio]},v=(d,r,h,m,b,u)=>(d=d<h?h:d,d=d>m?m:d,r=r<b?b:r,r=r>u?u:r,[d,r]),c=()=>{const d=o.value.offsetParent||document.body,r=Array.from(d.children).filter(h=>h!==o.value&&h.classList.contains("es-drager"));for(let h=0;h<r.length;h++){const m=r[h];if(Ze(o.value,m))return!0}},M=()=>{l.value=!1};return et(n,f,l,{getBoundary:g,fixBoundary:v,checkDragerCollision:c,emit:e}),pe(()=>{if(o.value){if(!f.value.width&&!f.value.height){const{width:d,height:r}=o.value.getBoundingClientRect();f.value={...f.value,width:d||100,height:r||100}}o.value.addEventListener("mousedown",i),o.value.addEventListener("touchstart",i,{passive:!0})}}),{isMousedown:t,selected:l,dragData:f,getBoundary:g,checkDragerCollision:c}}const nt=q("div",{class:"es-drager-rotate-handle"},[q("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[q("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),ot=W({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=B(null),l=z({get:()=>e.modelValue,set:s=>{n("update:modelValue",s)}});function f(s){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");s.stopPropagation();const{width:a,height:i,left:g,top:v}=e.element.getBoundingClientRect(),c=g+a/2,M=v+i/2;n("rotate-start",l.value),ee(d=>{const{clientX:r,clientY:h}=I(d),m=c-r,b=M-h,p=Math.atan2(b,m)*180/Math.PI-90;l.value=(p+360)%360,n("rotate",l.value)},()=>{n("rotate-end",l.value)})}return(s,a)=>(P(),O("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:f,onTouchstartPassive:f},[U(s.$slots,"default",{},()=>[nt])],544))}});const st=["data-side","onMousedown","onTouchstartPassive"],lt=q("div",{class:"es-drager-dot-handle"},null,-1),me=W({__name:"drager",props:Fe,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=(u,...p)=>{n(u,...p)},l=B(null),{selected:f,dragData:s,isMousedown:a,getBoundary:i,checkDragerCollision:g}=tt(l,e,t),v=B(fe(0,e.resizeList)),c=z(()=>e.resizable&&!e.disabled),M=z(()=>e.rotatable&&!e.disabled&&f.value),d=z(()=>{const{width:u,height:p,left:w,top:y,angle:A}=s.value,L={};return u&&(L.width=G(u)),p&&(L.height=G(p)),{...L,left:G(w),top:G(y),zIndex:e.zIndex,transform:`rotate(${A}deg)`,"--es-drager-color":e.color}});function r(u){l.value||(l.value=u.$el||u)}function h(u){v.value=fe(u,e.resizeList),t("rotate-end",s.value)}function m(u,p){if(e.disabled)return;p.stopPropagation();const{clientX:w,clientY:y}=I(p),A=w,L=y,{width:_,height:X,left:E,top:Y}=s.value,R=E+_/2,$=Y+X/2,C={width:_,height:X,centerX:R,centerY:$,rotateAngle:s.value.angle},J=u.side,{minWidth:we,minHeight:ye,aspectRatio:ne,equalProportion:be}=e;t("resize-start",s.value);let oe=[];e.boundary&&(oe=i()),ee(se=>{const{clientX:ke,clientY:xe}=I(se);let V=(ke-A)/e.scaleRatio,F=(xe-L)/e.scaleRatio;e.snapToGrid&&(V=j(V,e.gridX),F=j(F,e.gridY));const Me=Math.atan2(F,V),le=Oe(V,F),Le=se.shiftKey,ie=Me-te(C.rotateAngle),Ae=le*Math.cos(ie),Ee=le*Math.sin(ie),ae=(be||Le)&&!ne?C.width/C.height:ne,{position:{centerX:re,centerY:ce},size:{width:_e,height:Xe}}=je(J,{...C,rotateAngle:C.rotateAngle},Ae,Ee,ae,we,ye),Ye=Je({centerX:re,centerY:ce,width:_e,height:Xe,angle:s.value.angle});let T={...s.value,...Qe(Ye,re,ce)};e.maxWidth>0&&(T.width=Math.min(T.width,e.maxWidth)),e.maxHeight>0&&(T.height=Math.min(T.height,e.maxHeight)),e.boundary&&(T=b(T,oe,ae)),s.value=T,t("resize",s.value)},()=>{e.checkCollision&&g()&&(s.value={...s.value,width:_,height:X,left:E,top:Y}),t("resize-end",s.value)})}function b(u,p,w){const[y,A,L,_,X,E]=p;return u.left<y&&(u.left=y,u.width=s.value.width,w&&(u.height=s.value.height)),u.left+u.width>X&&(u.left=s.value.left,u.width=X-u.left,w&&(u.height=s.value.height)),u.top<L&&(u.top=L,u.height=s.value.height,w&&(u.width=s.value.width)),u.top+u.height>E&&(u.top=s.value.top,u.height=E-u.top,w&&(u.width=s.value.width)),u}return K(()=>[e.width,e.height,e.left,e.top,e.angle],([u,p,w,y,A],[L,_,X,E,Y])=>{u!==L&&(s.value.width=u),p!==_&&(s.value.height=p),w!==X&&(s.value.left=w),y!==E&&(s.value.top=y),A!==Y&&(s.value.angle=A)}),K(()=>s.value,u=>{n("change",{...u})},{deep:!0}),K(()=>e.selected,u=>{f.value=u},{immediate:!0}),(u,p)=>(P(),ue(ze(u.tag),{ref:r,class:Ce(["es-drager",{disabled:u.disabled,dragging:D(a),selected:D(f),border:u.border}]),style:Z(d.value),onClick:p[3]||(p[3]=Te(()=>{},["stop"]))},{default:de(()=>[U(u.$slots,"default"),c.value?(P(!0),O(Pe,{key:0},De(v.value,(w,y)=>(P(),O("div",{key:y,class:"es-drager-dot","data-side":w.side,style:Z({...w}),onMousedown:A=>m(w,A),onTouchstartPassive:A=>m(w,A)},[U(u.$slots,"resize",Se(Ne({side:w.side})),()=>[lt])],44,st))),128)):he("",!0),M.value?(P(),ue(ot,{key:1,modelValue:D(s).angle,"onUpdate:modelValue":p[0]||(p[0]=w=>D(s).angle=w),element:l.value,onRotate:p[1]||(p[1]=w=>t("rotate",D(s))),onRotateStart:p[2]||(p[2]=w=>t("rotate-start",D(s))),onRotateEnd:h},{default:de(()=>[U(u.$slots,"rotate")]),_:3},8,["modelValue","element"])):he("",!0)]),_:3},8,["class","style"]))}});const it=o=>{o.component("es-drager",me)};me.install=it;const at=W({__name:"Area",emits:["move","up"],setup(o,{expose:n,emit:e}){const t=B(!1),l=B({width:0,height:0,top:0,left:0}),f=z(()=>{const{width:a,height:i,top:g,left:v}=l.value;return{width:a+"px",height:i+"px",top:g+"px",left:v+"px"}});function s(a){const{pageX:i,pageY:g}=a,v=a.target.getBoundingClientRect(),c=i-v.left,M=g-v.top,d=h=>{const m=h.pageX-i,b=h.pageY-g;let u=c,p=M,w=Math.abs(m),y=Math.abs(b);(w>2||y>2)&&(t.value=!0),m<0&&(u=c-w),b<0&&(p=M-y),l.value={width:w,height:y,left:u,top:p},e("move",{...l.value})},r=()=>{document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",r),t.value=!1,l.value={width:0,height:0,top:0,left:0},e("up",l.value)};document.addEventListener("mousemove",d),document.addEventListener("mouseup",r)}return n({onMouseDown:s,areaData:l}),(a,i)=>Ie((P(),O("div",{class:"es-editor-area",style:Z(f.value)},null,4)),[[$e,t.value]])}});const ut=Ve(at,[["__scopeId","data-v-136196f6"]]);function dt(o,n){const e=B();function t(s){let a=!1;o.value.elements.forEach(i=>{i.selected&&(i.selected=!1,a=!0)}),a||n.value.onMouseDown(s)}function l(s){for(let a=0;a<o.value.elements.length;a++){const i=o.value.elements[a],g=s.left<i.left&&s.left+s.width>i.left+i.width,v=s.top<i.top&&s.top+s.height>i.top+i.height;g&&v?i.selected=!0:i.selected=!1}}function f(){e.value=o.value.elements.some(s=>s.selected),e.value&&setTimeout(()=>{document.addEventListener("click",()=>{e.value=!1},{once:!0})})}return{areaSelected:e,onEditorMouseDown:t,onAreaMove:l,onAreaUp:f}}export{ut as A,me as _,dt as u};
