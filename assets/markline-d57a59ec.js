import{G as S}from"./GridRect-212b5856.js";import{i as M}from"./index.es-02b4857d.js";import{M as F,c as G}from"./common-e4951e25.js";import{d as O,r as m,eC as P,eD as V,eE as z,o as c,c as k,f as C,i,w as u,u as _,F as I,a as J,eF as K,eG as R,e as v,b as w,eH as T,t as j,m as q,_ as H}from"./index-c7156e89.js";const U={class:"es-container"},$={class:"es-tools"},A={class:"es-editor"},Q=O({__name:"markline",setup(W){const g=m(-1),d=m({componentList:[{component:"div",text:"div1",width:100,height:100,left:0,top:0},{component:"div",text:"div2",width:100,height:100,top:100,left:100}]}),s=P({left:null,top:null}),r=m({x:[],y:[]}),p=E(d);function x(n){g.value=n,r.value=G(d.value.componentList,g.value)}function L(n){s.top=null,s.left=null;for(let e=0;e<r.value.y.length;e++){const{top:o,showTop:t}=r.value.y[e];if(Math.abs(o-n.top)<5){s.top=t;break}}for(let e=0;e<r.value.x.length;e++){const{left:o,showLeft:t}=r.value.x[e];if(Math.abs(o-n.left)<5){s.left=t;break}}}function b(){p.record(),s.top=null,s.left=null}function D(n,e){Object.keys(n).forEach(o=>{e[o]=n[o]})}function E(n){const e=[];let o=-1;const t=()=>{console.log("redo",o,e),o<e.length-1&&(o++,n.value.componentList=f(e[o]))},l=()=>{console.log("undo",o,e),o>=0&&(o--,e[o]&&(n.value.componentList=f(e[o])))},a=()=>{e[++o]=f(n.value.componentList)};a();const h=B=>{const{ctrlKey:N,key:y}=B;N&&(y==="z"?l():y==="y"&&t())};return window.addEventListener("keydown",h),V(()=>{window.removeEventListener("keydown",h)}),{redo:t,undo:l,record:a}}function f(n){return JSON.parse(JSON.stringify(n))}return(n,e)=>{const o=z("el-button");return c(),k("div",U,[C("div",$,[i(o,{type:"primary",onClick:_(p).undo},{default:u(()=>[v("撤销")]),_:1},8,["onClick"]),i(o,{type:"primary",onClick:_(p).redo},{default:u(()=>[v("重做")]),_:1},8,["onClick"])]),C("div",A,[(c(!0),k(I,null,J(d.value.componentList,(t,l)=>(c(),w(_(M),q(t,{onDragStart:a=>x(l),onDrag:e[0]||(e[0]=a=>L(a)),onChange:a=>D(a,t),onDragEnd:b}),{default:u(()=>[(c(),w(T(t.component),null,{default:u(()=>[v(j(t.text),1)]),_:2},1024))]),_:2},1040,["onDragStart","onChange"]))),256)),i(F,K(R(s)),null,16),i(S,{class:"grid-rect"})])])}}});const oe=H(Q,[["__scopeId","data-v-222b610e"]]);export{oe as default};
