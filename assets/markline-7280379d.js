import{d as X,r as c,f as Y,eE as z,eF as H,c as T,g as h,u as p,F as I,a as J,h as b,eG as C,n as y,o as g,b as D,w as S,eH as K,e as M,t as V,m as j,_ as q}from"./index-b8b6afa8.js";import{o as P}from"./index.es-58b0d461.js";const U={class:"es-tools"},W=X({__name:"markline",setup($){const x=c(!0),_=c(20),L=c(20),E=Y(()=>x.value?{"--es-grid-width":_.value+"px","--es-grid-height":L.value+"px"}:{}),m=c(-1),v=c({componentList:[{component:"div",text:"div1",width:100,height:100,left:0,top:0},{component:"div",text:"div2",width:100,height:100,top:100,left:100}]}),a=z({left:null,top:null}),d=c({x:[],y:[]}),f=O(v);function B(o){m.value=o,d.value=N()}function A(o){a.top=null,a.left=null;for(let t=0;t<d.value.y.length;t++){const{top:e,showTop:l}=d.value.y[t];if(Math.abs(e-o.top)<5){a.top=l;break}}for(let t=0;t<d.value.x.length;t++){const{left:e,showLeft:l}=d.value.x[t];if(Math.abs(e-o.left)<5){a.left=l;break}}}function G(){f.record()}function N(){const o={x:[],y:[]},{width:t,height:e}=v.value.componentList[m.value];return v.value.componentList.forEach((l,r)=>{if(m.value===r)return;const{top:n,left:s,width:i,height:u}=l;o.x.push({showLeft:s,left:s}),o.x.push({showLeft:s+i,left:s+i}),o.x.push({showLeft:s+i/2,left:s+i/2-t/2}),o.x.push({showLeft:s+i,left:s+i-t}),o.x.push({showLeft:s,left:s-t}),o.y.push({showTop:n,top:n}),o.y.push({showTop:n,top:n-e}),o.y.push({showTop:n+u/2,top:n+u/2-e/2}),o.y.push({showTop:n+u,top:n+u}),o.y.push({showTop:n+u,top:n+u-e})}),o}function F(o,t){Object.keys(o).forEach(e=>{t[e]=o[e]})}function O(o){const t=[];let e=-1;const l=()=>{console.log("redo",e,t),e<t.length-1&&(e++,o.value.componentList=w(t[e]))},r=()=>{console.log("undo",e,t),e>=0&&(e--,t[e]&&(o.value.componentList=w(t[e])))},n=()=>{t[++e]=w(o.value.componentList)};n();const s=i=>{const{ctrlKey:u,key:k}=i;u&&(k==="z"?r():k==="y"&&l())};return window.addEventListener("keydown",s),H(()=>{window.removeEventListener("keydown",s)}),{redo:l,undo:r,record:n}}function w(o){return JSON.parse(JSON.stringify(o))}return(o,t)=>(g(),T("div",{class:"es-container",style:y(p(E))},[h("div",U,[h("div",{class:"es-button",onClick:t[0]||(t[0]=(...e)=>p(f).undo&&p(f).undo(...e))},"撤销"),h("div",{class:"es-button",onClick:t[1]||(t[1]=(...e)=>p(f).redo&&p(f).redo(...e))},"重做")]),(g(!0),T(I,null,J(v.value.componentList,(e,l)=>(g(),D(p(P),j(e,{snapToGrid:x.value,gridX:_.value,gridY:L.value,onDragStart:r=>B(l),onDrag:t[2]||(t[2]=r=>A(r)),onChange:r=>F(r,e),onDragEnd:G}),{default:S(()=>[(g(),D(K(e.component),null,{default:S(()=>[M(V(e.text),1)]),_:2},1024))]),_:2},1040,["snapToGrid","gridX","gridY","onDragStart","onChange"]))),256)),b(h("div",{class:"es-markline-left",style:y({left:a.left+"px"})},null,4),[[C,a.left]]),b(h("div",{class:"es-markline-top",style:y({top:a.top+"px"})},null,4),[[C,a.top]])],4))}});const Z=q(W,[["__scopeId","data-v-298bcdcf"]]);export{Z as default};
