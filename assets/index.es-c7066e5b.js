import{d as he,r as x,g as I,eQ as U,o as P,b as ie,w as se,eR as $,c as q,a as ze,n as de,eJ as Ae,eK as Ce,F as Xe,eS as ue,u as X,eT as Ye,eM as Ne,eI as xe,eD as He,h as G,eG as De}from"./index-aa21fdab.js";const Pe={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},maxWidth:{type:Number,default:0},maxHeight:{type:Number,default:0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean},checkCollision:{type:Boolean}};function Q(a,o){const e=t=>{o&&o(t),document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",a),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",a),document.addEventListener("touchend",e)}function W(a){let o=0,e=0;if(We(a)){const t=a.targetTouches[0];o=t.pageX,e=t.pageY}else o=a.clientX,e=a.clientY;return{clientX:o,clientY:e}}function We(a){const o=Object.prototype.toString.call(a);return o.substring(8,o.length-1)==="TouchEvent"}const S=(a=0)=>parseInt(a+"")+"px",K={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},F=["n","ne","e","se","s","sw","w","nw"],Te={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},Ve={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},Se=(a,o)=>{const e=Ve[Math.floor(a/30)],t=(Te[o]+e)%8;return F[t]},ce=(a=0,o)=>{let e=[];for(let t=0;t<F.length;t++){const n=F[t],[c,s]=K[n].split("-"),u=Se(a,n),d={[c]:"0%",cursor:u+"-resize",side:K[n]};if(s)d[s]="0%";else{const v=["top","bottom"].includes(c)?"left":"top";d[v]="50%"}o?o.includes(K[n])&&e.push(d):e.push(d)}return e},J=a=>a*Math.PI/180,Ie=(a,o)=>Math.sqrt(a*a+o*o),b=a=>Math.cos(J(a)),y=a=>Math.sin(J(a)),$e=(a,o,e,t,n,c,s)=>{let{width:u,height:d,centerX:v,centerY:f,rotateAngle:l}=o;const g=u<0?-1:1,p=d<0?-1:1;switch(u=Math.abs(u),d=Math.abs(d),a){case"right":{const i=N(u,e,c);u=i.width,e=i.deltaW,n?(t=e/n,d=u/n,v+=e/2*b(l)-t/2*y(l),f+=e/2*y(l)+t/2*b(l)):(v+=e/2*b(l),f+=e/2*y(l));break}case"top-right":{t=-t;const i=N(u,e,c);u=i.width,e=i.deltaW;const h=Y(d,t,s);d=h.height,t=h.deltaH,n&&(e=t*n,u=d*n),v+=e/2*b(l)+t/2*y(l),f+=e/2*y(l)-t/2*b(l);break}case"bottom-right":{const i=N(u,e,c);u=i.width,e=i.deltaW;const h=Y(d,t,s);d=h.height,t=h.deltaH,n&&(e=t*n,u=d*n),v+=e/2*b(l)-t/2*y(l),f+=e/2*y(l)+t/2*b(l);break}case"bottom":{const i=Y(d,t,s);d=i.height,t=i.deltaH,n?(e=t*n,u=d*n,v+=e/2*b(l)-t/2*y(l),f+=e/2*y(l)+t/2*b(l)):(v-=t/2*y(l),f+=t/2*b(l));break}case"bottom-left":{e=-e;const i=N(u,e,c);u=i.width,e=i.deltaW;const h=Y(d,t,s);d=h.height,t=h.deltaH,n&&(d=u/n,t=e/n),v-=e/2*b(l)+t/2*y(l),f-=e/2*y(l)-t/2*b(l);break}case"left":{e=-e;const i=N(u,e,c);u=i.width,e=i.deltaW,n?(d=u/n,t=e/n,v-=e/2*b(l)+t/2*y(l),f-=e/2*y(l)-t/2*b(l)):(v-=e/2*b(l),f-=e/2*y(l));break}case"top-left":{e=-e,t=-t;const i=N(u,e,c);u=i.width,e=i.deltaW;const h=Y(d,t,s);d=h.height,t=h.deltaH,n&&(u=d*n,e=t*n),v-=e/2*b(l)-t/2*y(l),f-=e/2*y(l)+t/2*b(l);break}case"top":{t=-t;const i=Y(d,t,s);d=i.height,t=i.deltaH,n?(u=d*n,e=t*n,v+=e/2*b(l)+t/2*y(l),f+=e/2*y(l)-t/2*b(l)):(v+=t/2*y(l),f-=t/2*b(l));break}}return{position:{centerX:v,centerY:f},size:{width:u*g,height:d*p}}},Y=(a,o,e)=>{const t=a+o;return t>e?a=t:(o=e-a,a=e),{height:a,deltaH:o}},N=(a,o,e)=>{const t=a+o;return t>e?a=t:(o=e-a,a=e),{width:a,deltaW:o}},Ge=({centerX:a,centerY:o,width:e,height:t,angle:n})=>({top:o-t/2,left:a-e/2,width:e,height:t,angle:n}),_e=(a,o,e)=>{const{width:t,height:n}=a;return{width:Math.abs(t),height:Math.abs(n),left:o-Math.abs(t)/2,top:e-Math.abs(n)/2}};function _(a,o){const e=Math.abs(a)%o,t=a>0?o:-o;let n=0;return e>o/2?n=t*Math.ceil(Math.abs(a)/o):n=t*Math.floor(Math.abs(a)/o),n}function Oe(a,o){if(!a||!o)return!1;const e=a.getBoundingClientRect(),t=o.getBoundingClientRect();return e.left<t.left+t.width&&e.left+e.width>t.left&&e.top<t.top+t.height&&e.top+e.height>t.top}function je(a,o,e,{getBoundary:t,fixBoundary:n,checkDragerCollision:c,emit:s}){let u=0,d=0;const v=l=>{let{left:g,top:p}=o.value;if(u||(u=g),d||(d=p),["ArrowRight","ArrowLeft"].includes(l.key)){const i=l.key==="ArrowRight";let h=i?1:-1;a.snapToGrid&&(h=i?a.gridX:-a.gridX),g=g+h}else if(["ArrowUp","ArrowDown"].includes(l.key)){const i=l.key==="ArrowDown";let h=i?1:-1;a.snapToGrid&&(h=i?a.gridY:-a.gridY),p=p+h}if(a.boundary){const[i,h,E,L]=t();[g,p]=n(g,p,i,h,E,L)}o.value.left=g,o.value.top=p,s("change",{...o.value})},f=l=>{["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(l.key)&&a.checkCollision&&c()&&(o.value.left=u,o.value.top=d),u=0,d=0};U(e,l=>{a.disabledKeyEvent||(l?(document.addEventListener("keydown",v),document.addEventListener("keyup",f)):(document.removeEventListener("keydown",v),document.removeEventListener("keyup",f)))}),De(()=>{document.removeEventListener("keydown",v),document.removeEventListener("keyup",f)})}function Ke(a,o,e){const t=x(!1),n=x(!1),c=x({width:o.width,height:o.height,left:o.left,top:o.top,angle:o.angle}),s=new Set;function u(g){if(s.add(g.button),o.disabled)return;t.value=!0,n.value=!0;let{clientX:p,clientY:i}=W(g);const{left:h,top:E}=c.value;let L=0,r=0,m=0,w=0;o.boundary&&([L,r,m,w]=d()),e&&e("drag-start",c.value),Q(k=>{if(s.size>1)return;const{clientX:M,clientY:B}=W(k);let z=(M-p)/o.scaleRatio+h,R=(B-i)/o.scaleRatio+E;if(o.snapToGrid){let{left:A,top:H}=c.value;const O=z-A,j=R-H;z=A+_(O,o.gridX),R=H+_(j,o.gridY)}o.boundary&&([z,R]=v(z,R,L,r,m,w)),c.value.left=z,c.value.top=R,e&&e("drag",c.value)},k=>{o.checkCollision&&f()&&(c.value.top=E,c.value.left=h),s.clear(),t.value=!1,document.addEventListener("click",l,{once:!0}),e&&e("drag-end",c.value)})}const d=()=>{let g=0,p=0;const{left:i,top:h,height:E,width:L,angle:r}=c.value,m=(a.value.parentElement||document.body).getBoundingClientRect();if(r&&o.scaleRatio===1){const M=a.value.getBoundingClientRect();g=Math.abs(M.left-(i+m.left)),p=Math.abs(M.top-(h+m.top))}const w=m.width/o.scaleRatio-L,k=m.height/o.scaleRatio-E;return[g,w-g,p,k-p,m.width/o.scaleRatio,m.height/o.scaleRatio]},v=(g,p,i,h,E,L)=>(g=g<i?i:g,g=g>h?h:g,p=p<E?E:p,p=p>L?L:p,[g,p]),f=()=>{const g=a.value.parentElement||document.body,p=Array.from(g.children).filter(i=>i!==a.value&&i.classList.contains("es-drager"));for(let i=0;i<p.length;i++){const h=p[i];if(Oe(a.value,h))return!0}},l=()=>{n.value=!1};return je(o,c,n,{getBoundary:d,fixBoundary:v,checkDragerCollision:f,emit:e}),He(()=>{if(a.value){if(!c.value.width&&!c.value.height){const{width:g,height:p}=a.value.getBoundingClientRect();c.value={...c.value,width:g||100,height:p||100},e("change",{...c.value})}a.value.addEventListener("mousedown",u),a.value.addEventListener("touchstart",u,{passive:!0})}}),{isMousedown:t,selected:n,dragData:c,getBoundary:d,checkDragerCollision:f}}const Ue=G("div",{class:"es-drager-rotate-handle"},[G("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[G("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),qe=he({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(a,{emit:o}){const e=a,t=x(null),n=I({get:()=>e.modelValue,set:s=>{o("update:modelValue",s)}});function c(s){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");s.stopPropagation();const{width:u,height:d,left:v,top:f}=e.element.getBoundingClientRect(),l=v+u/2,g=f+d/2;o("rotate-start",n.value),Q(p=>{const{clientX:i,clientY:h}=W(p),E=l-i,L=g-h,r=Math.atan2(L,E)*180/Math.PI-90;n.value=(r+360)%360,o("rotate",n.value)},()=>{o("rotate-end",n.value)})}return(s,u)=>(P(),q("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:c,onTouchstartPassive:c},[$(s.$slots,"default",{},()=>[Ue])],544))}}),Fe=["data-side","onMousedown","onTouchstartPassive"],Qe=G("div",{class:"es-drager-dot-handle"},null,-1),ge=he({__name:"drager",props:Pe,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(a,{emit:o}){const e=a,t=(r,...m)=>{o(r,...m),o("change",...m)},n=x(null),{selected:c,dragData:s,isMousedown:u,getBoundary:d,checkDragerCollision:v}=Ke(n,e,t),f=x(ce(0,e.resizeList)),l=I(()=>e.resizable&&!e.disabled),g=I(()=>e.rotatable&&!e.disabled&&c.value),p=I(()=>{const{width:r,height:m,left:w,top:k,angle:M}=s.value,B={};return r&&(B.width=S(r)),m&&(B.height=S(m)),{...B,left:S(w),top:S(k),zIndex:e.zIndex,transform:`rotate(${M}deg)`,"--es-drager-color":e.color}});function i(r){n.value||(n.value=r.$el||r)}function h(r){f.value=ce(r,e.resizeList),t("rotate-end",s.value)}function E(r,m){if(e.disabled)return;m.stopPropagation();const{clientX:w,clientY:k}=W(m),M=w,B=k,{width:z,height:R,left:A,top:H}=s.value,O=A+z/2,j=H+R/2,D={width:z,height:R,centerX:O,centerY:j,rotateAngle:s.value.angle},pe=r.side,{minWidth:me,minHeight:ve,aspectRatio:Z,equalProportion:fe}=e;t("resize-start",s.value);let ee=[];e.boundary&&(ee=d()),Q(te=>{const{clientX:we,clientY:be}=W(te);let T=(we-M)/e.scaleRatio,V=(be-B)/e.scaleRatio;e.snapToGrid&&(T=_(T,e.gridX),V=_(V,e.gridY));const ye=Math.atan2(V,T),ae=Ie(T,V),ke=te.shiftKey,oe=ye-J(D.rotateAngle),Me=ae*Math.cos(oe),Ee=ae*Math.sin(oe),ne=(fe||ke)&&!Z?D.width/D.height:Z,{position:{centerX:le,centerY:re},size:{width:Le,height:Re}}=$e(pe,{...D,rotateAngle:D.rotateAngle},Me,Ee,ne,me,ve),Be=Ge({centerX:le,centerY:re,width:Le,height:Re,angle:s.value.angle});let C={...s.value,..._e(Be,le,re)};e.maxWidth>0&&(C.width=Math.min(C.width,e.maxWidth)),e.maxHeight>0&&(C.height=Math.min(C.height,e.maxHeight)),e.boundary&&(C=L(C,ee,ne)),s.value=C,t("resize",s.value)},()=>{e.checkCollision&&v()&&(s.value={...s.value,width:z,height:R,left:A,top:H}),t("resize-end",s.value)})}function L(r,m,w){const[k,M,B,z,R,A]=m;return r.left<k&&(r.left=k,r.width=s.value.width,w&&(r.height=s.value.height)),r.left+r.width>R&&(r.left=s.value.left,r.width=R-r.left,w&&(r.height=s.value.height)),r.top<B&&(r.top=B,r.height=s.value.height,w&&(r.width=s.value.width)),r.top+r.height>A&&(r.top=s.value.top,r.height=A-r.top,w&&(r.width=s.value.width)),r}return U(()=>[e.width,e.height,e.left,e.top,e.angle],([r,m,w,k,M])=>{s.value={...s.value,width:r,height:m,left:w,top:k,angle:M}}),U(()=>e.selected,r=>{c.value=r},{immediate:!0}),(r,m)=>(P(),ie(xe(r.tag),{ref:i,class:Ye(["es-drager",{disabled:r.disabled,dragging:X(u),selected:X(c),border:r.border}]),style:de(p.value),onClick:m[3]||(m[3]=Ne(()=>{},["stop"]))},{default:se(()=>[$(r.$slots,"default"),l.value?(P(!0),q(Xe,{key:0},ze(f.value,(w,k)=>(P(),q("div",{key:k,class:"es-drager-dot","data-side":w.side,style:de({...w}),onMousedown:M=>E(w,M),onTouchstartPassive:M=>E(w,M)},[$(r.$slots,"resize",Ae(Ce({side:w.side})),()=>[Qe])],44,Fe))),128)):ue("",!0),g.value?(P(),ie(qe,{key:1,modelValue:X(s).angle,"onUpdate:modelValue":m[0]||(m[0]=w=>X(s).angle=w),element:n.value,onRotate:m[1]||(m[1]=w=>t("rotate",X(s))),onRotateStart:m[2]||(m[2]=w=>t("rotate-start",X(s))),onRotateEnd:h},{default:se(()=>[$(r.$slots,"rotate")]),_:3},8,["modelValue","element"])):ue("",!0)]),_:3},8,["class","style"]))}}),Je=a=>{a.component("es-drager",ge)};ge.install=Je;export{ge as f};
