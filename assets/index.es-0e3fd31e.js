import{d as se,r as X,eJ as le,eV as P,o as B,b as J,w as ee,eW as x,c as $,a as ye,eM as te,eI as ae,eG as Me,eH as ke,F as Ee,eL as oe,u as M,eX as ze,eF as Le,eA as Re,eD as Xe,f as D}from"./index-bc805ebc.js";const Be={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array}};function j(n,a){const e=t=>{a&&a(t),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",n),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",n),document.addEventListener("touchend",e)}function Y(n){let a=0,e=0;if(Ye(n)){const t=n.targetTouches[0];a=t.pageX,e=t.pageY}else a=n.clientX,e=n.clientY;return{clientX:a,clientY:e}}function Ye(n){const a=Object.prototype.toString.call(n);return a.substring(8,a.length-1)==="TouchEvent"}const W=(n=0)=>parseInt(n+"")+"px",G={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},S=["n","ne","e","se","s","sw","w","nw"],Ne={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},Ae={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},Ve=(n,a)=>{const e=Ae[Math.floor(n/30)],t=(Ne[a]+e)%8;return S[t]},ne=(n=0,a)=>{let e=[];for(let t=0;t<S.length;t++){const l=S[t],[h,d]=G[l].split("-"),c=Ve(n,l),u={[h]:"0%",cursor:c+"-resize",side:G[l]};if(d)u[d]="0%";else{const m=["top","bottom"].includes(h)?"left":"top";u[m]="50%"}a?a.includes(G[l])&&e.push(u):e.push(u)}return e},O=n=>n*Math.PI/180,He=(n,a)=>Math.sqrt(n*n+a*a),v=n=>Math.cos(O(n)),f=n=>Math.sin(O(n)),Te=(n,a,e,t,l,h,d)=>{let{width:c,height:u,centerX:m,centerY:p,rotateAngle:o}=a;const g=c<0?-1:1,r=u<0?-1:1;switch(c=Math.abs(c),u=Math.abs(u),n){case"right":{const s=R(c,e,h);c=s.width,e=s.deltaW,l?(t=e/l,u=c/l,m+=e/2*v(o)-t/2*f(o),p+=e/2*f(o)+t/2*v(o)):(m+=e/2*v(o),p+=e/2*f(o));break}case"top-right":{t=-t;const s=R(c,e,h);c=s.width,e=s.deltaW;const i=L(u,t,d);u=i.height,t=i.deltaH,l&&(e=t*l,c=u*l),m+=e/2*v(o)+t/2*f(o),p+=e/2*f(o)-t/2*v(o);break}case"bottom-right":{const s=R(c,e,h);c=s.width,e=s.deltaW;const i=L(u,t,d);u=i.height,t=i.deltaH,l&&(e=t*l,c=u*l),m+=e/2*v(o)-t/2*f(o),p+=e/2*f(o)+t/2*v(o);break}case"bottom":{const s=L(u,t,d);u=s.height,t=s.deltaH,l?(e=t*l,c=u*l,m+=e/2*v(o)-t/2*f(o),p+=e/2*f(o)+t/2*v(o)):(m-=t/2*f(o),p+=t/2*v(o));break}case"bottom-left":{e=-e;const s=R(c,e,h);c=s.width,e=s.deltaW;const i=L(u,t,d);u=i.height,t=i.deltaH,l&&(u=c/l,t=e/l),m-=e/2*v(o)+t/2*f(o),p-=e/2*f(o)-t/2*v(o);break}case"left":{e=-e;const s=R(c,e,h);c=s.width,e=s.deltaW,l?(u=c/l,t=e/l,m-=e/2*v(o)+t/2*f(o),p-=e/2*f(o)-t/2*v(o)):(m-=e/2*v(o),p-=e/2*f(o));break}case"top-left":{e=-e,t=-t;const s=R(c,e,h);c=s.width,e=s.deltaW;const i=L(u,t,d);u=i.height,t=i.deltaH,l&&(c=u*l,e=t*l),m-=e/2*v(o)-t/2*f(o),p-=e/2*f(o)+t/2*v(o);break}case"top":{t=-t;const s=L(u,t,d);u=s.height,t=s.deltaH,l?(c=u*l,e=t*l,m+=e/2*v(o)+t/2*f(o),p+=e/2*f(o)-t/2*v(o)):(m+=t/2*f(o),p-=t/2*v(o));break}}return{position:{centerX:m,centerY:p},size:{width:c*g,height:u*r}}},L=(n,a,e)=>{const t=n+a;return t>e?n=t:(a=e-n,n=e),{height:n,deltaH:a}},R=(n,a,e)=>{const t=n+a;return t>e?n=t:(a=e-n,n=e),{width:n,deltaW:a}},Ce=({centerX:n,centerY:a,width:e,height:t,angle:l})=>({top:a-t/2,left:n-e/2,width:e,height:t,angle:l}),We=(n,a,e)=>{const{width:t,height:l}=n;return{width:Math.abs(t),height:Math.abs(l),left:a-Math.abs(t)/2,top:e-Math.abs(l)/2}};function I(n,a){const e=Math.abs(n)%a,t=n>0?a:-a;let l=0;return e>a/2?l=t*Math.ceil(Math.abs(n)/a):l=t*Math.floor(Math.abs(n)/a),l}function xe(n,a,e){const t=X(!1),l=X(!1),h=X({width:a.width,height:a.height,left:a.left,top:a.top,angle:a.angle});function d(o){if(a.disabled)return;t.value=!0,l.value=!0;let{clientX:g,clientY:r}=Y(o);const{left:s,top:i}=h.value;let b=0,w=0;a.boundary&&([b,w]=c()),e&&e("drag-start",h.value),j(y=>{const{clientX:N,clientY:A}=Y(y);let k=(N-g)/a.scaleRatio+s,E=(A-r)/a.scaleRatio+i;if(a.snapToGrid){let{left:V,top:H}=h.value;const z=k-V,_=E-H;k=V+I(z,a.gridX),E=H+I(_,a.gridY)}a.boundary&&([k,E]=u(k,E,b,w)),h.value.left=k,h.value.top=E,e&&e("drag",h.value)},y=>{t.value=!1,document.addEventListener("click",m,{once:!0}),e&&e("drag-end",h.value)})}const c=()=>{const{width:o,height:g}=h.value,r=(n.value.parentElement||document.body).getBoundingClientRect(),s=r.width/a.scaleRatio-o,i=r.height/a.scaleRatio-g;return[s,i]},u=(o,g,r,s)=>(o=o<0?0:o,o=o>r?r:o,g=g<0?0:g,g=g>s?s:g,[o,g]),m=()=>{l.value=!1},p=o=>{if(t.value)return;let{left:g,top:r}=h.value;if(["ArrowRight","ArrowLeft"].includes(o.key)){const s=o.key==="ArrowRight";let i=s?1:-1;a.snapToGrid&&(i=s?a.gridX:-a.gridX),g=g+i}else if(["ArrowUp","ArrowDown"].includes(o.key)){const s=o.key==="ArrowDown";let i=s?1:-1;a.snapToGrid&&(i=s?a.gridY:-a.gridY),r=r+i}if(a.boundary){const[s,i]=c();[g,r]=u(g,r,s,i)}h.value.left=g,h.value.top=r};return Re(()=>{if(!n.value)return;const{width:o,height:g}=n.value.getBoundingClientRect();h.value={...h.value,width:o||100,height:g||100},n.value.addEventListener("mousedown",d),n.value.addEventListener("touchstart",d)}),P(l,o=>{a.disabledKeyEvent||(o?document.addEventListener("keydown",p):document.removeEventListener("keydown",p))}),Xe(()=>{document.removeEventListener("keydown",p)}),{isMousedown:t,selected:l,dragData:h}}const De=D("div",{class:"es-drager-rotate-handle"},[D("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[D("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),Ie=se({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object,required:!0}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(n,{emit:a}){const e=n,t=X(null),l=le({get:()=>e.modelValue,set:d=>{a("update:modelValue",d)}});function h(d){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");d.stopPropagation(),d.preventDefault();const{width:c,height:u,left:m,top:p}=e.element.getBoundingClientRect(),o=m+c/2,g=p+u/2;a("rotate-start",l.value),j(r=>{const{clientX:s,clientY:i}=Y(r),b=o-s,w=g-i,y=Math.atan2(w,b)*180/Math.PI-90;l.value=(y+360)%360,a("rotate",l.value)},()=>{a("rotate-end",l.value)})}return(d,c)=>(B(),$("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:h,onTouchstart:h},[x(d.$slots,"default",{},()=>[De])],544))}}),_e=["data-side","onMousedown","onTouchstart"],Ge=D("div",{class:"es-drager-dot-handle"},null,-1),re=se({__name:"drager",props:Be,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(n,{emit:a}){const e=n,t=(r,...s)=>{a(r,...s),a("change",...s)},l=X(null),{selected:h,dragData:d,isMousedown:c}=xe(l,e,t),u=X(ne(0,e.resizeList)),m=le(()=>{const{width:r,height:s,left:i,top:b,angle:w}=d.value,y={};return r&&(y.width=W(r)),s&&(y.height=W(s)),{...y,left:W(i),top:W(b),zIndex:e.zIndex,transform:`rotate(${w}deg)`,"--es-drager-color":e.color}});function p(r){l.value||(l.value=r.$el||r)}function o(r){u.value=ne(r,e.resizeList),t("rotate-end",d.value)}function g(r,s){s.stopPropagation(),s.preventDefault();const{clientX:i,clientY:b}=Y(s),w=i,y=b,{width:N,height:A,left:k,top:E}=d.value,V=k+N/2,H=E+A/2,z={width:N,height:A,centerX:V,centerY:H,rotateAngle:d.value.angle},_=r.side,{minWidth:ie,minHeight:de,aspectRatio:U}=e;t("resize-start",d.value),j(q=>{const{clientX:ue,clientY:ce}=Y(q);let T=(ue-w)/e.scaleRatio,C=(ce-y)/e.scaleRatio;e.snapToGrid&&(T=I(T,e.gridX),C=I(C,e.gridY));const he=Math.atan2(C,T),F=He(T,C),ge=q.shiftKey,K=he-O(z.rotateAngle),me=F*Math.cos(K),pe=F*Math.sin(K),ve=ge&&!U?z.width/z.height:U,{position:{centerX:Q,centerY:Z},size:{width:fe,height:we}}=Te(_,{...z,rotateAngle:z.rotateAngle},me,pe,ve,ie,de),be=Ce({centerX:Q,centerY:Z,width:fe,height:we,angle:d.value.angle});d.value={...d.value,...We(be,Q,Z)},t("resize",d.value)},()=>{t("resize-end",d.value)})}return P(()=>[e.width,e.height,e.left,e.top,e.angle],([r,s,i,b,w])=>{d.value={...d.value,width:r,height:s,left:i,top:b,angle:w}}),P(()=>e.selected,r=>{h.value=r},{immediate:!0}),(r,s)=>(B(),J(Le(r.tag),{ref:p,class:ze(["es-drager",{disabled:r.disabled,dragging:M(c),selected:M(h),border:r.border}]),style:te(m.value),onClick:s[3]||(s[3]=ae(()=>{},["stop"]))},{default:ee(()=>[x(r.$slots,"default"),!r.disabled&&r.resizable?(B(!0),$(Ee,{key:0},ye(u.value,(i,b)=>(B(),$("div",{key:b,class:"es-drager-dot","data-side":i.side,style:te({...i}),onMousedown:ae(w=>g(i,w),["stop","prevent"]),onTouchstart:w=>g(i,w)},[x(r.$slots,"resize",Me(ke({side:i.side})),()=>[Ge])],44,_e))),128)):oe("",!0),!r.disabled&&M(h)?(B(),J(Ie,{key:1,modelValue:M(d).angle,"onUpdate:modelValue":s[0]||(s[0]=i=>M(d).angle=i),"drag-data":M(d),element:l.value,onRotate:s[1]||(s[1]=i=>t("rotate",M(d))),onRotateStart:s[2]||(s[2]=i=>t("rotate-start",M(d))),onRotateEnd:o},{default:ee(()=>[x(r.$slots,"rotate")]),_:3},8,["modelValue","drag-data","element"])):oe("",!0)]),_:3},8,["class","style"]))}}),Pe=n=>{n.component("es-drager",re)};re.install=Pe;export{re as i};
