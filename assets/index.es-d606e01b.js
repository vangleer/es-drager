import{d as pe,r as A,g as P,eN as _,o as W,b as ie,w as re,eO as q,c as K,a as Ye,n as de,eP as ze,eQ as Ae,F as Te,eR as ue,u as T,eS as Ne,eJ as He,eH as Pe,eD as fe,h as G,eF as We,eT as De}from"./index-50d0385d.js";const Se={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},maxWidth:{type:Number,default:0},maxHeight:{type:Number,default:0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean},checkCollision:{type:Boolean},snap:Boolean,snapThreshold:{type:Number,default:10},markline:[Boolean,Function]};function J(l,a){const e=t=>{a&&a(t),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",l),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",l),document.addEventListener("touchend",e)}function D(l){let a=0,e=0;if(Ve(l)){const t=l.targetTouches[0];a=t.pageX,e=t.pageY}else a=l.clientX,e=l.clientY;return{clientX:a,clientY:e}}function Ve(l){const a=Object.prototype.toString.call(l);return a.substring(8,a.length-1)==="TouchEvent"}const I=(l=0)=>parseInt(l+"")+"px",F={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},U=["n","ne","e","se","s","sw","w","nw"],$e={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},Ie={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},_e=(l,a)=>{const e=Ie[Math.floor(l/30)],t=($e[a]+e)%8;return U[t]},he=(l=0,a)=>{let e=[];for(let t=0;t<U.length;t++){const n=U[t],[g,o]=F[n].split("-"),d=_e(l,n),u={[g]:"0%",cursor:d+"-resize",side:F[n]};if(o)u[o]="0%";else{const p=["top","bottom"].includes(g)?"left":"top";u[p]="50%"}a?a.includes(F[n])&&e.push(u):e.push(u)}return e},Q=l=>l*Math.PI/180,qe=(l,a)=>Math.sqrt(l*l+a*a),b=l=>Math.cos(Q(l)),k=l=>Math.sin(Q(l)),Ge=(l,a,e,t,n,g,o)=>{let{width:d,height:u,centerX:p,centerY:m,rotateAngle:i}=a;const M=d<0?-1:1,h=u<0?-1:1;switch(d=Math.abs(d),u=Math.abs(u),l){case"right":{const s=H(d,e,g);d=s.width,e=s.deltaW,n?(t=e/n,u=d/n,p+=e/2*b(i)-t/2*k(i),m+=e/2*k(i)+t/2*b(i)):(p+=e/2*b(i),m+=e/2*k(i));break}case"top-right":{t=-t;const s=H(d,e,g);d=s.width,e=s.deltaW;const c=N(u,t,o);u=c.height,t=c.deltaH,n&&(e=t*n,d=u*n),p+=e/2*b(i)+t/2*k(i),m+=e/2*k(i)-t/2*b(i);break}case"bottom-right":{const s=H(d,e,g);d=s.width,e=s.deltaW;const c=N(u,t,o);u=c.height,t=c.deltaH,n&&(e=t*n,d=u*n),p+=e/2*b(i)-t/2*k(i),m+=e/2*k(i)+t/2*b(i);break}case"bottom":{const s=N(u,t,o);u=s.height,t=s.deltaH,n?(e=t*n,d=u*n,p+=e/2*b(i)-t/2*k(i),m+=e/2*k(i)+t/2*b(i)):(p-=t/2*k(i),m+=t/2*b(i));break}case"bottom-left":{e=-e;const s=H(d,e,g);d=s.width,e=s.deltaW;const c=N(u,t,o);u=c.height,t=c.deltaH,n&&(u=d/n,t=e/n),p-=e/2*b(i)+t/2*k(i),m-=e/2*k(i)-t/2*b(i);break}case"left":{e=-e;const s=H(d,e,g);d=s.width,e=s.deltaW,n?(u=d/n,t=e/n,p-=e/2*b(i)+t/2*k(i),m-=e/2*k(i)-t/2*b(i)):(p-=e/2*b(i),m-=e/2*k(i));break}case"top-left":{e=-e,t=-t;const s=H(d,e,g);d=s.width,e=s.deltaW;const c=N(u,t,o);u=c.height,t=c.deltaH,n&&(d=u*n,e=t*n),p-=e/2*b(i)-t/2*k(i),m-=e/2*k(i)+t/2*b(i);break}case"top":{t=-t;const s=N(u,t,o);u=s.height,t=s.deltaH,n?(d=u*n,e=t*n,p+=e/2*b(i)+t/2*k(i),m+=e/2*k(i)-t/2*b(i)):(p+=t/2*k(i),m-=t/2*b(i));break}}return{position:{centerX:p,centerY:m},size:{width:d*M,height:u*h}}},N=(l,a,e)=>{const t=l+a;return t>e?l=t:(a=e-l,l=e),{height:l,deltaH:a}},H=(l,a,e)=>{const t=l+a;return t>e?l=t:(a=e-l,l=e),{width:l,deltaW:a}},je=({centerX:l,centerY:a,width:e,height:t,angle:n})=>({top:a-t/2,left:l-e/2,width:e,height:t,angle:n}),Oe=(l,a,e)=>{const{width:t,height:n}=l;return{width:Math.abs(t),height:Math.abs(n),left:a-Math.abs(t)/2,top:e-Math.abs(n)/2}};function j(l,a){const e=Math.abs(l)%a,t=l>0?a:-a;let n=0;return e>a/2?n=t*Math.ceil(Math.abs(l)/a):n=t*Math.floor(Math.abs(l)/a),n}function Fe(l,a){if(!l||!a)return!1;const e=l.getBoundingClientRect(),t=a.getBoundingClientRect();return e.left<t.left+t.width&&e.left+e.width>t.left&&e.top<t.top+t.height&&e.top+e.height>t.top}const ce=l=>typeof l=="function";function Ke(l,a){let e=null,t=null;const n=P(()=>l.value.offsetParent||document.body),g=P(()=>n.value.getBoundingClientRect()),o=A({x:[],y:[]}),d=()=>{a.markline&&!ce(a.markline)&&(e||(e=document.querySelector(".es-drager-markline-x")||ge("x",n.value,a.color)),t||(t=document.querySelector(".es-drager-markline-y")||ge("y",n.value,a.color)))},u=(h={})=>{if(a.markline){if(ce(a.markline))return a.markline(h);h.left===null?e.style.display="none":(e.style.left=h.left+"px",e.style.backgroundColor=a.color,e.style.display="block"),h.top===null?t.style.display="none":(t.style.top=h.top+"px",t.style.backgroundColor=a.color,t.style.display="block")}},p=()=>{const h=l.value.getBoundingClientRect(),s=document.querySelectorAll(".es-drager"),c=[];for(let v=0;v<s.length;v++){const w=s[v];w!==l.value&&c.push(w.getBoundingClientRect())}o.value=Ue(c,h)},m=()=>{const h={top:null,left:null,diffX:0,diffY:0},s=l.value.getBoundingClientRect();for(let c=0;c<o.value.y.length;c++){const{top:v,showTop:w}=o.value.y[c];if(Math.abs(v-s.top)<a.snapThreshold){h.diffY=v-s.top,h.top=w-g.value.top;break}}for(let c=0;c<o.value.x.length;c++){const{left:v,showLeft:w}=o.value.x[c];if(Math.abs(v-s.left)<a.snapThreshold){h.diffX=v-s.left,h.left=w-g.value.left;break}}return u(h),h},i=()=>{u({left:null,top:null})},M=h=>{if(!(!a.snap&&!a.markline))switch(h){case"drag-start":p();break;case"drag":return m();case"drag-end":i();break}};return fe(()=>{d()}),{marklineEmit:M}}function ge(l="x",a,e=""){const t=document.createElement("div");return t.classList.add(`es-drager-markline-${l}`),t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.zIndex="9999",t.style.backgroundColor=e,t.style.display="none",l==="x"?(t.style.height="100%",t.style.width="1px"):(t.style.height="1px",t.style.width="100%"),a.appendChild(t),t}function Ue(l,a){const e={x:[],y:[]},{width:t=0,height:n=0}=a;return l.forEach(g=>{const{top:o,left:d,width:u,height:p}=g;e.y.push({showTop:o,top:o}),e.y.push({showTop:o,top:o-n}),e.y.push({showTop:o+p/2,top:o+p/2-n/2}),e.y.push({showTop:o+p,top:o+p}),e.y.push({showTop:o+p,top:o+p-n}),e.x.push({showLeft:d,left:d}),e.x.push({showLeft:d+u,left:d+u}),e.x.push({showLeft:d+u/2,left:d+u/2-t/2}),e.x.push({showLeft:d+u,left:d+u-t}),e.x.push({showLeft:d,left:d-t})}),e}function Je(l,a,e,{getBoundary:t,fixBoundary:n,checkDragerCollision:g,emit:o}){let d=0,u=0;const p=i=>{let{left:M,top:h}=a.value;if(d||(d=M),u||(u=h),["ArrowRight","ArrowLeft"].includes(i.key)){const s=i.key==="ArrowRight";let c=s?1:-1;l.snapToGrid&&(c=s?l.gridX:-l.gridX),M=M+c}else if(["ArrowUp","ArrowDown"].includes(i.key)){const s=i.key==="ArrowDown";let c=s?1:-1;l.snapToGrid&&(c=s?l.gridY:-l.gridY),h=h+c}if(l.boundary){const[s,c,v,w]=t();[M,h]=n(M,h,s,c,v,w)}a.value.left=M,a.value.top=h},m=i=>{["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(i.key)&&l.checkCollision&&g()&&(a.value.left=d,a.value.top=u),d=0,u=0};_(e,i=>{l.disabledKeyEvent||(i?(document.addEventListener("keydown",p),document.addEventListener("keyup",m)):(document.removeEventListener("keydown",p),document.removeEventListener("keyup",m)))}),We(()=>{document.removeEventListener("keydown",p),document.removeEventListener("keyup",m)})}function Qe(l,a,e){const t=A(!1),n=A(!1),g=A({width:a.width,height:a.height,left:a.left,top:a.top,angle:a.angle}),{marklineEmit:o}=Ke(l,a),d=new Set;function u(h){if(d.add(h.button),a.disabled)return;t.value=!0,n.value=!0;let{clientX:s,clientY:c}=D(h);const{left:v,top:w}=g.value;let r=0,y=0,f=0,L=0;a.boundary&&([r,y,f,L]=p()),o("drag-start"),e&&e("drag-start",g.value),J(x=>{if(d.size>1)return;const{clientX:B,clientY:X}=D(x);let R=(B-s)/a.scaleRatio+v,C=(X-c)/a.scaleRatio+w;if(a.snapToGrid){let{left:E,top:S}=g.value;const O=R-E,Y=C-S;R=E+j(O,a.gridX),C=S+j(Y,a.gridY)}a.boundary&&([R,C]=m(R,C,r,y,f,L)),g.value.left=R,g.value.top=C,e&&e("drag",g.value),De(()=>{const E=o("drag");a.snap&&(E.diffX&&(g.value.left+=E.diffX),E.diffY&&(g.value.top+=E.diffY))})},x=>{a.checkCollision&&i()&&(g.value.top=w,g.value.left=v),d.clear(),t.value=!1,document.addEventListener("click",M,{once:!0}),o("drag-end"),e&&e("drag-end",g.value)})}const p=()=>{let h=0,s=0;const{left:c,top:v,height:w,width:r,angle:y}=g.value,f=(l.value.offsetParent||document.body).getBoundingClientRect();if(y&&a.scaleRatio===1){const B=l.value.getBoundingClientRect();h=Math.abs(B.left-(c+f.left)),s=Math.abs(B.top-(v+f.top))}const L=f.width/a.scaleRatio-r,x=f.height/a.scaleRatio-w;return[h,L-h,s,x-s,f.width/a.scaleRatio,f.height/a.scaleRatio]},m=(h,s,c,v,w,r)=>(h=h<c?c:h,h=h>v?v:h,s=s<w?w:s,s=s>r?r:s,[h,s]),i=()=>{const h=l.value.offsetParent||document.body,s=Array.from(h.children).filter(c=>c!==l.value&&c.classList.contains("es-drager"));for(let c=0;c<s.length;c++){const v=s[c];if(Fe(l.value,v))return!0}},M=()=>{n.value=!1};return Je(a,g,n,{getBoundary:p,fixBoundary:m,checkDragerCollision:i,emit:e}),fe(()=>{if(l.value){if(!g.value.width&&!g.value.height){const{width:h,height:s}=l.value.getBoundingClientRect();g.value={...g.value,width:h||100,height:s||100}}l.value.addEventListener("mousedown",u),l.value.addEventListener("touchstart",u,{passive:!0})}}),{isMousedown:t,selected:n,dragData:g,getBoundary:p,checkDragerCollision:i}}const Ze=G("div",{class:"es-drager-rotate-handle"},[G("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[G("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),et=pe({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(l,{emit:a}){const e=l,t=A(null),n=P({get:()=>e.modelValue,set:o=>{a("update:modelValue",o)}});function g(o){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");o.stopPropagation();const{width:d,height:u,left:p,top:m}=e.element.getBoundingClientRect(),i=p+d/2,M=m+u/2;a("rotate-start",n.value),J(h=>{const{clientX:s,clientY:c}=D(h),v=i-s,w=M-c,r=Math.atan2(w,v)*180/Math.PI-90;n.value=(r+360)%360,a("rotate",n.value)},()=>{a("rotate-end",n.value)})}return(o,d)=>(W(),K("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:g,onTouchstartPassive:g},[q(o.$slots,"default",{},()=>[Ze])],544))}}),tt=["data-side","onMousedown","onTouchstartPassive"],at=G("div",{class:"es-drager-dot-handle"},null,-1),me=pe({__name:"drager",props:Se,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(l,{emit:a}){const e=l,t=(r,...y)=>{a(r,...y)},n=A(null),{selected:g,dragData:o,isMousedown:d,getBoundary:u,checkDragerCollision:p}=Qe(n,e,t),m=A(he(0,e.resizeList)),i=P(()=>e.resizable&&!e.disabled),M=P(()=>e.rotatable&&!e.disabled&&g.value),h=P(()=>{const{width:r,height:y,left:f,top:L,angle:x}=o.value,B={};return r&&(B.width=I(r)),y&&(B.height=I(y)),{...B,left:I(f),top:I(L),zIndex:e.zIndex,transform:`rotate(${x}deg)`,"--es-drager-color":e.color}});function s(r){n.value||(n.value=r.$el||r)}function c(r){m.value=he(r,e.resizeList),t("rotate-end",o.value)}function v(r,y){if(e.disabled)return;y.stopPropagation();const{clientX:f,clientY:L}=D(y),x=f,B=L,{width:X,height:R,left:C,top:E}=o.value,S=C+X/2,O=E+R/2,Y={width:X,height:R,centerX:S,centerY:O,rotateAngle:o.value.angle},ve=r.side,{minWidth:ye,minHeight:we,aspectRatio:Z,equalProportion:be}=e;t("resize-start",o.value);let ee=[];e.boundary&&(ee=u()),J(te=>{const{clientX:ke,clientY:Me}=D(te);let V=(ke-x)/e.scaleRatio,$=(Me-B)/e.scaleRatio;e.snapToGrid&&(V=j(V,e.gridX),$=j($,e.gridY));const Le=Math.atan2($,V),ae=qe(V,$),xe=te.shiftKey,le=Le-Q(Y.rotateAngle),Be=ae*Math.cos(le),Re=ae*Math.sin(le),oe=(be||xe)&&!Z?Y.width/Y.height:Z,{position:{centerX:ne,centerY:se},size:{width:Ce,height:Ee}}=Ge(ve,{...Y,rotateAngle:Y.rotateAngle},Be,Re,oe,ye,we),Xe=je({centerX:ne,centerY:se,width:Ce,height:Ee,angle:o.value.angle});let z={...o.value,...Oe(Xe,ne,se)};e.maxWidth>0&&(z.width=Math.min(z.width,e.maxWidth)),e.maxHeight>0&&(z.height=Math.min(z.height,e.maxHeight)),e.boundary&&(z=w(z,ee,oe)),o.value=z,t("resize",o.value)},()=>{e.checkCollision&&p()&&(o.value={...o.value,width:X,height:R,left:C,top:E}),t("resize-end",o.value)})}function w(r,y,f){const[L,x,B,X,R,C]=y;return r.left<L&&(r.left=L,r.width=o.value.width,f&&(r.height=o.value.height)),r.left+r.width>R&&(r.left=o.value.left,r.width=R-r.left,f&&(r.height=o.value.height)),r.top<B&&(r.top=B,r.height=o.value.height,f&&(r.width=o.value.width)),r.top+r.height>C&&(r.top=o.value.top,r.height=C-r.top,f&&(r.width=o.value.width)),r}return _(()=>[e.width,e.height,e.left,e.top,e.angle],([r,y,f,L,x],[B,X,R,C,E])=>{r!==B&&(o.value.width=r),y!==X&&(o.value.height=y),f!==R&&(o.value.left=f),L!==C&&(o.value.top=L),x!==E&&(o.value.angle=x)}),_(()=>o.value,r=>{a("change",{...r})},{deep:!0}),_(()=>e.selected,r=>{g.value=r},{immediate:!0}),(r,y)=>(W(),ie(Pe(r.tag),{ref:s,class:Ne(["es-drager",{disabled:r.disabled,dragging:T(d),selected:T(g),border:r.border}]),style:de(h.value),onClick:y[3]||(y[3]=He(()=>{},["stop"]))},{default:re(()=>[q(r.$slots,"default"),i.value?(W(!0),K(Te,{key:0},Ye(m.value,(f,L)=>(W(),K("div",{key:L,class:"es-drager-dot","data-side":f.side,style:de({...f}),onMousedown:x=>v(f,x),onTouchstartPassive:x=>v(f,x)},[q(r.$slots,"resize",ze(Ae({side:f.side})),()=>[at])],44,tt))),128)):ue("",!0),M.value?(W(),ie(et,{key:1,modelValue:T(o).angle,"onUpdate:modelValue":y[0]||(y[0]=f=>T(o).angle=f),element:n.value,onRotate:y[1]||(y[1]=f=>t("rotate",T(o))),onRotateStart:y[2]||(y[2]=f=>t("rotate-start",T(o))),onRotateEnd:c},{default:re(()=>[q(r.$slots,"rotate")]),_:3},8,["modelValue","element"])):ue("",!0)]),_:3},8,["class","style"]))}}),lt=l=>{l.component("es-drager",me)};me.install=lt;export{me as y};
