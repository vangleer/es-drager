import{G as S}from"./GridRect-a4b085e8.js";import{i as M}from"./index.es-b966b3a0.js";import{M as O,c as P}from"./common-58372327.js";import{d as V,r as m,eN as j,a as z,eO as F,b as c,e as k,g as x,B as i,i as u,t as _,u as v,F as G,j as I,h as C,s as J,v as K,x as R,l as T,m as q,_ as U}from"./index-c4559540.js";const $={class:"es-container"},A={class:"es-tools"},H={class:"es-editor"},Q=V({__name:"markline",setup(W){const g=m(-1),d=m({componentList:[{component:"div",text:"div1",width:100,height:100,left:0,top:0},{component:"div",text:"div2",width:100,height:100,top:100,left:100}]}),s=j({left:null,top:null}),r=m({x:[],y:[]}),p=B(d);function L(o){g.value=o,r.value=P(d.value.componentList,g.value)}function w(o){s.top=null,s.left=null;for(let e=0;e<r.value.y.length;e++){const{top:n,showTop:t}=r.value.y[e];if(Math.abs(n-o.top)<5){s.top=t;break}}for(let e=0;e<r.value.x.length;e++){const{left:n,showLeft:t}=r.value.x[e];if(Math.abs(n-o.left)<5){s.left=t;break}}}function b(){p.record(),s.top=null,s.left=null}function D(o,e){Object.keys(o).forEach(n=>{e[n]=o[n]})}function B(o){const e=[];let n=-1;const t=()=>{console.log("redo",n,e),n<e.length-1&&(n++,o.value.componentList=f(e[n]))},l=()=>{console.log("undo",n,e),n>=0&&(n--,e[n]&&(o.value.componentList=f(e[n])))},a=()=>{e[++n]=f(o.value.componentList)};a();const h=N=>{const{ctrlKey:E,key:y}=N;E&&(y==="z"?l():y==="y"&&t())};return window.addEventListener("keydown",h),z(()=>{window.removeEventListener("keydown",h)}),{redo:t,undo:l,record:a}}function f(o){return JSON.parse(JSON.stringify(o))}return(o,e)=>{const n=F("el-button");return c(),k("div",$,[x("div",A,[i(n,{type:"primary",onClick:v(p).undo},{default:u(()=>[_("撤销")]),_:1},8,["onClick"]),i(n,{type:"primary",onClick:v(p).redo},{default:u(()=>[_("重做")]),_:1},8,["onClick"])]),x("div",H,[(c(!0),k(G,null,I(d.value.componentList,(t,l)=>(c(),C(v(M),R(t,{onDragStart:a=>L(l),onDrag:e[0]||(e[0]=a=>w(a)),onChange:a=>D(a,t),onDragEnd:b}),{default:u(()=>[(c(),C(J(t.component),null,{default:u(()=>[_(K(t.text),1)]),_:2},1024))]),_:2},1040,["onDragStart","onChange"]))),256)),i(O,T(q(s)),null,16),i(S,{class:"grid-rect"})])])}}});const ne=U(Q,[["__scopeId","data-v-222b610e"]]);export{ne as default};
