import{d as A,r as H,eL as ee,o as f,c as V,eM as re,e as P,t as j,eN as se,_ as q,eH as g,l as t,w as s,i as L,F as z,a as R,b as E,eI as K,u as o,eO as le,eP as ue,m as J,eQ as N,h as M,n as I,eR as X,eK as F,eE as Z,eS as ie,eT as W,eU as ce,g as pe,eV as fe,eW as me,eX as _e,eY as ve,eZ as be,e_ as ge,e$ as he,f0 as ye,f1 as Ve,f2 as xe,f3 as we}from"./index-57a7feee.js";import{a as ke,d as Ce,G as Se,u as oe}from"./GridRect-3605385b.js";import{u as Ue,A as ze}from"./useArea-0b8f70ab.js";import{u as $e,$ as Me,a as ne}from"./useEditorContainer-d39b8817.js";const Re=["fontSize","lineHeight","borderWidth","borderRadius"],ae=["fontSize","fontWeight","fontFamily","color","lineHeight","fontStyle","textDecoration","justifyContent","alignItems"];function Q(v,e=!0){if(!v)return v;const m={},r=Object.keys(v).filter(n=>e?ae.includes(n):!ae.includes(n));for(const n of r)m[n]=Re.includes(n)?ke(v[n]):v[n];return m}function Ee(v,e){return Object.keys(v).reduce((m,r)=>(e.includes(r)||(m[r]=v[r]),m),{})}const He=["contenteditable"],De=A({__name:"TextEditor",props:{editable:{type:Boolean,default:!1},text:{type:String}},setup(v){const e=v,m=H();function r(){if(!m.value)return;const n=document.createRange();n.selectNode(m.value),window.getSelection().removeAllRanges(),window.getSelection().addRange(n)}return ee(()=>[e.editable],()=>{e.editable&&r()}),(n,_)=>(f(),V("div",{ref_key:"textRef",ref:m,class:se(["es-text",{editable:v.editable}]),contenteditable:v.editable},[re(n.$slots,"default",{},()=>[P(j(v.text),1)],!0)],10,He))}}),de=q(De,[["__scopeId","data-v-6f7332e1"]]),Le={class:"es-layout-aside"},Te={class:"collapse-content"},Ae=["onDragstart"],Ie={class:"collapse-content"},Oe=["onDragstart"],Be=A({__name:"Aside",emits:["dragstart","dragend"],setup(v,{emit:e}){const m=e,r=H(["1"]);function n(p,d){let l=50,c=50;d.component!=="es-icon"&&(l=p.target.offsetWidth,c=p.target.offsetHeight),m("dragstart",{...d,width:l,height:c})}function _(){m("dragend")}return(p,d)=>{const l=g("el-collapse-item"),c=g("el-collapse");return f(),V("div",Le,[re(p.$slots,"default",{},()=>[t(c,{modelValue:r.value,"onUpdate:modelValue":d[0]||(d[0]=a=>r.value=a)},{default:s(()=>[t(l,{title:"通用",name:"1"},{default:s(()=>[L("div",Te,[(f(!0),V(z,null,R(o(le).componentList,a=>(f(),V("div",{class:"es-block",draggable:"true",onDragstart:h=>n(h,a),onDragend:_},[a.component?(f(),E(K(a.component),{key:0},{default:s(()=>[P(j(a.text),1)]),_:2},1024)):(f(),V(z,{key:1},[P(j(a.text),1)],64))],40,Ae))),256))])]),_:1}),t(l,{title:"杂项",name:"2"}),t(l,{title:"图标",name:"3"},{default:s(()=>[L("div",Ie,[(f(!0),V(z,null,R(o(le).iconList,a=>(f(),V("div",{class:"es-block",draggable:"true",onDragstart:h=>n(h,a),onDragend:_},[a.component?(f(),E(K(a.component),ue(J({key:0},a.props)),null,16)):(f(),V(z,{key:1},[P(j(a.props.icon),1)],64))],40,Oe))),256))])]),_:1})]),_:1},8,["modelValue"])])])}}}),Pe=A({__name:"EditorStyle",setup(v){const e=N(),m=H(100),r=M({get:()=>{const{width:p,height:d}=e.data.container.style;return`${p} x ${d}`},set:p=>{const[d,l]=p.split(" x ");e.data.container.style.width=+d,e.data.container.style.height=+l}}),n=[{label:"PC",options:[{label:"1360 x 760",value:"1360 x 760"},{label:"1280 x 720",value:"1280 x 720"},{label:"800 x 600",value:"800 x 600"}]},{label:"H5",options:[{label:"360 x 780",value:"360 x 780"},{label:"iPhone 6/7/8",value:"375 x 667"},{label:"iPhone 6/7/8 Plus",value:"414 x 736"}]}],_=p=>{e.data.container.scaleRatio=p/100};return(p,d)=>{const l=g("el-option"),c=g("el-option-group"),a=g("el-select"),h=g("el-form-item"),U=g("el-input"),b=g("el-input-number"),k=g("el-switch"),O=g("el-color-picker"),y=g("el-checkbox"),S=g("el-form");return f(),E(S,{model:o(e).data.container,"label-width":"90px","label-position":"left",style:{padding:"0 10px"}},{default:s(()=>[t(h,{label:"画布尺寸"},{default:s(()=>[t(a,{modelValue:r.value,"onUpdate:modelValue":d[0]||(d[0]=u=>r.value=u)},{default:s(()=>[(f(),V(z,null,R(n,u=>t(c,{key:u.label,label:u.label},{default:s(()=>[(f(!0),V(z,null,R(u.options,i=>(f(),E(l,{label:i.label,value:i.value},null,8,["label","value"]))),256))]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1}),t(h,{label:"缩放比例(%)"},{default:s(()=>[t(U,{modelValue:m.value,"onUpdate:modelValue":d[1]||(d[1]=u=>m.value=u),modelModifiers:{number:!0},onChange:_},null,8,["modelValue"])]),_:1}),t(h,{label:"画布宽度"},{default:s(()=>[t(b,{modelValue:o(e).data.container.style.width,"onUpdate:modelValue":d[2]||(d[2]=u=>o(e).data.container.style.width=u)},null,8,["modelValue"])]),_:1}),t(h,{label:"画布高度"},{default:s(()=>[t(b,{modelValue:o(e).data.container.style.height,"onUpdate:modelValue":d[3]||(d[3]=u=>o(e).data.container.style.height=u)},null,8,["modelValue"])]),_:1}),t(h,{label:"网格"},{default:s(()=>[t(k,{modelValue:o(e).data.container.snapToGrid,"onUpdate:modelValue":d[4]||(d[4]=u=>o(e).data.container.snapToGrid=u)},null,8,["modelValue"])]),_:1}),t(h,{label:"网格大小"},{default:s(()=>[t(b,{modelValue:o(e).data.container.gridSize,"onUpdate:modelValue":d[5]||(d[5]=u=>o(e).data.container.gridSize=u)},null,8,["modelValue"])]),_:1}),t(h,{label:"网格颜色"},{default:s(()=>[t(O,{modelValue:o(e).data.container.gridColor,"onUpdate:modelValue":d[6]||(d[6]=u=>o(e).data.container.gridColor=u)},null,8,["modelValue"])]),_:1}),t(h,{label:"背景颜色"},{default:s(()=>[t(O,{modelValue:o(e).data.container.style.backgroundColor,"onUpdate:modelValue":d[7]||(d[7]=u=>o(e).data.container.style.backgroundColor=u)},null,8,["modelValue"])]),_:1}),t(h,{label:"参考线"},{default:s(()=>[t(y,{modelValue:o(e).data.container.markline.show,"onUpdate:modelValue":d[8]||(d[8]=u=>o(e).data.container.markline.show=u)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])}}}),We='<svg t="1692778133849" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15222" width="16" height="16"><path d="M123.26 411.37a32 32 0 1 1 45.28-45.23l311.34 311.67L479.71 97a32 32 0 0 1 32-32 32 32 0 0 1 32 32l0.17 580.89 311.59-311.76a32 32 0 0 1 45.27 45.24l-366.2 366.39-0.19 0.18-0.94 0.9-0.52 0.44-0.62 0.53-0.1 0.09-0.62 0.47-0.5 0.4c-0.05 0-0.1 0.08-0.16 0.11-0.21 0.16-0.43 0.31-0.65 0.46l-0.46 0.32-0.2 0.14-0.65 0.41-0.48 0.29a1.64 1.64 0 0 1-0.22 0.14l-0.62 0.35-0.52 0.29-0.23 0.13-0.59 0.29-0.6 0.3-0.18 0.09c-0.17 0.09-0.35 0.16-0.53 0.24l-0.71 0.3-0.19 0.08-0.48 0.18c-0.27 0.1-0.54 0.21-0.81 0.3H522.6l-0.42 0.13-0.91 0.3h-0.14l-0.39 0.11-1 0.26h-0.12l-0.38 0.08c-0.34 0.08-0.68 0.16-1 0.22h-0.06l-0.42 0.07-1 0.17h-0.09c-0.17 0-0.34 0-0.51 0.06l-0.94 0.12h-0.95l-0.75 0.05h-3.12l-0.75-0.05H508.84l-0.94-0.12c-0.17 0-0.34 0-0.51-0.06h-0.09l-1-0.17-0.42-0.07h-0.1c-0.34-0.06-0.68-0.14-1-0.22l-0.4-0.08h-0.08l-1-0.26-0.4-0.11h-0.14l-0.89-0.29-0.45-0.14-0.14-0.05c-0.26-0.09-0.53-0.19-0.79-0.3l-0.49-0.18h-0.2l-0.69-0.3-0.55-0.24-0.18-0.09-0.59-0.3-0.6-0.29-0.17-0.09h-0.05l-0.52-0.28-0.64-0.36-0.14-0.09h-0.07l-0.47-0.3c-0.22-0.14-0.45-0.27-0.67-0.42h-0.07l-0.11-0.08-0.47-0.33-0.81-0.49-0.09-0.08-0.53-0.42-0.61-0.47-0.08-0.07c-0.24-0.19-0.47-0.4-0.7-0.6l-0.46-0.4c-0.41-0.37-0.81-0.74-1.19-1.13zM896.68 895H127.32a32 32 0 1 0 0 64h769.36a32 32 0 0 0 0-64z" fill="currentColor" p-id="15223"></path></svg>',Ne='<svg t="1692774315617" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8893" width="16" height="16"><path fill="currentColor" d="M96 128h832v96H96zM96 576h832v96H96zM224 352h576v96H224zM224 800h576v96H224z" p-id="8894"></path></svg>',Ye='<svg t="1692774266304" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6910" width="16" height="16"><path fill="currentColor" d="M96 128h832v96H96zM96 576h832v96H96zM96 352h576v96H96zM96 800h576v96H96z" p-id="6911"></path></svg>',je='<svg t="1692778640543" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7435" width="16" height="16"><path fill="currentColor" d="M143.998942-0.011289h64.007055V1024h-64.007055zM815.982714 224.002117h64.007056v575.984478h-64.007056zM591.991886-0.011289h64.007056V1024h-64.007056zM368.001058 224.002117h63.995767v575.984478h-63.995767z" p-id="7436"></path></svg>',Ge='<svg t="1692774301684" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7896" width="16" height="16"><path fill="currentColor" d="M96 128h832v96H96zM96 576h832v96H96zM352 352h576v96H352zM352 800h576v96H352z" p-id="7897"></path></svg>',Fe='<svg t="1692777879594" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="14228" width="16" height="16"><path d="M557.654996 981.669904c-6.499999 59.041994-88.986991 53.776995-92.179991 0-0.083-40.896996-0.083-641.390937-0.083-641.390937l-283.839972 273.963973c-44.472996 38.308996-97.43499-22.922998-64.344994-63.215994 125.709988-121.895988 351.289966-340.004967 356.507965-345.049966 20.810998-22.608998 53.572995-23.779998 75.721993 0 41.406996 40.037996 348.700966 336.328967 358.028965 346.989966 31.166997 38.741996-19.223998 96.073991-62.242994 63.773994C834.109969 607.310941 557.739996 340.267967 557.739996 340.267967M116.396039 3.332l786.487923 0 0 89.285991L116.396039 92.617991 116.396039 3.332z" fill="currentColor" p-id="14229"></path></svg>',qe=Object.assign({"./bottom.svg":We,"./center.svg":Ne,"./left.svg":Ye,"./middle.svg":je,"./right.svg":Ge,"./top.svg":Fe}),G=v=>v?qe[`./${v}.svg`]:"",Xe={class:"text-block-box"},Ke={class:"text-style-block"},Je=["onClick","innerHTML"],Qe=A({__name:"TextStyle",setup(v){const e=N(),m=[{label:"正常",value:"normal"},{label:"标题 1",value:"2em"},{label:"标题 2",value:"1.5em"},{label:"标题 3",value:"1.17em"},{label:"标题 4",value:"1em"},{label:"标题 5",value:"0.9em"},{label:"标题 6",value:"0.8em"}],r=H(""),n=[{label:"B",key:"fontWeight",value:"bold"},{label:"I",key:"fontStyle",value:"italic"},{label:"U",key:"textDecoration",value:"underline"},{label:"S",key:"textDecoration",value:"line-through"},{label:G("left"),key:"justifyContent",value:"flex-start"},{label:G("center"),key:"justifyContent",value:"center"},{label:G("right"),key:"justifyContent",value:"flex-end"},{label:G("top"),key:"alignItems",value:"flex-start"},{label:G("middle"),key:"alignItems",value:"center"},{label:G("bottom"),key:"alignItems",value:"flex-end"}],_=M(()=>[...n].map(b=>({...b,selected:U(b.key)===b.value}))),p=M(()=>[_.value.slice(0,4),_.value.slice(4,7),_.value.slice(7,10)]),d=[{label:"Helvetica"},{label:"PingFang SC"},{label:"Hiragino Sans GB"},{label:"Microsoft YaHei"},{label:"Times New Roman"},{label:"Verdana"},{label:"Courier New"},{label:"Georgia"},{label:"Lucida Sans"},{label:"Tahoma"}];function l(b){b.selected=!b.selected,h(b.key,b.selected?b.value:void 0)}function c(b){const k=b==="normal";e.current.style.fontSize=k?void 0:b,e.current.style.fontWeight=k?"normal":"bold"}const a=M({get:()=>e.current.style||{},set:b=>{e.current.style=e.current.style||{},Object.keys(b).forEach(k=>{h(k,b[k])})}});function h(b,k){e.current.style[b]=k}function U(b){return e.current.style[b]}return(b,k)=>{const O=g("el-color-picker"),y=g("el-form-item"),S=g("el-option"),u=g("el-select"),i=g("el-input"),T=g("el-input-number");return f(),V("div",null,[t(y,{label:"字体颜色"},{default:s(()=>[t(O,{modelValue:a.value.color,"onUpdate:modelValue":k[0]||(k[0]=w=>a.value.color=w)},null,8,["modelValue"])]),_:1}),t(y,{label:"标题"},{default:s(()=>[t(u,{modelValue:r.value,"onUpdate:modelValue":k[1]||(k[1]=w=>r.value=w),placeholder:"标题",onChange:c},{default:s(()=>[(f(),V(z,null,R(m,w=>t(S,{label:w.label,value:w.value},{default:s(()=>[L("span",{style:I({fontSize:w.value,fontWeight:"bold"})},j(w.label),5)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"字体"},{default:s(()=>[t(u,{modelValue:a.value.fontFamily,"onUpdate:modelValue":k[2]||(k[2]=w=>a.value.fontFamily=w),placeholder:"字体"},{default:s(()=>[(f(),V(z,null,R(d,w=>t(S,{label:w.label,value:w.label},{default:s(()=>[L("span",{style:I({fontFamily:w.label})},j(w.label),5)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"字体大小"},{default:s(()=>[t(i,{modelValue:a.value.fontSize,"onUpdate:modelValue":k[3]||(k[3]=w=>a.value.fontSize=w)},null,8,["modelValue"])]),_:1}),t(y,{label:"行高"},{default:s(()=>[t(T,{modelValue:a.value.lineHeight,"onUpdate:modelValue":k[4]||(k[4]=w=>a.value.lineHeight=w)},null,8,["modelValue"])]),_:1}),t(y,{label:"文本"},{default:s(()=>[t(i,{type:"textarea",modelValue:o(e).current.text,"onUpdate:modelValue":k[5]||(k[5]=w=>o(e).current.text=w)},null,8,["modelValue"])]),_:1}),L("div",Xe,[(f(!0),V(z,null,R(p.value,(w,Y)=>(f(),V("div",Ke,[(f(!0),V(z,null,R(w,D=>(f(),V("div",{style:I(Y===0?{[D.key]:D.value}:{}),class:se(["block-item",{active:D.selected}]),onClick:C=>l(D),innerHTML:D.label},null,14,Je))),256))]))),256))])])}}}),Ze=q(Qe,[["__scopeId","data-v-f8236b34"]]),et={class:"info-color-map"},tt={class:"color-list"},lt=["onClick"],ot=A({__name:"ElementStyle",setup(v){const e=N(),m=H(["style"]),r=H([[{backgroundColor:"#18141d",borderColor:"#ffffff"},{backgroundColor:"#f5f5f5",borderColor:"#666666"},{backgroundColor:"#dae8fc",borderColor:"#6b8ebf"},{backgroundColor:"#d5e8d4",borderColor:"#82b366"},{backgroundColor:"#ffe6cc",borderColor:"#d79b00"},{backgroundColor:"#fff2cc",borderColor:"#d6b656"},{backgroundColor:"#f8cecc",borderColor:"#b85450"},{backgroundColor:"#e1d5e7",borderColor:"#9673a6"}]]),n=[{label:"实线",value:"solid"},{label:"虚线",value:"dashed"},{label:"点线",value:"dotted"}],_=d=>{e.current.selected&&(e.current.style={...e.current.style,...d})};function p(d,l){e.current.style[d]=l}return(d,l)=>{const c=g("el-input-number"),a=g("el-form-item"),h=g("el-color-picker"),U=g("el-checkbox"),b=g("el-slider"),k=g("el-option"),O=g("el-select"),y=g("el-collapse-item"),S=g("el-collapse"),u=g("el-form");return o(e).current&&o(e).current.selected?(f(),E(u,{key:0,model:o(e).current,"label-width":"80px","label-position":"left"},{default:s(()=>[t(S,{modelValue:m.value,"onUpdate:modelValue":l[15]||(l[15]=i=>m.value=i)},{default:s(()=>[t(y,{title:"布局/样式",name:"style"},{default:s(()=>[L("div",et,[(f(!0),V(z,null,R(r.value,i=>(f(),V("div",tt,[(f(!0),V(z,null,R(i,T=>(f(),V("div",{class:"color-item",style:I(T),onClick:w=>_(T)},null,12,lt))),256))]))),256))]),t(a,{label:"left"},{default:s(()=>[t(c,{modelValue:o(e).current.left,"onUpdate:modelValue":l[0]||(l[0]=i=>o(e).current.left=i)},null,8,["modelValue"])]),_:1}),t(a,{label:"top"},{default:s(()=>[t(c,{modelValue:o(e).current.top,"onUpdate:modelValue":l[1]||(l[1]=i=>o(e).current.top=i)},null,8,["modelValue"])]),_:1}),t(a,{label:"width"},{default:s(()=>[t(c,{modelValue:o(e).current.width,"onUpdate:modelValue":l[2]||(l[2]=i=>o(e).current.width=i)},null,8,["modelValue"])]),_:1}),t(a,{label:"height"},{default:s(()=>[t(c,{modelValue:o(e).current.height,"onUpdate:modelValue":l[3]||(l[3]=i=>o(e).current.height=i)},null,8,["modelValue"])]),_:1}),t(a,{label:"angle"},{default:s(()=>[t(c,{modelValue:o(e).current.angle,"onUpdate:modelValue":l[4]||(l[4]=i=>o(e).current.angle=i)},null,8,["modelValue"])]),_:1}),t(a,{label:"color"},{default:s(()=>[t(h,{modelValue:o(e).current.color,"onUpdate:modelValue":l[5]||(l[5]=i=>o(e).current.color=i)},null,8,["modelValue"])]),_:1}),t(a,{label:"disabled"},{default:s(()=>[t(U,{modelValue:o(e).current.disabled,"onUpdate:modelValue":l[6]||(l[6]=i=>o(e).current.disabled=i)},null,8,["modelValue"])]),_:1}),t(a,{label:"resizable"},{default:s(()=>[t(U,{modelValue:o(e).current.resizable,"onUpdate:modelValue":l[7]||(l[7]=i=>o(e).current.resizable=i),checked:!0},null,8,["modelValue"])]),_:1}),t(a,{label:"rotatable"},{default:s(()=>[t(U,{modelValue:o(e).current.rotatable,"onUpdate:modelValue":l[8]||(l[8]=i=>o(e).current.rotatable=i),checked:!0},null,8,["modelValue"])]),_:1}),t(a,{label:"透明度"},{default:s(()=>[t(b,{modelValue:1,step:.01,min:0,max:1,onInput:l[9]||(l[9]=i=>p("opacity",i))})]),_:1}),o(e).current.style?(f(),V(z,{key:0},[t(a,{label:"背景颜色"},{default:s(()=>[t(h,{modelValue:o(e).current.style.backgroundColor,"onUpdate:modelValue":l[10]||(l[10]=i=>o(e).current.style.backgroundColor=i)},null,8,["modelValue"])]),_:1}),t(a,{label:"边框颜色"},{default:s(()=>[t(h,{modelValue:o(e).current.style.borderColor,"onUpdate:modelValue":l[11]||(l[11]=i=>o(e).current.style.borderColor=i)},null,8,["modelValue"])]),_:1}),t(a,{label:"边框宽度"},{default:s(()=>[t(c,{modelValue:o(e).current.style.borderWidth,"onUpdate:modelValue":l[12]||(l[12]=i=>o(e).current.style.borderWidth=i)},null,8,["modelValue"])]),_:1}),t(a,{label:"边框风格"},{default:s(()=>[t(O,{modelValue:o(e).current.style.borderStyle,"onUpdate:modelValue":l[13]||(l[13]=i=>o(e).current.style.borderStyle=i)},{default:s(()=>[(f(),V(z,null,R(n,i=>t(k,{key:i.value,label:i.label,value:i.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(a,{label:"边框半径"},{default:s(()=>[t(c,{modelValue:o(e).current.style.borderRadius,"onUpdate:modelValue":l[14]||(l[14]=i=>o(e).current.style.borderRadius=i)},null,8,["modelValue"])]),_:1})],64)):X("",!0)]),_:1}),t(y,{title:"文本",name:"text"},{default:s(()=>[t(Ze)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["model"])):X("",!0)}}}),nt=q(ot,[["__scopeId","data-v-29ac4c7a"]]),at=A({__name:"Style",setup(v){const e=N();return(m,r)=>(f(),V("div",{class:"es-info-style",onClick:r[0]||(r[0]=F(()=>{},["stop"]))},[o(e).current&&o(e).current.selected?(f(),E(nt,{key:0})):(f(),E(Pe,{key:1}))]))}}),rt={class:"es-layout-info"},st=A({__name:"Info",setup(v){const e=N(),m=M(()=>e.current&&e.current.selected?"元素属性":"画布属性"),r=H("style"),n=(_,p)=>{console.log(_,p)};return(_,p)=>{const d=g("el-tab-pane"),l=g("el-tabs");return f(),V("div",rt,[t(l,{modelValue:r.value,"onUpdate:modelValue":p[0]||(p[0]=c=>r.value=c),class:"es-info-tabs",onTabClick:n},{default:s(()=>[t(d,{label:m.value,name:"style"},{default:s(()=>[t(at)]),_:1},8,["label"])]),_:1},8,["modelValue"])])}}});function dt(v){const e={current:-1,queue:[],commands:{},commandArray:[],destoryArray:[]},m=n=>{e.commandArray.push(n),e.commands[n.name]=(..._)=>{const{redo:p,undo:d}=n.execute(..._);if(p&&p(),n.pushQueue){let{queue:l}=e;l.length>0&&(l=l.slice(0,e.current+1),e.queue=l),e.queue.push({redo:p,undo:d}),e.current+=1}}};m({name:"redo",keyboard:"ctrl+y",execute(){return{redo(){let n=e.queue[e.current+1];n&&(n.redo&&n.redo(),e.current++)}}}}),m({name:"undo",keyboard:"ctrl+z",execute(){return{redo(){if(e.current===-1)return;let n=e.queue[e.current];n&&(n.undo&&n.undo(),e.current--)}}}}),m({name:"drag",pushQueue:!0,init(){const n=()=>{this.before=Ce(v.data.elements)},_=()=>e.commands.drag();return W.on("dragstart",n),W.on("dragend",_),()=>{W.off("dragstart",n),W.off("dragend",_)}},execute(){const n=this.before,_=v.data.elements;return{redo(){v.data={...v.data,elements:_}},undo(){v.data={...v.data,elements:n}}}}}),m({name:"updateContainer",pushQueue:!0,execute(n){const _={before:v.data,after:n};return{redo(){v.data=_.after},undo(){v.data=_.before}}}}),e.commandArray.forEach(n=>{n.init&&e.destoryArray.push(n.init())});const r=()=>{const n=_=>{const{ctrlKey:p,key:d}=_,l=[];p&&l.push("ctrl"),l.push(d);const c=l.join("+");e.commandArray.forEach(({name:a,keyboard:h})=>{h&&h===c&&(e.commands[a](),_.preventDefault())})};return window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}};return Z(()=>{e.destoryArray.push(r())}),ie(()=>{e.destoryArray.forEach(n=>n&&n())}),e}const ut=A({__name:"index",props:{modelValue:{type:Object,required:!0,default:()=>({})},commands:{type:Object}},setup(v){const e=N(),m=v,r=H(null),n=M({get:()=>m.modelValue,set:()=>{}}),_=M(()=>{var C;return((C=m.modelValue.container)==null?void 0:C.gridSize)||10}),p=M(()=>{var C;return((C=m.modelValue.container)==null?void 0:C.scaleRatio)||1}),d=M(()=>{const{width:C,height:$}=n.value.container.style;return{...n.value.container.style,width:C+"px",height:$+"px",transform:`scale(${p.value})`,transformOrigin:"top left"}}),l=H({startX:0,startY:0,disX:0,disY:0}),c=M({get:()=>e.current,set:C=>{e.current=C}}),a=H(),{areaSelected:h,onEditorMouseDown:U,onAreaMove:b,onAreaUp:k}=Ue(n,a),{editorRect:O,onContextmenu:y,onEditorContextMenu:S}=$e(n,r);function u(C){c.value=C,h.value||n.value.elements.filter(x=>x.selected).length===1&&n.value.elements.forEach(x=>x.selected=!1),c.value.selected=!0,l.value.startX=c.value.left,l.value.startY=c.value.top,W.emit("dragstart")}function i(){W.emit("dragend")}function T(C){const $=C.left-l.value.startX,x=C.top-l.value.startY;n.value.elements.forEach(B=>{var te;B.selected&&((te=c.value)==null?void 0:te.id)!==B.id&&(B.left+=$,B.top+=x)}),l.value.startX=C.left,l.value.startY=C.top}function w(C,$){Object.keys(C).forEach(x=>{$[x]=C[x]})}const Y={dblclick:()=>{!c.value||!c.value.selected||(c.value.editable=!0)},click:()=>{c.value&&(c.value.editable=!1)}};function D(C="on"){["dblclick","click"].forEach(x=>{C==="on"?document.addEventListener(x,Y[x]):document.removeEventListener(x,Y[x])})}return Z(()=>{D()}),ce(()=>{D("off")}),(C,$)=>(f(),V("div",{ref_key:"editorRef",ref:r,class:"es-editor",style:I(d.value),onMousedown:$[2]||($[2]=(...x)=>o(U)&&o(U)(...x)),onContextmenu:$[3]||($[3]=F((...x)=>o(S)&&o(S)(...x),["prevent"]))},[(f(!0),V(z,null,R(n.value.elements,x=>(f(),E(o(pe),J({rotatable:""},o(Ee)(x,["style","props"]),{"grid-x":_.value,"grid-y":_.value,scaleRatio:p.value,boundary:"",markline:"",snap:"","snap-threshold":n.value.container.gridSize,onDragStart:B=>u(x),onDragEnd:i,onDrag:T,onChange:B=>w(B,x),onContextmenu:F(B=>o(y)(B,x),["stop"]),onMousedown:$[0]||($[0]=F(()=>{},["stop"])),onClick:$[1]||($[1]=F(()=>{},["stop"]))}),{default:s(()=>[(f(),E(K(x.component),J({element:x},x.props,{style:{...o(Q)(x.style,!1),width:"100%",height:"100%"}}),{default:s(()=>[x.text?(f(),E(de,{key:0,editable:x.editable,text:x.text,style:I(o(Q)(x.style))},null,8,["editable","text","style"])):X("",!0)]),_:2},1040,["element","style"]))]),_:2},1040,["grid-x","grid-y","scaleRatio","snap-threshold","onDragStart","onChange","onContextmenu"]))),256)),n.value.container.snapToGrid?(f(),E(Se,{key:0,grid:n.value.container.gridSize,"border-color":n.value.container.gridColor},null,8,["grid","border-color"])):X("",!0),t(ze,{ref_key:"areaRef",ref:a,onMove:o(b),onUp:o(k)},null,8,["onMove","onUp"])],36))}}),it=q(ut,[["__scopeId","data-v-9e83b2c6"]]),ct={class:"es-preview-tools"},pt=A({__name:"Preview",setup(v){const e=N(),m=H(),r=M(()=>{const{width:p,height:d}=e.data.container.style;return{...e.data.container.style,width:p+"px",height:d+"px",transform:`scale(${n.value})`,transformOrigin:"top left"}}),n=M(()=>{var p;return((p=e.data.container)==null?void 0:p.scaleRatio)||1});function _(p){const{width:d,height:l}=e.data.container.style,c=fe().format("YYYY-MM-DD")+"-es-drager-editor."+p;me(m.value).then(a=>{if(p==="pdf"){const h=new _e("l","pt","a4"),U=a.toDataURL();return h.addImage(U,"PNG",0,0,+d,+l),h.save(c)}a.toBlob(h=>{const U=document.createElement("a");U.download=c;const b=URL.createObjectURL(h);U.href=b,U.click(),URL.revokeObjectURL(b)})})}return(p,d)=>{const l=g("el-button"),c=g("el-dialog");return f(),E(c,{draggable:"",fullscreen:""},{default:s(()=>[L("div",ct,[t(l,{type:"primary",onClick:d[0]||(d[0]=a=>_("png"))},{default:s(()=>[P("导出PNG")]),_:1}),t(l,{type:"primary",onClick:d[1]||(d[1]=a=>_("jpg"))},{default:s(()=>[P("导出JPG")]),_:1}),t(l,{type:"primary",onClick:d[2]||(d[2]=a=>_("pdf"))},{default:s(()=>[P("导出PDF")]),_:1})]),L("div",{class:"es-preview-body",style:I({width:r.value.width,height:r.value.height})},[L("div",{ref_key:"editorRef",ref:m,class:"es-editor preview",style:I(r.value)},[(f(!0),V(z,null,R(o(e).data.elements,a=>(f(),E(K(a.component),J(a.props,{style:{...o(Q)(a.style,!1),width:a.width+"px",height:a.height+"px",position:"absolute",left:a.left+"px",top:a.top+"px"}}),{default:s(()=>[a.text?(f(),E(de,{key:0,text:a.text,style:I(o(Q)(a.style))},null,8,["text","style"])):X("",!0)]),_:2},1040,["style"]))),256))],4)],4)]),_:1})}}}),ft=q(pt,[["__scopeId","data-v-294a182a"]]),mt={class:"es-layout-container"},_t=A({__name:"index",props:{data:{type:Object,required:!0},theme:{type:String}},setup(v,{expose:e}){const m=v,r=N(),n=H(),{commands:_}=dt(r),p=[{label:"撤销",icon:ve,handler:_.undo},{label:"重做",icon:be,handler:_.redo},{label:"导出",icon:ge,handler:()=>{Me({title:"导出",content:JSON.stringify(r.data),confirm(y){_.updateContainer(JSON.parse(y))}})}},{label:"导入",icon:he,handler:()=>{ne({resultType:"json",onChange(y){_.updateContainer(JSON.parse(y))}})}},{label:"插入图片",icon:ye,handler:()=>{ne({resultType:"image",onChange(y){const u={id:oe(),component:"img",props:{src:y,width:200,onLoadOnce(i){if(u.props.loaded)return;const{naturalHeight:T,naturalWidth:w}=i.target,Y=r.data.elements.find(C=>C.id===u.id);let D=200/w;D>1&&(D=1),Y.width=w*D,Y.height=T*D,u.props.loaded=!0}}};r.data.elements.push(u)}})}},{label:"预览",icon:Ve,handler:()=>r.preview=!0}],d=M(()=>{const{width:y,height:S}=r.data.container.style,u={},i=r.initWidth>+y,T=r.initHeight>+S;return i&&(u.position="absolute",u.left="50%",u.transform="translateX(-50%)"),T&&(u.position="absolute",u.top="50%",u.transform="translateY(-50%)"),i&&T&&(u.transform="translate(-50%, -50%)"),u}),l=M(()=>{var y;return((y=n.value)==null?void 0:y.getBoundingClientRect())||{}});let c=null;function a(y){W.emit("dragstart"),c=y}function h(){W.emit("dragend")}function U(y){y.dataTransfer.dropEffect="move"}function b(y){if(!c)return;const S=c.component==="es-icon",u=[...r.data.elements,{...c,equalProportion:S,left:y.offsetX-c.width/2,top:y.offsetY-c.height/2,id:oe(),style:c.style||{}}];r.data.elements=u,c=null}function k(){r.initWidth=Math.floor(l.value.width),r.initHeight=Math.floor(l.value.height-7),r.data.container.style.width=r.initWidth,r.data.container.style.height=r.initHeight}function O(){return{...r.data}}return ee(()=>m.data,()=>{r.update(m.data)},{immediate:!0}),ee(()=>m.theme,()=>{m.theme&&(r.theme=m.theme)},{immediate:!0}),Z(()=>{k()}),e({tools:p,getData:O}),(y,S)=>(f(),V(z,null,[L("div",mt,[t(Be,{onDragstart:a,onDragend:h}),L("div",{ref_key:"mainRef",ref:n,class:"es-layout-main"},[L("div",{class:"es-editor-container",style:I(d.value)},[t(it,{modelValue:o(r).data,"onUpdate:modelValue":S[0]||(S[0]=u=>o(r).data=u),commands:o(_),onDragenter:U,onDrop:b,onDragover:S[1]||(S[1]=F(()=>{},["prevent"]))},null,8,["modelValue","commands"])],4)],512),t(st,{modelValue:o(r).current,"onUpdate:modelValue":S[2]||(S[2]=u=>o(r).current=u)},null,8,["modelValue"])]),t(ft,{modelValue:o(r).preview,"onUpdate:modelValue":S[3]||(S[3]=u=>o(r).preview=u)},null,8,["modelValue"])],64))}}),vt={class:"es-layout"},bt={class:"es-header-toolbar"},gt=["onClick"],ht="ES Drager Editor 开发中...",yt=A({__name:"index",setup(v){const e=H(null),m=xe(),r=H({container:{markline:{show:!0,color:""},snapToGrid:!0,gridSize:10,gridColor:"",style:{},scaleRatio:1},elements:[{id:"1",component:"div",width:100,height:100,left:100,top:100,text:"div1",style:{border:"1px solid red",background:"blue"}},{id:"2",component:"div",width:100,height:100,left:300,top:150,text:"div2",style:{border:"1px solid red",background:"pink"}}]}),n=M(()=>{var p;return((p=e.value)==null?void 0:p.tools)||[]});function _(p){typeof p.handler=="function"&&p.handler()}return Z(()=>{console.log(e.value)}),(p,d)=>{const l=g("el-button");return f(),V("div",vt,[t(we,{title:ht},{default:s(()=>[L("div",bt,[(f(!0),V(z,null,R(n.value,c=>(f(),V("div",{class:"es-tool-btn",onClick:a=>_(c)},[t(l,{icon:c.icon},{default:s(()=>[P(j(c.label),1)]),_:2},1032,["icon"])],8,gt))),256))]),t(l,null,{default:s(()=>[P("修改数据")]),_:1})]),_:1}),t(o(_t),{ref_key:"editorRef",ref:e,data:r.value,theme:o(m).theme},null,8,["data","theme"])])}}});const Ct=q(yt,[["__scopeId","data-v-0cf0d05a"]]);export{Ct as default};
