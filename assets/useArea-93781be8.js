import{eQ as J,eG as Xe,r as Y,eD as Ye,d as H,g as S,o as N,c as F,eR as K,h as U,b as ce,w as ue,eT as xe,u as z,n as Q,eM as Re,eI as Be,a as ze,eJ as De,eK as Ce,F as Ne,eS as de,i as Te,f8 as Se,_ as Ie}from"./index-aa21fdab.js";const Pe={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},maxWidth:{type:Number,default:0},maxHeight:{type:Number,default:0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean},checkCollision:{type:Boolean}};function W(n,o){const e=t=>{o&&o(t),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",n),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",n),document.addEventListener("touchend",e)}function I(n){let o=0,e=0;if($e(n)){const t=n.targetTouches[0];o=t.pageX,e=t.pageY}else o=n.clientX,e=n.clientY;return{clientX:o,clientY:e}}function $e(n){const o=Object.prototype.toString.call(n);return o.substring(8,o.length-1)==="TouchEvent"}const G=(n=0)=>parseInt(n+"")+"px",q={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},Z=["n","ne","e","se","s","sw","w","nw"],Ve={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},Ge={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},Ke=(n,o)=>{const e=Ge[Math.floor(n/30)],s=(Ve[o]+e)%8;return Z[s]},he=(n=0,o)=>{let e=[];for(let t=0;t<Z.length;t++){const s=Z[t],[d,i]=q[s].split("-"),c=Ke(n,s),a={[d]:"0%",cursor:c+"-resize",side:q[s]};if(i)a[i]="0%";else{const p=["top","bottom"].includes(d)?"left":"top";a[p]="50%"}o?o.includes(q[s])&&e.push(a):e.push(a)}return e},ee=n=>n*Math.PI/180,Ue=(n,o)=>Math.sqrt(n*n+o*o),y=n=>Math.cos(ee(n)),b=n=>Math.sin(ee(n)),Fe=(n,o,e,t,s,d,i)=>{let{width:c,height:a,centerX:p,centerY:m,rotateAngle:l}=o;const f=c<0?-1:1,g=a<0?-1:1;switch(c=Math.abs(c),a=Math.abs(a),n){case"right":{const u=C(c,e,d);c=u.width,e=u.deltaW,s?(t=e/s,a=c/s,p+=e/2*y(l)-t/2*b(l),m+=e/2*b(l)+t/2*y(l)):(p+=e/2*y(l),m+=e/2*b(l));break}case"top-right":{t=-t;const u=C(c,e,d);c=u.width,e=u.deltaW;const h=D(a,t,i);a=h.height,t=h.deltaH,s&&(e=t*s,c=a*s),p+=e/2*y(l)+t/2*b(l),m+=e/2*b(l)-t/2*y(l);break}case"bottom-right":{const u=C(c,e,d);c=u.width,e=u.deltaW;const h=D(a,t,i);a=h.height,t=h.deltaH,s&&(e=t*s,c=a*s),p+=e/2*y(l)-t/2*b(l),m+=e/2*b(l)+t/2*y(l);break}case"bottom":{const u=D(a,t,i);a=u.height,t=u.deltaH,s?(e=t*s,c=a*s,p+=e/2*y(l)-t/2*b(l),m+=e/2*b(l)+t/2*y(l)):(p-=t/2*b(l),m+=t/2*y(l));break}case"bottom-left":{e=-e;const u=C(c,e,d);c=u.width,e=u.deltaW;const h=D(a,t,i);a=h.height,t=h.deltaH,s&&(a=c/s,t=e/s),p-=e/2*y(l)+t/2*b(l),m-=e/2*b(l)-t/2*y(l);break}case"left":{e=-e;const u=C(c,e,d);c=u.width,e=u.deltaW,s?(a=c/s,t=e/s,p-=e/2*y(l)+t/2*b(l),m-=e/2*b(l)-t/2*y(l)):(p-=e/2*y(l),m-=e/2*b(l));break}case"top-left":{e=-e,t=-t;const u=C(c,e,d);c=u.width,e=u.deltaW;const h=D(a,t,i);a=h.height,t=h.deltaH,s&&(c=a*s,e=t*s),p-=e/2*y(l)-t/2*b(l),m-=e/2*b(l)+t/2*y(l);break}case"top":{t=-t;const u=D(a,t,i);a=u.height,t=u.deltaH,s?(c=a*s,e=t*s,p+=e/2*y(l)+t/2*b(l),m+=e/2*b(l)-t/2*y(l)):(p+=t/2*b(l),m-=t/2*y(l));break}}return{position:{centerX:p,centerY:m},size:{width:c*f,height:a*g}}},D=(n,o,e)=>{const t=n+o;return t>e?n=t:(o=e-n,n=e),{height:n,deltaH:o}},C=(n,o,e)=>{const t=n+o;return t>e?n=t:(o=e-n,n=e),{width:n,deltaW:o}},Oe=({centerX:n,centerY:o,width:e,height:t,angle:s})=>({top:o-t/2,left:n-e/2,width:e,height:t,angle:s}),je=(n,o,e)=>{const{width:t,height:s}=n;return{width:Math.abs(t),height:Math.abs(s),left:o-Math.abs(t)/2,top:e-Math.abs(s)/2}};function O(n,o){const e=Math.abs(n)%o,t=n>0?o:-o;let s=0;return e>o/2?s=t*Math.ceil(Math.abs(n)/o):s=t*Math.floor(Math.abs(n)/o),s}function qe(n,o){if(!n||!o)return!1;const e=n.getBoundingClientRect(),t=o.getBoundingClientRect();return e.left<t.left+t.width&&e.left+e.width>t.left&&e.top<t.top+t.height&&e.top+e.height>t.top}function Je(n,o,e,{getBoundary:t,fixBoundary:s,checkDragerCollision:d,emit:i}){let c=0,a=0;const p=l=>{let{left:f,top:g}=o.value;if(c||(c=f),a||(a=g),["ArrowRight","ArrowLeft"].includes(l.key)){const u=l.key==="ArrowRight";let h=u?1:-1;n.snapToGrid&&(h=u?n.gridX:-n.gridX),f=f+h}else if(["ArrowUp","ArrowDown"].includes(l.key)){const u=l.key==="ArrowDown";let h=u?1:-1;n.snapToGrid&&(h=u?n.gridY:-n.gridY),g=g+h}if(n.boundary){const[u,h,M,A]=t();[f,g]=s(f,g,u,h,M,A)}o.value.left=f,o.value.top=g,i("change",{...o.value})},m=l=>{["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(l.key)&&n.checkCollision&&d()&&(o.value.left=c,o.value.top=a),c=0,a=0};J(e,l=>{n.disabledKeyEvent||(l?(document.addEventListener("keydown",p),document.addEventListener("keyup",m)):(document.removeEventListener("keydown",p),document.removeEventListener("keyup",m)))}),Xe(()=>{document.removeEventListener("keydown",p),document.removeEventListener("keyup",m)})}function Qe(n,o,e){const t=Y(!1),s=Y(!1),d=Y({width:o.width,height:o.height,left:o.left,top:o.top,angle:o.angle}),i=new Set;function c(f){if(i.add(f.button),o.disabled)return;t.value=!0,s.value=!0;let{clientX:g,clientY:u}=I(f);const{left:h,top:M}=d.value;let A=0,r=0,w=0,v=0;o.boundary&&([A,r,w,v]=a()),e&&e("drag-start",d.value),W(E=>{if(i.size>1)return;const{clientX:k,clientY:B}=I(E);let L=(k-g)/o.scaleRatio+h,X=(B-u)/o.scaleRatio+M;if(o.snapToGrid){let{left:T,top:P}=d.value;const j=L-T,x=X-P;L=T+O(j,o.gridX),X=P+O(x,o.gridY)}o.boundary&&([L,X]=p(L,X,A,r,w,v)),d.value.left=L,d.value.top=X,e&&e("drag",d.value)},E=>{o.checkCollision&&m()&&(d.value.top=M,d.value.left=h),i.clear(),t.value=!1,document.addEventListener("click",l,{once:!0}),e&&e("drag-end",d.value)})}const a=()=>{let f=0,g=0;const{left:u,top:h,height:M,width:A,angle:r}=d.value,v=(n.value.parentElement||document.body).getBoundingClientRect();if(r&&o.scaleRatio===1){const k=n.value.getBoundingClientRect();f=Math.abs(k.left-(u+v.left)),g=Math.abs(k.top-(h+v.top))}const _=v.width/o.scaleRatio-A,E=v.height/o.scaleRatio-M;return[f,_-f,g,E-g,v.width/o.scaleRatio,v.height/o.scaleRatio]},p=(f,g,u,h,M,A)=>(f=f<u?u:f,f=f>h?h:f,g=g<M?M:g,g=g>A?A:g,[f,g]),m=()=>{const f=n.value.parentElement||document.body,g=Array.from(f.children).filter(u=>u!==n.value&&u.classList.contains("es-drager"));for(let u=0;u<g.length;u++){const h=g[u];if(qe(n.value,h))return!0}},l=()=>{s.value=!1};return Je(o,d,s,{getBoundary:a,fixBoundary:p,checkDragerCollision:m,emit:e}),Ye(()=>{if(n.value){if(!d.value.width&&!d.value.height){const{width:f,height:g}=n.value.getBoundingClientRect();d.value={...d.value,width:f||100,height:g||100},e("change",{...d.value})}n.value.addEventListener("mousedown",c),n.value.addEventListener("touchstart",c,{passive:!0})}}),{isMousedown:t,selected:s,dragData:d,getBoundary:a,checkDragerCollision:m}}const Ze=U("div",{class:"es-drager-rotate-handle"},[U("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[U("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),He=H({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(n,{emit:o}){const e=n,t=Y(null),s=S({get:()=>e.modelValue,set:i=>{o("update:modelValue",i)}});function d(i){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");i.stopPropagation();const{width:c,height:a,left:p,top:m}=e.element.getBoundingClientRect(),l=p+c/2,f=m+a/2;o("rotate-start",s.value),W(g=>{const{clientX:u,clientY:h}=I(g),M=l-u,A=f-h,w=Math.atan2(A,M)*180/Math.PI-90;s.value=(w+360)%360,o("rotate",s.value)},()=>{o("rotate-end",s.value)})}return(i,c)=>(N(),F("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:d,onTouchstartPassive:d},[K(i.$slots,"default",{},()=>[Ze])],544))}});const We=["data-side","onMousedown","onTouchstartPassive"],et=U("div",{class:"es-drager-dot-handle"},null,-1),fe=H({__name:"drager",props:Pe,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(n,{emit:o}){const e=n,t=(r,...w)=>{o(r,...w),o("change",...w)},s=Y(null),{selected:d,dragData:i,isMousedown:c,getBoundary:a,checkDragerCollision:p}=Qe(s,e,t),m=Y(he(0,e.resizeList)),l=S(()=>e.resizable&&!e.disabled),f=S(()=>e.rotatable&&!e.disabled&&d.value),g=S(()=>{const{width:r,height:w,left:v,top:_,angle:E}=i.value,k={};return r&&(k.width=G(r)),w&&(k.height=G(w)),{...k,left:G(v),top:G(_),zIndex:e.zIndex,transform:`rotate(${E}deg)`,"--es-drager-color":e.color}});function u(r){s.value||(s.value=r.$el||r)}function h(r){m.value=he(r,e.resizeList),t("rotate-end",i.value)}function M(r,w){if(e.disabled)return;w.stopPropagation();const{clientX:v,clientY:_}=I(w),E=v,k=_,{width:B,height:L,left:X,top:T}=i.value,P=X+B/2,j=T+L/2,x={width:B,height:L,centerX:P,centerY:j,rotateAngle:i.value.angle},ge=r.side,{minWidth:ve,minHeight:pe,aspectRatio:te,equalProportion:me}=e;t("resize-start",i.value);let ne=[];e.boundary&&(ne=a()),W(oe=>{const{clientX:we,clientY:ye}=I(oe);let $=(we-E)/e.scaleRatio,V=(ye-k)/e.scaleRatio;e.snapToGrid&&($=O($,e.gridX),V=O(V,e.gridY));const be=Math.atan2(V,$),se=Ue($,V),Me=oe.shiftKey,ie=be-ee(x.rotateAngle),_e=se*Math.cos(ie),Ae=se*Math.sin(ie),ae=(me||Me)&&!te?x.width/x.height:te,{position:{centerX:le,centerY:re},size:{width:Ee,height:ke}}=Fe(ge,{...x,rotateAngle:x.rotateAngle},_e,Ae,ae,ve,pe),Le=Oe({centerX:le,centerY:re,width:Ee,height:ke,angle:i.value.angle});let R={...i.value,...je(Le,le,re)};e.maxWidth>0&&(R.width=Math.min(R.width,e.maxWidth)),e.maxHeight>0&&(R.height=Math.min(R.height,e.maxHeight)),e.boundary&&(R=A(R,ne,ae)),i.value=R,t("resize",i.value)},()=>{e.checkCollision&&p()&&(i.value={...i.value,width:B,height:L,left:X,top:T}),t("resize-end",i.value)})}function A(r,w,v){const[_,E,k,B,L,X]=w;return r.left<_&&(r.left=_,r.width=i.value.width,v&&(r.height=i.value.height)),r.left+r.width>L&&(r.left=i.value.left,r.width=L-r.left,v&&(r.height=i.value.height)),r.top<k&&(r.top=k,r.height=i.value.height,v&&(r.width=i.value.width)),r.top+r.height>X&&(r.top=i.value.top,r.height=X-r.top,v&&(r.width=i.value.width)),r}return J(()=>[e.width,e.height,e.left,e.top,e.angle],([r,w,v,_,E])=>{i.value={...i.value,width:r,height:w,left:v,top:_,angle:E}}),J(()=>e.selected,r=>{d.value=r},{immediate:!0}),(r,w)=>(N(),ce(Be(r.tag),{ref:u,class:xe(["es-drager",{disabled:r.disabled,dragging:z(c),selected:z(d),border:r.border}]),style:Q(g.value),onClick:w[3]||(w[3]=Re(()=>{},["stop"]))},{default:ue(()=>[K(r.$slots,"default"),l.value?(N(!0),F(Ne,{key:0},ze(m.value,(v,_)=>(N(),F("div",{key:_,class:"es-drager-dot","data-side":v.side,style:Q({...v}),onMousedown:E=>M(v,E),onTouchstartPassive:E=>M(v,E)},[K(r.$slots,"resize",De(Ce({side:v.side})),()=>[et])],44,We))),128)):de("",!0),f.value?(N(),ce(He,{key:1,modelValue:z(i).angle,"onUpdate:modelValue":w[0]||(w[0]=v=>z(i).angle=v),element:s.value,onRotate:w[1]||(w[1]=v=>t("rotate",z(i))),onRotateStart:w[2]||(w[2]=v=>t("rotate-start",z(i))),onRotateEnd:h},{default:ue(()=>[K(r.$slots,"rotate")]),_:3},8,["modelValue","element"])):de("",!0)]),_:3},8,["class","style"]))}});const tt=n=>{n.component("es-drager",fe)};fe.install=tt;const nt=H({__name:"Area",emits:["move","up"],setup(n,{expose:o,emit:e}){const t=Y(!1),s=Y({width:0,height:0,top:0,left:0}),d=S(()=>{const{width:c,height:a,top:p,left:m}=s.value;return{width:c+"px",height:a+"px",top:p+"px",left:m+"px"}});function i(c){const{pageX:a,pageY:p}=c,m=c.target.getBoundingClientRect(),l=a-m.left,f=p-m.top,g=h=>{const M=h.pageX-a,A=h.pageY-p;let r=l,w=f,v=Math.abs(M),_=Math.abs(A);(v>2||_>2)&&(t.value=!0),M<0&&(r=l-v),A<0&&(w=f-_),s.value={width:v,height:_,left:r,top:w},e("move",{...s.value})},u=()=>{document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",u),t.value=!1,s.value={width:0,height:0,top:0,left:0},e("up",s.value)};document.addEventListener("mousemove",g),document.addEventListener("mouseup",u)}return o({onMouseDown:i,areaData:s}),(c,a)=>Te((N(),F("div",{class:"es-editor-area",style:Q(d.value)},null,4)),[[Se,t.value]])}});const it=Ie(nt,[["__scopeId","data-v-136196f6"]]);function at(n,o){const e=Y();function t(i){let c=!1;n.value.elements.forEach(a=>{a.selected&&(a.selected=!1,c=!0)}),c||o.value.onMouseDown(i)}function s(i){for(let c=0;c<n.value.elements.length;c++){const a=n.value.elements[c],p=i.left<a.left&&i.left+i.width>a.left+a.width,m=i.top<a.top&&i.top+i.height>a.top+a.height;p&&m?a.selected=!0:a.selected=!1}}function d(){e.value=n.value.elements.some(i=>i.selected),e.value&&setTimeout(()=>{document.addEventListener("click",()=>{e.value=!1},{once:!0})})}return{areaSelected:e,onEditorMouseDown:t,onAreaMove:s,onAreaUp:d}}export{it as A,fe as _,at as u};
