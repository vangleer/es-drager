import{r as Y,eC as Ae,eL as K,eF as Ee,d as ce,f as S,o as z,c as O,eM as I,g as $,b as te,w as ne,eP as ke,u as L,n as oe,eN as se,eH as Le,a as Re,eI as Xe,eJ as Ye,F as ze,eO as ae}from"./index-d09f1b02.js";const _e={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean}};function j(s,n){const e=t=>{n&&n(t),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",s),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",s),document.addEventListener("touchend",e)}function _(s){let n=0,e=0;if(Be(s)){const t=s.targetTouches[0];n=t.pageX,e=t.pageY}else n=s.clientX,e=s.clientY;return{clientX:n,clientY:e}}function Be(s){const n=Object.prototype.toString.call(s);return n.substring(8,n.length-1)==="TouchEvent"}const C=(s=0)=>parseInt(s+"")+"px",F={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},U=["n","ne","e","se","s","sw","w","nw"],Ne={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},xe={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},Te=(s,n)=>{const e=xe[Math.floor(s/30)],a=(Ne[n]+e)%8;return U[a]},re=(s=0,n)=>{let e=[];for(let t=0;t<U.length;t++){const a=U[t],[u,l]=F[a].split("-"),d=Te(s,a),i={[u]:"0%",cursor:d+"-resize",side:F[a]};if(l)i[l]="0%";else{const g=["top","bottom"].includes(u)?"left":"top";i[g]="50%"}n?n.includes(F[a])&&e.push(i):e.push(i)}return e},q=s=>s*Math.PI/180,Pe=(s,n)=>Math.sqrt(s*s+n*n),p=s=>Math.cos(q(s)),m=s=>Math.sin(q(s)),Ce=(s,n,e,t,a,u,l)=>{let{width:d,height:i,centerX:g,centerY:v,rotateAngle:o}=n;const f=d<0?-1:1,y=i<0?-1:1;switch(d=Math.abs(d),i=Math.abs(i),s){case"right":{const c=X(d,e,u);d=c.width,e=c.deltaW,a?(t=e/a,i=d/a,g+=e/2*p(o)-t/2*m(o),v+=e/2*m(o)+t/2*p(o)):(g+=e/2*p(o),v+=e/2*m(o));break}case"top-right":{t=-t;const c=X(d,e,u);d=c.width,e=c.deltaW;const r=R(i,t,l);i=r.height,t=r.deltaH,a&&(e=t*a,d=i*a),g+=e/2*p(o)+t/2*m(o),v+=e/2*m(o)-t/2*p(o);break}case"bottom-right":{const c=X(d,e,u);d=c.width,e=c.deltaW;const r=R(i,t,l);i=r.height,t=r.deltaH,a&&(e=t*a,d=i*a),g+=e/2*p(o)-t/2*m(o),v+=e/2*m(o)+t/2*p(o);break}case"bottom":{const c=R(i,t,l);i=c.height,t=c.deltaH,a?(e=t*a,d=i*a,g+=e/2*p(o)-t/2*m(o),v+=e/2*m(o)+t/2*p(o)):(g-=t/2*m(o),v+=t/2*p(o));break}case"bottom-left":{e=-e;const c=X(d,e,u);d=c.width,e=c.deltaW;const r=R(i,t,l);i=r.height,t=r.deltaH,a&&(i=d/a,t=e/a),g-=e/2*p(o)+t/2*m(o),v-=e/2*m(o)-t/2*p(o);break}case"left":{e=-e;const c=X(d,e,u);d=c.width,e=c.deltaW,a?(i=d/a,t=e/a,g-=e/2*p(o)+t/2*m(o),v-=e/2*m(o)-t/2*p(o)):(g-=e/2*p(o),v-=e/2*m(o));break}case"top-left":{e=-e,t=-t;const c=X(d,e,u);d=c.width,e=c.deltaW;const r=R(i,t,l);i=r.height,t=r.deltaH,a&&(d=i*a,e=t*a),g-=e/2*p(o)-t/2*m(o),v-=e/2*m(o)+t/2*p(o);break}case"top":{t=-t;const c=R(i,t,l);i=c.height,t=c.deltaH,a?(d=i*a,e=t*a,g+=e/2*p(o)+t/2*m(o),v+=e/2*m(o)-t/2*p(o)):(g+=t/2*m(o),v-=t/2*p(o));break}}return{position:{centerX:g,centerY:v},size:{width:d*f,height:i*y}}},R=(s,n,e)=>{const t=s+n;return t>e?s=t:(n=e-s,s=e),{height:s,deltaH:n}},X=(s,n,e)=>{const t=s+n;return t>e?s=t:(n=e-s,s=e),{width:s,deltaW:n}},Se=({centerX:s,centerY:n,width:e,height:t,angle:a})=>({top:n-t/2,left:s-e/2,width:e,height:t,angle:a}),Ie=(s,n,e)=>{const{width:t,height:a}=s;return{width:Math.abs(t),height:Math.abs(a),left:n-Math.abs(t)/2,top:e-Math.abs(a)/2}};function V(s,n){const e=Math.abs(s)%n,t=s>0?n:-n;let a=0;return e>n/2?a=t*Math.ceil(Math.abs(s)/n):a=t*Math.floor(Math.abs(s)/n),a}function $e(s,n,e){const t=Y(!1),a=Y(!1),u=Y({width:n.width,height:n.height,left:n.left,top:n.top,angle:n.angle});function l(o){if(n.disabled)return;t.value=!0,a.value=!0;let{clientX:f,clientY:y}=_(o);const{left:c,top:r}=u.value;let h=0,w=0;n.boundary&&([h,w]=d()),e&&e("drag-start",u.value),j(b=>{const{clientX:A,clientY:B}=_(b);let D=(A-f)/n.scaleRatio+c,E=(B-y)/n.scaleRatio+r;if(n.snapToGrid){let{left:N,top:x}=u.value;const G=D-N,k=E-x;D=N+V(G,n.gridX),E=x+V(k,n.gridY)}n.boundary&&([D,E]=i(D,E,h,w)),u.value.left=D,u.value.top=E,e&&e("drag",u.value)},b=>{t.value=!1,document.addEventListener("click",g,{once:!0}),e&&e("drag-end",u.value)})}const d=()=>{const{width:o,height:f}=u.value,c=(s.value.parentElement||document.body).getBoundingClientRect(),r=c.width/n.scaleRatio-o,h=c.height/n.scaleRatio-f;return[r,h]},i=(o,f,y,c)=>(o=o<0?0:o,o=o>y?y:o,f=f<0?0:f,f=f>c?c:f,[o,f]),g=()=>{a.value=!1},v=o=>{if(t.value)return;let{left:f,top:y}=u.value;if(["ArrowRight","ArrowLeft"].includes(o.key)){const c=o.key==="ArrowRight";let r=c?1:-1;n.snapToGrid&&(r=c?n.gridX:-n.gridX),f=f+r}else if(["ArrowUp","ArrowDown"].includes(o.key)){const c=o.key==="ArrowDown";let r=c?1:-1;n.snapToGrid&&(r=c?n.gridY:-n.gridY),y=y+r}if(n.boundary){const[c,r]=d();[f,y]=i(f,y,c,r)}u.value.left=f,u.value.top=y};return Ae(()=>{if(s.value){if(!u.value.width&&!u.value.height){const{width:o,height:f}=s.value.getBoundingClientRect();u.value={...u.value,width:o||100,height:f||100},e("change",{...u.value})}s.value.addEventListener("mousedown",l),s.value.addEventListener("touchstart",l,{passive:!0})}}),K(a,o=>{n.disabledKeyEvent||(o?document.addEventListener("keydown",v):document.removeEventListener("keydown",v))}),Ee(()=>{document.removeEventListener("keydown",v)}),{isMousedown:t,selected:a,dragData:u}}const Ve=$("div",{class:"es-drager-rotate-handle"},[$("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[$("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),Ge=ce({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(s,{emit:n}){const e=s,t=Y(null),a=S({get:()=>e.modelValue,set:l=>{n("update:modelValue",l)}});function u(l){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");l.stopPropagation(),l.preventDefault();const{width:d,height:i,left:g,top:v}=e.element.getBoundingClientRect(),o=g+d/2,f=v+i/2;n("rotate-start",a.value),j(y=>{const{clientX:c,clientY:r}=_(y),h=o-c,w=f-r,b=Math.atan2(w,h)*180/Math.PI-90;a.value=(b+360)%360,n("rotate",a.value)},()=>{n("rotate-end",a.value)})}return(l,d)=>(z(),O("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:u,onTouchstartPassive:u},[I(l.$slots,"default",{},()=>[Ve])],544))}});const Fe=["data-side","onMousedown","onTouchstartPassive"],Ke=$("div",{class:"es-drager-dot-handle"},null,-1),ie=ce({__name:"drager",props:_e,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(s,{emit:n}){const e=s,t=(r,...h)=>{n(r,...h),n("change",...h)},a=Y(null),{selected:u,dragData:l,isMousedown:d}=$e(a,e,t),i=Y(re(0,e.resizeList)),g=S(()=>e.resizable&&!e.disabled),v=S(()=>e.rotatable&&!e.disabled&&u.value),o=S(()=>{const{width:r,height:h,left:w,top:M,angle:b}=l.value,A={};return r&&(A.width=C(r)),h&&(A.height=C(h)),{...A,left:C(w),top:C(M),zIndex:e.zIndex,transform:`rotate(${b}deg)`,"--es-drager-color":e.color}});function f(r){a.value||(a.value=r.$el||r)}function y(r){i.value=re(r,e.resizeList),t("rotate-end",l.value)}function c(r,h){h.stopPropagation(),h.preventDefault();const{clientX:w,clientY:M}=_(h),b=w,A=M,{width:B,height:D,left:E,top:N}=l.value,x=E+B/2,G=N+D/2,k={width:B,height:D,centerX:x,centerY:G,rotateAngle:l.value.angle},le=r.side,{minWidth:ue,minHeight:de,aspectRatio:J,equalProportion:he}=e;t("resize-start",l.value),j(Q=>{const{clientX:fe,clientY:ge}=_(Q);let T=(fe-b)/e.scaleRatio,P=(ge-A)/e.scaleRatio;e.snapToGrid&&(T=V(T,e.gridX),P=V(P,e.gridY));const ve=Math.atan2(P,T),Z=Pe(T,P),we=Q.shiftKey,H=ve-q(k.rotateAngle),pe=Z*Math.cos(H),me=Z*Math.sin(H),ye=(he||we)&&!J?k.width/k.height:J,{position:{centerX:W,centerY:ee},size:{width:be,height:Me}}=Ce(le,{...k,rotateAngle:k.rotateAngle},pe,me,ye,ue,de),De=Se({centerX:W,centerY:ee,width:be,height:Me,angle:l.value.angle});l.value={...l.value,...Ie(De,W,ee)},t("resize",l.value)},()=>{t("resize-end",l.value)})}return K(()=>[e.width,e.height,e.left,e.top,e.angle],([r,h,w,M,b])=>{l.value={...l.value,width:r,height:h,left:w,top:M,angle:b}}),K(()=>e.selected,r=>{u.value=r},{immediate:!0}),(r,h)=>(z(),te(Le(r.tag),{ref:f,class:ke(["es-drager",{disabled:r.disabled,dragging:L(d),selected:L(u),border:r.border}]),style:oe(o.value),onClick:h[3]||(h[3]=se(()=>{},["stop"]))},{default:ne(()=>[I(r.$slots,"default"),g.value?(z(!0),O(ze,{key:0},Re(i.value,(w,M)=>(z(),O("div",{key:M,class:"es-drager-dot","data-side":w.side,style:oe({...w}),onMousedown:se(b=>c(w,b),["stop","prevent"]),onTouchstartPassive:b=>c(w,b)},[I(r.$slots,"resize",Xe(Ye({side:w.side})),()=>[Ke])],44,Fe))),128)):ae("",!0),v.value?(z(),te(Ge,{key:1,modelValue:L(l).angle,"onUpdate:modelValue":h[0]||(h[0]=w=>L(l).angle=w),element:a.value,onRotate:h[1]||(h[1]=w=>t("rotate",L(l))),onRotateStart:h[2]||(h[2]=w=>t("rotate-start",L(l))),onRotateEnd:y},{default:ne(()=>[I(r.$slots,"rotate")]),_:3},8,["modelValue","element"])):ae("",!0)]),_:3},8,["class","style"]))}});const Oe=s=>{s.component("es-drager",ie)};ie.install=Oe;export{ie as _};
