import{d as se,r as O,s as z,p as Re,c as D,D as G,o as U,E as Be,i as Y,j as J,G as fe,y as V,B as ee,a as ve,H as Ce,m as ge,F as He,b as Pe,e as ke,u as M,t as Te,I as Ue,J as De,l as K,K as $e,L as Qe,w as ie,C as Fe,f as qe,M as Ge}from"./index-CM2PV9If.js";import{_ as Ke}from"./index-Be__8c-E.js";/*!vue3-sketch-ruler v2.2.102025年6月Wed Jun 18 2025 17:41:08 GMT+0800 (中国标准时间)制作*/const je=e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1;function Ze(e,t,n,a,r,c){c?r.moveTo(e,0):r.moveTo(0,e),r.save(),c?r.translate(e+5,a*.2):r.translate(n*.1,e+32),c||r.rotate(-Math.PI/2),r.fillText(Math.round(t).toString(),4,7),r.restore(),c?r.lineTo(e,a):r.lineTo(n,e),r.stroke(),r.closePath(),r.setTransform(1,0,0,1,0,0)}function ce(e,t,n,a,r,c){a.fillStyle=r.fontShadowColor,a.strokeStyle=r.longfgColor,a.save(),a.translate(e,t),c||a.rotate(-Math.PI/2),a.font="bold 12px  Aria",a.fillText(String(n),0,0),a.restore()}const _e=(e,t,n,a,r,c)=>{const{scale:h,width:f,height:u,ratio:E,palette:A,gridRatio:b,showShadowText:m}=r,{bgColor:d,fontColor:p,shadowColor:R,longfgColor:N}=A,w=c?r.canvasWidth:r.canvasHeight;e.setTransform(1,0,0,1,0,0),e.scale(E,E),e.clearRect(0,0,f,u),e.fillStyle=d,e.fillRect(0,0,f,u);const y=je(h)*b*10,L=y*h,B=Math.floor(t/y)*y,H=(B-t)/y*L,X=t+Math.ceil((c?f:u)/h);if(a){const x=(n-t)*h,T=a*h;if(e.fillStyle=R,c?e.fillRect(x,0,T,u):e.fillRect(0,x,f,T),m)if(c){ce(x,u*.4,Math.round(n),e,A,c);const k=(n+a-t)*h;ce(k,u*.4,Math.round(n+a),e,A,c)}else{ce(f*.4,x,Math.round(n),e,A,c);const k=(n+a-t)*h;ce(f*.4,k,Math.round(n+a),e,A,c)}}e.beginPath(),e.fillStyle=p,e.strokeStyle=N;for(let x=B,T=0;x<X;x+=y,T++){const k=H+T*L+.5;if(x-y<w&&x>w||x==w){const $=H+T*L+.5+(w-x)*h;Ze($,w,f,u,e,c);return}x>=0&&x<=w&&(x==0?c?(e.moveTo(k,0),e.lineTo(k,u)):(e.moveTo(0,k),e.lineTo(f,k)):c?(e.moveTo(k,20),e.lineTo(k,u/1.3)):(e.moveTo(20,k),e.lineTo(f/1.3,k)),e.save(),x==0?c?e.translate(k-15,u*.01):e.translate(f*.3,k-5):c?e.translate(k-12,u*.05):e.translate(f*.05,k+12),c||e.rotate(-Math.PI/2),w-x>y/2&&(!m||a==0||Math.abs(x-n)>y/2&&Math.abs(x-(n+a))>y/2)&&e.fillText(x.toString(),4,9),e.restore())}e.stroke(),e.closePath()};function Ee(e,t=100){let n=null;const a=function(...r){n!==null&&clearTimeout(n),n=setTimeout(()=>{e(...r)},t)};return a.cancel=function(){n!==null&&(clearTimeout(n),n=null)},a}function We(e,t){const n=O(0),a=O(0),r=O(!1),c=z(()=>({backgroundColor:e.palette.hoverBg,color:e.palette.hoverColor,[t?"top":"left"]:"-8px",[t?"left":"top"]:`${n.value+10}px`})),h=({offsetX:d,offsetY:p})=>{n.value=t?d:p},f=(d,p)=>new Promise(R=>{if(e.lockLine)return;const N=t?d.clientY:d.clientX;h(d);const w=p||a.value;let y=w;const L=H=>{let X=((t?H.clientY:H.clientX)-N)/e.scale+w,x=X;const T=(t?e.snapsObj.h:e.snapsObj.v).slice().sort((k,$)=>Math.abs(x-k)-Math.abs(x-$));T.length&&Math.abs(T[0]-X)<e.snapThreshold/e.scale&&(x=T[0],X=x),y=Math.round(X),a.value=y},B=()=>{document.removeEventListener("mousemove",L),u(y,e.index),R()};document.addEventListener("mousemove",L),document.addEventListener("mouseup",B,{once:!0})}),u=(d,p)=>{var R,N;const w=t?(R=e.lines)==null?void 0:R.h:(N=e.lines)==null?void 0:N.v,y=E(d);if(w)if(y)if(typeof p=="number")w.splice(p,1);else return;else typeof p!="number"?w.push(d):w[p]=d},E=d=>{const p=t?e.canvasHeight:e.canvasWidth;return d<0||d>p},A=z(()=>E(a.value)?"放开删除":`${t?"Y":"X"}：${a.value*e.rate}`),b=Ee(()=>{r.value=!1},200),m=Ee(()=>{r.value=!0},200);return{showLabel:r,startValue:a,actionStyle:c,labelContent:A,handleMouseDown:f,handleMouseenter:d=>{e.lockLine||(h(d),m(),b.cancel())},handleMouseLeave:()=>{b()}}}const Je={key:0,class:"value"},et=se({__name:"ruler-line",props:{scale:{},palette:{},index:{},start:{},vertical:{type:Boolean},value:{},canvasWidth:{},canvasHeight:{},lines:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},lockLine:{type:Boolean}},setup(e){const t=e,n=O(!1),{actionStyle:a,handleMouseDown:r,labelContent:c,startValue:h,showLabel:f,handleMouseenter:u,handleMouseLeave:E}=We(t,t.vertical),A=z(()=>h.value>=t.start),b=z(()=>{const{lineType:d,lockLineColor:p,lineColor:R}=t.palette,N=t.lockLine?p:R??"black",w=t.lockLine||n.value?"none":"auto",y=t.isShowReferLine&&!t.lockLine?t.vertical?"ns-resize":"ew-resize":"default",L=t.vertical?"borderTop":"borderLeft",B=(h.value-t.start)*t.scale;return{[L]:`1px ${d} ${N}`,pointerEvents:w,cursor:y,[t.vertical?"top":"left"]:`${B}px`}});Re(()=>{h.value=t.value??0});const m=Ee(()=>{n.value=!1},1e3);return G([()=>t.scale],()=>{n.value=!0,m()}),(d,p)=>J((U(),D("div",{class:"line",style:V(b.value),onMouseenter:p[0]||(p[0]=K((...R)=>M(u)&&M(u)(...R),["stop"])),onMouseleave:p[1]||(p[1]=K((...R)=>M(E)&&M(E)(...R),["stop"])),onMousedown:p[2]||(p[2]=K((...R)=>M(r)&&M(r)(...R),["stop"]))},[Y("div",{class:"action",style:V(M(a))},[M(f)?(U(),D("span",Je,Te(M(c)),1)):Ce("",!0)],4)],36)),[[ee,A.value]])}}),tt=se({__name:"index",props:{scale:{},palette:{},vertical:{type:Boolean},showShadowText:{type:Boolean},start:{},width:{},height:{},selectStart:{},selectLength:{},canvasWidth:{},canvasHeight:{},rate:{},gridRatio:{}},emits:["handleDragStart"],setup(e,{emit:t}){const n=e,a=t,r=Ue({isDragging:!1,canvasContext:null});let c=window.devicePixelRatio;const h=O(null);Re(()=>{window.addEventListener("resize",f),u(),A(c),b(c)});const f=()=>{c=window.devicePixelRatio,A(c),b(c)},u=()=>{var d;r.canvasContext=((d=h.value)==null?void 0:d.getContext("2d"))||null},E=z(()=>({width:n.width+"px",height:n.height+"px",cursor:n.vertical?"ew-resize":"ns-resize",[n.vertical?"borderRight":"borderBottom"]:`1px solid ${n.palette.borderColor||"#eeeeef"} `}));De(()=>{window.removeEventListener("resize",f)});const A=d=>{if(h.value){h.value.width=Math.round(n.width*d),h.value.height=Math.round(n.height*d);const p=r.canvasContext;p&&(p.font=`11px -apple-system,
                "Helvetica Neue", ".SFNSText-Regular",
                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",
                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif`,p.lineWidth=1,p.textBaseline="middle")}},b=d=>{const p={scale:n.scale,width:n.width,height:n.height,palette:n.palette,canvasWidth:n.canvasWidth,canvasHeight:n.canvasHeight,ratio:d,rate:n.rate,gridRatio:n.gridRatio,showShadowText:n.showShadowText};p.scale=n.scale/n.rate,p.canvasWidth=n.canvasWidth*n.rate,p.canvasHeight=n.canvasHeight*n.rate,r.canvasContext&&_e(r.canvasContext,n.start*n.rate,n.selectStart,n.selectLength,p,!n.vertical)};G([()=>n.width,()=>n.height,()=>n.start,()=>n.palette,()=>n.selectStart,()=>n.selectLength],()=>{b(c)}),G([()=>n.width,()=>n.height],()=>{A(c)});const m=d=>{a("handleDragStart",d)};return(d,p)=>(U(),D("canvas",{ref_key:"canvas",ref:h,class:"ruler",style:V(E.value),onMousedown:K(m,["stop"])},null,36))}}),nt={class:"lines"},at={key:0,class:"value"},Oe=se({__name:"ruler-wrapper",props:{scale:{},thick:{},canvasWidth:{},canvasHeight:{},palette:{},vertical:{type:Boolean},width:{},height:{},start:{},startOther:{},lines:{},selectStart:{},selectLength:{},isShowReferLine:{type:Boolean},rate:{},snapThreshold:{},snapsObj:{},gridRatio:{},lockLine:{type:Boolean},showShadowText:{type:Boolean}},emits:["changeLineState"],setup(e,{emit:t}){const n=e,{showLabel:a,actionStyle:r,handleMouseenter:c,handleMouseLeave:h,handleMouseDown:f,labelContent:u,startValue:E}=We(n,!n.vertical),A=O(!1),b=O(!1),m=z(()=>n.vertical?"v-container":"h-container"),d=t,p=z(()=>{var w,y;return n.vertical?(w=n.lines)==null?void 0:w.h:(y=n.lines)==null?void 0:y.v}),R=z(()=>{const w=n.palette.lineType;let y=n.vertical?"left":"top",L=n.vertical?"top":"left",B=n.vertical?"borderLeft":"borderBottom";const H=(E.value-n.startOther)*n.scale+n.thick;return{[y]:H+"px",[L]:-n.thick+"px",cursor:n.vertical?"ew-resize":"ns-resize",[B]:`1px ${w} ${n.palette.lineColor}`}}),N=async w=>{const{offsetX:y,offsetY:L}=w,{scale:B,vertical:H,thick:X,startOther:x}=n;if(!A.value){b.value=!0,d("changeLineState",!1);let T=Math.round(x-X/B+(H?y:L)/B);E.value=T,await f(w,T),b.value=!1}};return G([()=>n.lockLine],()=>{A.value=n.lockLine}),(w,y)=>(U(),D("div",{class:fe(m.value)},[ve(tt,ge(w.$props,{onHandleDragStart:N}),null,16),J(Y("div",nt,[(U(!0),D(He,null,Pe(p.value,(L,B)=>(U(),ke(et,ge({key:L+B,index:B,value:L>>0,ref_for:!0},w.$props),null,16,["index","value"]))),128))],512),[[ee,w.isShowReferLine]]),w.isShowReferLine?J((U(),D("div",{key:0,class:"indicator",style:V(R.value),onMouseenter:y[0]||(y[0]=(...L)=>M(c)&&M(c)(...L)),onMouseleave:y[1]||(y[1]=(...L)=>M(h)&&M(h)(...L))},[Y("div",{class:"action",style:V(M(r))},[M(a)?(U(),D("span",at,Te(M(u)),1)):Ce("",!0)],4)],36)),[[ee,b.value]]):Ce("",!0)],2))}}),ot="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC",lt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII=";/*!simple-panzoom v1.0.72024年8月Sat Aug 10 2024 16:04:04 GMT+0800 (中国标准时间)制作*/typeof window<"u"&&(window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),typeof window.CustomEvent!="function"&&(window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}));function Ye(e,t){let n=e.length;for(;n--;)if(e[n].pointerId===t.pointerId)return n;return-1}function Le(e,t){let n;if(t.touches){n=0;for(const a of t.touches)a.pointerId=n++,Le(e,a);return}n=Ye(e,t),n>-1&&e.splice(n,1),e.push(t)}function st(e,t){if(t.touches){for(;e.length;)e.pop();return}const n=Ye(e,t);n>-1&&e.splice(n,1)}function ze(e){e=e.slice(0);let t=e.pop(),n;for(;n=e.pop();)t={clientX:(n.clientX-t.clientX)/2+t.clientX,clientY:(n.clientY-t.clientY)/2+t.clientY};return t}function xe(e){if(e.length<2)return 0;const t=e[0],n=e[1];return Math.sqrt(Math.pow(Math.abs(n.clientX-t.clientX),2)+Math.pow(Math.abs(n.clientY-t.clientY),2))}let le={down:"mousedown",move:"mousemove",up:"mouseup mouseleave"};typeof window<"u"&&(typeof window.PointerEvent=="function"?le={down:"pointerdown",move:"pointermove",up:"pointerup pointerleave pointercancel"}:typeof window.TouchEvent=="function"&&(le={down:"touchstart",move:"touchmove",up:"touchend touchcancel"}));function Ae(e,t,n,a){le[e].split(" ").forEach(r=>{t.addEventListener(r,n,a)})}function Se(e,t,n){le[e].split(" ").forEach(a=>{t.removeEventListener(a,n)})}const rt=typeof document<"u"&&!!document.documentMode;let Ne;function it(){return Ne||(Ne=document.createElement("div").style)}const Xe=["webkit","moz","ms"],ue={};function Me(e){if(ue[e])return ue[e];const t=it();if(e in t)return ue[e]=e;const n=e[0].toUpperCase()+e.slice(1);let a=Xe.length;for(;a--;){const r=`${Xe[a]}${n}`;if(r in t)return ue[e]=r}}function he(e,t){return parseFloat(t[Me(e)])||0}function de(e,t,n=window.getComputedStyle(e)){const a=t==="border"?"Width":"";return{left:he(`${t}Left${a}`,n),right:he(`${t}Right${a}`,n),top:he(`${t}Top${a}`,n),bottom:he(`${t}Bottom${a}`,n)}}function _(e,t,n){e.style[Me(t)]=n}function ct(e,t){const n=Me("transform");_(e,"transition",`${n} ${t.duration}ms ${t.easing}`)}function ut(e,{x:t,y:n,scale:a,isSVG:r},c){if(_(e,"transform",`scale(${a}) translate(${t}px, ${n}px)`),r&&rt){const h=window.getComputedStyle(e).getPropertyValue("transform");e.setAttribute("transform",h)}}function pe(e){const t=e.parentNode,n=window.getComputedStyle(e),a=window.getComputedStyle(t),r=e.getBoundingClientRect(),c=t.getBoundingClientRect();return{elem:{style:n,width:r.width,height:r.height,top:r.top,bottom:r.bottom,left:r.left,right:r.right,margin:de(e,"margin",n),border:de(e,"border",n)},parent:{style:a,width:c.width,height:c.height,top:c.top,bottom:c.bottom,left:c.left,right:c.right,padding:de(t,"padding",a),border:de(t,"border",a)}}}function ht(e){let t=e;for(;t&&t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}return!1}function dt(e){return(e.getAttribute("class")||"").trim()}function pt(e,t){return e.nodeType===1&&` ${dt(e)} `.indexOf(` ${t} `)>-1}function ft(e,t){for(let n=e;n!=null;n=n.parentNode)if(pt(n,t.excludeClass)||t.exclude.indexOf(n)>-1)return!0;return!1}const vt=/^http:[\w\.\/]+svg$/;function gt(e){return vt.test(e.namespaceURI)&&e.nodeName.toLowerCase()!=="svg"}function mt(e){const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}const Ie={animate:!1,canvas:!1,cursor:"move",disablePan:!1,disableZoom:!1,disableXAxis:!1,disableYAxis:!1,duration:200,easing:"ease-in-out",exclude:[],excludeClass:"panzoom-exclude",handleStartEvent:e=>{e.preventDefault(),e.stopPropagation()},maxScale:4,minScale:.125,overflow:"hidden",panOnlyWhenZoomed:!1,pinchAndPan:!1,relative:!1,setTransform:ut,startX:0,startY:0,startScale:1,step:.3,touchAction:"none"};function Ve(e,t){if(!e)throw new Error("Panzoom requires an element as an argument");if(e.nodeType!==1)throw new Error("Panzoom requires an element with a nodeType of 1");if(!ht(e))throw new Error("Panzoom should be called on elements that have been attached to the DOM");t={...Ie,...t};const n=gt(e),a=e.parentNode;a.style.overflow=t.overflow,a.style.userSelect="none",a.style.touchAction=t.touchAction,(t.canvas?a:e).style.cursor=t.cursor,e.style.userSelect="none",e.style.touchAction=t.touchAction,_(e,"transformOrigin",typeof t.origin=="string"?t.origin:n?"0 0":"50% 50%");function r(){a.style.overflow="",a.style.userSelect="",a.style.touchAction="",a.style.cursor="",e.style.cursor="",e.style.userSelect="",e.style.touchAction="",_(e,"transformOrigin","")}function c(o={}){for(const l in o)o.hasOwnProperty(l)&&(t[l]=o[l]);(o.hasOwnProperty("cursor")||o.hasOwnProperty("canvas"))&&(a.style.cursor=e.style.cursor="",(t.canvas?a:e).style.cursor=t.cursor),o.hasOwnProperty("overflow")&&(a.style.overflow=o.overflow),o.hasOwnProperty("touchAction")&&(a.style.touchAction=o.touchAction,e.style.touchAction=o.touchAction)}let h=0,f=0,u=1,E=!1;R(t.startScale,{animate:!1,force:!0}),setTimeout(()=>{p(t.startX,t.startY,{animate:!1,force:!0})});function A(o,l,g){if(g.silent)return;const S=new CustomEvent(o,{detail:l});e.dispatchEvent(S)}function b(o,l,g){const S={x:h,y:f,scale:u,isSVG:n,originalEvent:g,dimsOut:{}};typeof l.animate=="boolean"&&(l.animate?ct(e,l):_(e,"transition","none")),l.setTransform(e,S,l);function i(){const C=pe(e);S.dimsOut=C,A(o,S,l),A("panzoomchange",S,l)}return l.animate?setTimeout(()=>{i()},l.duration+50):requestAnimationFrame(()=>{i()}),S}function m(o,l,g,S){const i={...t,...S},C={x:h,y:f,opts:i};if(!i.force&&(i.disablePan||i.panOnlyWhenZoomed&&u===i.startScale))return C;if(o=parseFloat(o),l=parseFloat(l),i.disableXAxis||(C.x=(i.relative?h:0)+o),i.disableYAxis||(C.y=(i.relative?f:0)+l),i.contain){const v=pe(e),I=v.elem.width/u,W=v.elem.height/u,ae=I*g,oe=W*g,F=(ae-I)/2,q=(oe-W)/2;if(i.contain==="inside"){const me=(-v.elem.margin.left-v.parent.padding.left+F)/g,we=(v.parent.width-ae-v.parent.padding.left-v.elem.margin.left-v.parent.border.left-v.parent.border.right+F)/g;C.x=Math.max(Math.min(C.x,we),me);const ye=(-v.elem.margin.top-v.parent.padding.top+q)/g,be=(v.parent.height-oe-v.parent.padding.top-v.elem.margin.top-v.parent.border.top-v.parent.border.bottom+q)/g;C.y=Math.max(Math.min(C.y,be),ye)}else if(i.contain==="outside"){const me=(-(ae-v.parent.width)-v.parent.padding.left-v.parent.border.left-v.parent.border.right+F)/g,we=(F-v.parent.padding.left)/g;C.x=Math.max(Math.min(C.x,we),me);const ye=(-(oe-v.parent.height)-v.parent.padding.top-v.parent.border.top-v.parent.border.bottom+q)/g,be=(q-v.parent.padding.top)/g;C.y=Math.max(Math.min(C.y,be),ye)}}return i.roundPixels&&(C.x=Math.round(C.x),C.y=Math.round(C.y)),C}function d(o,l){const g={...t,...l},S={scale:u,opts:g};if(!g.force&&g.disableZoom)return S;let i=t.minScale,C=t.maxScale;if(g.contain){const v=pe(e),I=v.elem.width/u,W=v.elem.height/u;if(I>1&&W>1){const ae=v.parent.width-v.parent.border.left-v.parent.border.right,oe=v.parent.height-v.parent.border.top-v.parent.border.bottom,F=ae/I,q=oe/W;t.contain==="inside"?C=Math.min(C,F,q):t.contain==="outside"&&(i=Math.max(i,F,q))}}return S.scale=Math.min(Math.max(o,i),C),S}function p(o,l,g,S){const i=m(o,l,u,g);return h!==i.x||f!==i.y?(h=i.x,f=i.y,b("panzoompan",i.opts,S)):{x:h,y:f,scale:u,isSVG:n,originalEvent:S}}function R(o,l,g){const S=d(o,l),i=S.opts;if(!i.force&&i.disableZoom)return;o=S.scale;let C=h,v=f;if(i.focal){const W=i.focal;C=(W.x/o-W.x/u+h*o)/o,v=(W.y/o-W.y/u+f*o)/o}const I=m(C,v,o,{relative:!1,force:!0});return h=I.x,f=I.y,u=o,b("panzoomzoom",i,g)}function N(o,l){const g={...t,animate:!0,...l};return R(u*Math.exp((o?1:-1)*g.step),g)}function w(o){return N(!0,o)}function y(o){return N(!1,o)}function L(o,l,g,S){const i=pe(e),C={width:i.parent.width-i.parent.padding.left-i.parent.padding.right-i.parent.border.left-i.parent.border.right,height:i.parent.height-i.parent.padding.top-i.parent.padding.bottom-i.parent.border.top-i.parent.border.bottom};let v=l.clientX-i.parent.left-i.parent.padding.left-i.parent.border.left-i.elem.margin.left,I=l.clientY-i.parent.top-i.parent.padding.top-i.parent.border.top-i.elem.margin.top;n||(v-=i.elem.width/u/2,I-=i.elem.height/u/2);const W={x:v/C.width*(C.width*o),y:I/C.height*(C.height*o)};return R(o,{...g,animate:!1,focal:W},S)}function B(o,l){o.preventDefault();const g={...t,...l,animate:!1},S=(o.deltaY===0&&o.deltaX?o.deltaX:o.deltaY)<0?1:-1,i=d(u*Math.exp(S*g.step/3),g).scale;return L(i,o,g,o)}function H(o){const l={...t,animate:!0,force:!0,...o};u=d(l.startScale,l).scale;const g=m(l.startX,l.startY,u,l);return h=g.x,f=g.y,b("panzoomreset",l)}let X,x,T,k,$,Q;const P=[];function j(o){if(ft(o.target,t))return;Le(P,o),E=!0,t.handleStartEvent(o),X=h,x=f,A("panzoomstart",{x:h,y:f,scale:u,isSVG:n,originalEvent:o},t);const l=ze(P);T=l.clientX,k=l.clientY,$=u,Q=xe(P)}function te(o){if(!E||X===void 0||x===void 0||T===void 0||k===void 0)return;Le(P,o);const l=ze(P),g=P.length>1;let S=u;if(g){Q===0&&(Q=xe(P));const i=xe(P)-Q;S=d(i*t.step/80+$).scale,L(S,l,{animate:!1},o)}(!g||t.pinchAndPan)&&p(X+(l.clientX-T)/S,x+(l.clientY-k)/S,{animate:!1},o)}function ne(o){P.length===1&&A("panzoomend",{x:h,y:f,scale:u,isSVG:n,originalEvent:o},t),st(P,o),E&&(E=!1,X=x=T=k=void 0)}let Z=!1;function re(){Z||(Z=!0,Ae("down",t.canvas?a:e,j),Ae("move",document,te,{passive:!0}),Ae("up",document,ne,{passive:!0}))}function s(){Z=!1,Se("down",t.canvas?a:e,j),Se("move",document,te),Se("up",document,ne)}return t.noBind||re(),{bind:re,destroy:s,eventNames:le,getPan:()=>({x:h,y:f}),getScale:()=>u,getOptions:()=>mt(t),handleDown:j,handleMove:te,handleUp:ne,pan:p,reset:H,resetStyle:r,setOptions:c,setStyle:(o,l)=>_(e,o,l),zoom:R,zoomIn:w,zoomOut:y,zoomToPoint:L,zoomWithWheel:B}}Ve.defaultOptions=Ie;const wt={class:"sketch-ruler"},yt=se({__name:"index",props:{showRuler:{type:Boolean,default:!0},eyeIcon:{},closeEyeIcon:{},scale:{default:1},rate:{default:1},thick:{default:16},palette:{},width:{default:1400},height:{default:800},paddingRatio:{default:.2},autoCenter:{type:Boolean,default:!0},shadow:{default:()=>({x:0,y:0,width:0,height:0})},lines:{default:()=>({h:[],v:[]})},isShowReferLine:{type:Boolean,default:!0},canvasWidth:{default:700},canvasHeight:{default:700},snapsObj:{default:()=>({h:[],v:[]})},snapThreshold:{default:5},gridRatio:{default:1},lockLine:{type:Boolean,default:!1},selfHandle:{type:Boolean,default:!1},showShadowText:{type:Boolean,default:!0},panzoomOption:{}},emits:["onCornerClick","update:scale","zoomchange","update:lockLine"],setup(e,{expose:t,emit:n}){$e(s=>({"89f302c6":re.value}));const a=e,r=n,c=O(null),h=O(0),f=O(0);let u=0,E=0;const A=O(1),b=O(a.isShowReferLine),m=O(null),d=O("defaultCursor"),p=z(()=>({bgColor:"#f6f7f9",longfgColor:"#BABBBC",fontColor:"#7D8694",fontShadowColor:"#106ebe",shadowColor:"#e9f7fe",lineColor:"#51d6a9",lineType:"solid",lockLineColor:"#d4d7dc",hoverBg:"#000",hoverColor:"#fff",borderColor:"#eeeeef",...a.palette})),R=z(()=>({backgroundImage:b.value?`url(${a.eyeIcon??ot})`:`url(${a.closeEyeIcon??lt})`,width:a.thick+"px",height:a.thick+"px",borderRight:`1px solid ${p.value.borderColor}`,borderBottom:`1px solid ${p.value.borderColor}`})),N=z(()=>({background:p.value.bgColor,width:w.value+"px",height:y.value+"px"})),w=z(()=>a.width-a.thick),y=z(()=>a.height-a.thick),L=s=>{var o;(s.ctrlKey||s.metaKey)&&((o=m.value)==null||o.zoomWithWheel(s))},B=s=>{var o;const l=document.activeElement;l!=null&&l.closest(".monaco-editor")||(l==null?void 0:l.tagName)==="INPUT"||(l==null?void 0:l.tagName)==="TEXTAREA"||(l==null?void 0:l.getAttribute("contenteditable"))==="true"||s.key===" "&&(d.value="grabCursor",(o=m.value)==null||o.bind(),s.preventDefault())},H=s=>{var o;const l=document.activeElement;l!=null&&l.closest(".monaco-editor")||(l==null?void 0:l.tagName)==="INPUT"||(l==null?void 0:l.tagName)==="TEXTAREA"||(l==null?void 0:l.getAttribute("contenteditable"))==="true"||s.key===" "&&((o=m.value)==null||o.destroy(),d.value="defaultCursor")};function X(s){var o;s.preventDefault(),s.stopPropagation(),(o=m.value)==null||o.bind()}Re(()=>{if(k(),!a.selfHandle&&c.value){const s=c.value.parentElement;if(!s)return;s.addEventListener("wheel",L),document.addEventListener("keydown",B),document.addEventListener("keyup",H),s.addEventListener("touchstart",X)}});const x=s=>({noBind:!0,startScale:s,startX:u,startY:E,smoothScroll:!0,canvas:!0,...a.panzoomOption}),T=s=>{const{scale:o,dimsOut:l}=s.detail;if(l){r("update:scale",o),A.value=o;const g=(l.parent.left-l.elem.left)/o,S=(l.parent.top-l.elem.top)/o;h.value=g,r("zoomchange",s.detail),f.value=S}},k=()=>{if(c.value=document.querySelector(".canvasedit"),c.value){let s=a.scale;a.autoCenter&&(s=$()),m.value=Ve(c.value,x(s)),c.value&&c.value.addEventListener("panzoomchange",T)}},$=()=>{const s=w.value*(1-a.paddingRatio)/a.canvasWidth,o=y.value*(1-a.paddingRatio)/a.canvasHeight,l=Math.min(s,o);return u=w.value/2-a.canvasWidth/2,l<1?E=(a.canvasHeight*l/2-a.canvasHeight/2)/l-(a.canvasHeight*l-y.value)/l/2:l>1?E=(a.canvasHeight*l-a.canvasHeight)/2/l+(y.value-a.canvasHeight*l)/l/2:E=0,l},Q=()=>{var s;return(s=m.value)==null?void 0:s.reset()},P=()=>{var s;return(s=m.value)==null?void 0:s.zoomIn()},j=()=>{var s;return(s=m.value)==null?void 0:s.zoomOut()},te=()=>{var s;(s=m.value)==null||s.setOptions(x(a.scale))},ne=()=>{b.value=!b.value,r("onCornerClick",b.value)},Z=s=>{r("update:lockLine",s)},re=z(()=>a.thick+"px");return G([()=>a.isShowReferLine],()=>{b.value=a.isShowReferLine}),G([()=>a.canvasWidth,()=>a.canvasHeight,()=>a.width,()=>a.height],()=>{k()}),G(()=>a.panzoomOption,()=>{te()},{deep:!0}),t({initPanzoom:k,panzoomInstance:m,reset:Q,zoomIn:P,zoomOut:j,cursorClass:d}),(s,o)=>(U(),D("div",wt,[Be(s.$slots,"btn",{reset:Q,zoomIn:P,zoomOut:j}),Y("div",{class:fe(["canvasedit-parent",d.value]),style:V(N.value)},[Y("div",{class:fe(["canvasedit",d.value])},[Be(s.$slots,"default")],2)],6),J(ve(Oe,{style:V({marginLeft:s.thick+"px",width:w.value+"px"}),vertical:!1,width:s.width,height:s.thick,"is-show-refer-line":b.value,thick:s.thick,start:h.value,"start-other":f.value,lines:s.lines,"select-start":s.shadow.x,"snap-threshold":s.snapThreshold,"snaps-obj":s.snapsObj,"select-length":s.shadow.width,scale:A.value,palette:p.value,"canvas-width":s.canvasWidth,"show-shadow-text":s.showShadowText,"canvas-height":s.canvasHeight,rate:s.rate,"grid-ratio":s.gridRatio,"lock-line":s.lockLine,onChangeLineState:Z},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","snap-threshold","snaps-obj","select-length","scale","palette","canvas-width","show-shadow-text","canvas-height","rate","grid-ratio","lock-line"]),[[ee,s.showRuler]]),J(ve(Oe,{style:V({marginTop:s.thick+"px",top:0,height:y.value+"px"}),vertical:!0,width:s.thick,height:s.height,"is-show-refer-line":b.value,thick:s.thick,start:f.value,"start-other":h.value,lines:s.lines,"select-start":s.shadow.y,"select-length":s.shadow.height,"snap-threshold":s.snapThreshold,"snaps-obj":s.snapsObj,scale:A.value,palette:p.value,"canvas-width":s.canvasWidth,"canvas-height":s.canvasHeight,"show-shadow-text":s.showShadowText,rate:s.rate,"grid-ratio":s.gridRatio,"lock-line":s.lockLine,onChangeLineState:Z},null,8,["style","width","height","is-show-refer-line","thick","start","start-other","lines","select-start","select-length","snap-threshold","snaps-obj","scale","palette","canvas-width","canvas-height","show-shadow-text","rate","grid-ratio","lock-line"]),[[ee,s.showRuler]]),J(Y("a",{class:"corner",style:V(R.value),onClick:ne},null,4),[[ee,s.showRuler]])]))}}),bt={class:"btns"},xt=["onClick"],At=["onClick"],St=["onClick"],Et=se({__name:"snap",setup(e){const t=Qe(),n=O(),a=O(),r=Ue({scale:1,thick:20,width:1470,height:700,showShadowText:!1,canvasWidth:1e3,canvasHeight:500,showRuler:!0,palette:{bgColor:"transparent",lineType:"dashed"},isShowReferLine:!0,shadow:{x:0,y:0,width:0,height:0},lines:{h:[300],v:[400]}}),c=O({componentList:[{id:"div1",component:"div",text:"div1",width:100,height:100,left:0,top:0},{id:"div2",component:"div",text:"div2",width:100,height:100,top:100,left:100}]}),h=z(()=>({width:`${r.width}px`,height:`${r.height}px`})),f=z(()=>({width:`${r.canvasWidth}px`,height:`${r.canvasHeight}px`,position:"relative",background:t.isLight?"#eff2f5":"#333333"})),u=(A,b)=>{Ge(()=>{r.shadow={x:b.left,y:b.top,width:b.width,height:b.height}}),Object.keys(A).forEach(m=>{b[m]=A[m]})},E=A=>Array.from(document.querySelectorAll(".sketch-ruler .lines .line"));return(A,b)=>(U(),D("div",null,[Y("div",{class:fe(["wrapper",[M(t).isLight?"whitewrapper":"blackwrapper"]]),style:V(h.value)},[ve(M(yt),ge({ref_key:"sketchruleRef",ref:n,scale:r.scale,"onUpdate:scale":b[0]||(b[0]=m=>r.scale=m)},r),{default:ie(()=>[Y("div",{ref_key:"dragParentRef",ref:a,"data-type":"page",style:V(f.value)},[(U(!0),D(He,null,Pe(c.value.componentList,m=>(U(),ke(M(Ke),ge({ref_for:!0},m,{key:m.id,snap:"",scaleRatio:r.scale,class:"dragerItem","snap-threshold":10,markline:"",extraLines:E,onChange:d=>u(d,m)}),{default:ie(()=>[(U(),ke(Fe(m.component),null,{default:ie(()=>[qe(Te(m.text),1)]),_:2},1024))]),_:2},1040,["scaleRatio","onChange"]))),128))],4)]),btn:ie(({reset:m,zoomIn:d,zoomOut:p})=>[Y("div",bt,[Y("button",{onClick:K(m,["stop"])},"还原",8,xt),Y("button",{onClick:K(d,["stop"])},"放大",8,At),Y("button",{onClick:K(p,["stop"])},"缩小",8,St)])]),_:1},16,["scale"])],6)]))}});export{Et as default};
