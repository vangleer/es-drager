import{r as L,o as ke,w as j,a as Ae,d as J,c as C,b as z,e as P,f as V,g as I,h as O,i as U,j as ie,n as ae,k as re,l as Ee,m as ze,F as ue,p as ce,u as _,q as Le,s as Re,t as Xe,v as Ye,x as xe}from"./index-c4559540.js";const Be={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array}};function Q(s,n){const e=t=>{n&&n(t),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",s),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",s),document.addEventListener("touchend",e)}function Y(s){let n=0,e=0;if(Ne(s)){const t=s.targetTouches[0];n=t.pageX,e=t.pageY}else n=s.clientX,e=s.clientY;return{clientX:n,clientY:e}}function Ne(s){const n=Object.prototype.toString.call(s);return n.substring(8,n.length-1)==="TouchEvent"}const $=(s=0)=>parseInt(s+"")+"px",K={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},q=["n","ne","e","se","s","sw","w","nw"],Te={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},Se={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},$e=(s,n)=>{const e=Se[Math.floor(s/30)],a=(Te[n]+e)%8;return q[a]},le=(s=0,n)=>{let e=[];for(let t=0;t<q.length;t++){const a=q[t],[u,l]=K[a].split("-"),d=$e(s,a),i={[u]:"0%",cursor:d+"-resize",side:K[a]};if(l)i[l]="0%";else{const g=["top","bottom"].includes(u)?"left":"top";i[g]="50%"}n?n.includes(K[a])&&e.push(i):e.push(i)}return e},Z=s=>s*Math.PI/180,Ce=(s,n)=>Math.sqrt(s*s+n*n),w=s=>Math.cos(Z(s)),m=s=>Math.sin(Z(s)),Ve=(s,n,e,t,a,u,l)=>{let{width:d,height:i,centerX:g,centerY:v,rotateAngle:o}=n;const f=d<0?-1:1,b=i<0?-1:1;switch(d=Math.abs(d),i=Math.abs(i),s){case"right":{const c=X(d,e,u);d=c.width,e=c.deltaW,a?(t=e/a,i=d/a,g+=e/2*w(o)-t/2*m(o),v+=e/2*m(o)+t/2*w(o)):(g+=e/2*w(o),v+=e/2*m(o));break}case"top-right":{t=-t;const c=X(d,e,u);d=c.width,e=c.deltaW;const r=R(i,t,l);i=r.height,t=r.deltaH,a&&(e=t*a,d=i*a),g+=e/2*w(o)+t/2*m(o),v+=e/2*m(o)-t/2*w(o);break}case"bottom-right":{const c=X(d,e,u);d=c.width,e=c.deltaW;const r=R(i,t,l);i=r.height,t=r.deltaH,a&&(e=t*a,d=i*a),g+=e/2*w(o)-t/2*m(o),v+=e/2*m(o)+t/2*w(o);break}case"bottom":{const c=R(i,t,l);i=c.height,t=c.deltaH,a?(e=t*a,d=i*a,g+=e/2*w(o)-t/2*m(o),v+=e/2*m(o)+t/2*w(o)):(g-=t/2*m(o),v+=t/2*w(o));break}case"bottom-left":{e=-e;const c=X(d,e,u);d=c.width,e=c.deltaW;const r=R(i,t,l);i=r.height,t=r.deltaH,a&&(i=d/a,t=e/a),g-=e/2*w(o)+t/2*m(o),v-=e/2*m(o)-t/2*w(o);break}case"left":{e=-e;const c=X(d,e,u);d=c.width,e=c.deltaW,a?(i=d/a,t=e/a,g-=e/2*w(o)+t/2*m(o),v-=e/2*m(o)-t/2*w(o)):(g-=e/2*w(o),v-=e/2*m(o));break}case"top-left":{e=-e,t=-t;const c=X(d,e,u);d=c.width,e=c.deltaW;const r=R(i,t,l);i=r.height,t=r.deltaH,a&&(d=i*a,e=t*a),g-=e/2*w(o)-t/2*m(o),v-=e/2*m(o)+t/2*w(o);break}case"top":{t=-t;const c=R(i,t,l);i=c.height,t=c.deltaH,a?(d=i*a,e=t*a,g+=e/2*w(o)+t/2*m(o),v+=e/2*m(o)-t/2*w(o)):(g+=t/2*m(o),v-=t/2*w(o));break}}return{position:{centerX:g,centerY:v},size:{width:d*f,height:i*b}}},R=(s,n,e)=>{const t=s+n;return t>e?s=t:(n=e-s,s=e),{height:s,deltaH:n}},X=(s,n,e)=>{const t=s+n;return t>e?s=t:(n=e-s,s=e),{width:s,deltaW:n}},Ie=({centerX:s,centerY:n,width:e,height:t,angle:a})=>({top:n-t/2,left:s-e/2,width:e,height:t,angle:a}),Pe=(s,n,e)=>{const{width:t,height:a}=s;return{width:Math.abs(t),height:Math.abs(a),left:n-Math.abs(t)/2,top:e-Math.abs(a)/2}};function G(s,n){const e=Math.abs(s)%n,t=s>0?n:-n;let a=0;return e>n/2?a=t*Math.ceil(Math.abs(s)/n):a=t*Math.floor(Math.abs(s)/n),a}function Ge(s,n,e){const t=L(!1),a=L(!1),u=L({width:n.width,height:n.height,left:n.left,top:n.top,angle:n.angle});function l(o){if(n.disabled)return;t.value=!0,a.value=!0;let{clientX:f,clientY:b}=Y(o);const{left:c,top:r}=u.value;let h=0,p=0;n.boundary&&([h,p]=d()),e&&e("drag-start",u.value),Q(y=>{const{clientX:k,clientY:x}=Y(y);let D=(k-f)/n.scaleRatio+c,A=(x-b)/n.scaleRatio+r;if(n.snapToGrid){let{left:B,top:N}=u.value;const F=D-B,E=A-N;D=B+G(F,n.gridX),A=N+G(E,n.gridY)}n.boundary&&([D,A]=i(D,A,h,p)),u.value.left=D,u.value.top=A,e&&e("drag",u.value)},y=>{t.value=!1,document.addEventListener("click",g,{once:!0}),e&&e("drag-end",u.value)})}const d=()=>{const{width:o,height:f}=u.value,c=(s.value.parentElement||document.body).getBoundingClientRect(),r=c.width/n.scaleRatio-o,h=c.height/n.scaleRatio-f;return[r,h]},i=(o,f,b,c)=>(o=o<0?0:o,o=o>b?b:o,f=f<0?0:f,f=f>c?c:f,[o,f]),g=()=>{a.value=!1},v=o=>{if(t.value)return;let{left:f,top:b}=u.value;if(["ArrowRight","ArrowLeft"].includes(o.key)){const c=o.key==="ArrowRight";let r=c?1:-1;n.snapToGrid&&(r=c?n.gridX:-n.gridX),f=f+r}else if(["ArrowUp","ArrowDown"].includes(o.key)){const c=o.key==="ArrowDown";let r=c?1:-1;n.snapToGrid&&(r=c?n.gridY:-n.gridY),b=b+r}if(n.boundary){const[c,r]=d();[f,b]=i(f,b,c,r)}u.value.left=f,u.value.top=b};return ke(()=>{if(!s.value)return;const{width:o,height:f}=s.value.getBoundingClientRect();u.value={...u.value,width:o||100,height:f||100},s.value.addEventListener("mousedown",l),s.value.addEventListener("touchstart",l)}),j(a,o=>{n.disabledKeyEvent||(o?document.addEventListener("keydown",v):document.removeEventListener("keydown",v))}),Ae(()=>{document.removeEventListener("keydown",v)}),{isMousedown:t,selected:a,dragData:u}}const Fe=I("div",{class:"es-drager-rotate-handle"},[I("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[I("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),Ke=J({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object,required:!0}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(s,{emit:n}){const e=s,t=L(null),a=C({get:()=>e.modelValue,set:l=>{n("update:modelValue",l)}});function u(l){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");l.stopPropagation(),l.preventDefault();const{width:d,height:i,left:g,top:v}=e.element.getBoundingClientRect(),o=g+d/2,f=v+i/2;n("rotate-start",a.value),Q(b=>{const{clientX:c,clientY:r}=Y(b),h=o-c,p=f-r,y=Math.atan2(p,h)*180/Math.PI-90;a.value=(y+360)%360,n("rotate",a.value)},()=>{n("rotate-end",a.value)})}return(l,d)=>(z(),P("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:u,onTouchstart:u},[V(l.$slots,"default",{},()=>[Fe])],544))}});const je=["data-side","onMousedown","onTouchstart"],Oe=I("div",{class:"es-drager-dot-handle"},null,-1),H=J({__name:"drager",props:Be,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(s,{emit:n}){const e=s,t=(r,...h)=>{n(r,...h),n("change",...h)},a=L(null),{selected:u,dragData:l,isMousedown:d}=Ge(a,e,t),i=L(le(0,e.resizeList)),g=C(()=>e.resizable&&!e.disabled),v=C(()=>e.rotatable&&!e.disabled&&u.value),o=C(()=>{const{width:r,height:h,left:p,top:M,angle:y}=l.value,k={};return r&&(k.width=$(r)),h&&(k.height=$(h)),{...k,left:$(p),top:$(M),zIndex:e.zIndex,transform:`rotate(${y}deg)`,"--es-drager-color":e.color}});function f(r){a.value||(a.value=r.$el||r)}function b(r){i.value=le(r,e.resizeList),t("rotate-end",l.value)}function c(r,h){h.stopPropagation(),h.preventDefault();const{clientX:p,clientY:M}=Y(h),y=p,k=M,{width:x,height:D,left:A,top:B}=l.value,N=A+x/2,F=B+D/2,E={width:x,height:D,centerX:N,centerY:F,rotateAngle:l.value.angle},de=r.side,{minWidth:he,minHeight:fe,aspectRatio:W}=e;t("resize-start",l.value),Q(ee=>{const{clientX:ge,clientY:ve}=Y(ee);let T=(ge-y)/e.scaleRatio,S=(ve-k)/e.scaleRatio;e.snapToGrid&&(T=G(T,e.gridX),S=G(S,e.gridY));const pe=Math.atan2(S,T),te=Ce(T,S),we=ee.shiftKey,ne=pe-Z(E.rotateAngle),me=te*Math.cos(ne),be=te*Math.sin(ne),ye=we&&!W?E.width/E.height:W,{position:{centerX:oe,centerY:se},size:{width:Me,height:De}}=Ve(de,{...E,rotateAngle:E.rotateAngle},me,be,ye,he,fe),_e=Ie({centerX:oe,centerY:se,width:Me,height:De,angle:l.value.angle});l.value={...l.value,...Pe(_e,oe,se)},t("resize",l.value)},()=>{t("resize-end",l.value)})}return j(()=>[e.width,e.height,e.left,e.top,e.angle],([r,h,p,M,y])=>{l.value={...l.value,width:r,height:h,left:p,top:M,angle:y}}),j(()=>e.selected,r=>{u.value=r},{immediate:!0}),(r,h)=>(z(),O(Re(r.tag),{ref:f,class:Le(["es-drager",{disabled:r.disabled,dragging:_(d),selected:_(u),border:r.border}]),style:ae(o.value),onClick:h[3]||(h[3]=re(()=>{},["stop"]))},{default:U(()=>[V(r.$slots,"default"),g.value?(z(!0),P(ue,{key:0},ie(i.value,(p,M)=>(z(),P("div",{key:M,class:"es-drager-dot","data-side":p.side,style:ae({...p}),onMousedown:re(y=>c(p,y),["stop","prevent"]),onTouchstart:y=>c(p,y)},[V(r.$slots,"resize",Ee(ze({side:p.side})),()=>[Oe])],44,je))),128)):ce("",!0),v.value?(z(),O(Ke,{key:1,modelValue:_(l).angle,"onUpdate:modelValue":h[0]||(h[0]=p=>_(l).angle=p),"drag-data":_(l),element:a.value,onRotate:h[1]||(h[1]=p=>t("rotate",_(l))),onRotateStart:h[2]||(h[2]=p=>t("rotate-start",_(l))),onRotateEnd:b},{default:U(()=>[V(r.$slots,"rotate")]),_:3},8,["modelValue","drag-data","element"])):ce("",!0)]),_:3},8,["class","style"]))}});const Ue=s=>{s.component("es-drager",H)};H.install=Ue;const Qe=J({__name:"basic",setup(s){const n=L([{text:"移动",resizable:!1,rotatable:!1},{color:"#00c48f",text:"移动+缩放",rotatable:!1},{color:"#ff9f00",text:"旋转",rotatable:!0,resizable:!1},{color:"#f44336",text:"旋转+缩放",rotatable:!0}]);return(e,t)=>(z(!0),P(ue,null,ie(n.value,(a,u)=>(z(),O(_(H),xe({key:u,width:100,height:100,left:120,top:u*120+30},a,{style:{color:a.color}}),{default:U(()=>[Xe(Ye(a.text),1)]),_:2},1040,["top","style"]))),128))}});export{Qe as default};
