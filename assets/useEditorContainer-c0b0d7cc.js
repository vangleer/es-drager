import{d as T,K as P,o as h,b as q,w as x,g as k,e as S,u as w,a3 as $,m as G,a4 as W,i as N,O as H,a5 as Q,T as Z,a6 as B,r as O,s as V,l as I,z as ee,c as C,y as z,k as te,C as ne,F as oe,a as le,t as se,J as ce,D as J,a7 as ie,a8 as ae,a9 as re,aa as ue,_ as X,M as pe}from"./index-394668c0.js";import{d as R,m as de,c as me,u as fe}from"./GridRect-e927bd1d.js";const ve=N("div",{id:"esEditor"},null,-1),be=T({__name:"Dialog",props:{option:{type:Object,default:()=>({})}},setup(t,{expose:p}){const o=P({option:t.option,visible:!1});let i;const l=s=>{o.option=s,o.visible=!0,H(()=>{i=Q.edit("esEditor",{maxLines:34,minLines:34,fontSize:14,theme:"ace/theme/one_dark",mode:"ace/mode/json5",tabSize:4,readOnly:!1}),i.setValue(JSON.stringify(JSON.parse(o.option.content),null,4))})},b=()=>{o.visible=!1},g=()=>{const{confirm:s}=o.option;s&&s(i&&i.getValue())},d=()=>{if(!i)return;const s=document.createElement("a"),c=Z().format("YYYY-MM-DD")+"-es-drager.json";s.download=c;const f=new Blob([i.getValue()]),u=URL.createObjectURL(f);s.href=u,s.click(),URL.revokeObjectURL(u)};return p({open:l,close:b}),(s,c)=>(h(),q(w(W),G({modelValue:o.visible,"onUpdate:modelValue":c[0]||(c[0]=f=>o.visible=f)},o.option,{draggable:""}),{footer:x(()=>[k(w($),{onClick:b},{default:x(()=>[S("取消")]),_:1}),k(w($),{type:"primary",onClick:g},{default:x(()=>[S("保存编辑")]),_:1}),k(w($),{type:"primary",onClick:d},{default:x(()=>[S("导出JSON")]),_:1})]),default:x(()=>[ve]),_:1},16,["modelValue"]))}});let D=null;function De(t){if(!D){const{container:r}=Y(),o=document.createElement("div");D=k(be,{option:t}),B(D,o),r.appendChild(o.firstElementChild)}const{open:p}=D.component.exposed;p(t)}const ge={key:0},ye=["onClick"],he=T({__name:"Menu",props:{option:{type:Object,default:()=>({})}},setup(t,{expose:p}){const r=t,o=O(),i=O(),l=P({option:r.option,visible:!1,top:0,left:0}),b=V(()=>({left:l.left+"px",top:l.top+"px"})),g=V(()=>({left:l.option.clientX+"px",top:l.option.clientY+"px"})),d=[ae(),re(),ue(10)],s=u=>{l.option=u,l.visible=!0,ie(o.value,i.value,{middleware:d}).then(m=>{l.left=m.x,l.top=m.y})},c=()=>{l.visible=!1},f=u=>{l.option.onClick&&l.option.onClick(u),c()};return I(()=>{document.addEventListener("mousedown",c)}),ee(()=>{document.removeEventListener("mousedown",c)}),p({open:s,close:c}),(u,m)=>(h(),C("div",null,[N("div",{ref_key:"triggerRef",ref:o,class:"es-trigger",style:z(g.value)},null,4),te(N("div",{ref_key:"menuRef",ref:i,class:"es-contentmenu",style:z(b.value),onClick:m[0]||(m[0]=J(()=>{},["stop"])),onMousedown:m[1]||(m[1]=J(()=>{},["stop"]))},[l.option.items?(h(),C("ul",ge,[(h(!0),C(oe,null,le(l.option.items,e=>(h(),C("li",{onClick:n=>f(e)},se(e.label),9,ye))),256))])):ce("",!0)],36),[[ne,l.visible]])]))}}),ke=X(he,[["__scopeId","data-v-b6d1f345"]]);let L=null;function K(t){if(!L){const{container:r}=Y(),o=document.createElement("div");L=k(ke,{option:t}),B(L,o),r.appendChild(o.firstElementChild)}const{open:p}=L.component.exposed;p(t)}const xe=["accept"],Ce=T({__name:"Upload",props:{option:{type:Object,required:!0}},setup(t,{expose:p}){const r={json:".json",image:"image/*"},o=t,i={option:o.option},l=O(),b=s=>{i.option=s;let c=r[s.resultType];s.accept&&(c=s.accept),l.value.setAttribute("accept",c),l.value.click()},g=async s=>{if(!i.option||!i.option.onChange)return;const{resultType:c,onChange:f}=i.option;let u=s;const m=s.target.files[0];["json","text"].includes(c)?u=await d(m):c==="image"&&(u=await d(m,c)),f(u),l.value.value=""},d=(s,c="text")=>new Promise(f=>{const u=new FileReader;u.addEventListener("load",m=>{const e=m.target.result||"{}";f(e)}),c==="text"?u.readAsText(s):u.readAsDataURL(s)});return I(()=>{b(o.option)}),p({open:b}),(s,c)=>{var f;return h(),C("input",{ref_key:"inpurRef",ref:l,type:"file",accept:(f=i.option)==null?void 0:f.accept,class:"es-upload",onChange:g},null,40,xe)}}}),_e=X(Ce,[["__scopeId","data-v-bff817d0"]]);let U=null;function Le(t){if(U){const{open:p}=U.component.exposed;p(t)}else{const{container:p}=Y(),r=document.createElement("div");U=k(_e,{option:t}),B(U,r),p.appendChild(r.firstElementChild)}}const Ee={"ctrl+x":"cut","ctrl+c":"copy","ctrl+v":"paste",Delete:"remove","ctrl+a":"selectAll","ctrl+d":"duplicate"};function Ue(t,p){const r=V(()=>{var e;return((e=p.value)==null?void 0:e.getBoundingClientRect())||{}});let o=null,i=null;const l=e=>e?t.value.elements.findIndex(n=>n.id===e.id):-1,b=(e,n)=>{[t.value.elements[e],t.value.elements[n]]=[t.value.elements[n],t.value.elements[e]]},g=e=>{if(!e)return;const n=R(e);n.id=fe(),t.value.elements.push(n)},d={remove(){const e=l(o);e>-1&&t.value.elements.splice(e,1)},cut(e){i=e,d.remove(e)},copy(e){i=e},duplicate(e){const n=R(e);n.left+=10,n.top+=10,g(n)},top(e){const n=l(e),[a]=t.value.elements.splice(n,1);t.value.elements.push(a)},bottom(e){const n=l(e),[a]=t.value.elements.splice(n,1);t.value.elements.unshift(a)},group(){t.value.elements=de(t.value.elements,r.value)},ungroup(){t.value.elements=me(t.value.elements,r.value)},paste(e,n,a){if(!i)return;const v=R(i);v.left=n-r.value.left,v.top=a-r.value.top,g(v)},selectAll(){t.value.elements.forEach(e=>e.selected=!0)},lock(e){const n=l(e);t.value.elements[n].disabled=!t.value.elements[n].disabled},moveUp(e){const n=l(e);n>=t.value.elements.length-1||b(n,n+1)},moveDown(e){const n=l(e);n<=0||b(n,n-1)}},s=(e,n)=>{e.preventDefault();const{clientX:a,clientY:v}=e;o=R(n);const M=t.value.elements.filter(E=>E.selected),y=[{action:"remove",label:"删除"},{action:"cut",label:"剪切"},{action:"copy",label:"复制"},{action:"duplicate",label:"创建副本"},{action:"top",label:"置顶"},{action:"bottom",label:"置底"},{action:"moveUp",label:"上移一层"},{action:"moveDown",label:"下移一层"}];!n.group&&M.length>1?y.push({action:"group",label:"组合"}):n.group&&y.push({action:"ungroup",label:"取消组合"});const _=o.disabled,F={action:"lock",label:"锁定 / 解锁"};_||y.push(F),K({clientX:a,clientY:v,items:_?[F]:y,onClick:({action:E})=>{d[E]&&d[E](o)}})},c=e=>{const{clientX:n,clientY:a}=e;K({clientX:n,clientY:a,items:[{action:"paste",label:"在这粘贴"},{action:"selectAll",label:"全选"}],onClick({action:v}){v==="paste"?d.paste(o,n,a):d[v]&&d[v](o)}})},f=e=>{if(!e.ctrlKey)return;e.preventDefault();const{deltaY:n}=e;let a=t.value.container.scaleRatio||1;n<0?a+=.1:a-=.1,a<.5?a=.5:a>2&&(a=2),t.value.container.scaleRatio=a},u=()=>{let e=document.activeElement||{tagName:""};return e.tagName==="INPUT"||e.tagName==="TEXTAREA"},m=e=>{const{ctrlKey:n,key:a}=e,v=[];n&&v.push("ctrl"),v.push(a);const M=v.join("+"),y=Ee[M];d[y]&&(u()||(e.preventDefault(),o=t.value.elements.find(_=>_.selected)||null,d[y](o)))};return I(()=>{window.addEventListener("keydown",m)}),pe(()=>{window.removeEventListener("keydown",m)}),{editorRect:r,onContextmenu:s,onEditorContextMenu:c,onWheel:f}}let j;const A="es-editor-container-1996",Y=()=>{if(!j&&!document.querySelector(`#${A}`)){const t=document.createElement("div");t.id=A,j=t,document.body.appendChild(t)}return{container:j,selector:A}};export{De as $,Le as a,Ue as u};
