import{h as K,r as N,eE as we,eL as q,eG as Ce,eM as _e,d as ne,o as I,c as H,eN as O,i as U,b as W,w as ee,a as ze,n as ge,eO as Te,eP as De,F as Ne,eQ as ve,u as D,eR as Se,eK as Pe,eI as Ie,e as Ke}from"./index-7d51d83b.js";const $e={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},maxWidth:{type:Number,default:0},maxHeight:{type:Number,default:0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean},checkCollision:{type:Boolean},snap:Boolean,snapThreshold:{type:Number,default:10},markline:[Boolean,Function]};function oe(o,n){const e=t=>{n&&n(t),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",o),document.addEventListener("touchend",e)}function $(o){let n=0,e=0;if(Ve(o)){const t=o.targetTouches[0];n=t.pageX,e=t.pageY}else n=o.clientX,e=o.clientY;return{clientX:n,clientY:e}}function Ve(o){const n=Object.prototype.toString.call(o);return n.substring(8,n.length-1)==="TouchEvent"}const G=(o=0)=>parseInt(o+"")+"px",Z={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},te=["n","ne","e","se","s","sw","w","nw"],Fe={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},Ge={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},qe=(o,n)=>{const e=Ge[Math.floor(o/30)],i=(Fe[n]+e)%8;return te[i]},pe=(o=0,n)=>{let e=[];for(let t=0;t<te.length;t++){const i=te[t],[d,h]=Z[i].split("-"),s=qe(o,i),c={[d]:"0%",cursor:s+"-resize",side:Z[i]};if(h)c[h]="0%";else{const g=["top","bottom"].includes(d)?"left":"top";c[g]="50%"}n?n.includes(Z[i])&&e.push(c):e.push(c)}return e},se=o=>o*Math.PI/180,Oe=(o,n)=>Math.sqrt(o*o+n*n),k=o=>Math.cos(se(o)),x=o=>Math.sin(se(o)),Ue=(o,n,e,t,i,d,h)=>{let{width:s,height:c,centerX:g,centerY:w,rotateAngle:l}=n;const L=s<0?-1:1,v=c<0?-1:1;switch(s=Math.abs(s),c=Math.abs(c),o){case"right":{const u=P(s,e,d);s=u.width,e=u.deltaW,i?(t=e/i,c=s/i,g+=e/2*k(l)-t/2*x(l),w+=e/2*x(l)+t/2*k(l)):(g+=e/2*k(l),w+=e/2*x(l));break}case"top-right":{t=-t;const u=P(s,e,d);s=u.width,e=u.deltaW;const a=S(c,t,h);c=a.height,t=a.deltaH,i&&(e=t*i,s=c*i),g+=e/2*k(l)+t/2*x(l),w+=e/2*x(l)-t/2*k(l);break}case"bottom-right":{const u=P(s,e,d);s=u.width,e=u.deltaW;const a=S(c,t,h);c=a.height,t=a.deltaH,i&&(e=t*i,s=c*i),g+=e/2*k(l)-t/2*x(l),w+=e/2*x(l)+t/2*k(l);break}case"bottom":{const u=S(c,t,h);c=u.height,t=u.deltaH,i?(e=t*i,s=c*i,g+=e/2*k(l)-t/2*x(l),w+=e/2*x(l)+t/2*k(l)):(g-=t/2*x(l),w+=t/2*k(l));break}case"bottom-left":{e=-e;const u=P(s,e,d);s=u.width,e=u.deltaW;const a=S(c,t,h);c=a.height,t=a.deltaH,i&&(c=s/i,t=e/i),g-=e/2*k(l)+t/2*x(l),w-=e/2*x(l)-t/2*k(l);break}case"left":{e=-e;const u=P(s,e,d);s=u.width,e=u.deltaW,i?(c=s/i,t=e/i,g-=e/2*k(l)+t/2*x(l),w-=e/2*x(l)-t/2*k(l)):(g-=e/2*k(l),w-=e/2*x(l));break}case"top-left":{e=-e,t=-t;const u=P(s,e,d);s=u.width,e=u.deltaW;const a=S(c,t,h);c=a.height,t=a.deltaH,i&&(s=c*i,e=t*i),g-=e/2*k(l)-t/2*x(l),w-=e/2*x(l)+t/2*k(l);break}case"top":{t=-t;const u=S(c,t,h);c=u.height,t=u.deltaH,i?(s=c*i,e=t*i,g+=e/2*k(l)+t/2*x(l),w+=e/2*x(l)-t/2*k(l)):(g+=t/2*x(l),w-=t/2*k(l));break}}return{position:{centerX:g,centerY:w},size:{width:s*L,height:c*v}}},S=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{height:o,deltaH:n}},P=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{width:o,deltaW:n}},je=({centerX:o,centerY:n,width:e,height:t,angle:i})=>({top:n-t/2,left:o-e/2,width:e,height:t,angle:i}),Qe=(o,n,e)=>{const{width:t,height:i}=o;return{width:Math.abs(t),height:Math.abs(i),left:n-Math.abs(t)/2,top:e-Math.abs(i)/2}};function j(o,n){const e=Math.abs(o)%n,t=o>0?n:-n;let i=0;return e>n/2?i=t*Math.ceil(Math.abs(o)/n):i=t*Math.floor(Math.abs(o)/n),i}function Je(o,n){if(!o||!n)return!1;const e=o.getBoundingClientRect(),t=n.getBoundingClientRect();return e.left<t.left+t.width&&e.left+e.width>t.left&&e.top<t.top+t.height&&e.top+e.height>t.top}const ye=o=>typeof o=="function";function Ze(o,n){let e=null,t=null;const i=K(()=>o.value.offsetParent||document.body),d=K(()=>i.value.getBoundingClientRect()),h=N({x:[],y:[]}),s=()=>{n.markline&&!ye(n.markline)&&(e||(e=document.querySelector(".es-drager-markline-x")||me("x",i.value,n.color)),t||(t=document.querySelector(".es-drager-markline-y")||me("y",i.value,n.color)))},c=(v={})=>{if(n.markline){if(ye(n.markline))return n.markline(v);v.left===null?e.style.display="none":(e.style.left=v.left+"px",e.style.backgroundColor=n.color,e.style.display="block"),v.top===null?t.style.display="none":(t.style.top=v.top+"px",t.style.backgroundColor=n.color,t.style.display="block")}},g=()=>{const v=o.value.getBoundingClientRect(),u=document.querySelectorAll(".es-drager"),a=[];for(let f=0;f<u.length;f++){const y=u[f];y!==o.value&&a.push(y.getBoundingClientRect())}h.value=He(a,v)},w=()=>{const v={top:null,left:null,diffX:0,diffY:0},u=o.value.getBoundingClientRect();for(let a=0;a<h.value.y.length;a++){const{top:f,showTop:y}=h.value.y[a];if(Math.abs(f-u.top)<n.snapThreshold){v.diffY=f-u.top,v.top=y-d.value.top;break}}for(let a=0;a<h.value.x.length;a++){const{left:f,showLeft:y}=h.value.x[a];if(Math.abs(f-u.left)<n.snapThreshold){v.diffX=f-u.left,v.left=y-d.value.left;break}}return c(v),v},l=()=>{c({left:null,top:null})},L=v=>{if(!(!n.snap&&!n.markline))switch(v){case"drag-start":g();break;case"drag":return w();case"drag-end":l();break}};return we(()=>{s()}),{marklineEmit:L}}function me(o="x",n,e=""){const t=document.createElement("div");return t.classList.add(`es-drager-markline-${o}`),t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.zIndex="9999",t.style.backgroundColor=e,t.style.display="none",o==="x"?(t.style.height="100%",t.style.width="1px"):(t.style.height="1px",t.style.width="100%"),n.appendChild(t),t}function He(o,n){const e={x:[],y:[]},{width:t=0,height:i=0}=n;return o.forEach(d=>{const{top:h,left:s,width:c,height:g}=d;e.y.push({showTop:h,top:h}),e.y.push({showTop:h,top:h-i}),e.y.push({showTop:h+g/2,top:h+g/2-i/2}),e.y.push({showTop:h+g,top:h+g}),e.y.push({showTop:h+g,top:h+g-i}),e.x.push({showLeft:s,left:s}),e.x.push({showLeft:s+c,left:s+c}),e.x.push({showLeft:s+c/2,left:s+c/2-t/2}),e.x.push({showLeft:s+c,left:s+c-t}),e.x.push({showLeft:s,left:s-t})}),e}function We(o,n,e,{getBoundary:t,fixBoundary:i,checkDragerCollision:d,emit:h}){let s=0,c=0;return{onKeydown:l=>{let{left:L,top:v}=n.value;if(s||(s=L),c||(c=v),["ArrowRight","ArrowLeft"].includes(l.key)){const u=l.key==="ArrowRight";let a=u?1:-1;o.snapToGrid&&(a=u?o.gridX:-o.gridX),L=L+a}else if(["ArrowUp","ArrowDown"].includes(l.key)){const u=l.key==="ArrowDown";let a=u?1:-1;o.snapToGrid&&(a=u?o.gridY:-o.gridY),v=v+a}if(o.boundary){const[u,a,f,y]=t();[L,v]=i(L,v,u,a,f,y)}n.value.left=L,n.value.top=v},onKeyup:l=>{["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(l.key)&&o.checkCollision&&d()&&(n.value.left=s,n.value.top=c),s=0,c=0}}}function et(o,n,e){const t=N(!1),i=N(!1),d=N({width:n.width,height:n.height,left:n.left,top:n.top,angle:n.angle}),{marklineEmit:h}=Ze(o,n),s=new Set;function c(a){if(s.add(a.button),n.disabled)return;t.value=!0,i.value=!0;let{clientX:f,clientY:y}=$(a);const{left:E,top:r}=d.value;let p=0,m=0,M=0,b=0;n.boundary&&([p,m,M,b]=g()),h("drag-start"),e&&e("drag-start",d.value),oe(X=>{if(s.size>1)return;const{clientX:A,clientY:R}=$(X);let Y=(A-f)/n.scaleRatio+E,z=(R-y)/n.scaleRatio+r;if(n.snapToGrid){let{left:C,top:_}=d.value;const Q=Y-C,J=z-_;Y=C+j(Q,n.gridX),z=_+j(J,n.gridY)}n.boundary&&([Y,z]=w(Y,z,p,m,M,b)),d.value.left=Y,d.value.top=z,e&&e("drag",d.value),_e(()=>{const C=h("drag");n.snap&&(C.diffX&&(d.value.left+=C.diffX),C.diffY&&(d.value.top+=C.diffY))})},X=>{n.checkCollision&&l()&&(d.value.top=r,d.value.left=E),s.clear(),t.value=!1,h("drag-end"),e&&e("drag-end",d.value)})}const g=()=>{let a=0,f=0;const{left:y,top:E,height:r,width:p,angle:m}=d.value,b=(o.value.offsetParent||document.body).getBoundingClientRect();if(m&&n.scaleRatio===1){const A=o.value.getBoundingClientRect();a=Math.abs(A.left-(y+b.left)),f=Math.abs(A.top-(E+b.top))}const B=b.width/n.scaleRatio-p,X=b.height/n.scaleRatio-r;return[a,B-a,f,X-f,b.width/n.scaleRatio,b.height/n.scaleRatio]},w=(a,f,y,E,r,p)=>(a=a<y?y:a,a=a>E?E:a,f=f<r?r:f,f=f>p?p:f,[a,f]),l=()=>{const a=o.value.offsetParent||document.body,f=Array.from(a.children).filter(y=>y!==o.value&&y.classList.contains("es-drager"));for(let y=0;y<f.length;y++){const E=f[y];if(Je(o.value,E))return!0}},L=()=>{i.value=!1},{onKeydown:v,onKeyup:u}=We(n,d,i,{getBoundary:g,fixBoundary:w,checkDragerCollision:l,emit:e});return q(i,a=>{a?(e("focus",a),document.addEventListener("click",L,{once:!0})):e("blur",a),!n.disabledKeyEvent&&(a?(document.addEventListener("keydown",v),document.addEventListener("keyup",u)):(document.removeEventListener("keydown",v),document.removeEventListener("keyup",u)))}),we(()=>{if(o.value){if(!d.value.width&&!d.value.height){const{width:a,height:f}=o.value.getBoundingClientRect();d.value={...d.value,width:a||100,height:f||100}}o.value.addEventListener("mousedown",c),o.value.addEventListener("touchstart",c,{passive:!0})}}),Ce(()=>{document.removeEventListener("click",L),document.removeEventListener("keydown",v),document.removeEventListener("keyup",u)}),{isMousedown:t,selected:i,dragData:d,getBoundary:g,checkDragerCollision:l}}const tt=U("div",{class:"es-drager-rotate-handle"},[U("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[U("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),nt=ne({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=n,i=N(null),d=K({get:()=>e.modelValue,set:s=>{t("update:modelValue",s)}});function h(s){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");s.stopPropagation();const{width:c,height:g,left:w,top:l}=e.element.getBoundingClientRect(),L=w+c/2,v=l+g/2;t("rotate-start",d.value),oe(u=>{const{clientX:a,clientY:f}=$(u),y=L-a,E=v-f,p=Math.atan2(E,y)*180/Math.PI-90;d.value=(p+360)%360,t("rotate",d.value)},()=>{t("rotate-end",d.value)})}return(s,c)=>(I(),H("div",{ref_key:"rotateRef",ref:i,class:"es-drager-rotate",onMousedown:h,onTouchstartPassive:h},[O(s.$slots,"default",{},()=>[tt])],544))}});const ot=["data-side","onMousedown","onTouchstartPassive"],st=U("div",{class:"es-drager-dot-handle"},null,-1),ie=ne({__name:"drager",props:$e,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end","focus","blur"],setup(o,{emit:n}){const e=o,t=n,i=(r,...p)=>{t(r,...p)},d=N(null),{selected:h,dragData:s,isMousedown:c,getBoundary:g,checkDragerCollision:w}=et(d,e,i),l=N(pe(0,e.resizeList)),L=K(()=>e.resizable&&!e.disabled),v=K(()=>e.rotatable&&!e.disabled&&h.value),u=K(()=>{const{width:r,height:p,left:m,top:M,angle:b}=s.value,B={};return r&&(B.width=G(r)),p&&(B.height=G(p)),{...B,left:G(m),top:G(M),zIndex:e.zIndex,transform:`rotate(${b}deg)`,"--es-drager-color":e.color}});function a(r){d.value||(d.value=r.$el||r)}function f(r){l.value=pe(r,e.resizeList),i("rotate-end",s.value)}function y(r,p){if(e.disabled)return;p.stopPropagation();const{clientX:m,clientY:M}=$(p),b=m,B=M,{width:X,height:A,left:R,top:Y}=s.value,z=R+X/2,C=Y+A/2,_={width:X,height:A,centerX:z,centerY:C,rotateAngle:s.value.angle},Q=r.side,{minWidth:J,minHeight:be,aspectRatio:le,equalProportion:ke}=e;i("resize-start",s.value);let ae=[];e.boundary&&(ae=g()),oe(re=>{const{clientX:xe,clientY:Le}=$(re);let V=(xe-b)/e.scaleRatio,F=(Le-B)/e.scaleRatio;e.snapToGrid&&(V=j(V,e.gridX),F=j(F,e.gridY));const Me=Math.atan2(F,V),ce=Oe(V,F),Ae=re.shiftKey,ue=Me-se(_.rotateAngle),Ee=ce*Math.cos(ue),Be=ce*Math.sin(ue),de=(ke||Ae)&&!le?_.width/_.height:le,{position:{centerX:he,centerY:fe},size:{width:Xe,height:Ye}}=Ue(Q,{..._,rotateAngle:_.rotateAngle},Ee,Be,de,J,be),Re=je({centerX:he,centerY:fe,width:Xe,height:Ye,angle:s.value.angle});let T={...s.value,...Qe(Re,he,fe)};e.maxWidth>0&&(T.width=Math.min(T.width,e.maxWidth)),e.maxHeight>0&&(T.height=Math.min(T.height,e.maxHeight)),e.boundary&&(T=E(T,ae,de)),s.value=T,i("resize",s.value)},()=>{e.checkCollision&&w()&&(s.value={...s.value,width:X,height:A,left:R,top:Y}),i("resize-end",s.value)})}function E(r,p,m){const[M,b,B,X,A,R]=p;return r.left<M&&(r.left=M,r.width=s.value.width,m&&(r.height=s.value.height)),r.left+r.width>A&&(r.left=s.value.left,r.width=A-r.left,m&&(r.height=s.value.height)),r.top<B&&(r.top=B,r.height=s.value.height,m&&(r.width=s.value.width)),r.top+r.height>R&&(r.top=s.value.top,r.height=R-r.top,m&&(r.width=s.value.width)),r}return q(()=>[e.width,e.height,e.left,e.top,e.angle],([r,p,m,M,b],[B,X,A,R,Y])=>{r!==B&&(s.value.width=r),p!==X&&(s.value.height=p),m!==A&&(s.value.left=m),M!==R&&(s.value.top=M),b!==Y&&(s.value.angle=b)}),q(()=>s.value,r=>{t("change",{...r})},{deep:!0}),q(()=>e.selected,r=>{h.value=r},{immediate:!0}),(r,p)=>(I(),W(Ie(r.tag),{ref:a,class:Se(["es-drager",{disabled:r.disabled,dragging:D(c),selected:D(h),border:r.border}]),style:ge(u.value),onClick:p[3]||(p[3]=Pe(()=>{},["stop"]))},{default:ee(()=>[O(r.$slots,"default"),L.value?(I(!0),H(Ne,{key:0},ze(l.value,(m,M)=>(I(),H("div",{key:M,class:"es-drager-dot","data-side":m.side,style:ge({...m}),onMousedown:b=>y(m,b),onTouchstartPassive:b=>y(m,b)},[O(r.$slots,"resize",Te(De({side:m.side})),()=>[st])],44,ot))),128)):ve("",!0),v.value?(I(),W(nt,{key:1,modelValue:D(s).angle,"onUpdate:modelValue":p[0]||(p[0]=m=>D(s).angle=m),element:d.value,onRotate:p[1]||(p[1]=m=>i("rotate",D(s))),onRotateStart:p[2]||(p[2]=m=>i("rotate-start",D(s))),onRotateEnd:f},{default:ee(()=>[O(r.$slots,"rotate")]),_:3},8,["modelValue","element"])):ve("",!0)]),_:3},8,["class","style"]))}});const it=o=>{o.component("es-drager",ie)};ie.install=it;const rt=ne({__name:"temp",setup(o){function n(t){console.log("onFocus")}function e(t){console.log("onBlur")}return(t,i)=>(I(),W(D(ie),{width:100,height:100,left:100,top:100,rotatable:"",onFocus:n,onBlur:e},{default:ee(()=>[Ke(" 测试 ")]),_:1}))}});export{rt as default};
