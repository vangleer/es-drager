import{eO as ie,d as T,r as H,eP as ce,o as p,c as y,eQ as se,e as j,t as Y,eR as de,_ as X,eH as b,l as t,w as r,i as L,F as z,a as E,b as D,eI as J,u as n,eS as le,eT as pe,m as Q,eU as G,h as M,n as P,eV as K,eK as q,eE as ee,eW as fe,eX as N,eY as me,eZ as _e,g as ve,e_ as be,e$ as ge,f0 as he,f1 as ye,f2 as oe,f3 as Ve,f4 as xe,f5 as ke,f6 as we,f7 as Ce,f8 as Se,eN as ne,f9 as Ue,fa as $e,fb as ze}from"./index-3a9f5e44.js";import{G as Re}from"./GridRect-104d11a5.js";import{u as Me,A as Ee}from"./useArea-2a77043d.js";import{u as De,$ as He,a as ae}from"./useEditorContainer-a931e9a5.js";const Le=["fontSize","lineHeight","borderWidth","borderRadius"],re=["fontSize","fontWeight","fontFamily","color","lineHeight","fontStyle","textDecoration","justifyContent","alignItems"];function Z(_,e=!0){if(!_)return _;const f={},d=Object.keys(_).filter(o=>e?re.includes(o):!re.includes(o));for(const o of d)f[o]=Le.includes(o)?ie(_[o]):_[o];return f}function Te(_,e){return Object.keys(_).reduce((f,d)=>(e.includes(d)||(f[d]=_[d]),f),{})}const Ae=["contenteditable"],Ie=T({__name:"TextEditor",props:{editable:{type:Boolean,default:!1},text:{type:String}},setup(_){const e=_,f=H();function d(){if(!f.value)return;const o=document.createRange();o.selectNode(f.value),window.getSelection().removeAllRanges(),window.getSelection().addRange(o)}return ce(()=>[e.editable],()=>{e.editable&&d()}),(o,m)=>(p(),y("div",{ref_key:"textRef",ref:f,class:de(["es-text",{editable:_.editable}]),contenteditable:_.editable},[se(o.$slots,"default",{},()=>[j(Y(_.text),1)],!0)],10,Ae))}}),ue=X(Ie,[["__scopeId","data-v-6f7332e1"]]),Oe={class:"es-layout-aside"},Be={class:"collapse-content"},Pe=["onDragstart"],Ne={class:"collapse-content"},je=["onDragstart"],We=T({__name:"Aside",emits:["dragstart","dragend"],setup(_,{emit:e}){const f=e,d=H(["1"]);function o(u,s){let l=50,i=50;s.component!=="es-icon"&&(l=u.target.offsetWidth,i=u.target.offsetHeight),f("dragstart",{...s,width:l,height:i})}function m(){f("dragend")}return(u,s)=>{const l=b("el-collapse-item"),i=b("el-collapse");return p(),y("div",Oe,[se(u.$slots,"default",{},()=>[t(i,{modelValue:d.value,"onUpdate:modelValue":s[0]||(s[0]=a=>d.value=a)},{default:r(()=>[t(l,{title:"通用",name:"1"},{default:r(()=>[L("div",Be,[(p(!0),y(z,null,E(n(le).componentList,a=>(p(),y("div",{class:"es-block",draggable:"true",onDragstart:h=>o(h,a),onDragend:m},[a.component?(p(),D(J(a.component),{key:0},{default:r(()=>[j(Y(a.text),1)]),_:2},1024)):(p(),y(z,{key:1},[j(Y(a.text),1)],64))],40,Pe))),256))])]),_:1}),t(l,{title:"杂项",name:"2"}),t(l,{title:"图标",name:"3"},{default:r(()=>[L("div",Ne,[(p(!0),y(z,null,E(n(le).iconList,a=>(p(),y("div",{class:"es-block",draggable:"true",onDragstart:h=>o(h,a),onDragend:m},[a.component?(p(),D(J(a.component),pe(Q({key:0},a.props)),null,16)):(p(),y(z,{key:1},[j(Y(a.props.icon),1)],64))],40,je))),256))])]),_:1})]),_:1},8,["modelValue"])])])}}}),W=Symbol("checkboxGroupContextKey"),Ye=T({__name:"EditorStyle",setup(_){const e=G(W),f=H(100),d=M({get:()=>{const{width:u,height:s}=e.data.container.style;return`${u} x ${s}`},set:u=>{const[s,l]=u.split(" x ");e.data.container.style.width=+s,e.data.container.style.height=+l}}),o=[{label:"PC",options:[{label:"1360 x 760",value:"1360 x 760"},{label:"1280 x 720",value:"1280 x 720"},{label:"800 x 600",value:"800 x 600"}]},{label:"H5",options:[{label:"360 x 780",value:"360 x 780"},{label:"iPhone 6/7/8",value:"375 x 667"},{label:"iPhone 6/7/8 Plus",value:"414 x 736"}]}],m=u=>{e.data.container.scaleRatio=u/100};return(u,s)=>{const l=b("el-option"),i=b("el-option-group"),a=b("el-select"),h=b("el-form-item"),U=b("el-input"),g=b("el-input-number"),k=b("el-switch"),C=b("el-color-picker"),w=b("el-checkbox"),$=b("el-form");return p(),D($,{model:n(e).data.container,"label-width":"90px","label-position":"left",style:{padding:"0 10px"}},{default:r(()=>[t(h,{label:"画布尺寸"},{default:r(()=>[t(a,{modelValue:d.value,"onUpdate:modelValue":s[0]||(s[0]=v=>d.value=v)},{default:r(()=>[(p(),y(z,null,E(o,v=>t(i,{key:v.label,label:v.label},{default:r(()=>[(p(!0),y(z,null,E(v.options,c=>(p(),D(l,{label:c.label,value:c.value},null,8,["label","value"]))),256))]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1}),t(h,{label:"缩放比例(%)"},{default:r(()=>[t(U,{modelValue:f.value,"onUpdate:modelValue":s[1]||(s[1]=v=>f.value=v),modelModifiers:{number:!0},onChange:m},null,8,["modelValue"])]),_:1}),t(h,{label:"画布宽度"},{default:r(()=>[t(g,{modelValue:n(e).data.container.style.width,"onUpdate:modelValue":s[2]||(s[2]=v=>n(e).data.container.style.width=v)},null,8,["modelValue"])]),_:1}),t(h,{label:"画布高度"},{default:r(()=>[t(g,{modelValue:n(e).data.container.style.height,"onUpdate:modelValue":s[3]||(s[3]=v=>n(e).data.container.style.height=v)},null,8,["modelValue"])]),_:1}),t(h,{label:"网格"},{default:r(()=>[t(k,{modelValue:n(e).data.container.snapToGrid,"onUpdate:modelValue":s[4]||(s[4]=v=>n(e).data.container.snapToGrid=v)},null,8,["modelValue"])]),_:1}),t(h,{label:"网格大小"},{default:r(()=>[t(g,{modelValue:n(e).data.container.gridSize,"onUpdate:modelValue":s[5]||(s[5]=v=>n(e).data.container.gridSize=v)},null,8,["modelValue"])]),_:1}),t(h,{label:"网格颜色"},{default:r(()=>[t(C,{modelValue:n(e).data.container.gridColor,"onUpdate:modelValue":s[6]||(s[6]=v=>n(e).data.container.gridColor=v)},null,8,["modelValue"])]),_:1}),t(h,{label:"背景颜色"},{default:r(()=>[t(C,{modelValue:n(e).data.container.style.backgroundColor,"onUpdate:modelValue":s[7]||(s[7]=v=>n(e).data.container.style.backgroundColor=v)},null,8,["modelValue"])]),_:1}),t(h,{label:"参考线"},{default:r(()=>[t(w,{modelValue:n(e).data.container.markline.show,"onUpdate:modelValue":s[8]||(s[8]=v=>n(e).data.container.markline.show=v)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])}}}),Ge='<svg t="1692778133849" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15222" width="16" height="16"><path d="M123.26 411.37a32 32 0 1 1 45.28-45.23l311.34 311.67L479.71 97a32 32 0 0 1 32-32 32 32 0 0 1 32 32l0.17 580.89 311.59-311.76a32 32 0 0 1 45.27 45.24l-366.2 366.39-0.19 0.18-0.94 0.9-0.52 0.44-0.62 0.53-0.1 0.09-0.62 0.47-0.5 0.4c-0.05 0-0.1 0.08-0.16 0.11-0.21 0.16-0.43 0.31-0.65 0.46l-0.46 0.32-0.2 0.14-0.65 0.41-0.48 0.29a1.64 1.64 0 0 1-0.22 0.14l-0.62 0.35-0.52 0.29-0.23 0.13-0.59 0.29-0.6 0.3-0.18 0.09c-0.17 0.09-0.35 0.16-0.53 0.24l-0.71 0.3-0.19 0.08-0.48 0.18c-0.27 0.1-0.54 0.21-0.81 0.3H522.6l-0.42 0.13-0.91 0.3h-0.14l-0.39 0.11-1 0.26h-0.12l-0.38 0.08c-0.34 0.08-0.68 0.16-1 0.22h-0.06l-0.42 0.07-1 0.17h-0.09c-0.17 0-0.34 0-0.51 0.06l-0.94 0.12h-0.95l-0.75 0.05h-3.12l-0.75-0.05H508.84l-0.94-0.12c-0.17 0-0.34 0-0.51-0.06h-0.09l-1-0.17-0.42-0.07h-0.1c-0.34-0.06-0.68-0.14-1-0.22l-0.4-0.08h-0.08l-1-0.26-0.4-0.11h-0.14l-0.89-0.29-0.45-0.14-0.14-0.05c-0.26-0.09-0.53-0.19-0.79-0.3l-0.49-0.18h-0.2l-0.69-0.3-0.55-0.24-0.18-0.09-0.59-0.3-0.6-0.29-0.17-0.09h-0.05l-0.52-0.28-0.64-0.36-0.14-0.09h-0.07l-0.47-0.3c-0.22-0.14-0.45-0.27-0.67-0.42h-0.07l-0.11-0.08-0.47-0.33-0.81-0.49-0.09-0.08-0.53-0.42-0.61-0.47-0.08-0.07c-0.24-0.19-0.47-0.4-0.7-0.6l-0.46-0.4c-0.41-0.37-0.81-0.74-1.19-1.13zM896.68 895H127.32a32 32 0 1 0 0 64h769.36a32 32 0 0 0 0-64z" fill="currentColor" p-id="15223"></path></svg>',Fe='<svg t="1692774315617" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8893" width="16" height="16"><path fill="currentColor" d="M96 128h832v96H96zM96 576h832v96H96zM224 352h576v96H224zM224 800h576v96H224z" p-id="8894"></path></svg>',qe='<svg t="1692774266304" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6910" width="16" height="16"><path fill="currentColor" d="M96 128h832v96H96zM96 576h832v96H96zM96 352h576v96H96zM96 800h576v96H96z" p-id="6911"></path></svg>',Xe='<svg t="1692778640543" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7435" width="16" height="16"><path fill="currentColor" d="M143.998942-0.011289h64.007055V1024h-64.007055zM815.982714 224.002117h64.007056v575.984478h-64.007056zM591.991886-0.011289h64.007056V1024h-64.007056zM368.001058 224.002117h63.995767v575.984478h-63.995767z" p-id="7436"></path></svg>',Ke='<svg t="1692774301684" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7896" width="16" height="16"><path fill="currentColor" d="M96 128h832v96H96zM96 576h832v96H96zM352 352h576v96H352zM352 800h576v96H352z" p-id="7897"></path></svg>',Je='<svg t="1692777879594" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="14228" width="16" height="16"><path d="M557.654996 981.669904c-6.499999 59.041994-88.986991 53.776995-92.179991 0-0.083-40.896996-0.083-641.390937-0.083-641.390937l-283.839972 273.963973c-44.472996 38.308996-97.43499-22.922998-64.344994-63.215994 125.709988-121.895988 351.289966-340.004967 356.507965-345.049966 20.810998-22.608998 53.572995-23.779998 75.721993 0 41.406996 40.037996 348.700966 336.328967 358.028965 346.989966 31.166997 38.741996-19.223998 96.073991-62.242994 63.773994C834.109969 607.310941 557.739996 340.267967 557.739996 340.267967M116.396039 3.332l786.487923 0 0 89.285991L116.396039 92.617991 116.396039 3.332z" fill="currentColor" p-id="14229"></path></svg>',Qe=Object.assign({"./bottom.svg":Ge,"./center.svg":Fe,"./left.svg":qe,"./middle.svg":Xe,"./right.svg":Ke,"./top.svg":Je}),F=_=>_?Qe[`./${_}.svg`]:"",Ze={class:"text-block-box"},et={class:"text-style-block"},tt=["onClick","innerHTML"],lt=T({__name:"TextStyle",setup(_){const e=G(W),f=[{label:"正常",value:"normal"},{label:"标题 1",value:"2em"},{label:"标题 2",value:"1.5em"},{label:"标题 3",value:"1.17em"},{label:"标题 4",value:"1em"},{label:"标题 5",value:"0.9em"},{label:"标题 6",value:"0.8em"}],d=H(""),o=[{label:"B",key:"fontWeight",value:"bold"},{label:"I",key:"fontStyle",value:"italic"},{label:"U",key:"textDecoration",value:"underline"},{label:"S",key:"textDecoration",value:"line-through"},{label:F("left"),key:"justifyContent",value:"flex-start"},{label:F("center"),key:"justifyContent",value:"center"},{label:F("right"),key:"justifyContent",value:"flex-end"},{label:F("top"),key:"alignItems",value:"flex-start"},{label:F("middle"),key:"alignItems",value:"center"},{label:F("bottom"),key:"alignItems",value:"flex-end"}],m=M(()=>[...o].map(g=>({...g,selected:U(g.key)===g.value}))),u=M(()=>[m.value.slice(0,4),m.value.slice(4,7),m.value.slice(7,10)]),s=[{label:"Helvetica"},{label:"PingFang SC"},{label:"Hiragino Sans GB"},{label:"Microsoft YaHei"},{label:"Times New Roman"},{label:"Verdana"},{label:"Courier New"},{label:"Georgia"},{label:"Lucida Sans"},{label:"Tahoma"}];function l(g){g.selected=!g.selected,h(g.key,g.selected?g.value:void 0)}function i(g){const k=g==="normal";e.current.style.fontSize=k?void 0:g,e.current.style.fontWeight=k?"normal":"bold"}const a=M({get:()=>e.current.style||{},set:g=>{e.current.style=e.current.style||{},Object.keys(g).forEach(k=>{h(k,g[k])})}});function h(g,k){e.current.style[g]=k}function U(g){return e.current.style[g]}return(g,k)=>{const C=b("el-color-picker"),w=b("el-form-item"),$=b("el-option"),v=b("el-select"),c=b("el-input"),I=b("el-input-number");return p(),y("div",null,[t(w,{label:"字体颜色"},{default:r(()=>[t(C,{modelValue:a.value.color,"onUpdate:modelValue":k[0]||(k[0]=x=>a.value.color=x)},null,8,["modelValue"])]),_:1}),t(w,{label:"标题"},{default:r(()=>[t(v,{modelValue:d.value,"onUpdate:modelValue":k[1]||(k[1]=x=>d.value=x),placeholder:"标题",onChange:i},{default:r(()=>[(p(),y(z,null,E(f,x=>t($,{label:x.label,value:x.value},{default:r(()=>[L("span",{style:P({fontSize:x.value,fontWeight:"bold"})},Y(x.label),5)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"字体"},{default:r(()=>[t(v,{modelValue:a.value.fontFamily,"onUpdate:modelValue":k[2]||(k[2]=x=>a.value.fontFamily=x),placeholder:"字体"},{default:r(()=>[(p(),y(z,null,E(s,x=>t($,{label:x.label,value:x.label},{default:r(()=>[L("span",{style:P({fontFamily:x.label})},Y(x.label),5)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"字体大小"},{default:r(()=>[t(c,{modelValue:a.value.fontSize,"onUpdate:modelValue":k[3]||(k[3]=x=>a.value.fontSize=x)},null,8,["modelValue"])]),_:1}),t(w,{label:"行高"},{default:r(()=>[t(I,{modelValue:a.value.lineHeight,"onUpdate:modelValue":k[4]||(k[4]=x=>a.value.lineHeight=x)},null,8,["modelValue"])]),_:1}),t(w,{label:"文本"},{default:r(()=>[t(c,{type:"textarea",modelValue:n(e).current.text,"onUpdate:modelValue":k[5]||(k[5]=x=>n(e).current.text=x)},null,8,["modelValue"])]),_:1}),L("div",Ze,[(p(!0),y(z,null,E(u.value,(x,O)=>(p(),y("div",et,[(p(!0),y(z,null,E(x,A=>(p(),y("div",{style:P(O===0?{[A.key]:A.value}:{}),class:de(["block-item",{active:A.selected}]),onClick:S=>l(A),innerHTML:A.label},null,14,tt))),256))]))),256))])])}}}),ot=X(lt,[["__scopeId","data-v-e7476531"]]),nt={class:"info-color-map"},at={class:"color-list"},rt=["onClick"],st=T({__name:"ElementStyle",setup(_){const e=G(W),f=H(["style"]),d=H([[{backgroundColor:"#18141d",borderColor:"#ffffff"},{backgroundColor:"#f5f5f5",borderColor:"#666666"},{backgroundColor:"#dae8fc",borderColor:"#6b8ebf"},{backgroundColor:"#d5e8d4",borderColor:"#82b366"},{backgroundColor:"#ffe6cc",borderColor:"#d79b00"},{backgroundColor:"#fff2cc",borderColor:"#d6b656"},{backgroundColor:"#f8cecc",borderColor:"#b85450"},{backgroundColor:"#e1d5e7",borderColor:"#9673a6"}]]),o=[{label:"实线",value:"solid"},{label:"虚线",value:"dashed"},{label:"点线",value:"dotted"}],m=s=>{e.current.selected&&(e.current.style={...e.current.style,...s})};function u(s,l){e.current.style[s]=l}return(s,l)=>{const i=b("el-input-number"),a=b("el-form-item"),h=b("el-color-picker"),U=b("el-checkbox"),g=b("el-slider"),k=b("el-option"),C=b("el-select"),w=b("el-collapse-item"),$=b("el-collapse"),v=b("el-form");return n(e).current&&n(e).current.selected?(p(),D(v,{key:0,model:n(e).current,"label-width":"80px","label-position":"left"},{default:r(()=>[t($,{modelValue:f.value,"onUpdate:modelValue":l[15]||(l[15]=c=>f.value=c)},{default:r(()=>[t(w,{title:"布局/样式",name:"style"},{default:r(()=>[L("div",nt,[(p(!0),y(z,null,E(d.value,c=>(p(),y("div",at,[(p(!0),y(z,null,E(c,I=>(p(),y("div",{class:"color-item",style:P(I),onClick:x=>m(I)},null,12,rt))),256))]))),256))]),t(a,{label:"left"},{default:r(()=>[t(i,{modelValue:n(e).current.left,"onUpdate:modelValue":l[0]||(l[0]=c=>n(e).current.left=c)},null,8,["modelValue"])]),_:1}),t(a,{label:"top"},{default:r(()=>[t(i,{modelValue:n(e).current.top,"onUpdate:modelValue":l[1]||(l[1]=c=>n(e).current.top=c)},null,8,["modelValue"])]),_:1}),t(a,{label:"width"},{default:r(()=>[t(i,{modelValue:n(e).current.width,"onUpdate:modelValue":l[2]||(l[2]=c=>n(e).current.width=c)},null,8,["modelValue"])]),_:1}),t(a,{label:"height"},{default:r(()=>[t(i,{modelValue:n(e).current.height,"onUpdate:modelValue":l[3]||(l[3]=c=>n(e).current.height=c)},null,8,["modelValue"])]),_:1}),t(a,{label:"angle"},{default:r(()=>[t(i,{modelValue:n(e).current.angle,"onUpdate:modelValue":l[4]||(l[4]=c=>n(e).current.angle=c)},null,8,["modelValue"])]),_:1}),t(a,{label:"color"},{default:r(()=>[t(h,{modelValue:n(e).current.color,"onUpdate:modelValue":l[5]||(l[5]=c=>n(e).current.color=c)},null,8,["modelValue"])]),_:1}),t(a,{label:"disabled"},{default:r(()=>[t(U,{modelValue:n(e).current.disabled,"onUpdate:modelValue":l[6]||(l[6]=c=>n(e).current.disabled=c)},null,8,["modelValue"])]),_:1}),t(a,{label:"resizable"},{default:r(()=>[t(U,{modelValue:n(e).current.resizable,"onUpdate:modelValue":l[7]||(l[7]=c=>n(e).current.resizable=c),checked:!0},null,8,["modelValue"])]),_:1}),t(a,{label:"rotatable"},{default:r(()=>[t(U,{modelValue:n(e).current.rotatable,"onUpdate:modelValue":l[8]||(l[8]=c=>n(e).current.rotatable=c),checked:!0},null,8,["modelValue"])]),_:1}),t(a,{label:"透明度"},{default:r(()=>[t(g,{modelValue:1,step:.01,min:0,max:1,onInput:l[9]||(l[9]=c=>u("opacity",c))})]),_:1}),n(e).current.style?(p(),y(z,{key:0},[t(a,{label:"背景颜色"},{default:r(()=>[t(h,{modelValue:n(e).current.style.backgroundColor,"onUpdate:modelValue":l[10]||(l[10]=c=>n(e).current.style.backgroundColor=c)},null,8,["modelValue"])]),_:1}),t(a,{label:"边框颜色"},{default:r(()=>[t(h,{modelValue:n(e).current.style.borderColor,"onUpdate:modelValue":l[11]||(l[11]=c=>n(e).current.style.borderColor=c)},null,8,["modelValue"])]),_:1}),t(a,{label:"边框宽度"},{default:r(()=>[t(i,{modelValue:n(e).current.style.borderWidth,"onUpdate:modelValue":l[12]||(l[12]=c=>n(e).current.style.borderWidth=c)},null,8,["modelValue"])]),_:1}),t(a,{label:"边框风格"},{default:r(()=>[t(C,{modelValue:n(e).current.style.borderStyle,"onUpdate:modelValue":l[13]||(l[13]=c=>n(e).current.style.borderStyle=c)},{default:r(()=>[(p(),y(z,null,E(o,c=>t(k,{key:c.value,label:c.label,value:c.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(a,{label:"边框半径"},{default:r(()=>[t(i,{modelValue:n(e).current.style.borderRadius,"onUpdate:modelValue":l[14]||(l[14]=c=>n(e).current.style.borderRadius=c)},null,8,["modelValue"])]),_:1})],64)):K("",!0)]),_:1}),t(w,{title:"文本",name:"text"},{default:r(()=>[t(ot)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["model"])):K("",!0)}}}),dt=X(st,[["__scopeId","data-v-175d563d"]]),ut=T({__name:"Style",setup(_){const e=G(W);return(f,d)=>(p(),y("div",{class:"es-info-style",onClick:d[0]||(d[0]=q(()=>{},["stop"]))},[n(e).current&&n(e).current.selected?(p(),D(dt,{key:0})):(p(),D(Ye,{key:1}))]))}}),it={class:"es-layout-info"},ct=T({__name:"Info",setup(_){const e=G(W),f=M(()=>e.current&&e.current.selected?"元素属性":"画布属性"),d=H("style"),o=(m,u)=>{console.log(m,u)};return(m,u)=>{const s=b("el-tab-pane"),l=b("el-tabs");return p(),y("div",it,[t(l,{modelValue:d.value,"onUpdate:modelValue":u[0]||(u[0]=i=>d.value=i),class:"es-info-tabs",onTabClick:o},{default:r(()=>[t(s,{label:f.value,name:"style"},{default:r(()=>[t(ut)]),_:1},8,["label"])]),_:1},8,["modelValue"])])}}});function pt(_){const e={current:-1,queue:[],commands:{},commandArray:[],destoryArray:[]},f=o=>{e.commandArray.push(o),e.commands[o.name]=(...m)=>{const{redo:u,undo:s}=o.execute(...m);if(u&&u(),o.pushQueue){let{queue:l}=e;l.length>0&&(l=l.slice(0,e.current+1),e.queue=l),e.queue.push({redo:u,undo:s}),e.current+=1}}};f({name:"redo",keyboard:"ctrl+y",execute(){return{redo(){let o=e.queue[e.current+1];o&&(o.redo&&o.redo(),e.current++)}}}}),f({name:"undo",keyboard:"ctrl+z",execute(){return{redo(){if(e.current===-1)return;let o=e.queue[e.current];o&&(o.undo&&o.undo(),e.current--)}}}}),f({name:"drag",pushQueue:!0,init(){const o=()=>{this.before=me(_.data.elements)},m=()=>e.commands.drag();return N.on("dragstart",o),N.on("dragend",m),()=>{N.off("dragstart",o),N.off("dragend",m)}},execute(){const o=this.before,m=_.data.elements;return{redo(){_.data={..._.data,elements:m}},undo(){_.data={..._.data,elements:o}}}}}),f({name:"updateContainer",pushQueue:!0,execute(o){const m={before:_.data,after:o};return{redo(){_.data=m.after},undo(){_.data=m.before}}}}),e.commandArray.forEach(o=>{o.init&&e.destoryArray.push(o.init())});const d=()=>{const o=m=>{const{ctrlKey:u,key:s}=m,l=[];u&&l.push("ctrl"),l.push(s);const i=l.join("+");e.commandArray.forEach(({name:a,keyboard:h})=>{h&&h===i&&(e.commands[a](),m.preventDefault())})};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}};return ee(()=>{e.destoryArray.push(d())}),fe(()=>{e.destoryArray.forEach(o=>o&&o())}),e}const ft=T({__name:"index",props:{modelValue:{type:Object,required:!0,default:()=>({})},commands:{type:Object}},setup(_){const e=G(W),f=_,d=H(null),o=M({get:()=>f.modelValue,set:()=>{}}),m=M(()=>{var S;return((S=f.modelValue.container)==null?void 0:S.gridSize)||10}),u=M(()=>{var S;return((S=f.modelValue.container)==null?void 0:S.scaleRatio)||1}),s=M(()=>{const{width:S,height:R}=o.value.container.style;return{...o.value.container.style,width:S+"px",height:R+"px",transform:`scale(${u.value})`,transformOrigin:"top left"}}),l=H({startX:0,startY:0,disX:0,disY:0}),i=M({get:()=>e.current,set:S=>{e.current=S}}),a=H(),{areaSelected:h,onEditorMouseDown:U,onAreaMove:g,onAreaUp:k}=Me(o,a),{editorRect:C,onContextmenu:w,onEditorContextMenu:$}=De(o,d);function v(S){i.value=S,h.value||o.value.elements.filter(V=>V.selected).length===1&&o.value.elements.forEach(V=>V.selected=!1),i.value.selected=!0,l.value.startX=i.value.left,l.value.startY=i.value.top,N.emit("dragstart")}function c(){N.emit("dragend")}function I(S){const R=S.left-l.value.startX,V=S.top-l.value.startY;o.value.elements.forEach(B=>{var te;B.selected&&((te=i.value)==null?void 0:te.id)!==B.id&&(B.left+=R,B.top+=V)}),l.value.startX=S.left,l.value.startY=S.top}function x(S,R){Object.keys(S).forEach(V=>{R[V]=S[V]})}const O={dblclick:()=>{!i.value||!i.value.selected||(i.value.editable=!0)},click:()=>{i.value&&(i.value.editable=!1)}};function A(S="on"){["dblclick","click"].forEach(V=>{S==="on"?document.addEventListener(V,O[V]):document.removeEventListener(V,O[V])})}return ee(()=>{A()}),_e(()=>{A("off")}),(S,R)=>(p(),y("div",{ref_key:"editorRef",ref:d,class:"es-editor",style:P(s.value),onMousedown:R[2]||(R[2]=(...V)=>n(U)&&n(U)(...V)),onContextmenu:R[3]||(R[3]=q((...V)=>n($)&&n($)(...V),["prevent"]))},[(p(!0),y(z,null,E(o.value.elements,V=>(p(),D(n(ve),Q({rotatable:""},n(Te)(V,["style","props"]),{"grid-x":m.value,"grid-y":m.value,scaleRatio:u.value,boundary:"",markline:"",snap:"","snap-threshold":o.value.container.gridSize,onDragStart:B=>v(V),onDragEnd:c,onDrag:I,onChange:B=>x(B,V),onContextmenu:q(B=>n(w)(B,V),["stop"]),onMousedown:R[0]||(R[0]=q(()=>{},["stop"])),onClick:R[1]||(R[1]=q(()=>{},["stop"]))}),{default:r(()=>[(p(),D(J(V.component),Q({element:V},V.props,{style:{...n(Z)(V.style,!1),width:"100%",height:"100%"}}),{default:r(()=>[V.text?(p(),D(ue,{key:0,editable:V.editable,text:V.text,style:P(n(Z)(V.style))},null,8,["editable","text","style"])):K("",!0)]),_:2},1040,["element","style"]))]),_:2},1040,["grid-x","grid-y","scaleRatio","snap-threshold","onDragStart","onChange","onContextmenu"]))),256)),o.value.container.snapToGrid?(p(),D(Re,{key:0,grid:o.value.container.gridSize,"border-color":o.value.container.gridColor},null,8,["grid","border-color"])):K("",!0),t(Ee,{ref_key:"areaRef",ref:a,onMove:n(g),onUp:n(k)},null,8,["onMove","onUp"])],36))}}),mt=X(ft,[["__scopeId","data-v-6a52534a"]]),_t={class:"es-preview-tools"},vt=T({__name:"Preview",setup(_){const e=G(W),f=H(),d=M(()=>{const{width:u,height:s}=e.data.container.style;return{...e.data.container.style,width:u+"px",height:s+"px",transform:`scale(${o.value})`,transformOrigin:"top left"}}),o=M(()=>{var u;return((u=e.data.container)==null?void 0:u.scaleRatio)||1});function m(u){const{width:s,height:l}=e.data.container.style,i=be().format("YYYY-MM-DD")+"-es-drager-editor."+u;ge(f.value).then(a=>{if(u==="pdf"){const h=new he("l","pt","a4"),U=a.toDataURL();return h.addImage(U,"PNG",0,0,+s,+l),h.save(i)}a.toBlob(h=>{const U=document.createElement("a");U.download=i;const g=URL.createObjectURL(h);U.href=g,U.click(),URL.revokeObjectURL(g)})})}return(u,s)=>{const l=b("el-button"),i=b("el-dialog");return p(),D(i,{draggable:"",fullscreen:""},{default:r(()=>[L("div",_t,[t(l,{type:"primary",onClick:s[0]||(s[0]=a=>m("png"))},{default:r(()=>[j("导出PNG")]),_:1}),t(l,{type:"primary",onClick:s[1]||(s[1]=a=>m("jpg"))},{default:r(()=>[j("导出JPG")]),_:1}),t(l,{type:"primary",onClick:s[2]||(s[2]=a=>m("pdf"))},{default:r(()=>[j("导出PDF")]),_:1})]),L("div",{class:"es-preview-body",style:P({width:d.value.width,height:d.value.height})},[L("div",{ref_key:"editorRef",ref:f,class:"es-editor preview",style:P(d.value)},[(p(!0),y(z,null,E(n(e).data.elements,a=>(p(),D(J(a.component),Q(a.props,{style:{...n(Z)(a.style,!1),width:a.width+"px",height:a.height+"px",position:"absolute",left:a.left+"px",top:a.top+"px"}}),{default:r(()=>[a.text?(p(),D(ue,{key:0,text:a.text,style:P(n(Z)(a.style))},null,8,["text","style"])):K("",!0)]),_:2},1040,["style"]))),256))],4)],4)]),_:1})}}}),bt=X(vt,[["__scopeId","data-v-c79f5fb4"]]),gt={class:"es-layout-container"},ht=T({__name:"index",props:{store:{type:Object,required:!0},theme:{type:String}},setup(_,{expose:e}){const f=_,d=ye(f.store),o=M(()=>f.theme);oe(W,d),oe("theme",o);const m=H(),{commands:u}=pt(d),s=[{label:"撤销",icon:Ve,handler:u.undo},{label:"重做",icon:xe,handler:u.redo},{label:"导出",icon:ke,handler:()=>{He({title:"导出",content:JSON.stringify(d.data),confirm(C){u.updateContainer(JSON.parse(C))}})}},{label:"导入",icon:we,handler:()=>{ae({resultType:"json",onChange(C){u.updateContainer(JSON.parse(C))}})}},{label:"插入图片",icon:Ce,handler:()=>{ae({resultType:"image",onChange(C){const $={id:ne(),component:"img",props:{src:C,width:200,onLoadOnce(v){if($.props.loaded)return;const{naturalHeight:c,naturalWidth:I}=v.target,x=d.data.elements.find(A=>A.id===$.id);let O=200/I;O>1&&(O=1),x.width=I*O,x.height=c*O,$.props.loaded=!0}}};d.data.elements.push($)}})}},{label:"预览",icon:Se,handler:()=>d.preview=!0}],l=M(()=>{var C;return((C=m.value)==null?void 0:C.getBoundingClientRect())||{}});let i=null;function a(C){N.emit("dragstart"),i=C}function h(){N.emit("dragend")}function U(C){C.dataTransfer.dropEffect="move"}function g(C){if(!i)return;const w=i.component==="es-icon",$=[...d.data.elements,{...i,equalProportion:w,left:C.offsetX-i.width/2,top:C.offsetY-i.height/2,id:ne(),style:i.style||{}}];d.data.elements=$,i=null}function k(){d.data.container.style.width=l.value.width-1,d.data.container.style.height=l.value.height-4}return ee(()=>{k()}),e({tools:s}),(C,w)=>{const $=b("el-scrollbar");return p(),y(z,null,[L("div",gt,[t(We,{onDragstart:a,onDragend:h}),L("div",{ref_key:"mainRef",ref:m,class:"es-layout-main"},[t($,{height:l.value.height},{default:r(()=>[t(mt,{modelValue:d.data,"onUpdate:modelValue":w[0]||(w[0]=v=>d.data=v),commands:n(u),onDragenter:U,onDrop:g,onDragover:w[1]||(w[1]=q(()=>{},["prevent"]))},null,8,["modelValue","commands"])]),_:1},8,["height"])],512),t(ct,{modelValue:d.current,"onUpdate:modelValue":w[2]||(w[2]=v=>d.current=v)},null,8,["modelValue"])]),t(bt,{modelValue:d.preview,"onUpdate:modelValue":w[3]||(w[3]=v=>d.preview=v)},null,8,["modelValue"])],64)}}}),yt={class:"es-layout"},Vt={class:"es-header-toolbar"},xt=["onClick"],kt="ES Drager Editor 开发中...",wt=T({__name:"index",setup(_){const e=H(null),f=Ue(),d=$e(),o=M(()=>{var u;return((u=e.value)==null?void 0:u.tools)||[]});function m(u){typeof u.handler=="function"&&u.handler()}return ee(()=>{console.log(e.value)}),(u,s)=>{const l=b("el-button");return p(),y("div",yt,[t(ze,{title:kt},{default:r(()=>[L("div",Vt,[(p(!0),y(z,null,E(o.value,i=>(p(),y("div",{class:"es-tool-btn",onClick:a=>m(i)},[t(l,{icon:i.icon},{default:r(()=>[j(Y(i.label),1)]),_:2},1032,["icon"])],8,xt))),256))])]),_:1}),t(n(ht),{ref_key:"editorRef",ref:e,store:n(f),theme:n(d).theme},null,8,["store","theme"])])}}});const zt=X(wt,[["__scopeId","data-v-1c236f9a"]]);export{zt as default};
