import{i as P,r as $,y as we,H as j,A as Re,O as De,d as be,o as K,c as ee,I as O,j as U,b as de,w as fe,a as Ne,q as he,n as _e,h as Pe,F as $e,K as ge,u as I,J as Ie,E as ve,C as Ke}from"./index-9fec1052.js";const Ve={type:{type:String,default:"rect"},tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},maxWidth:{type:Number,default:0},maxHeight:{type:Number,default:0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean},checkCollision:{type:Boolean},snap:Boolean,snapThreshold:{type:Number,default:10},markline:[Boolean,Function],extraLines:Function};function ne(o,n){const e=t=>{n&&n(t),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",o),document.addEventListener("touchend",e)}function V(o){let n=0,e=0;if(Fe(o)){const t=o.targetTouches[0];n=t.pageX,e=t.pageY}else n=o.clientX,e=o.clientY;return{clientX:n,clientY:e}}function Fe(o){const n=Object.prototype.toString.call(o);return n.substring(8,n.length-1)==="TouchEvent"}const G=(o=0)=>parseInt(o+"")+"px",Z={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},te=["n","ne","e","se","s","sw","w","nw"],qe={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},Ge={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},je=(o,n)=>{const e=Ge[Math.floor(o/30)],i=(qe[n]+e)%8;return te[i]},pe=(o=0,n)=>{let e=[];for(let t=0;t<te.length;t++){const i=te[t],[u,f]=Z[i].split("-"),s=je(o,i),c={[u]:"0%",cursor:s+"-resize",side:Z[i]};if(f)c[f]="0%";else{const g=["top","bottom"].includes(u)?"left":"top";c[g]="50%"}n?n.includes(Z[i])&&e.push(c):e.push(c)}return e},oe=o=>o*Math.PI/180,Oe=(o,n)=>Math.sqrt(o*o+n*n),L=o=>Math.cos(oe(o)),M=o=>Math.sin(oe(o)),Ue=(o,n,e,t,i,u,f)=>{let{width:s,height:c,centerX:g,centerY:w,rotateAngle:a}=n;const E=s<0?-1:1,h=c<0?-1:1;if(s=Math.abs(s),c=Math.abs(c),["top-left","top-right","bottom-left","bottom-right"].includes(o)){o==="top-right"?t=-t:o==="bottom-left"?e=-e:o==="top-left"&&(e=-e,t=-t);const d=W(s,e,u);s=d.width,e=d.deltaW;const r=H(c,t,f);c=r.height,t=r.deltaH,i&&(t=e/i,c=s/i)}switch(o){case"right":{const d=W(s,e,u);s=d.width,e=d.deltaW,i?(t=e/i,c=s/i,g+=e/2*L(a)-t/2*M(a),w+=e/2*M(a)+t/2*L(a)):(g+=e/2*L(a),w+=e/2*M(a));break}case"top-right":{g+=e/2*L(a)+t/2*M(a),w+=e/2*M(a)-t/2*L(a);break}case"bottom-right":{g+=e/2*L(a)-t/2*M(a),w+=e/2*M(a)+t/2*L(a);break}case"bottom":{const d=H(c,t,f);c=d.height,t=d.deltaH,i?(e=t*i,s=c*i,g+=e/2*L(a)-t/2*M(a),w+=e/2*M(a)+t/2*L(a)):(g-=t/2*M(a),w+=t/2*L(a));break}case"bottom-left":{g-=e/2*L(a)+t/2*M(a),w-=e/2*M(a)-t/2*L(a);break}case"left":{e=-e;const d=W(s,e,u);s=d.width,e=d.deltaW,i?(c=s/i,t=e/i,g-=e/2*L(a)+t/2*M(a),w-=e/2*M(a)-t/2*L(a)):(g-=e/2*L(a),w-=e/2*M(a));break}case"top-left":{g-=e/2*L(a)-t/2*M(a),w-=e/2*M(a)+t/2*L(a);break}case"top":{t=-t;const d=H(c,t,f);c=d.height,t=d.deltaH,i?(s=c*i,e=t*i,g+=e/2*L(a)+t/2*M(a),w+=e/2*M(a)-t/2*L(a)):(g+=t/2*M(a),w-=t/2*L(a));break}}return{position:{centerX:g,centerY:w},size:{width:s*E,height:c*h}}},H=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{height:o,deltaH:n}},W=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{width:o,deltaW:n}},Je=({centerX:o,centerY:n,width:e,height:t,angle:i})=>({top:n-t/2,left:o-e/2,width:e,height:t,angle:i}),Qe=(o,n,e)=>{const{width:t,height:i}=o;return{width:Math.abs(t),height:Math.abs(i),left:n-Math.abs(t)/2,top:e-Math.abs(i)/2}};function J(o,n){const e=Math.abs(o)%n,t=o>0?n:-n;let i=0;return e>n/2?i=t*Math.ceil(Math.abs(o)/n):i=t*Math.floor(Math.abs(o)/n),i}function Ze(o,n,e){if(!o||!n)return!1;const t=R(o,e),i=R(n,e);return t.left<i.left+i.width&&t.left+t.width>i.left&&t.top<i.top+i.height&&t.top+t.height>i.top}const R=(o,n)=>{var e=o.getBoundingClientRect();return{...e,left:e.left/n,top:e.top/n,right:e.right/n,bottom:e.bottom/n,width:e.width/n,height:e.height/n}},me=o=>typeof o=="function";function He(o,n){let e=null,t=null;const i=P(()=>o.value.offsetParent||document.body),u=P(()=>R(i.value,n.scaleRatio)),f=$({x:[],y:[]}),s=()=>{n.markline&&!me(n.markline)&&(e||(e=document.querySelector(".es-drager-markline-x")||ye("x",i.value,n.color)),t||(t=document.querySelector(".es-drager-markline-y")||ye("y",i.value,n.color)))},c=(h={})=>{if(n.markline){if(me(n.markline))return n.markline(h);h.left===null?e.style.display="none":(e.style.left=h.left+"px",e.style.backgroundColor=n.color,e.style.display="block"),h.top===null?t.style.display="none":(t.style.top=h.top+"px",t.style.backgroundColor=n.color,t.style.display="block")}},g=()=>{const h=R(o.value,n.scaleRatio),d=Array.from(document.querySelectorAll(".es-drager"));if(n.extraLines){const x=n.extraLines(h)||[];d.push(...x)}const r=[],v=[],m=[];for(let x=0;x<d.length;x++){const b=d[x];b.nodeType===1?b!==o.value&&r.push(R(b,n.scaleRatio)):b.showTop||b.showTop===0?m.push(b):(b.showLeft||b.showLeft===0)&&v.push(b)}f.value=We(r,h),f.value.x.push(...v),f.value.y.push(...m)},w=()=>{const h={top:null,left:null,diffX:0,diffY:0},d=R(o.value,n.scaleRatio);for(let r=0;r<f.value.y.length;r++){const{top:v,showTop:m}=f.value.y[r];if(Math.abs(v-d.top)<n.snapThreshold){h.diffY=v-d.top,h.top=m-u.value.top;break}}for(let r=0;r<f.value.x.length;r++){const{left:v,showLeft:m}=f.value.x[r];if(Math.abs(v-d.left)<n.snapThreshold){h.diffX=v-d.left,h.left=m-u.value.left;break}}return c(h),h},a=()=>{c({left:null,top:null})},E=h=>{if(!(!n.snap&&!n.markline))switch(h){case"drag-start":g();break;case"drag":return w();case"drag-end":a();break}};return we(()=>{s()}),{marklineEmit:E}}function ye(o="x",n,e=""){const t=document.createElement("div");return t.classList.add(`es-drager-markline-${o}`),t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.zIndex="9999",t.style.backgroundColor=e,t.style.display="none",o==="x"?(t.style.height="100%",t.style.width="1px"):(t.style.height="1px",t.style.width="100%"),n.appendChild(t),t}function We(o,n){const e={x:[],y:[]},{width:t=0,height:i=0}=n;return o.forEach(u=>{const{top:f,left:s,width:c,height:g}=u;e.y.push({showTop:f,top:f}),e.y.push({showTop:f,top:f-i}),e.y.push({showTop:f+g/2,top:f+g/2-i/2}),e.y.push({showTop:f+g,top:f+g}),e.y.push({showTop:f+g,top:f+g-i}),e.x.push({showLeft:s,left:s}),e.x.push({showLeft:s+c,left:s+c}),e.x.push({showLeft:s+c/2,left:s+c/2-t/2}),e.x.push({showLeft:s+c,left:s+c-t}),e.x.push({showLeft:s,left:s-t})}),e}function et(o,n,e,{getBoundary:t,fixBoundary:i,checkDragerCollision:u,emit:f}){let s=0,c=0;return{onKeydown:a=>{let{left:E,top:h}=n.value;if(s||(s=E),c||(c=h),["ArrowRight","ArrowLeft"].includes(a.key)){const d=a.key==="ArrowRight";let r=d?1:-1;o.snapToGrid&&(r=d?o.gridX:-o.gridX),E=E+r}else if(["ArrowUp","ArrowDown"].includes(a.key)){const d=a.key==="ArrowDown";let r=d?1:-1;o.snapToGrid&&(r=d?o.gridY:-o.gridY),h=h+r}if(o.boundary){const[d,r,v,m]=t();[E,h]=i(E,h,d,r,v,m)}n.value.left=E,n.value.top=h},onKeyup:a=>{["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(a.key)&&o.checkCollision&&u()&&(n.value.left=s,n.value.top=c),s=0,c=0}}}function tt(o,n,e){const t=$(!1),i=$(!1),u=$({width:n.width,height:n.height,left:n.left,top:n.top,angle:n.angle}),{marklineEmit:f}=He(o,n),s=new Set;function c(r){if(s.add(r.button),n.disabled)return;t.value=!0,i.value=!0;let{clientX:v,clientY:m}=V(r);const{left:x,top:b}=u.value;let l=0,p=0,y=0,k=0;n.boundary&&([l,p,y,k]=g()),f("drag-start"),e&&e("drag-start",u.value),ne(X=>{if(s.size>1)return;const{clientX:Y,clientY:S}=V(X);let B=(Y-v)/n.scaleRatio+x,C=(S-m)/n.scaleRatio+b;if(n.snapToGrid){let{left:T,top:D}=u.value;const z=B-T,N=C-D;B=T+J(z,n.gridX),C=D+J(N,n.gridY)}n.boundary&&([B,C]=w(B,C,l,p,y,k)),u.value.left=B,u.value.top=C,e&&e("drag",u.value),De(()=>{const T=f("drag");n.snap&&(T.diffX&&(u.value.left+=T.diffX),T.diffY&&(u.value.top+=T.diffY))})},X=>{n.checkCollision&&a()&&(u.value.top=b,u.value.left=x),s.clear(),t.value=!1,f("drag-end"),e&&e("drag-end",u.value)})}const g=()=>{let r=0,v=0;const{left:m,top:x,height:b,width:l,angle:p}=u.value,y=o.value.offsetParent||document.body,k=R(y,n.scaleRatio);if(p){const Y=R(o.value,n.scaleRatio);r=Y.left-Math.floor(m-(Y.width-l)+k.left),v=Y.top-Math.floor(x-(Y.height-b)+k.top)}const A=k.width-l,X=k.height-b;return[r,A-r,v,X-v,k.width,k.height]},w=(r,v,m,x,b,l)=>(r=r<m?m:r,r=r>x?x:r,v=v<b?b:v,v=v>l?l:v,[r,v]),a=()=>{const r=o.value.offsetParent||document.body,v=Array.from(r.children).filter(m=>m!==o.value&&m.classList.contains("es-drager"));for(let m=0;m<v.length;m++){const x=v[m];if(Ze(o.value,x,n.scaleRatio))return!0}},E=()=>{i.value=!1},{onKeydown:h,onKeyup:d}=et(n,u,i,{getBoundary:g,fixBoundary:w,checkDragerCollision:a,emit:e});return j(i,r=>{r?(e("focus",r),document.addEventListener("click",E,{once:!0})):e("blur",r),!n.disabledKeyEvent&&(r?(document.addEventListener("keydown",h),document.addEventListener("keyup",d)):(document.removeEventListener("keydown",h),document.removeEventListener("keyup",d)))}),we(()=>{if(o.value){if(!u.value.width&&!u.value.height){const{width:r,height:v}=R(o.value,n.scaleRatio);u.value={...u.value,width:r+2,height:v+2}}if(o.value.addEventListener("mousedown",c),o.value.addEventListener("touchstart",c,{passive:!0}),n.type==="text"){const r=window.getComputedStyle(o.value);u.value.height=parseInt(r.fontSize)}}}),Re(()=>{document.removeEventListener("click",E),document.removeEventListener("keydown",h),document.removeEventListener("keyup",d)}),{isMousedown:t,selected:i,dragData:u,getBoundary:g,checkDragerCollision:a}}const nt=U("div",{class:"es-drager-rotate-handle"},[U("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[U("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),ot=be({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=n,i=$(null),u=P({get:()=>e.modelValue,set:s=>{t("update:modelValue",s)}});function f(s){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");s.stopPropagation();const{width:c,height:g,left:w,top:a}=e.element.getBoundingClientRect(),E=w+c/2,h=a+g/2;t("rotate-start",u.value),ne(d=>{const{clientX:r,clientY:v}=V(d),m=E-r,x=h-v,l=Math.atan2(x,m)*180/Math.PI-90;u.value=(l+360)%360,t("rotate",u.value)},()=>{t("rotate-end",u.value)})}return(s,c)=>(K(),ee("div",{ref_key:"rotateRef",ref:i,class:"es-drager-rotate",onMousedown:f,onTouchstartPassive:f},[O(s.$slots,"default",{},()=>[nt])],544))}});const st=["data-side","onMousedown","onTouchstartPassive"],it=U("div",{class:"es-drager-dot-handle"},null,-1),ke=be({__name:"drager",props:Ve,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end","focus","blur"],setup(o,{emit:n}){const e=o,t=n,i=(l,...p)=>{t(l,...p)},u=$(null),{selected:f,dragData:s,isMousedown:c,getBoundary:g,checkDragerCollision:w}=tt(u,e,i),a=$(pe(0,e.resizeList)),E=P(()=>e.resizable&&!e.disabled),h=P(()=>e.rotatable&&!e.disabled&&f.value),d=P(()=>e.type!="text"?a.value:a.value.filter(l=>!["top","bottom"].includes(l.side))),r=P(()=>{const{width:l,height:p,left:y,top:k,angle:A}=s.value,X={};l&&(X.width=G(l)),p&&(e.type==="text"?X.fontSize=p+"px":X.height=G(p));let Y=[`translateX(${G(y)})`,`translateY(${G(k)})`,`rotate(${A}deg)`];return{...X,zIndex:e.zIndex,transform:Y.join(" "),"--es-drager-color":e.color}});function v(l){u.value||(u.value=l.$el||l)}function m(l){a.value=pe(l,e.resizeList),i("rotate-end",s.value)}function x(l,p){if(e.disabled)return;p.stopPropagation();const{clientX:y,clientY:k}=V(p),A=y,X=k,{width:Y,height:S,left:B,top:C}=s.value,T=B+Y/2,D=C+S/2,z={width:Y,height:S,centerX:T,centerY:D,rotateAngle:s.value.angle},N=l.side;let{minWidth:xe,minHeight:Le,aspectRatio:Q,equalProportion:Me}=e;i("resize-start",s.value,N);let se=[];e.boundary&&(se=g()),["text","image"].includes(e.type)&&N.includes("-")&&(Q=z.width/z.height),ne(ie=>{const{clientX:Ee,clientY:Xe}=V(ie);let F=(Ee-A)/e.scaleRatio,q=(Xe-X)/e.scaleRatio;e.snapToGrid&&(F=J(F,e.gridX),q=J(q,e.gridY));const Ye=Math.atan2(q,F),le=Oe(F,q),Ae=ie.shiftKey,ae=Ye-oe(z.rotateAngle),Te=le*Math.cos(ae),ze=le*Math.sin(ae),re=(Me||Ae)&&!Q?z.width/z.height:Q,{position:{centerX:ue,centerY:ce},size:{width:Be,height:Ce}}=Ue(N,{...z,rotateAngle:z.rotateAngle},Te,ze,re,xe,Le),Se=Je({centerX:ue,centerY:ce,width:Be,height:Ce,angle:s.value.angle});let _={...s.value,...Qe(Se,ue,ce)};e.maxWidth>0&&(_.width=Math.min(_.width,e.maxWidth)),e.maxHeight>0&&(_.height=Math.min(_.height,e.maxHeight)),e.boundary&&(_=b(_,se,re)),s.value=_,i("resize",s.value,N)},()=>{e.checkCollision&&w()&&(s.value={...s.value,width:Y,height:S,left:B,top:C}),i("resize-end",s.value,N)})}function b(l,p,y){const[k,A,X,Y,S,B]=p,C=l.left<k,T=l.left+l.width>S,D=l.top<X,z=l.top+l.height>B;return C&&(l.left=k,l.width=s.value.width),D&&(l.top=X,l.height=s.value.height),(T||z)&&(T&&(l.left=s.value.left),z&&(l.top=s.value.top),z||(l.width=S-l.left),T||(l.height=B-l.top)),(z||D)&&y&&(l.width=s.value.width,l.left=s.value.left),(T||C)&&y&&(l.height=s.value.height,l.top=s.value.top),l}return j(()=>[e.width,e.height,e.left,e.top,e.angle],([l,p,y,k,A],[X,Y,S,B,C])=>{l!==X&&(s.value.width=l),p!==Y&&(s.value.height=p),y!==S&&(s.value.left=y),k!==B&&(s.value.top=k),A!==C&&(s.value.angle=A)}),j(()=>s.value,l=>{t("change",{...l})},{deep:!0}),j(()=>e.selected,l=>{f.value=l},{immediate:!0}),(l,p)=>(K(),de(Ke(l.tag),{ref:v,class:Ie(["es-drager",`es-drager-${l.type}`,{disabled:l.disabled,dragging:I(c),selected:I(f),border:l.border}]),style:he(r.value),onClick:p[3]||(p[3]=ve(()=>{},["stop"])),onMousedown:p[4]||(p[4]=ve(()=>{},["stop"]))},{default:fe(()=>[O(l.$slots,"default"),E.value?(K(!0),ee($e,{key:0},Ne(d.value,(y,k)=>(K(),ee("div",{key:k,class:"es-drager-dot","data-side":y.side,style:he({...y}),onMousedown:A=>x(y,A),onTouchstartPassive:A=>x(y,A)},[O(l.$slots,"resize",_e(Pe({side:y.side})),()=>[it])],44,st))),128)):ge("",!0),h.value?(K(),de(ot,{key:1,modelValue:I(s).angle,"onUpdate:modelValue":p[0]||(p[0]=y=>I(s).angle=y),element:u.value,onRotate:p[1]||(p[1]=y=>i("rotate",I(s))),onRotateStart:p[2]||(p[2]=y=>i("rotate-start",I(s))),onRotateEnd:m},{default:fe(()=>[O(l.$slots,"rotate")]),_:3},8,["modelValue","element"])):ge("",!0)]),_:3},40,["class","style"]))}});const lt=o=>{o.component("es-drager",ke)};ke.install=lt;export{ke as _};
