import{d as te,r as R,f as ae,l as U,o as E,c as D,q as _,F as pe,a as me,n as Z,s as fe,x as ve,y as J,u as M,b as we,w as be,z as ye,A as Me,B as ke,g as P}from"./index-ec168267.js";const ze={resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:100},height:{type:Number,default:100},left:{type:Number,default:0},top:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1}},C=(l=0)=>parseInt(l+"")+"px",K={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},S=["n","ne","e","se","s","sw","w","nw"],Re={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},Be={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},Ne=(l,n)=>{const e=Be[Math.floor(l/30)],t=(Re[n]+e)%8;return S[t]},Q=(l=0)=>{let n=[];for(let e=0;e<S.length;e++){const t=S[e],[r,m]=K[t].split("-"),s=Ne(l,t),i={[r]:"0%",cursor:s+"-resize",side:K[t]};if(m)i[m]="0%";else{const d=["top","bottom"].includes(r)?"left":"top";i[d]="50%"}n[e]=i}return n},$=l=>l*Math.PI/180,Xe=(l,n)=>Math.sqrt(l*l+n*n),g=l=>Math.cos($(l)),p=l=>Math.sin($(l)),Ye=(l,n,e,t,r,m,s)=>{let{width:i,height:d,centerX:f,centerY:c,rotateAngle:o}=n;const z=i<0?-1:1,h=d<0?-1:1;switch(i=Math.abs(i),d=Math.abs(d),l){case"right":{const a=X(i,e,m);i=a.width,e=a.deltaW,r?(t=e/r,d=i/r,f+=e/2*g(o)-t/2*p(o),c+=e/2*p(o)+t/2*g(o)):(f+=e/2*g(o),c+=e/2*p(o));break}case"top-right":{t=-t;const a=X(i,e,m);i=a.width,e=a.deltaW;const u=N(d,t,s);d=u.height,t=u.deltaH,r&&(e=t*r,i=d*r),f+=e/2*g(o)+t/2*p(o),c+=e/2*p(o)-t/2*g(o);break}case"bottom-right":{const a=X(i,e,m);i=a.width,e=a.deltaW;const u=N(d,t,s);d=u.height,t=u.deltaH,r&&(e=t*r,i=d*r),f+=e/2*g(o)-t/2*p(o),c+=e/2*p(o)+t/2*g(o);break}case"bottom":{const a=N(d,t,s);d=a.height,t=a.deltaH,r?(e=t*r,i=d*r,f+=e/2*g(o)-t/2*p(o),c+=e/2*p(o)+t/2*g(o)):(f-=t/2*p(o),c+=t/2*g(o));break}case"bottom-left":{e=-e;const a=X(i,e,m);i=a.width,e=a.deltaW;const u=N(d,t,s);d=u.height,t=u.deltaH,r&&(d=i/r,t=e/r),f-=e/2*g(o)+t/2*p(o),c-=e/2*p(o)-t/2*g(o);break}case"left":{e=-e;const a=X(i,e,m);i=a.width,e=a.deltaW,r?(d=i/r,t=e/r,f-=e/2*g(o)+t/2*p(o),c-=e/2*p(o)-t/2*g(o)):(f-=e/2*g(o),c-=e/2*p(o));break}case"top-left":{e=-e,t=-t;const a=X(i,e,m);i=a.width,e=a.deltaW;const u=N(d,t,s);d=u.height,t=u.deltaH,r&&(i=d*r,e=t*r),f-=e/2*g(o)-t/2*p(o),c-=e/2*p(o)+t/2*g(o);break}case"top":{t=-t;const a=N(d,t,s);d=a.height,t=a.deltaH,r?(i=d*r,e=t*r,f+=e/2*g(o)+t/2*p(o),c+=e/2*p(o)-t/2*g(o)):(f+=t/2*p(o),c-=t/2*g(o));break}}return{position:{centerX:f,centerY:c},size:{width:i*z,height:d*h}}},N=(l,n,e)=>{const t=l+n;return t>e?l=t:(n=e-l,l=e),{height:l,deltaH:n}},X=(l,n,e)=>{const t=l+n;return t>e?l=t:(n=e-l,l=e),{width:l,deltaW:n}},Ee=({centerX:l,centerY:n,width:e,height:t,angle:r})=>({top:n-t/2,left:l-e/2,width:e,height:t,angle:r}),He=(l,n,e)=>{const{width:t,height:r}=l;return{width:Math.abs(t),height:Math.abs(r),left:n-Math.abs(t)/2,top:e-Math.abs(r)/2}};let Le=1e3;function Ve(l,n,e){const t=R(),r=R(!1),m=R(!1),s=R({width:n.width,height:n.height,left:n.left,top:n.top,angle:n.angle});function i(f){if(n.disabled)return;r.value=!0,m.value=!0;const c=l.value;let{clientX:o,clientY:z}=f;const{width:h,height:a,left:u,top:b}=s.value;c.style.zIndex=We();let v=0,B=0,H=0,Y=0;if(n.boundary){const k=(c.parentElement||document.body).getBoundingClientRect();B=k.width/n.scaleRatio-h,Y=k.height/n.scaleRatio-a}e&&e("drag-start",s.value),q(k=>{let y=(k.clientX-o)/n.scaleRatio+u,w=(k.clientY-z)/n.scaleRatio+b;if(n.snapToGrid){let{left:L,top:V}=s.value;const I=y-L,W=w-V;y=ee(I,n.gridX,L),w=ee(W,n.gridY,V)}n.boundary&&(y=y<v?v:y,y=y>B?B:y,w=w<H?H:w,w=w>Y?Y:w),s.value.left=y,s.value.top=w,e&&e("drag",s.value)},k=>{r.value=!1,document.addEventListener("click",d,{once:!0}),e&&e("drag-end",s.value)})}const d=()=>{m.value=!1};return ke(()=>{l.value&&l.value.addEventListener("mousedown",i)}),{isMousedown:r,selected:m,dragRef:t,dragData:s}}function We(){return++Le+""}function q(l,n){const e=t=>{n&&n(t),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",e)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",e)}function ee(l,n,e){let t=e;return Math.abs(l)>n/2&&(t=e+(l>0?n:-n)),t}const xe=P("div",{class:"es-drager-rotate-handle"},[P("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[P("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),Ae=te({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object,required:!0}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(l,{emit:n}){const e=l,t=R(null),r=ae({get:()=>e.modelValue,set:s=>{n("update:modelValue",s)}});function m(s){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");s.stopPropagation(),s.preventDefault();const{width:i,height:d,left:f,top:c}=e.element.getBoundingClientRect(),o=f+i/2,z=c+d/2;n("rotate-start",r.value),q(h=>{const a=o-h.clientX,u=z-h.clientY,b=Math.atan2(u,a)*180/Math.PI-90;r.value=(b+360)%360,n("rotate",r.value)},()=>{n("rotate-end",r.value)})}return(s,i)=>(E(),D("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:m},[_(s.$slots,"default",{},()=>[xe])],544))}}),Ce=["data-side","onMousedown"],De=P("div",{class:"es-drager-dot-handle"},null,-1),ne=te({__name:"drager",props:ze,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(l,{emit:n}){const e=l,t=(h,...a)=>{n(h,...a),n("change",...a)},r=R(null),{selected:m,dragData:s,isMousedown:i}=Ve(r,e,t),d=R(Q()),f=ae(()=>{const{width:h,height:a,left:u,top:b,angle:v}=s.value;return{width:C(h),height:C(a),left:C(u),top:C(b),transform:`rotate(${v}deg)`,"--es-drager-color":e.color}});function c(h){d.value=Q(h),t("rotate-end",s.value)}function o(h,a){const u=Math.abs(h)%a,b=h>0?a:-a;let v=0;return u>a/2?v=b*Math.ceil(Math.abs(h)/a):v=b*Math.floor(Math.abs(h)/a),v}function z(h,a){a.stopPropagation(),a.preventDefault();const u=a.clientX,b=a.clientY,{width:v,height:B,left:H,top:Y}=s.value,k=H+v/2,y=Y+B/2,w={width:v,height:B,centerX:k,centerY:y,rotateAngle:s.value.angle},L=h.side,{minWidth:V,minHeight:I,aspectRatio:W}=e;t("resize-start",s.value),q(G=>{const{clientX:le,clientY:oe}=G;let x=(le-u)/e.scaleRatio,A=(oe-b)/e.scaleRatio;e.snapToGrid&&(x=o(x,e.gridX),A=o(A,e.gridY));const re=Math.atan2(A,x),T=Xe(x,A),se=G.shiftKey,F=re-$(w.rotateAngle),ie=T*Math.cos(F),de=T*Math.sin(F),ue=se&&!W?w.width/w.height:W,{position:{centerX:j,centerY:O},size:{width:he,height:ce}}=Ye(L,{...w,rotateAngle:w.rotateAngle},ie,de,ue,V,I),ge=Ee({centerX:j,centerY:O,width:he,height:ce,angle:s.value.angle});s.value={...s.value,...He(ge,j,O)},t("resize",s.value)},()=>{t("resize-end",s.value)})}return U(()=>[e.width,e.height,e.left,e.top,e.angle],([h,a,u,b,v])=>{s.value={...s.value,width:h,height:a,left:u,top:b,angle:v}}),U(()=>e.selected,h=>{m.value=h},{immediate:!0}),(h,a)=>(E(),D("div",{ref_key:"dragRef",ref:r,class:ye(["es-drager",{disabled:h.disabled,dragging:M(i),selected:M(m)}]),style:Z(M(f)),onClick:a[3]||(a[3]=Me(()=>{},["self","stop"]))},[_(h.$slots,"default"),!h.disabled&&h.resizable?(E(!0),D(pe,{key:0},me(d.value,(u,b)=>(E(),D("div",{key:b,class:"es-drager-dot","data-side":u.side,style:Z({...u}),onMousedown:v=>z(u,v)},[_(h.$slots,"resize",fe(ve({side:u.side})),()=>[De])],44,Ce))),128)):J("",!0),!h.disabled&&M(m)?(E(),we(Ae,{key:1,modelValue:M(s).angle,"onUpdate:modelValue":a[0]||(a[0]=u=>M(s).angle=u),"drag-data":M(s),element:r.value,onRotate:a[1]||(a[1]=u=>t("rotate",M(s))),onRotateStart:a[2]||(a[2]=u=>t("rotate-start",M(s))),onRotateEnd:c},{default:be(()=>[_(h.$slots,"rotate")]),_:3},8,["modelValue","drag-data","element"])):J("",!0)],6))}}),_e=l=>{l.component("es-drager",ne)};ne.install=_e;export{ne as s};
