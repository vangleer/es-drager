import{r as N,eD as Ye,eQ as J,eG as Le,d as he,g as K,o as T,c as Q,eR as F,h as O,b as re,w as le,eT as Re,u as x,n as ce,eM as ze,eI as Be,a as xe,eJ as Ce,eK as _e,F as Ne,eS as ue}from"./index-efd6d050.js";const Te={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},maxWidth:{type:Number,default:0},maxHeight:{type:Number,default:0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean},checkCollision:{type:Boolean}};function H(o,n){const e=t=>{n&&n(t),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",o),document.addEventListener("touchend",e)}function S(o){let n=0,e=0;if(Se(o)){const t=o.targetTouches[0];n=t.pageX,e=t.pageY}else n=o.clientX,e=o.clientY;return{clientX:n,clientY:e}}function Se(o){const n=Object.prototype.toString.call(o);return n.substring(8,n.length-1)==="TouchEvent"}const G=(o=0)=>parseInt(o+"")+"px",q={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},Z=["n","ne","e","se","s","sw","w","nw"],Pe={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},Ie={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},$e=(o,n)=>{const e=Ie[Math.floor(o/30)],s=(Pe[n]+e)%8;return Z[s]},de=(o=0,n)=>{let e=[];for(let t=0;t<Z.length;t++){const s=Z[t],[u,l]=q[s].split("-"),h=$e(o,s),c={[u]:"0%",cursor:h+"-resize",side:q[s]};if(l)c[l]="0%";else{const v=["top","bottom"].includes(u)?"left":"top";c[v]="50%"}n?n.includes(q[s])&&e.push(c):e.push(c)}return e},W=o=>o*Math.PI/180,Ve=(o,n)=>Math.sqrt(o*o+n*n),b=o=>Math.cos(W(o)),M=o=>Math.sin(W(o)),Ge=(o,n,e,t,s,u,l)=>{let{width:h,height:c,centerX:v,centerY:w,rotateAngle:r}=n;const X=h<0?-1:1,f=c<0?-1:1;switch(h=Math.abs(h),c=Math.abs(c),o){case"right":{const a=_(h,e,u);h=a.width,e=a.deltaW,s?(t=e/s,c=h/s,v+=e/2*b(r)-t/2*M(r),w+=e/2*M(r)+t/2*b(r)):(v+=e/2*b(r),w+=e/2*M(r));break}case"top-right":{t=-t;const a=_(h,e,u);h=a.width,e=a.deltaW;const d=C(c,t,l);c=d.height,t=d.deltaH,s&&(e=t*s,h=c*s),v+=e/2*b(r)+t/2*M(r),w+=e/2*M(r)-t/2*b(r);break}case"bottom-right":{const a=_(h,e,u);h=a.width,e=a.deltaW;const d=C(c,t,l);c=d.height,t=d.deltaH,s&&(e=t*s,h=c*s),v+=e/2*b(r)-t/2*M(r),w+=e/2*M(r)+t/2*b(r);break}case"bottom":{const a=C(c,t,l);c=a.height,t=a.deltaH,s?(e=t*s,h=c*s,v+=e/2*b(r)-t/2*M(r),w+=e/2*M(r)+t/2*b(r)):(v-=t/2*M(r),w+=t/2*b(r));break}case"bottom-left":{e=-e;const a=_(h,e,u);h=a.width,e=a.deltaW;const d=C(c,t,l);c=d.height,t=d.deltaH,s&&(c=h/s,t=e/s),v-=e/2*b(r)+t/2*M(r),w-=e/2*M(r)-t/2*b(r);break}case"left":{e=-e;const a=_(h,e,u);h=a.width,e=a.deltaW,s?(c=h/s,t=e/s,v-=e/2*b(r)+t/2*M(r),w-=e/2*M(r)-t/2*b(r)):(v-=e/2*b(r),w-=e/2*M(r));break}case"top-left":{e=-e,t=-t;const a=_(h,e,u);h=a.width,e=a.deltaW;const d=C(c,t,l);c=d.height,t=d.deltaH,s&&(h=c*s,e=t*s),v-=e/2*b(r)-t/2*M(r),w-=e/2*M(r)+t/2*b(r);break}case"top":{t=-t;const a=C(c,t,l);c=a.height,t=a.deltaH,s?(h=c*s,e=t*s,v+=e/2*b(r)+t/2*M(r),w+=e/2*M(r)-t/2*b(r)):(v+=t/2*M(r),w-=t/2*b(r));break}}return{position:{centerX:v,centerY:w},size:{width:h*X,height:c*f}}},C=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{height:o,deltaH:n}},_=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{width:o,deltaW:n}},Ke=({centerX:o,centerY:n,width:e,height:t,angle:s})=>({top:n-t/2,left:o-e/2,width:e,height:t,angle:s}),Fe=(o,n,e)=>{const{width:t,height:s}=o;return{width:Math.abs(t),height:Math.abs(s),left:n-Math.abs(t)/2,top:e-Math.abs(s)/2}};function U(o,n){const e=Math.abs(o)%n,t=o>0?n:-n;let s=0;return e>n/2?s=t*Math.ceil(Math.abs(o)/n):s=t*Math.floor(Math.abs(o)/n),s}function Oe(o,n){if(!o||!n)return!1;const e=o.getBoundingClientRect(),t=n.getBoundingClientRect();return e.left<t.left+t.width&&e.left+e.width>t.left&&e.top<t.top+t.height&&e.top+e.height>t.top}function Ue(o,n,e){const t=N(!1),s=N(!1),u=N({width:n.width,height:n.height,left:n.left,top:n.top,angle:n.angle}),l=new Set;function h(f){if(l.add(f.button),n.disabled)return;t.value=!0,s.value=!0;let{clientX:a,clientY:d}=S(f);const{left:p,top:y}=u.value;let i=0,g=0,m=0,k=0;n.boundary&&([i,g,m,k]=c()),e&&e("drag-start",u.value),H(E=>{if(l.size>1)return;const{clientX:A,clientY:Y}=S(E);let L=(A-a)/n.scaleRatio+p,R=(Y-d)/n.scaleRatio+y;if(n.snapToGrid){let{left:P,top:I}=u.value;const z=L-P,j=R-I;L=P+U(z,n.gridX),R=I+U(j,n.gridY)}n.boundary&&([L,R]=v(L,R,i,g,m,k)),u.value.left=L,u.value.top=R,e&&e("drag",u.value)},E=>{n.checkCollision&&w()&&(u.value.top=y,u.value.left=p),l.clear(),t.value=!1,document.addEventListener("click",r,{once:!0}),e&&e("drag-end",u.value)})}const c=()=>{let f=0,a=0;const{left:d,top:p,height:y,width:i,angle:g}=u.value,k=(o.value.parentElement||document.body).getBoundingClientRect();if(g&&n.scaleRatio===1){const A=o.value.getBoundingClientRect();f=Math.abs(A.left-(d+k.left)),a=Math.abs(A.top-(p+k.top))}const D=k.width/n.scaleRatio-i,E=k.height/n.scaleRatio-y;return[f,D-f,a,E-a,k.width,k.height]},v=(f,a,d,p,y,i)=>(f=f<d?d:f,f=f>p?p:f,a=a<y?y:a,a=a>i?i:a,[f,a]),w=()=>{const f=o.value.parentElement||document.body,a=Array.from(f.children).filter(d=>d!==o.value&&d.classList.contains("es-drager"));for(let d=0;d<a.length;d++){const p=a[d];if(Oe(o.value,p))return!0}},r=()=>{s.value=!1},X=f=>{if(t.value)return;let{left:a,top:d}=u.value;if(["ArrowRight","ArrowLeft"].includes(f.key)){const p=f.key==="ArrowRight";let y=p?1:-1;n.snapToGrid&&(y=p?n.gridX:-n.gridX),a=a+y}else if(["ArrowUp","ArrowDown"].includes(f.key)){const p=f.key==="ArrowDown";let y=p?1:-1;n.snapToGrid&&(y=p?n.gridY:-n.gridY),d=d+y}if(n.boundary){const[p,y,i,g]=c();[a,d]=v(a,d,p,y,i,g)}u.value.left=a,u.value.top=d};return Ye(()=>{if(o.value){if(!u.value.width&&!u.value.height){const{width:f,height:a}=o.value.getBoundingClientRect();u.value={...u.value,width:f||100,height:a||100},e("change",{...u.value})}o.value.addEventListener("mousedown",h),o.value.addEventListener("touchstart",h,{passive:!0})}}),J(s,f=>{n.disabledKeyEvent||(f?document.addEventListener("keydown",X):document.removeEventListener("keydown",X))}),Le(()=>{document.removeEventListener("keydown",X)}),{isMousedown:t,selected:s,dragData:u,getBoundary:c,checkDragerCollision:w}}const je=O("div",{class:"es-drager-rotate-handle"},[O("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[O("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),qe=he({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=N(null),s=K({get:()=>e.modelValue,set:l=>{n("update:modelValue",l)}});function u(l){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");l.stopPropagation();const{width:h,height:c,left:v,top:w}=e.element.getBoundingClientRect(),r=v+h/2,X=w+c/2;n("rotate-start",s.value),H(f=>{const{clientX:a,clientY:d}=S(f),p=r-a,y=X-d,g=Math.atan2(y,p)*180/Math.PI-90;s.value=(g+360)%360,n("rotate",s.value)},()=>{n("rotate-end",s.value)})}return(l,h)=>(T(),Q("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:u,onTouchstartPassive:u},[F(l.$slots,"default",{},()=>[je])],544))}});const Je=["data-side","onMousedown","onTouchstartPassive"],Qe=O("div",{class:"es-drager-dot-handle"},null,-1),fe=he({__name:"drager",props:Te,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=(i,...g)=>{n(i,...g),n("change",...g)},s=N(null),{selected:u,dragData:l,isMousedown:h,getBoundary:c,checkDragerCollision:v}=Ue(s,e,t),w=N(de(0,e.resizeList)),r=K(()=>e.resizable&&!e.disabled),X=K(()=>e.rotatable&&!e.disabled&&u.value),f=K(()=>{const{width:i,height:g,left:m,top:k,angle:D}=l.value,E={};return i&&(E.width=G(i)),g&&(E.height=G(g)),{...E,left:G(m),top:G(k),zIndex:e.zIndex,transform:`rotate(${D}deg)`,"--es-drager-color":e.color}});function a(i){s.value||(s.value=i.$el||i)}function d(i){w.value=de(i,e.resizeList),t("rotate-end",l.value)}function p(i,g){g.stopPropagation();const{clientX:m,clientY:k}=S(g),D=m,E=k,{width:A,height:Y,left:L,top:R}=l.value,P=L+A/2,I=R+Y/2,z={width:A,height:Y,centerX:P,centerY:I,rotateAngle:l.value.angle},j=i.side,{minWidth:ge,minHeight:ve,aspectRatio:ee,equalProportion:pe}=e;t("resize-start",l.value);let te=[];e.boundary&&(te=c()),H(ne=>{const{clientX:me,clientY:we}=S(ne);let $=(me-D)/e.scaleRatio,V=(we-E)/e.scaleRatio;e.snapToGrid&&($=U($,e.gridX),V=U(V,e.gridY));const ye=Math.atan2(V,$),oe=Ve($,V),be=ne.shiftKey,se=ye-W(z.rotateAngle),Me=oe*Math.cos(se),ke=oe*Math.sin(se),De=(pe||be)&&!ee?z.width/z.height:ee,{position:{centerX:ae,centerY:ie},size:{width:Ae,height:Ee}}=Ge(j,{...z,rotateAngle:z.rotateAngle},Me,ke,De,ge,ve),Xe=Ke({centerX:ae,centerY:ie,width:Ae,height:Ee,angle:l.value.angle});let B={...l.value,...Fe(Xe,ae,ie)};e.maxWidth>0&&(B.width=Math.min(B.width,e.maxWidth)),e.maxHeight>0&&(B.height=Math.min(B.height,e.maxHeight)),e.boundary&&(B=y(B,te)),l.value=B,t("resize",l.value)},()=>{e.checkCollision&&v()&&(l.value={...l.value,width:A,height:Y,left:L,top:R}),t("resize-end",l.value)})}function y(i,g){const[m,k,D,E,A,Y]=g;return i.left<m&&(i.left=m,i.width=l.value.width),i.left+i.width>A&&(i.left=l.value.left,i.width=A-i.left),i.top<D&&(i.top=D,i.height=l.value.height),i.top+i.height>Y&&(i.top=l.value.top,i.height=Y-i.top),i}return J(()=>[e.width,e.height,e.left,e.top,e.angle],([i,g,m,k,D])=>{l.value={...l.value,width:i,height:g,left:m,top:k,angle:D}}),J(()=>e.selected,i=>{u.value=i},{immediate:!0}),(i,g)=>(T(),re(Be(i.tag),{ref:a,class:Re(["es-drager",{disabled:i.disabled,dragging:x(h),selected:x(u),border:i.border}]),style:ce(f.value),onClick:g[3]||(g[3]=ze(()=>{},["stop"]))},{default:le(()=>[F(i.$slots,"default"),r.value?(T(!0),Q(Ne,{key:0},xe(w.value,(m,k)=>(T(),Q("div",{key:k,class:"es-drager-dot","data-side":m.side,style:ce({...m}),onMousedown:D=>p(m,D),onTouchstartPassive:D=>p(m,D)},[F(i.$slots,"resize",Ce(_e({side:m.side})),()=>[Qe])],44,Je))),128)):ue("",!0),X.value?(T(),re(qe,{key:1,modelValue:x(l).angle,"onUpdate:modelValue":g[0]||(g[0]=m=>x(l).angle=m),element:s.value,onRotate:g[1]||(g[1]=m=>t("rotate",x(l))),onRotateStart:g[2]||(g[2]=m=>t("rotate-start",x(l))),onRotateEnd:d},{default:le(()=>[F(i.$slots,"rotate")]),_:3},8,["modelValue","element"])):ue("",!0)]),_:3},8,["class","style"]))}});const Ze=o=>{o.component("es-drager",fe)};fe.install=Ze;export{fe as _};
