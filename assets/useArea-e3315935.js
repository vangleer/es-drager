import{r as L,eD as ke,eQ as Q,eG as Le,d as W,g as T,o as S,c as O,eR as U,h as F,b as ue,w as de,eT as xe,u as z,n as Z,eM as Re,eI as De,a as Be,eJ as ze,eK as Ce,F as Ne,eS as he,i as Se,f8 as Te,_ as Ie}from"./index-fbbac7a1.js";const Pe={tag:{type:[String,Object],default:"div"},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!1},boundary:{type:Boolean},disabled:Boolean,width:{type:Number,default:0},height:{type:Number,default:0},left:{type:Number,default:0},top:{type:Number,default:0},zIndex:{type:Number,default:0},angle:{type:Number,default:0},color:{type:String,default:"#3a7afe"},minWidth:{type:Number,default:-1/0},minHeight:{type:Number,default:-1/0},maxWidth:{type:Number,default:0},maxHeight:{type:Number,default:0},aspectRatio:{type:Number},selected:Boolean,snapToGrid:Boolean,gridX:{type:Number,default:50},gridY:{type:Number,default:50},scaleRatio:{type:Number,default:1},disabledKeyEvent:Boolean,border:{type:Boolean,default:!0},resizeList:{type:Array},equalProportion:{type:Boolean},checkCollision:{type:Boolean}};function ee(o,n){const e=t=>{n&&n(t),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e),document.removeEventListener("mouseleave",e),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",e)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",e),document.addEventListener("mouseleave",e),document.addEventListener("touchmove",o),document.addEventListener("touchend",e)}function I(o){let n=0,e=0;if($e(o)){const t=o.targetTouches[0];n=t.pageX,e=t.pageY}else n=o.clientX,e=o.clientY;return{clientX:n,clientY:e}}function $e(o){const n=Object.prototype.toString.call(o);return n.substring(8,n.length-1)==="TouchEvent"}const K=(o=0)=>parseInt(o+"")+"px",J={n:"top",s:"bottom",e:"right",w:"left",ne:"top-right",nw:"top-left",se:"bottom-right",sw:"bottom-left"},H=["n","ne","e","se","s","sw","w","nw"],Ve={n:0,ne:1,e:2,se:3,s:4,sw:5,w:6,nw:7},Ge={0:0,1:1,2:2,3:2,4:3,5:4,6:4,7:5,8:6,9:6,10:7,11:8},Ke=(o,n)=>{const e=Ge[Math.floor(o/30)],s=(Ve[n]+e)%8;return H[s]},fe=(o=0,n)=>{let e=[];for(let t=0;t<H.length;t++){const s=H[t],[d,a]=J[s].split("-"),u=Ke(o,s),l={[d]:"0%",cursor:u+"-resize",side:J[s]};if(a)l[a]="0%";else{const v=["top","bottom"].includes(d)?"left":"top";l[v]="50%"}n?n.includes(J[s])&&e.push(l):e.push(l)}return e},te=o=>o*Math.PI/180,Ue=(o,n)=>Math.sqrt(o*o+n*n),M=o=>Math.cos(te(o)),_=o=>Math.sin(te(o)),Fe=(o,n,e,t,s,d,a)=>{let{width:u,height:l,centerX:v,centerY:p,rotateAngle:c}=n;const X=u<0?-1:1,f=l<0?-1:1;switch(u=Math.abs(u),l=Math.abs(l),o){case"right":{const r=N(u,e,d);u=r.width,e=r.deltaW,s?(t=e/s,l=u/s,v+=e/2*M(c)-t/2*_(c),p+=e/2*_(c)+t/2*M(c)):(v+=e/2*M(c),p+=e/2*_(c));break}case"top-right":{t=-t;const r=N(u,e,d);u=r.width,e=r.deltaW;const h=C(l,t,a);l=h.height,t=h.deltaH,s&&(e=t*s,u=l*s),v+=e/2*M(c)+t/2*_(c),p+=e/2*_(c)-t/2*M(c);break}case"bottom-right":{const r=N(u,e,d);u=r.width,e=r.deltaW;const h=C(l,t,a);l=h.height,t=h.deltaH,s&&(e=t*s,u=l*s),v+=e/2*M(c)-t/2*_(c),p+=e/2*_(c)+t/2*M(c);break}case"bottom":{const r=C(l,t,a);l=r.height,t=r.deltaH,s?(e=t*s,u=l*s,v+=e/2*M(c)-t/2*_(c),p+=e/2*_(c)+t/2*M(c)):(v-=t/2*_(c),p+=t/2*M(c));break}case"bottom-left":{e=-e;const r=N(u,e,d);u=r.width,e=r.deltaW;const h=C(l,t,a);l=h.height,t=h.deltaH,s&&(l=u/s,t=e/s),v-=e/2*M(c)+t/2*_(c),p-=e/2*_(c)-t/2*M(c);break}case"left":{e=-e;const r=N(u,e,d);u=r.width,e=r.deltaW,s?(l=u/s,t=e/s,v-=e/2*M(c)+t/2*_(c),p-=e/2*_(c)-t/2*M(c)):(v-=e/2*M(c),p-=e/2*_(c));break}case"top-left":{e=-e,t=-t;const r=N(u,e,d);u=r.width,e=r.deltaW;const h=C(l,t,a);l=h.height,t=h.deltaH,s&&(u=l*s,e=t*s),v-=e/2*M(c)-t/2*_(c),p-=e/2*_(c)+t/2*M(c);break}case"top":{t=-t;const r=C(l,t,a);l=r.height,t=r.deltaH,s?(u=l*s,e=t*s,v+=e/2*M(c)+t/2*_(c),p+=e/2*_(c)-t/2*M(c)):(v+=t/2*_(c),p-=t/2*M(c));break}}return{position:{centerX:v,centerY:p},size:{width:u*X,height:l*f}}},C=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{height:o,deltaH:n}},N=(o,n,e)=>{const t=o+n;return t>e?o=t:(n=e-o,o=e),{width:o,deltaW:n}},Oe=({centerX:o,centerY:n,width:e,height:t,angle:s})=>({top:n-t/2,left:o-e/2,width:e,height:t,angle:s}),je=(o,n,e)=>{const{width:t,height:s}=o;return{width:Math.abs(t),height:Math.abs(s),left:n-Math.abs(t)/2,top:e-Math.abs(s)/2}};function j(o,n){const e=Math.abs(o)%n,t=o>0?n:-n;let s=0;return e>n/2?s=t*Math.ceil(Math.abs(o)/n):s=t*Math.floor(Math.abs(o)/n),s}function qe(o,n){if(!o||!n)return!1;const e=o.getBoundingClientRect(),t=n.getBoundingClientRect();return e.left<t.left+t.width&&e.left+e.width>t.left&&e.top<t.top+t.height&&e.top+e.height>t.top}function Je(o,n,e){const t=L(!1),s=L(!1),d=L({width:n.width,height:n.height,left:n.left,top:n.top,angle:n.angle}),a=new Set;function u(f){if(a.add(f.button),n.disabled)return;t.value=!0,s.value=!0;let{clientX:r,clientY:h}=I(f);const{left:w,top:b}=d.value;let i=0,g=0,m=0,y=0;n.boundary&&([i,g,m,y]=l()),e&&e("drag-start",d.value),ee(E=>{if(a.size>1)return;const{clientX:k,clientY:x}=I(E);let Y=(k-r)/n.scaleRatio+w,R=(x-h)/n.scaleRatio+b;if(n.snapToGrid){let{left:P,top:$}=d.value;const D=Y-P,q=R-$;Y=P+j(D,n.gridX),R=$+j(q,n.gridY)}n.boundary&&([Y,R]=v(Y,R,i,g,m,y)),d.value.left=Y,d.value.top=R,e&&e("drag",d.value)},E=>{n.checkCollision&&p()&&(d.value.top=b,d.value.left=w),a.clear(),t.value=!1,document.addEventListener("click",c,{once:!0}),e&&e("drag-end",d.value)})}const l=()=>{let f=0,r=0;const{left:h,top:w,height:b,width:i,angle:g}=d.value,y=(o.value.parentElement||document.body).getBoundingClientRect();if(g&&n.scaleRatio===1){const k=o.value.getBoundingClientRect();f=Math.abs(k.left-(h+y.left)),r=Math.abs(k.top-(w+y.top))}const A=y.width/n.scaleRatio-i,E=y.height/n.scaleRatio-b;return[f,A-f,r,E-r,y.width/n.scaleRatio,y.height/n.scaleRatio]},v=(f,r,h,w,b,i)=>(f=f<h?h:f,f=f>w?w:f,r=r<b?b:r,r=r>i?i:r,[f,r]),p=()=>{const f=o.value.parentElement||document.body,r=Array.from(f.children).filter(h=>h!==o.value&&h.classList.contains("es-drager"));for(let h=0;h<r.length;h++){const w=r[h];if(qe(o.value,w))return!0}},c=()=>{s.value=!1},X=f=>{if(t.value)return;let{left:r,top:h}=d.value;if(["ArrowRight","ArrowLeft"].includes(f.key)){const w=f.key==="ArrowRight";let b=w?1:-1;n.snapToGrid&&(b=w?n.gridX:-n.gridX),r=r+b}else if(["ArrowUp","ArrowDown"].includes(f.key)){const w=f.key==="ArrowDown";let b=w?1:-1;n.snapToGrid&&(b=w?n.gridY:-n.gridY),h=h+b}if(n.boundary){const[w,b,i,g]=l();[r,h]=v(r,h,w,b,i,g)}d.value.left=r,d.value.top=h,e("change",{...d.value})};return ke(()=>{if(o.value){if(!d.value.width&&!d.value.height){const{width:f,height:r}=o.value.getBoundingClientRect();d.value={...d.value,width:f||100,height:r||100},e("change",{...d.value})}o.value.addEventListener("mousedown",u),o.value.addEventListener("touchstart",u,{passive:!0})}}),Q(s,f=>{n.disabledKeyEvent||(f?document.addEventListener("keydown",X):document.removeEventListener("keydown",X))}),Le(()=>{document.removeEventListener("keydown",X)}),{isMousedown:t,selected:s,dragData:d,getBoundary:l,checkDragerCollision:p}}const Qe=F("div",{class:"es-drager-rotate-handle"},[F("svg",{viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[F("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})])],-1),Ze=W({__name:"rotate",props:{modelValue:{type:Number,default:0},element:{type:Object}},emits:["update:modelValue","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=L(null),s=T({get:()=>e.modelValue,set:a=>{n("update:modelValue",a)}});function d(a){if(!e.element)return console.warn("[es-drager] rotate component need drag element property");a.stopPropagation();const{width:u,height:l,left:v,top:p}=e.element.getBoundingClientRect(),c=v+u/2,X=p+l/2;n("rotate-start",s.value),ee(f=>{const{clientX:r,clientY:h}=I(f),w=c-r,b=X-h,g=Math.atan2(b,w)*180/Math.PI-90;s.value=(g+360)%360,n("rotate",s.value)},()=>{n("rotate-end",s.value)})}return(a,u)=>(S(),O("div",{ref_key:"rotateRef",ref:t,class:"es-drager-rotate",onMousedown:d,onTouchstartPassive:d},[U(a.$slots,"default",{},()=>[Qe])],544))}});const He=["data-side","onMousedown","onTouchstartPassive"],We=F("div",{class:"es-drager-dot-handle"},null,-1),ge=W({__name:"drager",props:Pe,emits:["change","drag","drag-start","drag-end","resize","resize-start","resize-end","rotate","rotate-start","rotate-end"],setup(o,{emit:n}){const e=o,t=(i,...g)=>{n(i,...g),n("change",...g)},s=L(null),{selected:d,dragData:a,isMousedown:u,getBoundary:l,checkDragerCollision:v}=Je(s,e,t),p=L(fe(0,e.resizeList)),c=T(()=>e.resizable&&!e.disabled),X=T(()=>e.rotatable&&!e.disabled&&d.value),f=T(()=>{const{width:i,height:g,left:m,top:y,angle:A}=a.value,E={};return i&&(E.width=K(i)),g&&(E.height=K(g)),{...E,left:K(m),top:K(y),zIndex:e.zIndex,transform:`rotate(${A}deg)`,"--es-drager-color":e.color}});function r(i){s.value||(s.value=i.$el||i)}function h(i){p.value=fe(i,e.resizeList),t("rotate-end",a.value)}function w(i,g){if(e.disabled)return;g.stopPropagation();const{clientX:m,clientY:y}=I(g),A=m,E=y,{width:k,height:x,left:Y,top:R}=a.value,P=Y+k/2,$=R+x/2,D={width:k,height:x,centerX:P,centerY:$,rotateAngle:a.value.angle},q=i.side,{minWidth:ve,minHeight:pe,aspectRatio:ne,equalProportion:me}=e;t("resize-start",a.value);let oe=[];e.boundary&&(oe=l()),ee(se=>{const{clientX:we,clientY:ye}=I(se);let V=(we-A)/e.scaleRatio,G=(ye-E)/e.scaleRatio;e.snapToGrid&&(V=j(V,e.gridX),G=j(G,e.gridY));const be=Math.atan2(G,V),ae=Ue(V,G),Me=se.shiftKey,ie=be-te(D.rotateAngle),_e=ae*Math.cos(ie),Ae=ae*Math.sin(ie),le=(me||Me)&&!ne?D.width/D.height:ne,{position:{centerX:re,centerY:ce},size:{width:Ee,height:Xe}}=Fe(q,{...D,rotateAngle:D.rotateAngle},_e,Ae,le,ve,pe),Ye=Oe({centerX:re,centerY:ce,width:Ee,height:Xe,angle:a.value.angle});let B={...a.value,...je(Ye,re,ce)};e.maxWidth>0&&(B.width=Math.min(B.width,e.maxWidth)),e.maxHeight>0&&(B.height=Math.min(B.height,e.maxHeight)),e.boundary&&(B=b(B,oe,le)),a.value=B,t("resize",a.value)},()=>{e.checkCollision&&v()&&(a.value={...a.value,width:k,height:x,left:Y,top:R}),t("resize-end",a.value)})}function b(i,g,m){const[y,A,E,k,x,Y]=g;return i.left<y&&(i.left=y,i.width=a.value.width,m&&(i.height=a.value.height)),i.left+i.width>x&&(i.left=a.value.left,i.width=x-i.left,m&&(i.height=a.value.height)),i.top<E&&(i.top=E,i.height=a.value.height,m&&(i.width=a.value.width)),i.top+i.height>Y&&(i.top=a.value.top,i.height=Y-i.top,m&&(i.width=a.value.width)),i}return Q(()=>[e.width,e.height,e.left,e.top,e.angle],([i,g,m,y,A])=>{a.value={...a.value,width:i,height:g,left:m,top:y,angle:A}}),Q(()=>e.selected,i=>{d.value=i},{immediate:!0}),(i,g)=>(S(),ue(De(i.tag),{ref:r,class:xe(["es-drager",{disabled:i.disabled,dragging:z(u),selected:z(d),border:i.border}]),style:Z(f.value),onClick:g[3]||(g[3]=Re(()=>{},["stop"]))},{default:de(()=>[U(i.$slots,"default"),c.value?(S(!0),O(Ne,{key:0},Be(p.value,(m,y)=>(S(),O("div",{key:y,class:"es-drager-dot","data-side":m.side,style:Z({...m}),onMousedown:A=>w(m,A),onTouchstartPassive:A=>w(m,A)},[U(i.$slots,"resize",ze(Ce({side:m.side})),()=>[We])],44,He))),128)):he("",!0),X.value?(S(),ue(Ze,{key:1,modelValue:z(a).angle,"onUpdate:modelValue":g[0]||(g[0]=m=>z(a).angle=m),element:s.value,onRotate:g[1]||(g[1]=m=>t("rotate",z(a))),onRotateStart:g[2]||(g[2]=m=>t("rotate-start",z(a))),onRotateEnd:h},{default:de(()=>[U(i.$slots,"rotate")]),_:3},8,["modelValue","element"])):he("",!0)]),_:3},8,["class","style"]))}});const et=o=>{o.component("es-drager",ge)};ge.install=et;const tt=W({__name:"Area",emits:["move","up"],setup(o,{expose:n,emit:e}){const t=L(!1),s=L({width:0,height:0,top:0,left:0}),d=T(()=>{const{width:u,height:l,top:v,left:p}=s.value;return{width:u+"px",height:l+"px",top:v+"px",left:p+"px"}});function a(u){const{pageX:l,pageY:v}=u,p=u.target.getBoundingClientRect(),c=l-p.left,X=v-p.top,f=h=>{const w=h.pageX-l,b=h.pageY-v;let i=c,g=X,m=Math.abs(w),y=Math.abs(b);(m>2||y>2)&&(t.value=!0),w<0&&(i=c-m),b<0&&(g=X-y),s.value={width:m,height:y,left:i,top:g},e("move",{...s.value})},r=()=>{document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",r),t.value=!1,s.value={width:0,height:0,top:0,left:0},e("up",s.value)};document.addEventListener("mousemove",f),document.addEventListener("mouseup",r)}return n({onMouseDown:a,areaData:s}),(u,l)=>Se((S(),O("div",{class:"es-editor-area",style:Z(d.value)},null,4)),[[Te,t.value]])}});const st=Ie(tt,[["__scopeId","data-v-136196f6"]]);function at(o,n){const e=L();function t(a){let u=!1;o.value.elements.forEach(l=>{l.selected&&(l.selected=!1,u=!0)}),u||n.value.onMouseDown(a)}function s(a){for(let u=0;u<o.value.elements.length;u++){const l=o.value.elements[u],v=a.left<l.left&&a.left+a.width>l.left+l.width,p=a.top<l.top&&a.top+a.height>l.top+l.height;v&&p?l.selected=!0:l.selected=!1}}function d(){e.value=o.value.elements.some(a=>a.selected),e.value&&setTimeout(()=>{document.addEventListener("click",()=>{e.value=!1},{once:!0})})}return{areaSelected:e,onEditorMouseDown:t,onAreaMove:s,onAreaUp:d}}export{st as A,ge as _,at as u};
